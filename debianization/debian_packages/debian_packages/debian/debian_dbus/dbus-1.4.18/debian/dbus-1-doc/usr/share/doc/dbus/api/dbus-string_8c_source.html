<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>D-Bus: dbus-string.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">D-Bus
   &#160;<span id="projectnumber">1.4.18</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">dbus-string.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* -*- mode: C; c-file-style: &quot;gnu&quot;; indent-tabs-mode: nil; -*- */</span>
<a name="l00002"></a>00002 <span class="comment">/* dbus-string.c String utility class (internal to D-Bus implementation)</span>
<a name="l00003"></a>00003 <span class="comment"> * </span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (C) 2002, 2003, 2004, 2005 Red Hat, Inc.</span>
<a name="l00005"></a>00005 <span class="comment"> * Copyright (C) 2006 Ralf Habacker &lt;ralf.habacker@freenet.de&gt;</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * Licensed under the Academic Free License version 2.1</span>
<a name="l00008"></a>00008 <span class="comment"> * </span>
<a name="l00009"></a>00009 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00010"></a>00010 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00011"></a>00011 <span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00012"></a>00012 <span class="comment"> * (at your option) any later version.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00015"></a>00015 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00016"></a>00016 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00017"></a>00017 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00018"></a>00018 <span class="comment"> * </span>
<a name="l00019"></a>00019 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00020"></a>00020 <span class="comment"> * along with this program; if not, write to the Free Software</span>
<a name="l00021"></a>00021 <span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> */</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;config.h&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;dbus-internals.h&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;dbus-string.h&quot;</span>
<a name="l00028"></a>00028 <span class="comment">/* we allow a system header here, for speed/convenience */</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00030"></a>00030 <span class="comment">/* for vsnprintf */</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#define DBUS_CAN_USE_DBUS_STRING_PRIVATE 1</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="preprocessor">#include &quot;dbus-string-private.h&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;dbus-marshal-basic.h&quot;</span> <span class="comment">/* probably should be removed by moving the usage of DBUS_TYPE</span>
<a name="l00035"></a>00035 <span class="comment">                                 * into the marshaling-related files</span>
<a name="l00036"></a>00036 <span class="comment">                                 */</span>
<a name="l00037"></a>00037 <span class="comment">/* for DBUS_VA_COPY */</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;dbus-sysdeps.h&quot;</span>
<a name="l00039"></a>00039 
<a name="l00078"></a>00078 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00079"></a>00079 fixup_alignment (<a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *real)
<a name="l00080"></a>00080 {
<a name="l00081"></a>00081   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *aligned;
<a name="l00082"></a>00082   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *real_block;
<a name="l00083"></a>00083   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> old_align_offset;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085   <span class="comment">/* we have to have extra space in real-&gt;allocated for the align offset and nul byte */</span>
<a name="l00086"></a>00086   _dbus_assert (real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> &lt;= real-&gt;<a class="code" href="structDBusRealString.html#ae12ec58c271e47f3f89fae1410b7c5e5" title="Allocated size of data.">allocated</a> - _DBUS_STRING_ALLOCATION_PADDING);
<a name="l00087"></a>00087   
<a name="l00088"></a>00088   old_align_offset = real-&gt;<a class="code" href="structDBusRealString.html#a21fb373a65e36646787392a3dfe62443" title="str - align_offset is the actual malloc block">align_offset</a>;
<a name="l00089"></a>00089   real_block = real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> - old_align_offset;
<a name="l00090"></a>00090   
<a name="l00091"></a>00091   aligned = _DBUS_ALIGN_ADDRESS (real_block, 8);
<a name="l00092"></a>00092 
<a name="l00093"></a>00093   real-&gt;<a class="code" href="structDBusRealString.html#a21fb373a65e36646787392a3dfe62443" title="str - align_offset is the actual malloc block">align_offset</a> = aligned - real_block;
<a name="l00094"></a>00094   real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> = aligned;
<a name="l00095"></a>00095   
<a name="l00096"></a>00096   <span class="keywordflow">if</span> (old_align_offset != real-&gt;<a class="code" href="structDBusRealString.html#a21fb373a65e36646787392a3dfe62443" title="str - align_offset is the actual malloc block">align_offset</a>)
<a name="l00097"></a>00097     {
<a name="l00098"></a>00098       <span class="comment">/* Here comes the suck */</span>
<a name="l00099"></a>00099       memmove (real_block + real-&gt;<a class="code" href="structDBusRealString.html#a21fb373a65e36646787392a3dfe62443" title="str - align_offset is the actual malloc block">align_offset</a>,
<a name="l00100"></a>00100                real_block + old_align_offset,
<a name="l00101"></a>00101                real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> + 1);
<a name="l00102"></a>00102     }
<a name="l00103"></a>00103 
<a name="l00104"></a>00104   _dbus_assert (real-&gt;<a class="code" href="structDBusRealString.html#a21fb373a65e36646787392a3dfe62443" title="str - align_offset is the actual malloc block">align_offset</a> &lt; 8);
<a name="l00105"></a>00105   _dbus_assert (_DBUS_ALIGN_ADDRESS (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>, 8) == real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>);
<a name="l00106"></a>00106 }
<a name="l00107"></a>00107 
<a name="l00108"></a>00108 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00109"></a>00109 undo_alignment (<a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *real)
<a name="l00110"></a>00110 {
<a name="l00111"></a>00111   <span class="keywordflow">if</span> (real-&gt;<a class="code" href="structDBusRealString.html#a21fb373a65e36646787392a3dfe62443" title="str - align_offset is the actual malloc block">align_offset</a> != 0)
<a name="l00112"></a>00112     {
<a name="l00113"></a>00113       memmove (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> - real-&gt;<a class="code" href="structDBusRealString.html#a21fb373a65e36646787392a3dfe62443" title="str - align_offset is the actual malloc block">align_offset</a>,
<a name="l00114"></a>00114                real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>,
<a name="l00115"></a>00115                real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> + 1);
<a name="l00116"></a>00116 
<a name="l00117"></a>00117       real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> = real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> - real-&gt;<a class="code" href="structDBusRealString.html#a21fb373a65e36646787392a3dfe62443" title="str - align_offset is the actual malloc block">align_offset</a>;
<a name="l00118"></a>00118       real-&gt;<a class="code" href="structDBusRealString.html#a21fb373a65e36646787392a3dfe62443" title="str - align_offset is the actual malloc block">align_offset</a> = 0;
<a name="l00119"></a>00119     }
<a name="l00120"></a>00120 }
<a name="l00121"></a>00121 
<a name="l00131"></a>00131 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l00132"></a><a class="code" href="group__DBusString.html#ga569b784beea1b4fa98f05d27e6dd0e72">00132</a> <a class="code" href="group__DBusString.html#ga569b784beea1b4fa98f05d27e6dd0e72" title="Initializes a string that can be up to the given allocation size before it has to realloc...">_dbus_string_init_preallocated</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00133"></a>00133                                 <span class="keywordtype">int</span>         allocate_size)
<a name="l00134"></a>00134 {
<a name="l00135"></a>00135   <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *real;
<a name="l00136"></a>00136   
<a name="l00137"></a>00137   _dbus_assert (str != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00138"></a>00138 
<a name="l00139"></a>00139   _dbus_assert (<span class="keyword">sizeof</span> (<a class="code" href="structDBusString.html">DBusString</a>) == <span class="keyword">sizeof</span> (<a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a>));
<a name="l00140"></a>00140   
<a name="l00141"></a>00141   real = (<a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a>*) str;
<a name="l00142"></a>00142 
<a name="l00143"></a>00143   <span class="comment">/* It&#39;s very important not to touch anything</span>
<a name="l00144"></a>00144 <span class="comment">   * other than real-&gt;str if we&#39;re going to fail,</span>
<a name="l00145"></a>00145 <span class="comment">   * since we also use this function to reset</span>
<a name="l00146"></a>00146 <span class="comment">   * an existing string, e.g. in _dbus_string_steal_data()</span>
<a name="l00147"></a>00147 <span class="comment">   */</span>
<a name="l00148"></a>00148   
<a name="l00149"></a>00149   real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> = <a class="code" href="group__DBusMemory.html#gaf6e588659067a854c3cca7ebe8ae5084" title="Allocates the given number of bytes, as with standard malloc().">dbus_malloc</a> (_DBUS_STRING_ALLOCATION_PADDING + allocate_size);
<a name="l00150"></a>00150   <span class="keywordflow">if</span> (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> == <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>)
<a name="l00151"></a>00151     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;  
<a name="l00152"></a>00152   
<a name="l00153"></a>00153   real-&gt;<a class="code" href="structDBusRealString.html#ae12ec58c271e47f3f89fae1410b7c5e5" title="Allocated size of data.">allocated</a> = _DBUS_STRING_ALLOCATION_PADDING + allocate_size;
<a name="l00154"></a>00154   real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> = 0;
<a name="l00155"></a>00155   real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>[real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00156"></a>00156   
<a name="l00157"></a>00157   real-&gt;<a class="code" href="structDBusRealString.html#aeb48dcb099660ffc277883166fa72159" title="Max length of this string, without nul byte.">max_length</a> = <a class="code" href="group__DBusStringInternals.html#gaff1c3814294a9db8ea968d159e8fd092" title="This is the maximum max length (and thus also the maximum length) of a DBusString.">_DBUS_STRING_MAX_MAX_LENGTH</a>;
<a name="l00158"></a>00158   real-&gt;<a class="code" href="structDBusRealString.html#a79675cfbe443cc779e3c668fbcb99578" title="String data is not owned by DBusString.">constant</a> = <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00159"></a>00159   real-&gt;<a class="code" href="structDBusRealString.html#a865d892d7cacedd598b828c15c5815c5" title="DBusString has been locked and can&#39;t be changed.">locked</a> = <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00160"></a>00160   real-&gt;<a class="code" href="structDBusRealString.html#a062f6b092cc6c4baf01f2a820e2ba5ad" title="DBusString is invalid (e.g.">invalid</a> = <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00161"></a>00161   real-&gt;<a class="code" href="structDBusRealString.html#a21fb373a65e36646787392a3dfe62443" title="str - align_offset is the actual malloc block">align_offset</a> = 0;
<a name="l00162"></a>00162   
<a name="l00163"></a>00163   fixup_alignment (real);
<a name="l00164"></a>00164   
<a name="l00165"></a>00165   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00166"></a>00166 }
<a name="l00167"></a>00167 
<a name="l00175"></a>00175 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l00176"></a><a class="code" href="group__DBusString.html#ga348252317f7bb8ac43529972945830ae">00176</a> <a class="code" href="group__DBusString.html#ga348252317f7bb8ac43529972945830ae" title="Initializes a string.">_dbus_string_init</a> (<a class="code" href="structDBusString.html">DBusString</a> *str)
<a name="l00177"></a>00177 {
<a name="l00178"></a>00178   <span class="keywordflow">return</span> <a class="code" href="group__DBusString.html#ga569b784beea1b4fa98f05d27e6dd0e72" title="Initializes a string that can be up to the given allocation size before it has to realloc...">_dbus_string_init_preallocated</a> (str, 0);
<a name="l00179"></a>00179 }
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l00182"></a>00182 <span class="preprocessor"></span><span class="comment">/* The max length thing is sort of a historical artifact</span>
<a name="l00183"></a>00183 <span class="comment"> * from a feature that turned out to be dumb; perhaps</span>
<a name="l00184"></a>00184 <span class="comment"> * we should purge it entirely. The problem with</span>
<a name="l00185"></a>00185 <span class="comment"> * the feature is that it looks like memory allocation</span>
<a name="l00186"></a>00186 <span class="comment"> * failure, but is not a transient or resolvable failure.</span>
<a name="l00187"></a>00187 <span class="comment"> */</span>
<a name="l00188"></a>00188 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00189"></a>00189 set_max_length (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00190"></a>00190                 <span class="keywordtype">int</span>         max_length)
<a name="l00191"></a>00191 {
<a name="l00192"></a>00192   <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *real;
<a name="l00193"></a>00193   
<a name="l00194"></a>00194   real = (<a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a>*) str;
<a name="l00195"></a>00195 
<a name="l00196"></a>00196   real-&gt;<a class="code" href="structDBusRealString.html#aeb48dcb099660ffc277883166fa72159" title="Max length of this string, without nul byte.">max_length</a> = max_length;
<a name="l00197"></a>00197 }
<a name="l00198"></a>00198 <span class="preprocessor">#endif </span><span class="comment">/* DBUS_BUILD_TESTS */</span>
<a name="l00199"></a>00199 
<a name="l00209"></a>00209 <span class="keywordtype">void</span>
<a name="l00210"></a><a class="code" href="group__DBusString.html#ga374640ddfa2f0b27a8356e2379ba8043">00210</a> <a class="code" href="group__DBusString.html#ga374640ddfa2f0b27a8356e2379ba8043" title="Initializes a constant string.">_dbus_string_init_const</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00211"></a>00211                          <span class="keyword">const</span> <span class="keywordtype">char</span> *value)
<a name="l00212"></a>00212 {
<a name="l00213"></a>00213   _dbus_assert (value != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00214"></a>00214   
<a name="l00215"></a>00215   <a class="code" href="group__DBusString.html#ga6792a5c1725faa9d635d95f7a3b5bfae" title="Initializes a constant string with a length.">_dbus_string_init_const_len</a> (str, value,
<a name="l00216"></a>00216                                strlen (value));
<a name="l00217"></a>00217 }
<a name="l00218"></a>00218 
<a name="l00229"></a>00229 <span class="keywordtype">void</span>
<a name="l00230"></a><a class="code" href="group__DBusString.html#ga6792a5c1725faa9d635d95f7a3b5bfae">00230</a> <a class="code" href="group__DBusString.html#ga6792a5c1725faa9d635d95f7a3b5bfae" title="Initializes a constant string with a length.">_dbus_string_init_const_len</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00231"></a>00231                              <span class="keyword">const</span> <span class="keywordtype">char</span> *value,
<a name="l00232"></a>00232                              <span class="keywordtype">int</span>         len)
<a name="l00233"></a>00233 {
<a name="l00234"></a>00234   <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *real;
<a name="l00235"></a>00235   
<a name="l00236"></a>00236   _dbus_assert (str != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00237"></a>00237   _dbus_assert (len == 0 || value != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00238"></a>00238   _dbus_assert (len &lt;= <a class="code" href="group__DBusStringInternals.html#gaff1c3814294a9db8ea968d159e8fd092" title="This is the maximum max length (and thus also the maximum length) of a DBusString.">_DBUS_STRING_MAX_MAX_LENGTH</a>);
<a name="l00239"></a>00239   _dbus_assert (len &gt;= 0);
<a name="l00240"></a>00240   
<a name="l00241"></a>00241   real = (<a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a>*) str;
<a name="l00242"></a>00242   
<a name="l00243"></a>00243   real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) value;
<a name="l00244"></a>00244   real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> = len;
<a name="l00245"></a>00245   real-&gt;<a class="code" href="structDBusRealString.html#ae12ec58c271e47f3f89fae1410b7c5e5" title="Allocated size of data.">allocated</a> = real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> + _DBUS_STRING_ALLOCATION_PADDING; <span class="comment">/* a lie, just to avoid special-case assertions... */</span>
<a name="l00246"></a>00246   real-&gt;<a class="code" href="structDBusRealString.html#aeb48dcb099660ffc277883166fa72159" title="Max length of this string, without nul byte.">max_length</a> = real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> + 1;
<a name="l00247"></a>00247   real-&gt;<a class="code" href="structDBusRealString.html#a79675cfbe443cc779e3c668fbcb99578" title="String data is not owned by DBusString.">constant</a> = <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00248"></a>00248   real-&gt;<a class="code" href="structDBusRealString.html#a865d892d7cacedd598b828c15c5815c5" title="DBusString has been locked and can&#39;t be changed.">locked</a> = <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00249"></a>00249   real-&gt;<a class="code" href="structDBusRealString.html#a062f6b092cc6c4baf01f2a820e2ba5ad" title="DBusString is invalid (e.g.">invalid</a> = <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00250"></a>00250   real-&gt;<a class="code" href="structDBusRealString.html#a21fb373a65e36646787392a3dfe62443" title="str - align_offset is the actual malloc block">align_offset</a> = 0;
<a name="l00251"></a>00251 
<a name="l00252"></a>00252   <span class="comment">/* We don&#39;t require const strings to be 8-byte aligned as the</span>
<a name="l00253"></a>00253 <span class="comment">   * memory is coming from elsewhere.</span>
<a name="l00254"></a>00254 <span class="comment">   */</span>
<a name="l00255"></a>00255 }
<a name="l00256"></a>00256 
<a name="l00262"></a>00262 <span class="keywordtype">void</span>
<a name="l00263"></a><a class="code" href="group__DBusString.html#ga781ca91acda49a834dce7d0ed0eef212">00263</a> <a class="code" href="group__DBusString.html#ga781ca91acda49a834dce7d0ed0eef212" title="Frees a string created by _dbus_string_init().">_dbus_string_free</a> (<a class="code" href="structDBusString.html">DBusString</a> *str)
<a name="l00264"></a>00264 {
<a name="l00265"></a>00265   <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *real = (<a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a>*) str;
<a name="l00266"></a>00266   <a class="code" href="group__DBusStringInternals.html#ga862cb88a139179981e1fcd5643165b56" title="Checks a bunch of assertions about a string object.">DBUS_GENERIC_STRING_PREAMBLE</a> (real);
<a name="l00267"></a>00267   
<a name="l00268"></a>00268   <span class="keywordflow">if</span> (real-&gt;<a class="code" href="structDBusRealString.html#a79675cfbe443cc779e3c668fbcb99578" title="String data is not owned by DBusString.">constant</a>)
<a name="l00269"></a>00269     <span class="keywordflow">return</span>;
<a name="l00270"></a>00270   <a class="code" href="group__DBusMemory.html#ga34e666b19b015035a9a31e53da84b39a" title="Frees a block of memory previously allocated by dbus_malloc() or dbus_malloc0().">dbus_free</a> (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> - real-&gt;<a class="code" href="structDBusRealString.html#a21fb373a65e36646787392a3dfe62443" title="str - align_offset is the actual malloc block">align_offset</a>);
<a name="l00271"></a>00271 
<a name="l00272"></a>00272   real-&gt;<a class="code" href="structDBusRealString.html#a062f6b092cc6c4baf01f2a820e2ba5ad" title="DBusString is invalid (e.g.">invalid</a> = <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00273"></a>00273 }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 <span class="keyword">static</span> <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l00276"></a>00276 compact (<a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *real,
<a name="l00277"></a>00277          <span class="keywordtype">int</span>             max_waste)
<a name="l00278"></a>00278 {
<a name="l00279"></a>00279   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *new_str;
<a name="l00280"></a>00280   <span class="keywordtype">int</span> new_allocated;
<a name="l00281"></a>00281   <span class="keywordtype">int</span> waste;
<a name="l00282"></a>00282 
<a name="l00283"></a>00283   waste = real-&gt;<a class="code" href="structDBusRealString.html#ae12ec58c271e47f3f89fae1410b7c5e5" title="Allocated size of data.">allocated</a> - (real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> + _DBUS_STRING_ALLOCATION_PADDING);
<a name="l00284"></a>00284 
<a name="l00285"></a>00285   <span class="keywordflow">if</span> (waste &lt;= max_waste)
<a name="l00286"></a>00286     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00287"></a>00287 
<a name="l00288"></a>00288   new_allocated = real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> + _DBUS_STRING_ALLOCATION_PADDING;
<a name="l00289"></a>00289 
<a name="l00290"></a>00290   new_str = <a class="code" href="group__DBusMemory.html#ga2d505f2960ccf343042d363170b27f9c" title="Resizes a block of memory previously allocated by dbus_malloc() or dbus_malloc0().">dbus_realloc</a> (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> - real-&gt;<a class="code" href="structDBusRealString.html#a21fb373a65e36646787392a3dfe62443" title="str - align_offset is the actual malloc block">align_offset</a>, new_allocated);
<a name="l00291"></a>00291   <span class="keywordflow">if</span> (_DBUS_UNLIKELY (new_str == <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>))
<a name="l00292"></a>00292     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00293"></a>00293 
<a name="l00294"></a>00294   real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> = new_str + real-&gt;<a class="code" href="structDBusRealString.html#a21fb373a65e36646787392a3dfe62443" title="str - align_offset is the actual malloc block">align_offset</a>;
<a name="l00295"></a>00295   real-&gt;<a class="code" href="structDBusRealString.html#ae12ec58c271e47f3f89fae1410b7c5e5" title="Allocated size of data.">allocated</a> = new_allocated;
<a name="l00296"></a>00296   fixup_alignment (real);
<a name="l00297"></a>00297 
<a name="l00298"></a>00298   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00299"></a>00299 }
<a name="l00300"></a>00300 
<a name="l00301"></a>00301 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l00302"></a>00302 <span class="preprocessor"></span><span class="comment">/* Not using this feature at the moment,</span>
<a name="l00303"></a>00303 <span class="comment"> * so marked DBUS_BUILD_TESTS-only</span>
<a name="l00304"></a>00304 <span class="comment"> */</span>
<a name="l00314"></a>00314 <span class="keywordtype">void</span>
<a name="l00315"></a>00315 _dbus_string_lock (<a class="code" href="structDBusString.html">DBusString</a> *str)
<a name="l00316"></a>00316 {  
<a name="l00317"></a>00317   <a class="code" href="group__DBusStringInternals.html#gad9f957c4027c34a5c330822aa98b9307" title="Checks assertions about a string object that may be locked but can&#39;t be const.">DBUS_LOCKED_STRING_PREAMBLE</a> (str); <span class="comment">/* can lock multiple times */</span>
<a name="l00318"></a>00318 
<a name="l00319"></a>00319   real-&gt;<a class="code" href="structDBusRealString.html#a865d892d7cacedd598b828c15c5815c5" title="DBusString has been locked and can&#39;t be changed.">locked</a> = <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00320"></a>00320 
<a name="l00321"></a>00321   <span class="comment">/* Try to realloc to avoid excess memory usage, since</span>
<a name="l00322"></a>00322 <span class="comment">   * we know we won&#39;t change the string further</span>
<a name="l00323"></a>00323 <span class="comment">   */</span>
<a name="l00324"></a>00324 <span class="preprocessor">#define MAX_WASTE 48</span>
<a name="l00325"></a>00325 <span class="preprocessor"></span>  compact (real, MAX_WASTE);
<a name="l00326"></a>00326 }
<a name="l00327"></a>00327 <span class="preprocessor">#endif </span><span class="comment">/* DBUS_BUILD_TESTS */</span>
<a name="l00328"></a>00328 
<a name="l00329"></a>00329 <span class="keyword">static</span> <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l00330"></a>00330 reallocate_for_length (<a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *real,
<a name="l00331"></a>00331                        <span class="keywordtype">int</span>             new_length)
<a name="l00332"></a>00332 {
<a name="l00333"></a>00333   <span class="keywordtype">int</span> new_allocated;
<a name="l00334"></a>00334   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *new_str;
<a name="l00335"></a>00335 
<a name="l00336"></a>00336   <span class="comment">/* at least double our old allocation to avoid O(n), avoiding</span>
<a name="l00337"></a>00337 <span class="comment">   * overflow</span>
<a name="l00338"></a>00338 <span class="comment">   */</span>
<a name="l00339"></a>00339   <span class="keywordflow">if</span> (real-&gt;<a class="code" href="structDBusRealString.html#ae12ec58c271e47f3f89fae1410b7c5e5" title="Allocated size of data.">allocated</a> &gt; (<a class="code" href="group__DBusStringInternals.html#gaff1c3814294a9db8ea968d159e8fd092" title="This is the maximum max length (and thus also the maximum length) of a DBusString.">_DBUS_STRING_MAX_MAX_LENGTH</a> + _DBUS_STRING_ALLOCATION_PADDING) / 2)
<a name="l00340"></a>00340     new_allocated = <a class="code" href="group__DBusStringInternals.html#gaff1c3814294a9db8ea968d159e8fd092" title="This is the maximum max length (and thus also the maximum length) of a DBusString.">_DBUS_STRING_MAX_MAX_LENGTH</a> + _DBUS_STRING_ALLOCATION_PADDING;
<a name="l00341"></a>00341   <span class="keywordflow">else</span>
<a name="l00342"></a>00342     new_allocated = real-&gt;<a class="code" href="structDBusRealString.html#ae12ec58c271e47f3f89fae1410b7c5e5" title="Allocated size of data.">allocated</a> * 2;
<a name="l00343"></a>00343 
<a name="l00344"></a>00344   <span class="comment">/* if you change the code just above here, run the tests without</span>
<a name="l00345"></a>00345 <span class="comment">   * the following assert-only hack before you commit</span>
<a name="l00346"></a>00346 <span class="comment">   */</span>
<a name="l00347"></a>00347   <span class="comment">/* This is keyed off asserts in addition to tests so when you</span>
<a name="l00348"></a>00348 <span class="comment">   * disable asserts to profile, you don&#39;t get this destroyer</span>
<a name="l00349"></a>00349 <span class="comment">   * of profiles.</span>
<a name="l00350"></a>00350 <span class="comment">   */</span>
<a name="l00351"></a>00351 <span class="preprocessor">#ifdef DBUS_DISABLE_ASSERT</span>
<a name="l00352"></a>00352 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00353"></a>00353 <span class="preprocessor"></span><span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l00354"></a>00354 <span class="preprocessor"></span>  new_allocated = 0; <span class="comment">/* ensure a realloc every time so that we go</span>
<a name="l00355"></a>00355 <span class="comment">                      * through all malloc failure codepaths</span>
<a name="l00356"></a>00356 <span class="comment">                      */</span>
<a name="l00357"></a>00357 <span class="preprocessor">#endif </span><span class="comment">/* DBUS_BUILD_TESTS */</span>
<a name="l00358"></a>00358 <span class="preprocessor">#endif </span><span class="comment">/* !DBUS_DISABLE_ASSERT */</span>
<a name="l00359"></a>00359 
<a name="l00360"></a>00360   <span class="comment">/* But be sure we always alloc at least space for the new length */</span>
<a name="l00361"></a>00361   new_allocated = MAX (new_allocated,
<a name="l00362"></a>00362                        new_length + _DBUS_STRING_ALLOCATION_PADDING);
<a name="l00363"></a>00363 
<a name="l00364"></a>00364   _dbus_assert (new_allocated &gt;= real-&gt;<a class="code" href="structDBusRealString.html#ae12ec58c271e47f3f89fae1410b7c5e5" title="Allocated size of data.">allocated</a>); <span class="comment">/* code relies on this */</span>
<a name="l00365"></a>00365   new_str = <a class="code" href="group__DBusMemory.html#ga2d505f2960ccf343042d363170b27f9c" title="Resizes a block of memory previously allocated by dbus_malloc() or dbus_malloc0().">dbus_realloc</a> (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> - real-&gt;<a class="code" href="structDBusRealString.html#a21fb373a65e36646787392a3dfe62443" title="str - align_offset is the actual malloc block">align_offset</a>, new_allocated);
<a name="l00366"></a>00366   <span class="keywordflow">if</span> (_DBUS_UNLIKELY (new_str == <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>))
<a name="l00367"></a>00367     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00368"></a>00368 
<a name="l00369"></a>00369   real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> = new_str + real-&gt;<a class="code" href="structDBusRealString.html#a21fb373a65e36646787392a3dfe62443" title="str - align_offset is the actual malloc block">align_offset</a>;
<a name="l00370"></a>00370   real-&gt;<a class="code" href="structDBusRealString.html#ae12ec58c271e47f3f89fae1410b7c5e5" title="Allocated size of data.">allocated</a> = new_allocated;
<a name="l00371"></a>00371   fixup_alignment (real);
<a name="l00372"></a>00372 
<a name="l00373"></a>00373   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00374"></a>00374 }
<a name="l00375"></a>00375 
<a name="l00387"></a>00387 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l00388"></a><a class="code" href="group__DBusString.html#gac49ec5782ca606029c096124b5e43ffc">00388</a> <a class="code" href="group__DBusString.html#gac49ec5782ca606029c096124b5e43ffc" title="Compacts the string to avoid wasted memory.">_dbus_string_compact</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00389"></a>00389                       <span class="keywordtype">int</span>         max_waste)
<a name="l00390"></a>00390 {
<a name="l00391"></a>00391   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00392"></a>00392 
<a name="l00393"></a>00393   <span class="keywordflow">return</span> compact (real, max_waste);
<a name="l00394"></a>00394 }
<a name="l00395"></a>00395 
<a name="l00396"></a>00396 <span class="keyword">static</span> <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l00397"></a>00397 set_length (<a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *real,
<a name="l00398"></a>00398             <span class="keywordtype">int</span>             new_length)
<a name="l00399"></a>00399 {
<a name="l00400"></a>00400   <span class="comment">/* Note, we are setting the length not including nul termination */</span>
<a name="l00401"></a>00401 
<a name="l00402"></a>00402   <span class="comment">/* exceeding max length is the same as failure to allocate memory */</span>
<a name="l00403"></a>00403   <span class="keywordflow">if</span> (_DBUS_UNLIKELY (new_length &gt; real-&gt;<a class="code" href="structDBusRealString.html#aeb48dcb099660ffc277883166fa72159" title="Max length of this string, without nul byte.">max_length</a>))
<a name="l00404"></a>00404     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00405"></a>00405   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (new_length &gt; (real-&gt;<a class="code" href="structDBusRealString.html#ae12ec58c271e47f3f89fae1410b7c5e5" title="Allocated size of data.">allocated</a> - _DBUS_STRING_ALLOCATION_PADDING) &amp;&amp;
<a name="l00406"></a>00406            _DBUS_UNLIKELY (!reallocate_for_length (real, new_length)))
<a name="l00407"></a>00407     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00408"></a>00408   <span class="keywordflow">else</span>
<a name="l00409"></a>00409     {
<a name="l00410"></a>00410       real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> = new_length;
<a name="l00411"></a>00411       real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>[new_length] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00412"></a>00412       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00413"></a>00413     }
<a name="l00414"></a>00414 }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416 <span class="keyword">static</span> <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l00417"></a>00417 open_gap (<span class="keywordtype">int</span>             len,
<a name="l00418"></a>00418           <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *dest,
<a name="l00419"></a>00419           <span class="keywordtype">int</span>             insert_at)
<a name="l00420"></a>00420 {
<a name="l00421"></a>00421   <span class="keywordflow">if</span> (len == 0)
<a name="l00422"></a>00422     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00423"></a>00423 
<a name="l00424"></a>00424   <span class="keywordflow">if</span> (len &gt; dest-&gt;<a class="code" href="structDBusRealString.html#aeb48dcb099660ffc277883166fa72159" title="Max length of this string, without nul byte.">max_length</a> - dest-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>)
<a name="l00425"></a>00425     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>; <span class="comment">/* detected overflow of dest-&gt;len + len below */</span>
<a name="l00426"></a>00426   
<a name="l00427"></a>00427   <span class="keywordflow">if</span> (!set_length (dest, dest-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> + len))
<a name="l00428"></a>00428     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00429"></a>00429 
<a name="l00430"></a>00430   memmove (dest-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + insert_at + len, 
<a name="l00431"></a>00431            dest-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + insert_at,
<a name="l00432"></a>00432            dest-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> - len - insert_at);
<a name="l00433"></a>00433 
<a name="l00434"></a>00434   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00435"></a>00435 }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437 <span class="preprocessor">#ifndef _dbus_string_get_data</span>
<a name="l00438"></a>00438 <span class="preprocessor"></span>
<a name="l00449"></a>00449 <span class="keywordtype">char</span>*
<a name="l00450"></a>00450 _dbus_string_get_data (<a class="code" href="structDBusString.html">DBusString</a> *str)
<a name="l00451"></a>00451 {
<a name="l00452"></a>00452   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00453"></a>00453   
<a name="l00454"></a>00454   <span class="keywordflow">return</span> (<span class="keywordtype">char</span>*) real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>;
<a name="l00455"></a>00455 }
<a name="l00456"></a>00456 <span class="preprocessor">#endif </span><span class="comment">/* _dbus_string_get_data */</span>
<a name="l00457"></a>00457 
<a name="l00458"></a>00458 <span class="comment">/* only do the function if we don&#39;t have the macro */</span>
<a name="l00459"></a>00459 <span class="preprocessor">#ifndef _dbus_string_get_const_data</span>
<a name="l00460"></a>00460 <span class="preprocessor"></span>
<a name="l00466"></a>00466 <span class="keyword">const</span> <span class="keywordtype">char</span>*
<a name="l00467"></a>00467 _dbus_string_get_const_data (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a>  *str)
<a name="l00468"></a>00468 {
<a name="l00469"></a>00469   <a class="code" href="group__DBusStringInternals.html#ga5cf5f12f6d8f839e9a7c3ad790a83316" title="Checks assertions about a string that may be const or locked.">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l00470"></a>00470   
<a name="l00471"></a>00471   <span class="keywordflow">return</span> (<span class="keyword">const</span> <span class="keywordtype">char</span>*) real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>;
<a name="l00472"></a>00472 }
<a name="l00473"></a>00473 <span class="preprocessor">#endif </span><span class="comment">/* _dbus_string_get_const_data */</span>
<a name="l00474"></a>00474 
<a name="l00488"></a>00488 <span class="keywordtype">char</span>*
<a name="l00489"></a><a class="code" href="group__DBusString.html#ga7a73fb373398606e6e1d0a86c4587a3c">00489</a> <a class="code" href="group__DBusString.html#ga7a73fb373398606e6e1d0a86c4587a3c" title="Gets a sub-portion of the raw character buffer from the string.">_dbus_string_get_data_len</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00490"></a>00490                            <span class="keywordtype">int</span>         start,
<a name="l00491"></a>00491                            <span class="keywordtype">int</span>         len)
<a name="l00492"></a>00492 {
<a name="l00493"></a>00493   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00494"></a>00494   _dbus_assert (start &gt;= 0);
<a name="l00495"></a>00495   _dbus_assert (len &gt;= 0);
<a name="l00496"></a>00496   _dbus_assert (start &lt;= real-&gt;len);
<a name="l00497"></a>00497   _dbus_assert (len &lt;= real-&gt;len - start);
<a name="l00498"></a>00498   
<a name="l00499"></a>00499   <span class="keywordflow">return</span> (<span class="keywordtype">char</span>*) real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + start;
<a name="l00500"></a>00500 }
<a name="l00501"></a>00501 
<a name="l00502"></a>00502 <span class="comment">/* only do the function if we don&#39;t have the macro */</span>
<a name="l00503"></a>00503 <span class="preprocessor">#ifndef _dbus_string_get_const_data_len</span>
<a name="l00504"></a>00504 <span class="preprocessor"></span>
<a name="l00512"></a>00512 <span class="keyword">const</span> <span class="keywordtype">char</span>*
<a name="l00513"></a>00513 _dbus_string_get_const_data_len (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a>  *str,
<a name="l00514"></a>00514                                  <span class="keywordtype">int</span>                start,
<a name="l00515"></a>00515                                  <span class="keywordtype">int</span>                len)
<a name="l00516"></a>00516 {
<a name="l00517"></a>00517   <a class="code" href="group__DBusStringInternals.html#ga5cf5f12f6d8f839e9a7c3ad790a83316" title="Checks assertions about a string that may be const or locked.">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l00518"></a>00518   _dbus_assert (start &gt;= 0);
<a name="l00519"></a>00519   _dbus_assert (len &gt;= 0);
<a name="l00520"></a>00520   _dbus_assert (start &lt;= real-&gt;len);
<a name="l00521"></a>00521   _dbus_assert (len &lt;= real-&gt;len - start);
<a name="l00522"></a>00522   
<a name="l00523"></a>00523   <span class="keywordflow">return</span> (<span class="keyword">const</span> <span class="keywordtype">char</span>*) real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + start;
<a name="l00524"></a>00524 }
<a name="l00525"></a>00525 <span class="preprocessor">#endif </span><span class="comment">/* _dbus_string_get_const_data_len */</span>
<a name="l00526"></a>00526 
<a name="l00527"></a>00527 <span class="comment">/* only do the function if we don&#39;t have the macro */</span>
<a name="l00528"></a>00528 <span class="preprocessor">#ifndef _dbus_string_set_byte</span>
<a name="l00529"></a>00529 <span class="preprocessor"></span>
<a name="l00536"></a>00536 <span class="keywordtype">void</span>
<a name="l00537"></a>00537 _dbus_string_set_byte (<a class="code" href="structDBusString.html">DBusString</a>    *str,
<a name="l00538"></a>00538                        <span class="keywordtype">int</span>            i,
<a name="l00539"></a>00539                        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>  byte)
<a name="l00540"></a>00540 {
<a name="l00541"></a>00541   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00542"></a>00542   _dbus_assert (i &lt; real-&gt;len);
<a name="l00543"></a>00543   _dbus_assert (i &gt;= 0);
<a name="l00544"></a>00544   
<a name="l00545"></a>00545   real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>[i] = byte;
<a name="l00546"></a>00546 }
<a name="l00547"></a>00547 <span class="preprocessor">#endif </span><span class="comment">/* _dbus_string_set_byte */</span>
<a name="l00548"></a>00548 
<a name="l00549"></a>00549 <span class="comment">/* only have the function if we didn&#39;t create a macro */</span>
<a name="l00550"></a>00550 <span class="preprocessor">#ifndef _dbus_string_get_byte</span>
<a name="l00551"></a>00551 <span class="preprocessor"></span>
<a name="l00560"></a>00560 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>
<a name="l00561"></a>00561 _dbus_string_get_byte (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a>  *str,
<a name="l00562"></a>00562                        <span class="keywordtype">int</span>                start)
<a name="l00563"></a>00563 {
<a name="l00564"></a>00564   <a class="code" href="group__DBusStringInternals.html#ga5cf5f12f6d8f839e9a7c3ad790a83316" title="Checks assertions about a string that may be const or locked.">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l00565"></a>00565   _dbus_assert (start &lt;= real-&gt;len);
<a name="l00566"></a>00566   _dbus_assert (start &gt;= 0);
<a name="l00567"></a>00567   
<a name="l00568"></a>00568   <span class="keywordflow">return</span> real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>[start];
<a name="l00569"></a>00569 }
<a name="l00570"></a>00570 <span class="preprocessor">#endif </span><span class="comment">/* _dbus_string_get_byte */</span>
<a name="l00571"></a>00571 
<a name="l00582"></a>00582 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l00583"></a><a class="code" href="group__DBusString.html#gaa0964d662ad17c58eb044c1b153017a6">00583</a> <a class="code" href="group__DBusString.html#gaa0964d662ad17c58eb044c1b153017a6" title="Inserts a number of bytes of a given value at the given position.">_dbus_string_insert_bytes</a> (<a class="code" href="structDBusString.html">DBusString</a>   *str,
<a name="l00584"></a>00584                            <span class="keywordtype">int</span>           i,
<a name="l00585"></a>00585                            <span class="keywordtype">int</span>           n_bytes,
<a name="l00586"></a>00586                            <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> byte)
<a name="l00587"></a>00587 {
<a name="l00588"></a>00588   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00589"></a>00589   _dbus_assert (i &lt;= real-&gt;len);
<a name="l00590"></a>00590   _dbus_assert (i &gt;= 0);
<a name="l00591"></a>00591   _dbus_assert (n_bytes &gt;= 0);
<a name="l00592"></a>00592 
<a name="l00593"></a>00593   <span class="keywordflow">if</span> (n_bytes == 0)
<a name="l00594"></a>00594     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00595"></a>00595   
<a name="l00596"></a>00596   <span class="keywordflow">if</span> (!open_gap (n_bytes, real, i))
<a name="l00597"></a>00597     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00598"></a>00598   
<a name="l00599"></a>00599   memset (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + i, byte, n_bytes);
<a name="l00600"></a>00600 
<a name="l00601"></a>00601   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00602"></a>00602 }
<a name="l00603"></a>00603 
<a name="l00612"></a>00612 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l00613"></a><a class="code" href="group__DBusString.html#gab0770800dce6df97e5d246105a44e7b4">00613</a> <a class="code" href="group__DBusString.html#gab0770800dce6df97e5d246105a44e7b4" title="Inserts a single byte at the given position.">_dbus_string_insert_byte</a> (<a class="code" href="structDBusString.html">DBusString</a>   *str,
<a name="l00614"></a>00614                            <span class="keywordtype">int</span>           i,
<a name="l00615"></a>00615                            <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> byte)
<a name="l00616"></a>00616 {
<a name="l00617"></a>00617   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00618"></a>00618   _dbus_assert (i &lt;= real-&gt;len);
<a name="l00619"></a>00619   _dbus_assert (i &gt;= 0);
<a name="l00620"></a>00620   
<a name="l00621"></a>00621   <span class="keywordflow">if</span> (!open_gap (1, real, i))
<a name="l00622"></a>00622     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00623"></a>00623 
<a name="l00624"></a>00624   real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>[i] = byte;
<a name="l00625"></a>00625 
<a name="l00626"></a>00626   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00627"></a>00627 }
<a name="l00628"></a>00628 
<a name="l00639"></a>00639 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l00640"></a><a class="code" href="group__DBusString.html#ga556cc30c3ab032dbc63e217119f0d1f5">00640</a> <a class="code" href="group__DBusString.html#ga556cc30c3ab032dbc63e217119f0d1f5" title="Like _dbus_string_get_data(), but removes the gotten data from the original string.">_dbus_string_steal_data</a> (<a class="code" href="structDBusString.html">DBusString</a>        *str,
<a name="l00641"></a>00641                          <span class="keywordtype">char</span>             **data_return)
<a name="l00642"></a>00642 {
<a name="l00643"></a>00643   <span class="keywordtype">int</span> old_max_length;
<a name="l00644"></a>00644   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00645"></a>00645   _dbus_assert (data_return != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00646"></a>00646 
<a name="l00647"></a>00647   undo_alignment (real);
<a name="l00648"></a>00648   
<a name="l00649"></a>00649   *data_return = (<span class="keywordtype">char</span>*) real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>;
<a name="l00650"></a>00650 
<a name="l00651"></a>00651   old_max_length = real-&gt;<a class="code" href="structDBusRealString.html#aeb48dcb099660ffc277883166fa72159" title="Max length of this string, without nul byte.">max_length</a>;
<a name="l00652"></a>00652   
<a name="l00653"></a>00653   <span class="comment">/* reset the string */</span>
<a name="l00654"></a>00654   if (!<a class="code" href="group__DBusString.html#ga348252317f7bb8ac43529972945830ae" title="Initializes a string.">_dbus_string_init</a> (str))
<a name="l00655"></a>00655     {
<a name="l00656"></a>00656       <span class="comment">/* hrm, put it back then */</span>
<a name="l00657"></a>00657       real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) *data_return;
<a name="l00658"></a>00658       *data_return = <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>;
<a name="l00659"></a>00659       fixup_alignment (real);
<a name="l00660"></a>00660       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00661"></a>00661     }
<a name="l00662"></a>00662 
<a name="l00663"></a>00663   real-&gt;<a class="code" href="structDBusRealString.html#aeb48dcb099660ffc277883166fa72159" title="Max length of this string, without nul byte.">max_length</a> = old_max_length;
<a name="l00664"></a>00664 
<a name="l00665"></a>00665   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00666"></a>00666 }
<a name="l00667"></a>00667 
<a name="l00668"></a>00668 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l00669"></a>00669 <span class="preprocessor"></span>
<a name="l00684"></a>00684 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l00685"></a>00685 _dbus_string_steal_data_len (<a class="code" href="structDBusString.html">DBusString</a>        *str,
<a name="l00686"></a>00686                              <span class="keywordtype">char</span>             **data_return,
<a name="l00687"></a>00687                              <span class="keywordtype">int</span>                start,
<a name="l00688"></a>00688                              <span class="keywordtype">int</span>                len)
<a name="l00689"></a>00689 {
<a name="l00690"></a>00690   <a class="code" href="structDBusString.html">DBusString</a> dest;
<a name="l00691"></a>00691   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00692"></a>00692   _dbus_assert (data_return != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00693"></a>00693   _dbus_assert (start &gt;= 0);
<a name="l00694"></a>00694   _dbus_assert (len &gt;= 0);
<a name="l00695"></a>00695   _dbus_assert (start &lt;= real-&gt;len);
<a name="l00696"></a>00696   _dbus_assert (len &lt;= real-&gt;len - start);
<a name="l00697"></a>00697 
<a name="l00698"></a>00698   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#ga348252317f7bb8ac43529972945830ae" title="Initializes a string.">_dbus_string_init</a> (&amp;dest))
<a name="l00699"></a>00699     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00700"></a>00700 
<a name="l00701"></a>00701   set_max_length (&amp;dest, real-&gt;<a class="code" href="structDBusRealString.html#aeb48dcb099660ffc277883166fa72159" title="Max length of this string, without nul byte.">max_length</a>);
<a name="l00702"></a>00702   
<a name="l00703"></a>00703   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#gab8e2dcb2dc71bf225da0827c6086a727" title="Like _dbus_string_move(), but can move a segment from the middle of the source string.">_dbus_string_move_len</a> (str, start, len, &amp;dest, 0))
<a name="l00704"></a>00704     {
<a name="l00705"></a>00705       <a class="code" href="group__DBusString.html#ga781ca91acda49a834dce7d0ed0eef212" title="Frees a string created by _dbus_string_init().">_dbus_string_free</a> (&amp;dest);
<a name="l00706"></a>00706       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00707"></a>00707     }
<a name="l00708"></a>00708 
<a name="l00709"></a>00709   <a class="code" href="group__DBusInternalsUtils.html#gabea2c16d6d3fe7c4eb5b9496fc877f84" title="Prints a warning message to stderr.">_dbus_warn</a> (<span class="stringliteral">&quot;Broken code in _dbus_string_steal_data_len(), see @todo, FIXME\n&quot;</span>);
<a name="l00710"></a>00710   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#ga556cc30c3ab032dbc63e217119f0d1f5" title="Like _dbus_string_get_data(), but removes the gotten data from the original string.">_dbus_string_steal_data</a> (&amp;dest, data_return))
<a name="l00711"></a>00711     {
<a name="l00712"></a>00712       <a class="code" href="group__DBusString.html#ga781ca91acda49a834dce7d0ed0eef212" title="Frees a string created by _dbus_string_init().">_dbus_string_free</a> (&amp;dest);
<a name="l00713"></a>00713       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00714"></a>00714     }
<a name="l00715"></a>00715 
<a name="l00716"></a>00716   <a class="code" href="group__DBusString.html#ga781ca91acda49a834dce7d0ed0eef212" title="Frees a string created by _dbus_string_init().">_dbus_string_free</a> (&amp;dest);
<a name="l00717"></a>00717   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00718"></a>00718 }
<a name="l00719"></a>00719 <span class="preprocessor">#endif </span><span class="comment">/* DBUS_BUILD_TESTS */</span>
<a name="l00720"></a>00720 
<a name="l00728"></a>00728 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l00729"></a><a class="code" href="group__DBusString.html#ga7e509d4f959d19d96f83250e62287b06">00729</a> <a class="code" href="group__DBusString.html#ga7e509d4f959d19d96f83250e62287b06" title="Copies the data from the string into a char*.">_dbus_string_copy_data</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a>  *str,
<a name="l00730"></a>00730                         <span class="keywordtype">char</span>             **data_return)
<a name="l00731"></a>00731 {
<a name="l00732"></a>00732   <a class="code" href="group__DBusStringInternals.html#ga5cf5f12f6d8f839e9a7c3ad790a83316" title="Checks assertions about a string that may be const or locked.">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l00733"></a>00733   _dbus_assert (data_return != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00734"></a>00734   
<a name="l00735"></a>00735   *data_return = <a class="code" href="group__DBusMemory.html#gaf6e588659067a854c3cca7ebe8ae5084" title="Allocates the given number of bytes, as with standard malloc().">dbus_malloc</a> (real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> + 1);
<a name="l00736"></a>00736   <span class="keywordflow">if</span> (*data_return == <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>)
<a name="l00737"></a>00737     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00738"></a>00738 
<a name="l00739"></a>00739   memcpy (*data_return, real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>, real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> + 1);
<a name="l00740"></a>00740 
<a name="l00741"></a>00741   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00742"></a>00742 }
<a name="l00743"></a>00743 
<a name="l00753"></a>00753 <span class="keywordtype">void</span>
<a name="l00754"></a><a class="code" href="group__DBusString.html#gaf97b18e419678dbf967d9b9ad1112ca6">00754</a> <a class="code" href="group__DBusString.html#gaf97b18e419678dbf967d9b9ad1112ca6" title="Copies the contents of a DBusString into a different buffer.">_dbus_string_copy_to_buffer</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a>  *str,
<a name="l00755"></a>00755                              <span class="keywordtype">char</span>              *buffer,
<a name="l00756"></a>00756                              <span class="keywordtype">int</span>                avail_len)
<a name="l00757"></a>00757 {
<a name="l00758"></a>00758   <a class="code" href="group__DBusStringInternals.html#ga5cf5f12f6d8f839e9a7c3ad790a83316" title="Checks assertions about a string that may be const or locked.">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l00759"></a>00759 
<a name="l00760"></a>00760   _dbus_assert (avail_len &gt;= 0);
<a name="l00761"></a>00761   _dbus_assert (avail_len &gt;= real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>);
<a name="l00762"></a>00762   
<a name="l00763"></a>00763   memcpy (buffer, real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>, real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>);
<a name="l00764"></a>00764 }
<a name="l00765"></a>00765 
<a name="l00775"></a>00775 <span class="keywordtype">void</span>
<a name="l00776"></a><a class="code" href="group__DBusString.html#gac42891d26084a4da0f63038d93b63828">00776</a> <a class="code" href="group__DBusString.html#gac42891d26084a4da0f63038d93b63828" title="Copies the contents of a DBusString into a different buffer.">_dbus_string_copy_to_buffer_with_nul</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a>  *str,
<a name="l00777"></a>00777                                       <span class="keywordtype">char</span>              *buffer,
<a name="l00778"></a>00778                                       <span class="keywordtype">int</span>                avail_len)
<a name="l00779"></a>00779 {
<a name="l00780"></a>00780   <a class="code" href="group__DBusStringInternals.html#ga5cf5f12f6d8f839e9a7c3ad790a83316" title="Checks assertions about a string that may be const or locked.">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l00781"></a>00781 
<a name="l00782"></a>00782   _dbus_assert (avail_len &gt;= 0);
<a name="l00783"></a>00783   _dbus_assert (avail_len &gt; real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>);
<a name="l00784"></a>00784   
<a name="l00785"></a>00785   memcpy (buffer, real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>, real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>+1);
<a name="l00786"></a>00786 }
<a name="l00787"></a>00787 
<a name="l00788"></a>00788 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l00789"></a>00789 <span class="preprocessor"></span>
<a name="l00798"></a>00798 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l00799"></a>00799 _dbus_string_copy_data_len (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a>  *str,
<a name="l00800"></a>00800                             <span class="keywordtype">char</span>             **data_return,
<a name="l00801"></a>00801                             <span class="keywordtype">int</span>                start,
<a name="l00802"></a>00802                             <span class="keywordtype">int</span>                len)
<a name="l00803"></a>00803 {
<a name="l00804"></a>00804   <a class="code" href="structDBusString.html">DBusString</a> dest;
<a name="l00805"></a>00805 
<a name="l00806"></a>00806   <a class="code" href="group__DBusStringInternals.html#ga5cf5f12f6d8f839e9a7c3ad790a83316" title="Checks assertions about a string that may be const or locked.">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l00807"></a>00807   _dbus_assert (data_return != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00808"></a>00808   _dbus_assert (start &gt;= 0);
<a name="l00809"></a>00809   _dbus_assert (len &gt;= 0);
<a name="l00810"></a>00810   _dbus_assert (start &lt;= real-&gt;len);
<a name="l00811"></a>00811   _dbus_assert (len &lt;= real-&gt;len - start);
<a name="l00812"></a>00812 
<a name="l00813"></a>00813   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#ga348252317f7bb8ac43529972945830ae" title="Initializes a string.">_dbus_string_init</a> (&amp;dest))
<a name="l00814"></a>00814     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00815"></a>00815 
<a name="l00816"></a>00816   set_max_length (&amp;dest, real-&gt;<a class="code" href="structDBusRealString.html#aeb48dcb099660ffc277883166fa72159" title="Max length of this string, without nul byte.">max_length</a>);
<a name="l00817"></a>00817 
<a name="l00818"></a>00818   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#gaf5f13bc7ac7a623516930d26ae2589bf" title="Like _dbus_string_copy(), but can copy a segment from the middle of the source string.">_dbus_string_copy_len</a> (str, start, len, &amp;dest, 0))
<a name="l00819"></a>00819     {
<a name="l00820"></a>00820       <a class="code" href="group__DBusString.html#ga781ca91acda49a834dce7d0ed0eef212" title="Frees a string created by _dbus_string_init().">_dbus_string_free</a> (&amp;dest);
<a name="l00821"></a>00821       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00822"></a>00822     }
<a name="l00823"></a>00823 
<a name="l00824"></a>00824   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#ga556cc30c3ab032dbc63e217119f0d1f5" title="Like _dbus_string_get_data(), but removes the gotten data from the original string.">_dbus_string_steal_data</a> (&amp;dest, data_return))
<a name="l00825"></a>00825     {
<a name="l00826"></a>00826       <a class="code" href="group__DBusString.html#ga781ca91acda49a834dce7d0ed0eef212" title="Frees a string created by _dbus_string_init().">_dbus_string_free</a> (&amp;dest);
<a name="l00827"></a>00827       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00828"></a>00828     }
<a name="l00829"></a>00829 
<a name="l00830"></a>00830   <a class="code" href="group__DBusString.html#ga781ca91acda49a834dce7d0ed0eef212" title="Frees a string created by _dbus_string_init().">_dbus_string_free</a> (&amp;dest);
<a name="l00831"></a>00831   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00832"></a>00832 }
<a name="l00833"></a>00833 <span class="preprocessor">#endif </span><span class="comment">/* DBUS_BUILD_TESTS */</span>
<a name="l00834"></a>00834 
<a name="l00835"></a>00835 <span class="comment">/* Only have the function if we don&#39;t have the macro */</span>
<a name="l00836"></a>00836 <span class="preprocessor">#ifndef _dbus_string_get_length</span>
<a name="l00837"></a>00837 <span class="preprocessor"></span>
<a name="l00842"></a>00842 <span class="keywordtype">int</span>
<a name="l00843"></a>00843 _dbus_string_get_length (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a>  *str)
<a name="l00844"></a>00844 {
<a name="l00845"></a>00845   <a class="code" href="group__DBusStringInternals.html#ga5cf5f12f6d8f839e9a7c3ad790a83316" title="Checks assertions about a string that may be const or locked.">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l00846"></a>00846   
<a name="l00847"></a>00847   <span class="keywordflow">return</span> real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>;
<a name="l00848"></a>00848 }
<a name="l00849"></a>00849 <span class="preprocessor">#endif </span><span class="comment">/* !_dbus_string_get_length */</span>
<a name="l00850"></a>00850 
<a name="l00863"></a>00863 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l00864"></a><a class="code" href="group__DBusString.html#ga8f13997d90ceed2f437706e6b7804d9b">00864</a> <a class="code" href="group__DBusString.html#ga8f13997d90ceed2f437706e6b7804d9b" title="Makes a string longer by the given number of bytes.">_dbus_string_lengthen</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00865"></a>00865                        <span class="keywordtype">int</span>         additional_length)
<a name="l00866"></a>00866 {
<a name="l00867"></a>00867   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);  
<a name="l00868"></a>00868   _dbus_assert (additional_length &gt;= 0);
<a name="l00869"></a>00869 
<a name="l00870"></a>00870   <span class="keywordflow">if</span> (_DBUS_UNLIKELY (additional_length &gt; real-&gt;<a class="code" href="structDBusRealString.html#aeb48dcb099660ffc277883166fa72159" title="Max length of this string, without nul byte.">max_length</a> - real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>))
<a name="l00871"></a>00871     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>; <span class="comment">/* would overflow */</span>
<a name="l00872"></a>00872   
<a name="l00873"></a>00873   <span class="keywordflow">return</span> set_length (real,
<a name="l00874"></a>00874                      real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> + additional_length);
<a name="l00875"></a>00875 }
<a name="l00876"></a>00876 
<a name="l00883"></a>00883 <span class="keywordtype">void</span>
<a name="l00884"></a><a class="code" href="group__DBusString.html#ga7af1cbfa905f26d972ab644d890548b8">00884</a> <a class="code" href="group__DBusString.html#ga7af1cbfa905f26d972ab644d890548b8" title="Makes a string shorter by the given number of bytes.">_dbus_string_shorten</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00885"></a>00885                       <span class="keywordtype">int</span>         length_to_remove)
<a name="l00886"></a>00886 {
<a name="l00887"></a>00887   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00888"></a>00888   _dbus_assert (length_to_remove &gt;= 0);
<a name="l00889"></a>00889   _dbus_assert (length_to_remove &lt;= real-&gt;len);
<a name="l00890"></a>00890 
<a name="l00891"></a>00891   set_length (real,
<a name="l00892"></a>00892               real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> - length_to_remove);
<a name="l00893"></a>00893 }
<a name="l00894"></a>00894 
<a name="l00905"></a>00905 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l00906"></a><a class="code" href="group__DBusString.html#ga08c423b93c28dd746dcb93e0461ab95c">00906</a> <a class="code" href="group__DBusString.html#ga08c423b93c28dd746dcb93e0461ab95c" title="Sets the length of a string.">_dbus_string_set_length</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00907"></a>00907                          <span class="keywordtype">int</span>         length)
<a name="l00908"></a>00908 {
<a name="l00909"></a>00909   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00910"></a>00910   _dbus_assert (length &gt;= 0);
<a name="l00911"></a>00911 
<a name="l00912"></a>00912   <span class="keywordflow">return</span> set_length (real, length);
<a name="l00913"></a>00913 }
<a name="l00914"></a>00914 
<a name="l00915"></a>00915 <span class="keyword">static</span> <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l00916"></a>00916 align_insert_point_then_open_gap (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00917"></a>00917                                   <span class="keywordtype">int</span>        *insert_at_p,
<a name="l00918"></a>00918                                   <span class="keywordtype">int</span>         alignment,
<a name="l00919"></a>00919                                   <span class="keywordtype">int</span>         gap_size)
<a name="l00920"></a>00920 {
<a name="l00921"></a>00921   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> new_len; <span class="comment">/* ulong to avoid _DBUS_ALIGN_VALUE overflow */</span>
<a name="l00922"></a>00922   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> gap_pos;
<a name="l00923"></a>00923   <span class="keywordtype">int</span> insert_at;
<a name="l00924"></a>00924   <span class="keywordtype">int</span> delta;
<a name="l00925"></a>00925   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00926"></a>00926   _dbus_assert (alignment &gt;= 1);
<a name="l00927"></a>00927   _dbus_assert (alignment &lt;= 8); <span class="comment">/* it has to be a bug if &gt; 8 */</span>
<a name="l00928"></a>00928 
<a name="l00929"></a>00929   insert_at = *insert_at_p;
<a name="l00930"></a>00930 
<a name="l00931"></a>00931   _dbus_assert (insert_at &lt;= real-&gt;len);
<a name="l00932"></a>00932   
<a name="l00933"></a>00933   gap_pos = _DBUS_ALIGN_VALUE (insert_at, alignment);
<a name="l00934"></a>00934   new_len = real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> + (gap_pos - insert_at) + gap_size;
<a name="l00935"></a>00935   
<a name="l00936"></a>00936   <span class="keywordflow">if</span> (_DBUS_UNLIKELY (new_len &gt; (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) real-&gt;<a class="code" href="structDBusRealString.html#aeb48dcb099660ffc277883166fa72159" title="Max length of this string, without nul byte.">max_length</a>))
<a name="l00937"></a>00937     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00938"></a>00938   
<a name="l00939"></a>00939   delta = new_len - real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>;
<a name="l00940"></a>00940   _dbus_assert (delta &gt;= 0);
<a name="l00941"></a>00941 
<a name="l00942"></a>00942   <span class="keywordflow">if</span> (delta == 0) <span class="comment">/* only happens if gap_size == 0 and insert_at is aligned already */</span>
<a name="l00943"></a>00943     {
<a name="l00944"></a>00944       _dbus_assert (((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) *insert_at_p) == gap_pos);
<a name="l00945"></a>00945       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00946"></a>00946     }
<a name="l00947"></a>00947 
<a name="l00948"></a>00948   <span class="keywordflow">if</span> (_DBUS_UNLIKELY (!open_gap (new_len - real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>,
<a name="l00949"></a>00949                                  real, insert_at)))
<a name="l00950"></a>00950     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00951"></a>00951 
<a name="l00952"></a>00952   <span class="comment">/* nul the padding if we had to add any padding */</span>
<a name="l00953"></a>00953   <span class="keywordflow">if</span> (gap_size &lt; delta)
<a name="l00954"></a>00954     {
<a name="l00955"></a>00955       memset (&amp;real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>[insert_at], <span class="charliteral">&#39;\0&#39;</span>,
<a name="l00956"></a>00956               gap_pos - insert_at);
<a name="l00957"></a>00957     }
<a name="l00958"></a>00958 
<a name="l00959"></a>00959   *insert_at_p = gap_pos;
<a name="l00960"></a>00960   
<a name="l00961"></a>00961   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00962"></a>00962 }
<a name="l00963"></a>00963 
<a name="l00964"></a>00964 <span class="keyword">static</span> <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l00965"></a>00965 align_length_then_lengthen (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00966"></a>00966                             <span class="keywordtype">int</span>         alignment,
<a name="l00967"></a>00967                             <span class="keywordtype">int</span>         then_lengthen_by)
<a name="l00968"></a>00968 {
<a name="l00969"></a>00969   <span class="keywordtype">int</span> insert_at;
<a name="l00970"></a>00970 
<a name="l00971"></a>00971   insert_at = _dbus_string_get_length (str);
<a name="l00972"></a>00972   
<a name="l00973"></a>00973   <span class="keywordflow">return</span> align_insert_point_then_open_gap (str,
<a name="l00974"></a>00974                                            &amp;insert_at,
<a name="l00975"></a>00975                                            alignment, then_lengthen_by);
<a name="l00976"></a>00976 }
<a name="l00977"></a>00977 
<a name="l00986"></a>00986 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l00987"></a><a class="code" href="group__DBusString.html#gaeadfb67c4e796131610499c91d0d7813">00987</a> <a class="code" href="group__DBusString.html#gaeadfb67c4e796131610499c91d0d7813" title="Align the length of a string to a specific alignment (typically 4 or 8) by appending nul bytes to the...">_dbus_string_align_length</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00988"></a>00988                            <span class="keywordtype">int</span>         alignment)
<a name="l00989"></a>00989 {
<a name="l00990"></a>00990   <span class="keywordflow">return</span> align_length_then_lengthen (str, alignment, 0);
<a name="l00991"></a>00991 }
<a name="l00992"></a>00992 
<a name="l01002"></a>01002 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01003"></a><a class="code" href="group__DBusString.html#ga4764e75c464356408fc1a12df93177c1">01003</a> <a class="code" href="group__DBusString.html#ga4764e75c464356408fc1a12df93177c1" title="Preallocate extra_bytes such that a future lengthening of the string by extra_bytes is guaranteed to ...">_dbus_string_alloc_space</a> (<a class="code" href="structDBusString.html">DBusString</a>        *str,
<a name="l01004"></a>01004                           <span class="keywordtype">int</span>                extra_bytes)
<a name="l01005"></a>01005 {
<a name="l01006"></a>01006   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#ga8f13997d90ceed2f437706e6b7804d9b" title="Makes a string longer by the given number of bytes.">_dbus_string_lengthen</a> (str, extra_bytes))
<a name="l01007"></a>01007     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01008"></a>01008   <a class="code" href="group__DBusString.html#ga7af1cbfa905f26d972ab644d890548b8" title="Makes a string shorter by the given number of bytes.">_dbus_string_shorten</a> (str, extra_bytes);
<a name="l01009"></a>01009 
<a name="l01010"></a>01010   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01011"></a>01011 }
<a name="l01012"></a>01012 
<a name="l01013"></a>01013 <span class="keyword">static</span> <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01014"></a>01014 append (<a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *real,
<a name="l01015"></a>01015         <span class="keyword">const</span> <span class="keywordtype">char</span>     *buffer,
<a name="l01016"></a>01016         <span class="keywordtype">int</span>             buffer_len)
<a name="l01017"></a>01017 {
<a name="l01018"></a>01018   <span class="keywordflow">if</span> (buffer_len == 0)
<a name="l01019"></a>01019     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01020"></a>01020 
<a name="l01021"></a>01021   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#ga8f13997d90ceed2f437706e6b7804d9b" title="Makes a string longer by the given number of bytes.">_dbus_string_lengthen</a> ((<a class="code" href="structDBusString.html">DBusString</a>*)real, buffer_len))
<a name="l01022"></a>01022     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01023"></a>01023 
<a name="l01024"></a>01024   memcpy (real-&gt;str + (real-&gt;len - buffer_len),
<a name="l01025"></a>01025           buffer,
<a name="l01026"></a>01026           buffer_len);
<a name="l01027"></a>01027 
<a name="l01028"></a>01028   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01029"></a>01029 }
<a name="l01030"></a>01030 
<a name="l01038"></a>01038 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01039"></a><a class="code" href="group__DBusString.html#ga100c5ce0696822c5a4cfbdfaba674d96">01039</a> <a class="code" href="group__DBusString.html#ga100c5ce0696822c5a4cfbdfaba674d96" title="Appends a nul-terminated C-style string to a DBusString.">_dbus_string_append</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l01040"></a>01040                      <span class="keyword">const</span> <span class="keywordtype">char</span> *buffer)
<a name="l01041"></a>01041 {
<a name="l01042"></a>01042   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> buffer_len;
<a name="l01043"></a>01043   
<a name="l01044"></a>01044   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l01045"></a>01045   _dbus_assert (buffer != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l01046"></a>01046   
<a name="l01047"></a>01047   buffer_len = strlen (buffer);
<a name="l01048"></a>01048   <span class="keywordflow">if</span> (buffer_len &gt; (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) real-&gt;<a class="code" href="structDBusRealString.html#aeb48dcb099660ffc277883166fa72159" title="Max length of this string, without nul byte.">max_length</a>)
<a name="l01049"></a>01049     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01050"></a>01050   
<a name="l01051"></a>01051   <span class="keywordflow">return</span> append (real, buffer, buffer_len);
<a name="l01052"></a>01052 }
<a name="l01053"></a>01053 
<a name="l01055"></a><a class="code" href="group__DBusString.html#ga4661e2b10dd3da080564b1191acb7619">01055</a> <span class="preprocessor">#define ASSIGN_2_OCTETS(p, octets) \</span>
<a name="l01056"></a>01056 <span class="preprocessor">  *((dbus_uint16_t*)(p)) = *((dbus_uint16_t*)(octets));</span>
<a name="l01057"></a>01057 <span class="preprocessor"></span>
<a name="l01059"></a><a class="code" href="group__DBusString.html#gae777c8fb39aef558604506d645af6420">01059</a> <span class="preprocessor">#define ASSIGN_4_OCTETS(p, octets) \</span>
<a name="l01060"></a>01060 <span class="preprocessor">  *((dbus_uint32_t*)(p)) = *((dbus_uint32_t*)(octets));</span>
<a name="l01061"></a>01061 <span class="preprocessor"></span>
<a name="l01062"></a>01062 <span class="preprocessor">#ifdef DBUS_HAVE_INT64</span>
<a name="l01063"></a>01063 <span class="preprocessor"></span>
<a name="l01064"></a>01064 <span class="preprocessor">#define ASSIGN_8_OCTETS(p, octets) \</span>
<a name="l01065"></a>01065 <span class="preprocessor">  *((dbus_uint64_t*)(p)) = *((dbus_uint64_t*)(octets));</span>
<a name="l01066"></a>01066 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l01067"></a>01067 <span class="preprocessor"></span>
<a name="l01068"></a><a class="code" href="group__DBusString.html#gad13077c6ef8f8b764611ef5ad23b4b8b">01068</a> <span class="preprocessor">#define ASSIGN_8_OCTETS(p, octets)              \</span>
<a name="l01069"></a>01069 <span class="preprocessor">do {                                            \</span>
<a name="l01070"></a>01070 <span class="preprocessor">  unsigned char *b;                             \</span>
<a name="l01071"></a>01071 <span class="preprocessor">                                                \</span>
<a name="l01072"></a>01072 <span class="preprocessor">  b = p;                                        \</span>
<a name="l01073"></a>01073 <span class="preprocessor">                                                \</span>
<a name="l01074"></a>01074 <span class="preprocessor">  *b++ = octets[0];                             \</span>
<a name="l01075"></a>01075 <span class="preprocessor">  *b++ = octets[1];                             \</span>
<a name="l01076"></a>01076 <span class="preprocessor">  *b++ = octets[2];                             \</span>
<a name="l01077"></a>01077 <span class="preprocessor">  *b++ = octets[3];                             \</span>
<a name="l01078"></a>01078 <span class="preprocessor">  *b++ = octets[4];                             \</span>
<a name="l01079"></a>01079 <span class="preprocessor">  *b++ = octets[5];                             \</span>
<a name="l01080"></a>01080 <span class="preprocessor">  *b++ = octets[6];                             \</span>
<a name="l01081"></a>01081 <span class="preprocessor">  *b++ = octets[7];                             \</span>
<a name="l01082"></a>01082 <span class="preprocessor">  _dbus_assert (b == p + 8);                    \</span>
<a name="l01083"></a>01083 <span class="preprocessor">} while (0)</span>
<a name="l01084"></a>01084 <span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* DBUS_HAVE_INT64 */</span>
<a name="l01085"></a>01085 
<a name="l01086"></a>01086 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l01087"></a>01087 <span class="preprocessor"></span>
<a name="l01095"></a>01095 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01096"></a>01096 _dbus_string_append_4_aligned (<a class="code" href="structDBusString.html">DBusString</a>         *str,
<a name="l01097"></a>01097                                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> octets[4])
<a name="l01098"></a>01098 {
<a name="l01099"></a>01099   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l01100"></a>01100   
<a name="l01101"></a>01101   <span class="keywordflow">if</span> (!align_length_then_lengthen (str, 4, 4))
<a name="l01102"></a>01102     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01103"></a>01103 
<a name="l01104"></a>01104   <a class="code" href="group__DBusString.html#gae777c8fb39aef558604506d645af6420" title="assign 4 bytes from one string to another">ASSIGN_4_OCTETS</a> (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + (real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> - 4), octets);
<a name="l01105"></a>01105 
<a name="l01106"></a>01106   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01107"></a>01107 }
<a name="l01108"></a>01108 <span class="preprocessor">#endif </span><span class="comment">/* DBUS_BUILD_TESTS */</span>
<a name="l01109"></a>01109 
<a name="l01110"></a>01110 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l01111"></a>01111 <span class="preprocessor"></span>
<a name="l01119"></a>01119 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01120"></a>01120 _dbus_string_append_8_aligned (<a class="code" href="structDBusString.html">DBusString</a>         *str,
<a name="l01121"></a>01121                                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> octets[8])
<a name="l01122"></a>01122 {
<a name="l01123"></a>01123   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l01124"></a>01124   
<a name="l01125"></a>01125   <span class="keywordflow">if</span> (!align_length_then_lengthen (str, 8, 8))
<a name="l01126"></a>01126     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01127"></a>01127 
<a name="l01128"></a>01128   <a class="code" href="group__DBusString.html#gad13077c6ef8f8b764611ef5ad23b4b8b" title="assign 8 bytes from one string to another">ASSIGN_8_OCTETS</a> (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + (real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> - 8), octets);
<a name="l01129"></a>01129 
<a name="l01130"></a>01130   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01131"></a>01131 }
<a name="l01132"></a>01132 <span class="preprocessor">#endif </span><span class="comment">/* DBUS_BUILD_TESTS */</span>
<a name="l01133"></a>01133 
<a name="l01143"></a>01143 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01144"></a><a class="code" href="group__DBusString.html#gac33cd9f66e1dc665f92f0478b3170e23">01144</a> <a class="code" href="group__DBusString.html#gac33cd9f66e1dc665f92f0478b3170e23" title="Inserts 2 bytes aligned on a 2 byte boundary with any alignment padding initialized to 0...">_dbus_string_insert_2_aligned</a> (<a class="code" href="structDBusString.html">DBusString</a>         *str,
<a name="l01145"></a>01145                                <span class="keywordtype">int</span>                 insert_at,
<a name="l01146"></a>01146                                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> octets[4])
<a name="l01147"></a>01147 {
<a name="l01148"></a>01148   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l01149"></a>01149   
<a name="l01150"></a>01150   <span class="keywordflow">if</span> (!align_insert_point_then_open_gap (str, &amp;insert_at, 2, 2))
<a name="l01151"></a>01151     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01152"></a>01152 
<a name="l01153"></a>01153   <a class="code" href="group__DBusString.html#ga4661e2b10dd3da080564b1191acb7619" title="assign 2 bytes from one string to another">ASSIGN_2_OCTETS</a> (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + insert_at, octets);
<a name="l01154"></a>01154 
<a name="l01155"></a>01155   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01156"></a>01156 }
<a name="l01157"></a>01157 
<a name="l01167"></a>01167 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01168"></a><a class="code" href="group__DBusString.html#gadd296cf1e6af18cb5bec438e9d353b4e">01168</a> <a class="code" href="group__DBusString.html#gadd296cf1e6af18cb5bec438e9d353b4e" title="Inserts 4 bytes aligned on a 4 byte boundary with any alignment padding initialized to 0...">_dbus_string_insert_4_aligned</a> (<a class="code" href="structDBusString.html">DBusString</a>         *str,
<a name="l01169"></a>01169                                <span class="keywordtype">int</span>                 insert_at,
<a name="l01170"></a>01170                                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> octets[4])
<a name="l01171"></a>01171 {
<a name="l01172"></a>01172   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l01173"></a>01173   
<a name="l01174"></a>01174   <span class="keywordflow">if</span> (!align_insert_point_then_open_gap (str, &amp;insert_at, 4, 4))
<a name="l01175"></a>01175     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01176"></a>01176 
<a name="l01177"></a>01177   <a class="code" href="group__DBusString.html#gae777c8fb39aef558604506d645af6420" title="assign 4 bytes from one string to another">ASSIGN_4_OCTETS</a> (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + insert_at, octets);
<a name="l01178"></a>01178 
<a name="l01179"></a>01179   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01180"></a>01180 }
<a name="l01181"></a>01181 
<a name="l01191"></a>01191 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01192"></a><a class="code" href="group__DBusString.html#ga108d7d64fb88fffca31e33181cefa232">01192</a> <a class="code" href="group__DBusString.html#ga108d7d64fb88fffca31e33181cefa232" title="Inserts 8 bytes aligned on an 8 byte boundary with any alignment padding initialized to 0...">_dbus_string_insert_8_aligned</a> (<a class="code" href="structDBusString.html">DBusString</a>         *str,
<a name="l01193"></a>01193                                <span class="keywordtype">int</span>                 insert_at,
<a name="l01194"></a>01194                                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> octets[8])
<a name="l01195"></a>01195 {
<a name="l01196"></a>01196   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l01197"></a>01197   
<a name="l01198"></a>01198   <span class="keywordflow">if</span> (!align_insert_point_then_open_gap (str, &amp;insert_at, 8, 8))
<a name="l01199"></a>01199     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01200"></a>01200 
<a name="l01201"></a>01201   _dbus_assert (_DBUS_ALIGN_VALUE (insert_at, 8) == (<span class="keywordtype">unsigned</span>) insert_at);
<a name="l01202"></a>01202   
<a name="l01203"></a>01203   <a class="code" href="group__DBusString.html#gad13077c6ef8f8b764611ef5ad23b4b8b" title="assign 8 bytes from one string to another">ASSIGN_8_OCTETS</a> (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + insert_at, octets);
<a name="l01204"></a>01204 
<a name="l01205"></a>01205   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01206"></a>01206 }
<a name="l01207"></a>01207 
<a name="l01208"></a>01208 
<a name="l01219"></a>01219 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01220"></a><a class="code" href="group__DBusString.html#ga267217e412c74c74dc3a3e412da5c600">01220</a> <a class="code" href="group__DBusString.html#ga267217e412c74c74dc3a3e412da5c600" title="Inserts padding at *insert_at such to align it to the given boundary.">_dbus_string_insert_alignment</a> (<a class="code" href="structDBusString.html">DBusString</a>        *str,
<a name="l01221"></a>01221                                <span class="keywordtype">int</span>               *insert_at,
<a name="l01222"></a>01222                                <span class="keywordtype">int</span>                alignment)
<a name="l01223"></a>01223 {
<a name="l01224"></a>01224   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l01225"></a>01225   
<a name="l01226"></a>01226   <span class="keywordflow">if</span> (!align_insert_point_then_open_gap (str, insert_at, alignment, 0))
<a name="l01227"></a>01227     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01228"></a>01228 
<a name="l01229"></a>01229   _dbus_assert (_DBUS_ALIGN_VALUE (*insert_at, alignment) == (<span class="keywordtype">unsigned</span>) *insert_at);
<a name="l01230"></a>01230 
<a name="l01231"></a>01231   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01232"></a>01232 }
<a name="l01233"></a>01233 
<a name="l01243"></a>01243 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01244"></a><a class="code" href="group__DBusString.html#ga8d794f292831d1a7edeb971b13a2c641">01244</a> <a class="code" href="group__DBusString.html#ga8d794f292831d1a7edeb971b13a2c641" title="Appends a printf-style formatted string to the DBusString.">_dbus_string_append_printf_valist</a>  (<a class="code" href="structDBusString.html">DBusString</a>        *str,
<a name="l01245"></a>01245                                     <span class="keyword">const</span> <span class="keywordtype">char</span>        *format,
<a name="l01246"></a>01246                                     va_list            args)
<a name="l01247"></a>01247 {
<a name="l01248"></a>01248   <span class="keywordtype">int</span> len;
<a name="l01249"></a>01249   va_list args_copy;
<a name="l01250"></a>01250 
<a name="l01251"></a>01251   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l01252"></a>01252 
<a name="l01253"></a>01253   DBUS_VA_COPY (args_copy, args);
<a name="l01254"></a>01254 
<a name="l01255"></a>01255   <span class="comment">/* Measure the message length without terminating nul */</span>
<a name="l01256"></a>01256   len = <a class="code" href="group__DBusSysdeps.html#gaffaf8b5bb832c20a8ccb10f012920776" title="Measure the length of the given format string and arguments, not including the terminating nul...">_dbus_printf_string_upper_bound</a> (format, args);
<a name="l01257"></a>01257 
<a name="l01258"></a>01258   <span class="keywordflow">if</span> (len &lt; 0)
<a name="l01259"></a>01259     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01260"></a>01260 
<a name="l01261"></a>01261   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#ga8f13997d90ceed2f437706e6b7804d9b" title="Makes a string longer by the given number of bytes.">_dbus_string_lengthen</a> (str, len))
<a name="l01262"></a>01262     {
<a name="l01263"></a>01263       <span class="comment">/* don&#39;t leak the copy */</span>
<a name="l01264"></a>01264       va_end (args_copy);
<a name="l01265"></a>01265       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01266"></a>01266     }
<a name="l01267"></a>01267   
<a name="l01268"></a>01268   vsprintf ((<span class="keywordtype">char</span>*) (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + (real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> - len)),
<a name="l01269"></a>01269             format, args_copy);
<a name="l01270"></a>01270 
<a name="l01271"></a>01271   va_end (args_copy);
<a name="l01272"></a>01272 
<a name="l01273"></a>01273   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01274"></a>01274 }
<a name="l01275"></a>01275 
<a name="l01284"></a>01284 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01285"></a><a class="code" href="group__DBusString.html#gab0078cf7e0e5bd784ec6d6e0cc3923a2">01285</a> <a class="code" href="group__DBusString.html#gab0078cf7e0e5bd784ec6d6e0cc3923a2" title="Appends a printf-style formatted string to the DBusString.">_dbus_string_append_printf</a> (<a class="code" href="structDBusString.html">DBusString</a>        *str,
<a name="l01286"></a>01286                             <span class="keyword">const</span> <span class="keywordtype">char</span>        *format,
<a name="l01287"></a>01287                             ...)
<a name="l01288"></a>01288 {
<a name="l01289"></a>01289   va_list args;
<a name="l01290"></a>01290   <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a> retval;
<a name="l01291"></a>01291   
<a name="l01292"></a>01292   va_start (args, format);
<a name="l01293"></a>01293   retval = <a class="code" href="group__DBusString.html#ga8d794f292831d1a7edeb971b13a2c641" title="Appends a printf-style formatted string to the DBusString.">_dbus_string_append_printf_valist</a> (str, format, args);
<a name="l01294"></a>01294   va_end (args);
<a name="l01295"></a>01295 
<a name="l01296"></a>01296   <span class="keywordflow">return</span> retval;
<a name="l01297"></a>01297 }
<a name="l01298"></a>01298 
<a name="l01307"></a>01307 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01308"></a><a class="code" href="group__DBusString.html#ga724656b7091b910965bd1af42d0b7bab">01308</a> <a class="code" href="group__DBusString.html#ga724656b7091b910965bd1af42d0b7bab" title="Appends block of bytes with the given length to a DBusString.">_dbus_string_append_len</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l01309"></a>01309                          <span class="keyword">const</span> <span class="keywordtype">char</span> *buffer,
<a name="l01310"></a>01310                          <span class="keywordtype">int</span>         len)
<a name="l01311"></a>01311 {
<a name="l01312"></a>01312   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l01313"></a>01313   _dbus_assert (buffer != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l01314"></a>01314   _dbus_assert (len &gt;= 0);
<a name="l01315"></a>01315 
<a name="l01316"></a>01316   <span class="keywordflow">return</span> append (real, buffer, len);
<a name="l01317"></a>01317 }
<a name="l01318"></a>01318 
<a name="l01327"></a>01327 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01328"></a><a class="code" href="group__DBusString.html#gaa6ecf36e70263659f921a4ef0335db12">01328</a> <a class="code" href="group__DBusString.html#gaa6ecf36e70263659f921a4ef0335db12" title="Appends a single byte to the string, returning FALSE if not enough memory.">_dbus_string_append_byte</a> (<a class="code" href="structDBusString.html">DBusString</a>    *str,
<a name="l01329"></a>01329                           <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>  byte)
<a name="l01330"></a>01330 {
<a name="l01331"></a>01331   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l01332"></a>01332 
<a name="l01333"></a>01333   <span class="keywordflow">if</span> (!set_length (real, real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> + 1))
<a name="l01334"></a>01334     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01335"></a>01335 
<a name="l01336"></a>01336   real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>[real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>-1] = byte;
<a name="l01337"></a>01337 
<a name="l01338"></a>01338   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01339"></a>01339 }
<a name="l01340"></a>01340 
<a name="l01341"></a>01341 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l01342"></a>01342 <span class="preprocessor"></span>
<a name="l01349"></a>01349 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01350"></a>01350 _dbus_string_append_unichar (<a class="code" href="structDBusString.html">DBusString</a>    *str,
<a name="l01351"></a>01351                              dbus_unichar_t ch)
<a name="l01352"></a>01352 {
<a name="l01353"></a>01353   <span class="keywordtype">int</span> len;
<a name="l01354"></a>01354   <span class="keywordtype">int</span> first;
<a name="l01355"></a>01355   <span class="keywordtype">int</span> i;
<a name="l01356"></a>01356   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *out;
<a name="l01357"></a>01357   
<a name="l01358"></a>01358   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l01359"></a>01359 
<a name="l01360"></a>01360   <span class="comment">/* this code is from GLib but is pretty standard I think */</span>
<a name="l01361"></a>01361   
<a name="l01362"></a>01362   len = 0;
<a name="l01363"></a>01363   
<a name="l01364"></a>01364   <span class="keywordflow">if</span> (ch &lt; 0x80)
<a name="l01365"></a>01365     {
<a name="l01366"></a>01366       first = 0;
<a name="l01367"></a>01367       len = 1;
<a name="l01368"></a>01368     }
<a name="l01369"></a>01369   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ch &lt; 0x800)
<a name="l01370"></a>01370     {
<a name="l01371"></a>01371       first = 0xc0;
<a name="l01372"></a>01372       len = 2;
<a name="l01373"></a>01373     }
<a name="l01374"></a>01374   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ch &lt; 0x10000)
<a name="l01375"></a>01375     {
<a name="l01376"></a>01376       first = 0xe0;
<a name="l01377"></a>01377       len = 3;
<a name="l01378"></a>01378     }
<a name="l01379"></a>01379    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ch &lt; 0x200000)
<a name="l01380"></a>01380     {
<a name="l01381"></a>01381       first = 0xf0;
<a name="l01382"></a>01382       len = 4;
<a name="l01383"></a>01383     }
<a name="l01384"></a>01384   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ch &lt; 0x4000000)
<a name="l01385"></a>01385     {
<a name="l01386"></a>01386       first = 0xf8;
<a name="l01387"></a>01387       len = 5;
<a name="l01388"></a>01388     }
<a name="l01389"></a>01389   <span class="keywordflow">else</span>
<a name="l01390"></a>01390     {
<a name="l01391"></a>01391       first = 0xfc;
<a name="l01392"></a>01392       len = 6;
<a name="l01393"></a>01393     }
<a name="l01394"></a>01394 
<a name="l01395"></a>01395   <span class="keywordflow">if</span> (len &gt; (real-&gt;<a class="code" href="structDBusRealString.html#aeb48dcb099660ffc277883166fa72159" title="Max length of this string, without nul byte.">max_length</a> - real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>))
<a name="l01396"></a>01396     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>; <span class="comment">/* real-&gt;len + len would overflow */</span>
<a name="l01397"></a>01397   
<a name="l01398"></a>01398   <span class="keywordflow">if</span> (!set_length (real, real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> + len))
<a name="l01399"></a>01399     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01400"></a>01400 
<a name="l01401"></a>01401   out = real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + (real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> - len);
<a name="l01402"></a>01402   
<a name="l01403"></a>01403   <span class="keywordflow">for</span> (i = len - 1; i &gt; 0; --i)
<a name="l01404"></a>01404     {
<a name="l01405"></a>01405       out[i] = (ch &amp; 0x3f) | 0x80;
<a name="l01406"></a>01406       ch &gt;&gt;= 6;
<a name="l01407"></a>01407     }
<a name="l01408"></a>01408   out[0] = ch | first;
<a name="l01409"></a>01409 
<a name="l01410"></a>01410   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01411"></a>01411 }
<a name="l01412"></a>01412 <span class="preprocessor">#endif </span><span class="comment">/* DBUS_BUILD_TESTS */</span>
<a name="l01413"></a>01413 
<a name="l01414"></a>01414 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01415"></a>01415 <span class="keyword">delete</span> (<a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *real,
<a name="l01416"></a>01416         <span class="keywordtype">int</span>             start,
<a name="l01417"></a>01417         <span class="keywordtype">int</span>             len)
<a name="l01418"></a>01418 {
<a name="l01419"></a>01419   <span class="keywordflow">if</span> (len == 0)
<a name="l01420"></a>01420     <span class="keywordflow">return</span>;
<a name="l01421"></a>01421   
<a name="l01422"></a>01422   memmove (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + start, real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + start + len, real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> - (start + len));
<a name="l01423"></a>01423   real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> -= len;
<a name="l01424"></a>01424   real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>[real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01425"></a>01425 }
<a name="l01426"></a>01426 
<a name="l01436"></a>01436 <span class="keywordtype">void</span>
<a name="l01437"></a><a class="code" href="group__DBusString.html#ga7e0e164ad5bb094e5ccad9edc7ae4235">01437</a> <a class="code" href="group__DBusString.html#ga7e0e164ad5bb094e5ccad9edc7ae4235" title="Deletes a segment of a DBusString with length len starting at start.">_dbus_string_delete</a> (<a class="code" href="structDBusString.html">DBusString</a>       *str,
<a name="l01438"></a>01438                      <span class="keywordtype">int</span>               start,
<a name="l01439"></a>01439                      <span class="keywordtype">int</span>               len)
<a name="l01440"></a>01440 {
<a name="l01441"></a>01441   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l01442"></a>01442   _dbus_assert (start &gt;= 0);
<a name="l01443"></a>01443   _dbus_assert (len &gt;= 0);
<a name="l01444"></a>01444   _dbus_assert (start &lt;= real-&gt;len);
<a name="l01445"></a>01445   _dbus_assert (len &lt;= real-&gt;len - start);
<a name="l01446"></a>01446   
<a name="l01447"></a>01447   <span class="keyword">delete</span> (real, start, len);
<a name="l01448"></a>01448 }
<a name="l01449"></a>01449 
<a name="l01450"></a>01450 <span class="keyword">static</span> <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01451"></a>01451 copy (<a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *source,
<a name="l01452"></a>01452       <span class="keywordtype">int</span>             start,
<a name="l01453"></a>01453       <span class="keywordtype">int</span>             len,
<a name="l01454"></a>01454       <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *dest,
<a name="l01455"></a>01455       <span class="keywordtype">int</span>             insert_at)
<a name="l01456"></a>01456 {
<a name="l01457"></a>01457   <span class="keywordflow">if</span> (len == 0)
<a name="l01458"></a>01458     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01459"></a>01459 
<a name="l01460"></a>01460   <span class="keywordflow">if</span> (!open_gap (len, dest, insert_at))
<a name="l01461"></a>01461     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01462"></a>01462   
<a name="l01463"></a>01463   memmove (dest-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + insert_at,
<a name="l01464"></a>01464            source-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + start,
<a name="l01465"></a>01465            len);
<a name="l01466"></a>01466 
<a name="l01467"></a>01467   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01468"></a>01468 }
<a name="l01469"></a>01469 
<a name="l01479"></a><a class="code" href="group__DBusString.html#gaacbbd102b66aa34dd13f792e7f08c205">01479</a> <span class="preprocessor">#define DBUS_STRING_COPY_PREAMBLE(source, start, dest, insert_at)       \</span>
<a name="l01480"></a>01480 <span class="preprocessor">  DBusRealString *real_source = (DBusRealString*) source;               \</span>
<a name="l01481"></a>01481 <span class="preprocessor">  DBusRealString *real_dest = (DBusRealString*) dest;                   \</span>
<a name="l01482"></a>01482 <span class="preprocessor">  _dbus_assert ((source) != (dest));                                    \</span>
<a name="l01483"></a>01483 <span class="preprocessor">  DBUS_GENERIC_STRING_PREAMBLE (real_source);                           \</span>
<a name="l01484"></a>01484 <span class="preprocessor">  DBUS_GENERIC_STRING_PREAMBLE (real_dest);                             \</span>
<a name="l01485"></a>01485 <span class="preprocessor">  _dbus_assert (!real_dest-&gt;constant);                                  \</span>
<a name="l01486"></a>01486 <span class="preprocessor">  _dbus_assert (!real_dest-&gt;locked);                                    \</span>
<a name="l01487"></a>01487 <span class="preprocessor">  _dbus_assert ((start) &gt;= 0);                                          \</span>
<a name="l01488"></a>01488 <span class="preprocessor">  _dbus_assert ((start) &lt;= real_source-&gt;len);                           \</span>
<a name="l01489"></a>01489 <span class="preprocessor">  _dbus_assert ((insert_at) &gt;= 0);                                      \</span>
<a name="l01490"></a>01490 <span class="preprocessor">  _dbus_assert ((insert_at) &lt;= real_dest-&gt;len)</span>
<a name="l01491"></a>01491 <span class="preprocessor"></span>
<a name="l01502"></a>01502 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01503"></a><a class="code" href="group__DBusString.html#gad379fce8d4ef4f7e28f81f50b46ee4c9">01503</a> <a class="code" href="group__DBusString.html#gad379fce8d4ef4f7e28f81f50b46ee4c9" title="Moves the end of one string into another string.">_dbus_string_move</a> (<a class="code" href="structDBusString.html">DBusString</a>       *source,
<a name="l01504"></a>01504                    <span class="keywordtype">int</span>               start,
<a name="l01505"></a>01505                    <a class="code" href="structDBusString.html">DBusString</a>       *dest,
<a name="l01506"></a>01506                    <span class="keywordtype">int</span>               insert_at)
<a name="l01507"></a>01507 {
<a name="l01508"></a>01508   <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *real_source = (<a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a>*) source;
<a name="l01509"></a>01509   _dbus_assert (start &lt;= real_source-&gt;len);
<a name="l01510"></a>01510   
<a name="l01511"></a>01511   <span class="keywordflow">return</span> <a class="code" href="group__DBusString.html#gab8e2dcb2dc71bf225da0827c6086a727" title="Like _dbus_string_move(), but can move a segment from the middle of the source string.">_dbus_string_move_len</a> (source, start,
<a name="l01512"></a>01512                                 real_source-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> - start,
<a name="l01513"></a>01513                                 dest, insert_at);
<a name="l01514"></a>01514 }
<a name="l01515"></a>01515 
<a name="l01526"></a>01526 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01527"></a><a class="code" href="group__DBusString.html#ga3c10f0d1bcaa3b450025b9c6a8b901d7">01527</a> <a class="code" href="group__DBusString.html#ga3c10f0d1bcaa3b450025b9c6a8b901d7" title="Like _dbus_string_move(), but does not delete the section of the source string that&#39;s copied to the d...">_dbus_string_copy</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *source,
<a name="l01528"></a>01528                    <span class="keywordtype">int</span>               start,
<a name="l01529"></a>01529                    <a class="code" href="structDBusString.html">DBusString</a>       *dest,
<a name="l01530"></a>01530                    <span class="keywordtype">int</span>               insert_at)
<a name="l01531"></a>01531 {
<a name="l01532"></a>01532   <a class="code" href="group__DBusString.html#gaacbbd102b66aa34dd13f792e7f08c205" title="Checks assertions for two strings we&#39;re copying a segment between, and declares real_source/real_dest...">DBUS_STRING_COPY_PREAMBLE</a> (source, start, dest, insert_at);
<a name="l01533"></a>01533 
<a name="l01534"></a>01534   <span class="keywordflow">return</span> copy (real_source, start,
<a name="l01535"></a>01535                real_source-&gt;len - start,
<a name="l01536"></a>01536                real_dest,
<a name="l01537"></a>01537                insert_at);
<a name="l01538"></a>01538 }
<a name="l01539"></a>01539 
<a name="l01554"></a>01554 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01555"></a><a class="code" href="group__DBusString.html#gab8e2dcb2dc71bf225da0827c6086a727">01555</a> <a class="code" href="group__DBusString.html#gab8e2dcb2dc71bf225da0827c6086a727" title="Like _dbus_string_move(), but can move a segment from the middle of the source string.">_dbus_string_move_len</a> (<a class="code" href="structDBusString.html">DBusString</a>       *source,
<a name="l01556"></a>01556                        <span class="keywordtype">int</span>               start,
<a name="l01557"></a>01557                        <span class="keywordtype">int</span>               len,
<a name="l01558"></a>01558                        <a class="code" href="structDBusString.html">DBusString</a>       *dest,
<a name="l01559"></a>01559                        <span class="keywordtype">int</span>               insert_at)
<a name="l01560"></a>01560 
<a name="l01561"></a>01561 {
<a name="l01562"></a>01562   <a class="code" href="group__DBusString.html#gaacbbd102b66aa34dd13f792e7f08c205" title="Checks assertions for two strings we&#39;re copying a segment between, and declares real_source/real_dest...">DBUS_STRING_COPY_PREAMBLE</a> (source, start, dest, insert_at);
<a name="l01563"></a>01563   _dbus_assert (len &gt;= 0);
<a name="l01564"></a>01564   _dbus_assert ((start + len) &lt;= real_source-&gt;len);
<a name="l01565"></a>01565 
<a name="l01566"></a>01566 
<a name="l01567"></a>01567   <span class="keywordflow">if</span> (len == 0)
<a name="l01568"></a>01568     {
<a name="l01569"></a>01569       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01570"></a>01570     }
<a name="l01571"></a>01571   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (start == 0 &amp;&amp;
<a name="l01572"></a>01572            len == real_source-&gt;len &amp;&amp;
<a name="l01573"></a>01573            real_dest-&gt;len == 0)
<a name="l01574"></a>01574     {
<a name="l01575"></a>01575       <span class="comment">/* Short-circuit moving an entire existing string to an empty string</span>
<a name="l01576"></a>01576 <span class="comment">       * by just swapping the buffers.</span>
<a name="l01577"></a>01577 <span class="comment">       */</span>
<a name="l01578"></a>01578       <span class="comment">/* we assume -&gt;constant doesn&#39;t matter as you can&#39;t have</span>
<a name="l01579"></a>01579 <span class="comment">       * a constant string involved in a move.</span>
<a name="l01580"></a>01580 <span class="comment">       */</span>
<a name="l01581"></a>01581 <span class="preprocessor">#define ASSIGN_DATA(a, b) do {                  \</span>
<a name="l01582"></a>01582 <span class="preprocessor">        (a)-&gt;str = (b)-&gt;str;                    \</span>
<a name="l01583"></a>01583 <span class="preprocessor">        (a)-&gt;len = (b)-&gt;len;                    \</span>
<a name="l01584"></a>01584 <span class="preprocessor">        (a)-&gt;allocated = (b)-&gt;allocated;        \</span>
<a name="l01585"></a>01585 <span class="preprocessor">        (a)-&gt;align_offset = (b)-&gt;align_offset;  \</span>
<a name="l01586"></a>01586 <span class="preprocessor">      } while (0)</span>
<a name="l01587"></a>01587 <span class="preprocessor"></span>      
<a name="l01588"></a>01588       <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> tmp;
<a name="l01589"></a>01589 
<a name="l01590"></a>01590       ASSIGN_DATA (&amp;tmp, real_source);
<a name="l01591"></a>01591       ASSIGN_DATA (real_source, real_dest);
<a name="l01592"></a>01592       ASSIGN_DATA (real_dest, &amp;tmp);
<a name="l01593"></a>01593 
<a name="l01594"></a>01594       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01595"></a>01595     }
<a name="l01596"></a>01596   <span class="keywordflow">else</span>
<a name="l01597"></a>01597     {
<a name="l01598"></a>01598       <span class="keywordflow">if</span> (!copy (real_source, start, len,
<a name="l01599"></a>01599                  real_dest,
<a name="l01600"></a>01600                  insert_at))
<a name="l01601"></a>01601         <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01602"></a>01602       
<a name="l01603"></a>01603       <span class="keyword">delete</span> (real_source, start,
<a name="l01604"></a>01604               len);
<a name="l01605"></a>01605       
<a name="l01606"></a>01606       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01607"></a>01607     }
<a name="l01608"></a>01608 }
<a name="l01609"></a>01609 
<a name="l01621"></a>01621 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01622"></a><a class="code" href="group__DBusString.html#gaf5f13bc7ac7a623516930d26ae2589bf">01622</a> <a class="code" href="group__DBusString.html#gaf5f13bc7ac7a623516930d26ae2589bf" title="Like _dbus_string_copy(), but can copy a segment from the middle of the source string.">_dbus_string_copy_len</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *source,
<a name="l01623"></a>01623                        <span class="keywordtype">int</span>               start,
<a name="l01624"></a>01624                        <span class="keywordtype">int</span>               len,
<a name="l01625"></a>01625                        <a class="code" href="structDBusString.html">DBusString</a>       *dest,
<a name="l01626"></a>01626                        <span class="keywordtype">int</span>               insert_at)
<a name="l01627"></a>01627 {
<a name="l01628"></a>01628   <a class="code" href="group__DBusString.html#gaacbbd102b66aa34dd13f792e7f08c205" title="Checks assertions for two strings we&#39;re copying a segment between, and declares real_source/real_dest...">DBUS_STRING_COPY_PREAMBLE</a> (source, start, dest, insert_at);
<a name="l01629"></a>01629   _dbus_assert (len &gt;= 0);
<a name="l01630"></a>01630   _dbus_assert (start &lt;= real_source-&gt;len);
<a name="l01631"></a>01631   _dbus_assert (len &lt;= real_source-&gt;len - start);
<a name="l01632"></a>01632   
<a name="l01633"></a>01633   <span class="keywordflow">return</span> copy (real_source, start, len,
<a name="l01634"></a>01634                real_dest,
<a name="l01635"></a>01635                insert_at);
<a name="l01636"></a>01636 }
<a name="l01637"></a>01637 
<a name="l01659"></a>01659 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01660"></a><a class="code" href="group__DBusString.html#gafe7921a92467cdefaa0a7829d6cf260b">01660</a> <a class="code" href="group__DBusString.html#gafe7921a92467cdefaa0a7829d6cf260b" title="Replaces a segment of dest string with a segment of source string.">_dbus_string_replace_len</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *source,
<a name="l01661"></a>01661                           <span class="keywordtype">int</span>               start,
<a name="l01662"></a>01662                           <span class="keywordtype">int</span>               len,
<a name="l01663"></a>01663                           <a class="code" href="structDBusString.html">DBusString</a>       *dest,
<a name="l01664"></a>01664                           <span class="keywordtype">int</span>               replace_at,
<a name="l01665"></a>01665                           <span class="keywordtype">int</span>               replace_len)
<a name="l01666"></a>01666 {
<a name="l01667"></a>01667   <a class="code" href="group__DBusString.html#gaacbbd102b66aa34dd13f792e7f08c205" title="Checks assertions for two strings we&#39;re copying a segment between, and declares real_source/real_dest...">DBUS_STRING_COPY_PREAMBLE</a> (source, start, dest, replace_at);
<a name="l01668"></a>01668   _dbus_assert (len &gt;= 0);
<a name="l01669"></a>01669   _dbus_assert (start &lt;= real_source-&gt;len);
<a name="l01670"></a>01670   _dbus_assert (len &lt;= real_source-&gt;len - start);
<a name="l01671"></a>01671   _dbus_assert (replace_at &gt;= 0);
<a name="l01672"></a>01672   _dbus_assert (replace_at &lt;= real_dest-&gt;len);
<a name="l01673"></a>01673   _dbus_assert (replace_len &lt;= real_dest-&gt;len - replace_at);
<a name="l01674"></a>01674 
<a name="l01675"></a>01675   <span class="keywordflow">if</span> (!copy (real_source, start, len,
<a name="l01676"></a>01676              real_dest, replace_at))
<a name="l01677"></a>01677     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01678"></a>01678 
<a name="l01679"></a>01679   <span class="keyword">delete</span> (real_dest, replace_at + len, replace_len);
<a name="l01680"></a>01680 
<a name="l01681"></a>01681   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01682"></a>01682 }
<a name="l01683"></a>01683 
<a name="l01696"></a>01696 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01697"></a><a class="code" href="group__DBusString.html#ga5d293b49b6afbbd74069d0823acce6b5">01697</a> <a class="code" href="group__DBusString.html#ga5d293b49b6afbbd74069d0823acce6b5" title="Looks for the first occurance of a byte, deletes that byte, and moves everything after the byte to th...">_dbus_string_split_on_byte</a> (<a class="code" href="structDBusString.html">DBusString</a>        *source,
<a name="l01698"></a>01698                             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>      byte,
<a name="l01699"></a>01699                             <a class="code" href="structDBusString.html">DBusString</a>        *tail)
<a name="l01700"></a>01700 {
<a name="l01701"></a>01701   <span class="keywordtype">int</span> byte_position;
<a name="l01702"></a>01702   <span class="keywordtype">char</span> byte_string[2] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01703"></a>01703   <span class="keywordtype">int</span> head_length;
<a name="l01704"></a>01704   <span class="keywordtype">int</span> tail_length;
<a name="l01705"></a>01705 
<a name="l01706"></a>01706   byte_string[0] = (char) byte;
<a name="l01707"></a>01707 
<a name="l01708"></a>01708   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#ga5fe47873b2838339107c3e1f03d1a703" title="Finds the given substring in the string, returning TRUE and filling in the byte index where the subst...">_dbus_string_find</a> (source, 0, byte_string, &amp;byte_position))
<a name="l01709"></a>01709     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01710"></a>01710 
<a name="l01711"></a>01711   head_length = byte_position;
<a name="l01712"></a>01712   tail_length = _dbus_string_get_length (source) - head_length - 1;
<a name="l01713"></a>01713 
<a name="l01714"></a>01714   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#gab8e2dcb2dc71bf225da0827c6086a727" title="Like _dbus_string_move(), but can move a segment from the middle of the source string.">_dbus_string_move_len</a> (source, byte_position + 1, tail_length,
<a name="l01715"></a>01715                               tail, 0))
<a name="l01716"></a>01716     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01717"></a>01717 
<a name="l01718"></a>01718   <span class="comment">/* remove the trailing delimiter byte from the head now.</span>
<a name="l01719"></a>01719 <span class="comment">   */</span>
<a name="l01720"></a>01720   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#ga08c423b93c28dd746dcb93e0461ab95c" title="Sets the length of a string.">_dbus_string_set_length</a> (source, head_length))
<a name="l01721"></a>01721     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01722"></a>01722 
<a name="l01723"></a>01723   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01724"></a>01724 }
<a name="l01725"></a>01725 
<a name="l01726"></a>01726 <span class="comment">/* Unicode macros and utf8_validate() from GLib Owen Taylor, Havoc</span>
<a name="l01727"></a>01727 <span class="comment"> * Pennington, and Tom Tromey are the authors and authorized relicense.</span>
<a name="l01728"></a>01728 <span class="comment"> */</span>
<a name="l01729"></a>01729 
<a name="l01735"></a><a class="code" href="group__DBusString.html#ga30614080229a4fb63460ffdc8ab484fb">01735</a> <span class="preprocessor">#define UTF8_COMPUTE(Char, Mask, Len)                                         \</span>
<a name="l01736"></a>01736 <span class="preprocessor">  if (Char &lt; 128)                                                             \</span>
<a name="l01737"></a>01737 <span class="preprocessor">    {                                                                         \</span>
<a name="l01738"></a>01738 <span class="preprocessor">      Len = 1;                                                                \</span>
<a name="l01739"></a>01739 <span class="preprocessor">      Mask = 0x7f;                                                            \</span>
<a name="l01740"></a>01740 <span class="preprocessor">    }                                                                         \</span>
<a name="l01741"></a>01741 <span class="preprocessor">  else if ((Char &amp; 0xe0) == 0xc0)                                             \</span>
<a name="l01742"></a>01742 <span class="preprocessor">    {                                                                         \</span>
<a name="l01743"></a>01743 <span class="preprocessor">      Len = 2;                                                                \</span>
<a name="l01744"></a>01744 <span class="preprocessor">      Mask = 0x1f;                                                            \</span>
<a name="l01745"></a>01745 <span class="preprocessor">    }                                                                         \</span>
<a name="l01746"></a>01746 <span class="preprocessor">  else if ((Char &amp; 0xf0) == 0xe0)                                             \</span>
<a name="l01747"></a>01747 <span class="preprocessor">    {                                                                         \</span>
<a name="l01748"></a>01748 <span class="preprocessor">      Len = 3;                                                                \</span>
<a name="l01749"></a>01749 <span class="preprocessor">      Mask = 0x0f;                                                            \</span>
<a name="l01750"></a>01750 <span class="preprocessor">    }                                                                         \</span>
<a name="l01751"></a>01751 <span class="preprocessor">  else if ((Char &amp; 0xf8) == 0xf0)                                             \</span>
<a name="l01752"></a>01752 <span class="preprocessor">    {                                                                         \</span>
<a name="l01753"></a>01753 <span class="preprocessor">      Len = 4;                                                                \</span>
<a name="l01754"></a>01754 <span class="preprocessor">      Mask = 0x07;                                                            \</span>
<a name="l01755"></a>01755 <span class="preprocessor">    }                                                                         \</span>
<a name="l01756"></a>01756 <span class="preprocessor">  else if ((Char &amp; 0xfc) == 0xf8)                                             \</span>
<a name="l01757"></a>01757 <span class="preprocessor">    {                                                                         \</span>
<a name="l01758"></a>01758 <span class="preprocessor">      Len = 5;                                                                \</span>
<a name="l01759"></a>01759 <span class="preprocessor">      Mask = 0x03;                                                            \</span>
<a name="l01760"></a>01760 <span class="preprocessor">    }                                                                         \</span>
<a name="l01761"></a>01761 <span class="preprocessor">  else if ((Char &amp; 0xfe) == 0xfc)                                             \</span>
<a name="l01762"></a>01762 <span class="preprocessor">    {                                                                         \</span>
<a name="l01763"></a>01763 <span class="preprocessor">      Len = 6;                                                                \</span>
<a name="l01764"></a>01764 <span class="preprocessor">      Mask = 0x01;                                                            \</span>
<a name="l01765"></a>01765 <span class="preprocessor">    }                                                                         \</span>
<a name="l01766"></a>01766 <span class="preprocessor">  else                                                                        \</span>
<a name="l01767"></a>01767 <span class="preprocessor">    {                                                                         \</span>
<a name="l01768"></a>01768 <span class="preprocessor">      Len = 0;                                                               \</span>
<a name="l01769"></a>01769 <span class="preprocessor">      Mask = 0;                                                               \</span>
<a name="l01770"></a>01770 <span class="preprocessor">    }</span>
<a name="l01771"></a>01771 <span class="preprocessor"></span>
<a name="l01776"></a><a class="code" href="group__DBusString.html#ga9691ff5386e218870299de1d9e77ceea">01776</a> <span class="preprocessor">#define UTF8_LENGTH(Char)              \</span>
<a name="l01777"></a>01777 <span class="preprocessor">  ((Char) &lt; 0x80 ? 1 :                 \</span>
<a name="l01778"></a>01778 <span class="preprocessor">   ((Char) &lt; 0x800 ? 2 :               \</span>
<a name="l01779"></a>01779 <span class="preprocessor">    ((Char) &lt; 0x10000 ? 3 :            \</span>
<a name="l01780"></a>01780 <span class="preprocessor">     ((Char) &lt; 0x200000 ? 4 :          \</span>
<a name="l01781"></a>01781 <span class="preprocessor">      ((Char) &lt; 0x4000000 ? 5 : 6)))))</span>
<a name="l01782"></a>01782 <span class="preprocessor"></span>   
<a name="l01792"></a><a class="code" href="group__DBusString.html#gab5b4b316a69f78611a14e6b1fd091992">01792</a> <span class="preprocessor">#define UTF8_GET(Result, Chars, Count, Mask, Len)                             \</span>
<a name="l01793"></a>01793 <span class="preprocessor">  (Result) = (Chars)[0] &amp; (Mask);                                             \</span>
<a name="l01794"></a>01794 <span class="preprocessor">  for ((Count) = 1; (Count) &lt; (Len); ++(Count))                               \</span>
<a name="l01795"></a>01795 <span class="preprocessor">    {                                                                         \</span>
<a name="l01796"></a>01796 <span class="preprocessor">      if (((Chars)[(Count)] &amp; 0xc0) != 0x80)                                  \</span>
<a name="l01797"></a>01797 <span class="preprocessor">        {                                                                     \</span>
<a name="l01798"></a>01798 <span class="preprocessor">          (Result) = -1;                                                      \</span>
<a name="l01799"></a>01799 <span class="preprocessor">          break;                                                              \</span>
<a name="l01800"></a>01800 <span class="preprocessor">        }                                                                     \</span>
<a name="l01801"></a>01801 <span class="preprocessor">      (Result) &lt;&lt;= 6;                                                         \</span>
<a name="l01802"></a>01802 <span class="preprocessor">      (Result) |= ((Chars)[(Count)] &amp; 0x3f);                                  \</span>
<a name="l01803"></a>01803 <span class="preprocessor">    }</span>
<a name="l01804"></a>01804 <span class="preprocessor"></span>
<a name="l01821"></a><a class="code" href="group__DBusString.html#ga25f0a93fc023fa0eec07ac1e32011e89">01821</a> <span class="preprocessor">#define UNICODE_VALID(Char)                   \</span>
<a name="l01822"></a>01822 <span class="preprocessor">    ((Char) &lt; 0x110000 &amp;&amp;                     \</span>
<a name="l01823"></a>01823 <span class="preprocessor">     (((Char) &amp; 0xFFFFF800) != 0xD800) &amp;&amp;     \</span>
<a name="l01824"></a>01824 <span class="preprocessor">     ((Char) &lt; 0xFDD0 || (Char) &gt; 0xFDEF) &amp;&amp;  \</span>
<a name="l01825"></a>01825 <span class="preprocessor">     ((Char) &amp; 0xFFFE) != 0xFFFE)</span>
<a name="l01826"></a>01826 <span class="preprocessor"></span>
<a name="l01827"></a>01827 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l01828"></a>01828 <span class="preprocessor"></span>
<a name="l01838"></a>01838 <span class="keywordtype">void</span>
<a name="l01839"></a>01839 _dbus_string_get_unichar (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l01840"></a>01840                           <span class="keywordtype">int</span>               start,
<a name="l01841"></a>01841                           dbus_unichar_t   *ch_return,
<a name="l01842"></a>01842                           <span class="keywordtype">int</span>              *end_return)
<a name="l01843"></a>01843 {
<a name="l01844"></a>01844   <span class="keywordtype">int</span> i, mask, len;
<a name="l01845"></a>01845   dbus_unichar_t result;
<a name="l01846"></a>01846   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c;
<a name="l01847"></a>01847   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p;
<a name="l01848"></a>01848   <a class="code" href="group__DBusStringInternals.html#ga5cf5f12f6d8f839e9a7c3ad790a83316" title="Checks assertions about a string that may be const or locked.">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l01849"></a>01849   _dbus_assert (start &gt;= 0);
<a name="l01850"></a>01850   _dbus_assert (start &lt;= real-&gt;len);
<a name="l01851"></a>01851   
<a name="l01852"></a>01852   <span class="keywordflow">if</span> (ch_return)
<a name="l01853"></a>01853     *ch_return = 0;
<a name="l01854"></a>01854   <span class="keywordflow">if</span> (end_return)
<a name="l01855"></a>01855     *end_return = real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>;
<a name="l01856"></a>01856   
<a name="l01857"></a>01857   mask = 0;
<a name="l01858"></a>01858   p = real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + start;
<a name="l01859"></a>01859   c = *p;
<a name="l01860"></a>01860   
<a name="l01861"></a>01861   <a class="code" href="group__DBusString.html#ga30614080229a4fb63460ffdc8ab484fb" title="computes length and mask of a unicode character">UTF8_COMPUTE</a> (c, mask, len);
<a name="l01862"></a>01862   <span class="keywordflow">if</span> (len == 0)
<a name="l01863"></a>01863     <span class="keywordflow">return</span>;
<a name="l01864"></a>01864   <a class="code" href="group__DBusString.html#gab5b4b316a69f78611a14e6b1fd091992" title="Gets a UTF-8 value.">UTF8_GET</a> (result, p, i, mask, len);
<a name="l01865"></a>01865 
<a name="l01866"></a>01866   <span class="keywordflow">if</span> (result == (dbus_unichar_t)-1)
<a name="l01867"></a>01867     <span class="keywordflow">return</span>;
<a name="l01868"></a>01868 
<a name="l01869"></a>01869   <span class="keywordflow">if</span> (ch_return)
<a name="l01870"></a>01870     *ch_return = result;
<a name="l01871"></a>01871   <span class="keywordflow">if</span> (end_return)
<a name="l01872"></a>01872     *end_return = start + len;
<a name="l01873"></a>01873 }
<a name="l01874"></a>01874 <span class="preprocessor">#endif </span><span class="comment">/* DBUS_BUILD_TESTS */</span>
<a name="l01875"></a>01875 
<a name="l01890"></a>01890 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01891"></a><a class="code" href="group__DBusString.html#ga5fe47873b2838339107c3e1f03d1a703">01891</a> <a class="code" href="group__DBusString.html#ga5fe47873b2838339107c3e1f03d1a703" title="Finds the given substring in the string, returning TRUE and filling in the byte index where the subst...">_dbus_string_find</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l01892"></a>01892                    <span class="keywordtype">int</span>               start,
<a name="l01893"></a>01893                    <span class="keyword">const</span> <span class="keywordtype">char</span>       *substr,
<a name="l01894"></a>01894                    <span class="keywordtype">int</span>              *found)
<a name="l01895"></a>01895 {
<a name="l01896"></a>01896   <span class="keywordflow">return</span> <a class="code" href="group__DBusString.html#gaf2281731c3119f946726680242a5ae02" title="Finds the given substring in the string, up to a certain position, returning TRUE and filling in the ...">_dbus_string_find_to</a> (str, start,
<a name="l01897"></a>01897                                ((<span class="keyword">const</span> <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a>*)str)-&gt;len,
<a name="l01898"></a>01898                                substr, found);
<a name="l01899"></a>01899 }
<a name="l01900"></a>01900 
<a name="l01913"></a>01913 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01914"></a><a class="code" href="group__DBusString.html#ga3c98d1913e3ba4deb8eda60b2e262fdb">01914</a> <a class="code" href="group__DBusString.html#ga3c98d1913e3ba4deb8eda60b2e262fdb" title="Finds end of line (&quot;\r\n&quot; or &quot;\n&quot;) in the string, returning TRUE and filling in the byte index where ...">_dbus_string_find_eol</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l01915"></a>01915                        <span class="keywordtype">int</span>               start,
<a name="l01916"></a>01916                        <span class="keywordtype">int</span>              *found,
<a name="l01917"></a>01917                        <span class="keywordtype">int</span>              *found_len)
<a name="l01918"></a>01918 {
<a name="l01919"></a>01919   <span class="keywordtype">int</span> i;
<a name="l01920"></a>01920 
<a name="l01921"></a>01921   <a class="code" href="group__DBusStringInternals.html#ga5cf5f12f6d8f839e9a7c3ad790a83316" title="Checks assertions about a string that may be const or locked.">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l01922"></a>01922   _dbus_assert (start &lt;= real-&gt;len);
<a name="l01923"></a>01923   _dbus_assert (start &gt;= 0);
<a name="l01924"></a>01924   
<a name="l01925"></a>01925   i = start;
<a name="l01926"></a>01926   <span class="keywordflow">while</span> (i &lt; real-&gt;len)
<a name="l01927"></a>01927     {
<a name="l01928"></a>01928       <span class="keywordflow">if</span> (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>[i] == <span class="charliteral">&#39;\r&#39;</span>) 
<a name="l01929"></a>01929         {
<a name="l01930"></a>01930           <span class="keywordflow">if</span> ((i+1) &lt; real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> &amp;&amp; real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>[i+1] == <span class="charliteral">&#39;\n&#39;</span>) <span class="comment">/* &quot;\r\n&quot; */</span>
<a name="l01931"></a>01931             {
<a name="l01932"></a>01932               <span class="keywordflow">if</span> (found) 
<a name="l01933"></a>01933                 *found = i;
<a name="l01934"></a>01934               <span class="keywordflow">if</span> (found_len)
<a name="l01935"></a>01935                 *found_len = 2;
<a name="l01936"></a>01936               <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01937"></a>01937             } 
<a name="l01938"></a>01938           <span class="keywordflow">else</span> <span class="comment">/* only &quot;\r&quot; */</span>
<a name="l01939"></a>01939             {
<a name="l01940"></a>01940               <span class="keywordflow">if</span> (found) 
<a name="l01941"></a>01941                 *found = i;
<a name="l01942"></a>01942               <span class="keywordflow">if</span> (found_len)
<a name="l01943"></a>01943                 *found_len = 1;
<a name="l01944"></a>01944               <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01945"></a>01945             }
<a name="l01946"></a>01946         } 
<a name="l01947"></a>01947       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>[i] == <span class="charliteral">&#39;\n&#39;</span>)  <span class="comment">/* only &quot;\n&quot; */</span>
<a name="l01948"></a>01948         {
<a name="l01949"></a>01949           <span class="keywordflow">if</span> (found) 
<a name="l01950"></a>01950             *found = i;
<a name="l01951"></a>01951           <span class="keywordflow">if</span> (found_len)
<a name="l01952"></a>01952             *found_len = 1;
<a name="l01953"></a>01953           <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01954"></a>01954         }
<a name="l01955"></a>01955       ++i;
<a name="l01956"></a>01956     }
<a name="l01957"></a>01957 
<a name="l01958"></a>01958   <span class="keywordflow">if</span> (found)
<a name="l01959"></a>01959     *found = real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>;
<a name="l01960"></a>01960 
<a name="l01961"></a>01961   <span class="keywordflow">if</span> (found_len)
<a name="l01962"></a>01962     *found_len = 0;
<a name="l01963"></a>01963   
<a name="l01964"></a>01964   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01965"></a>01965 }
<a name="l01966"></a>01966 
<a name="l01983"></a>01983 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01984"></a><a class="code" href="group__DBusString.html#gaf2281731c3119f946726680242a5ae02">01984</a> <a class="code" href="group__DBusString.html#gaf2281731c3119f946726680242a5ae02" title="Finds the given substring in the string, up to a certain position, returning TRUE and filling in the ...">_dbus_string_find_to</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l01985"></a>01985                       <span class="keywordtype">int</span>               start,
<a name="l01986"></a>01986                       <span class="keywordtype">int</span>               end,
<a name="l01987"></a>01987                       <span class="keyword">const</span> <span class="keywordtype">char</span>       *substr,
<a name="l01988"></a>01988                       <span class="keywordtype">int</span>              *found)
<a name="l01989"></a>01989 {
<a name="l01990"></a>01990   <span class="keywordtype">int</span> i;
<a name="l01991"></a>01991   <a class="code" href="group__DBusStringInternals.html#ga5cf5f12f6d8f839e9a7c3ad790a83316" title="Checks assertions about a string that may be const or locked.">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l01992"></a>01992   _dbus_assert (substr != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l01993"></a>01993   _dbus_assert (start &lt;= real-&gt;len);
<a name="l01994"></a>01994   _dbus_assert (start &gt;= 0);
<a name="l01995"></a>01995   _dbus_assert (substr != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l01996"></a>01996   _dbus_assert (end &lt;= real-&gt;len);
<a name="l01997"></a>01997   _dbus_assert (start &lt;= end);
<a name="l01998"></a>01998 
<a name="l01999"></a>01999   <span class="comment">/* we always &quot;find&quot; an empty string */</span>
<a name="l02000"></a>02000   <span class="keywordflow">if</span> (*substr == <span class="charliteral">&#39;\0&#39;</span>)
<a name="l02001"></a>02001     {
<a name="l02002"></a>02002       <span class="keywordflow">if</span> (found)
<a name="l02003"></a>02003         *found = start;
<a name="l02004"></a>02004       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l02005"></a>02005     }
<a name="l02006"></a>02006 
<a name="l02007"></a>02007   i = start;
<a name="l02008"></a>02008   <span class="keywordflow">while</span> (i &lt; end)
<a name="l02009"></a>02009     {
<a name="l02010"></a>02010       <span class="keywordflow">if</span> (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>[i] == substr[0])
<a name="l02011"></a>02011         {
<a name="l02012"></a>02012           <span class="keywordtype">int</span> j = i + 1;
<a name="l02013"></a>02013           
<a name="l02014"></a>02014           <span class="keywordflow">while</span> (j &lt; end)
<a name="l02015"></a>02015             {
<a name="l02016"></a>02016               <span class="keywordflow">if</span> (substr[j - i] == <span class="charliteral">&#39;\0&#39;</span>)
<a name="l02017"></a>02017                 <span class="keywordflow">break</span>;
<a name="l02018"></a>02018               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>[j] != substr[j - i])
<a name="l02019"></a>02019                 <span class="keywordflow">break</span>;
<a name="l02020"></a>02020               
<a name="l02021"></a>02021               ++j;
<a name="l02022"></a>02022             }
<a name="l02023"></a>02023 
<a name="l02024"></a>02024           <span class="keywordflow">if</span> (substr[j - i] == <span class="charliteral">&#39;\0&#39;</span>)
<a name="l02025"></a>02025             {
<a name="l02026"></a>02026               <span class="keywordflow">if</span> (found)
<a name="l02027"></a>02027                 *found = i;
<a name="l02028"></a>02028               <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l02029"></a>02029             }
<a name="l02030"></a>02030         }
<a name="l02031"></a>02031       
<a name="l02032"></a>02032       ++i;
<a name="l02033"></a>02033     }
<a name="l02034"></a>02034 
<a name="l02035"></a>02035   <span class="keywordflow">if</span> (found)
<a name="l02036"></a>02036     *found = end;
<a name="l02037"></a>02037   
<a name="l02038"></a>02038   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;  
<a name="l02039"></a>02039 }
<a name="l02040"></a>02040 
<a name="l02051"></a>02051 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l02052"></a><a class="code" href="group__DBusString.html#ga677ddb4246c7e7f67ed3145dc3c1c96b">02052</a> <a class="code" href="group__DBusString.html#ga677ddb4246c7e7f67ed3145dc3c1c96b" title="Finds a blank (space or tab) in the string.">_dbus_string_find_blank</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l02053"></a>02053                          <span class="keywordtype">int</span>               start,
<a name="l02054"></a>02054                          <span class="keywordtype">int</span>              *found)
<a name="l02055"></a>02055 {
<a name="l02056"></a>02056   <span class="keywordtype">int</span> i;
<a name="l02057"></a>02057   <a class="code" href="group__DBusStringInternals.html#ga5cf5f12f6d8f839e9a7c3ad790a83316" title="Checks assertions about a string that may be const or locked.">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l02058"></a>02058   _dbus_assert (start &lt;= real-&gt;len);
<a name="l02059"></a>02059   _dbus_assert (start &gt;= 0);
<a name="l02060"></a>02060   
<a name="l02061"></a>02061   i = start;
<a name="l02062"></a>02062   <span class="keywordflow">while</span> (i &lt; real-&gt;len)
<a name="l02063"></a>02063     {
<a name="l02064"></a>02064       <span class="keywordflow">if</span> (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>[i] == <span class="charliteral">&#39; &#39;</span> ||
<a name="l02065"></a>02065           real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>[i] == <span class="charliteral">&#39;\t&#39;</span>)
<a name="l02066"></a>02066         {
<a name="l02067"></a>02067           <span class="keywordflow">if</span> (found)
<a name="l02068"></a>02068             *found = i;
<a name="l02069"></a>02069           <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l02070"></a>02070         }
<a name="l02071"></a>02071       
<a name="l02072"></a>02072       ++i;
<a name="l02073"></a>02073     }
<a name="l02074"></a>02074 
<a name="l02075"></a>02075   <span class="keywordflow">if</span> (found)
<a name="l02076"></a>02076     *found = real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>;
<a name="l02077"></a>02077   
<a name="l02078"></a>02078   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02079"></a>02079 }
<a name="l02080"></a>02080 
<a name="l02089"></a>02089 <span class="keywordtype">void</span>
<a name="l02090"></a><a class="code" href="group__DBusString.html#ga5698b163289be0066cf10c0f1caf877a">02090</a> <a class="code" href="group__DBusString.html#ga5698b163289be0066cf10c0f1caf877a" title="Skips blanks from start, storing the first non-blank in *end (blank is space or tab).">_dbus_string_skip_blank</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l02091"></a>02091                          <span class="keywordtype">int</span>               start,
<a name="l02092"></a>02092                          <span class="keywordtype">int</span>              *end)
<a name="l02093"></a>02093 {
<a name="l02094"></a>02094   <span class="keywordtype">int</span> i;
<a name="l02095"></a>02095   <a class="code" href="group__DBusStringInternals.html#ga5cf5f12f6d8f839e9a7c3ad790a83316" title="Checks assertions about a string that may be const or locked.">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l02096"></a>02096   _dbus_assert (start &lt;= real-&gt;len);
<a name="l02097"></a>02097   _dbus_assert (start &gt;= 0);
<a name="l02098"></a>02098   
<a name="l02099"></a>02099   i = start;
<a name="l02100"></a>02100   <span class="keywordflow">while</span> (i &lt; real-&gt;len)
<a name="l02101"></a>02101     {
<a name="l02102"></a>02102       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusStringInternals.html#ga8f488964e430c0ae6a1a4204e0098dfe" title="Checks for ASCII blank byte.">DBUS_IS_ASCII_BLANK</a> (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>[i]))
<a name="l02103"></a>02103         <span class="keywordflow">break</span>;
<a name="l02104"></a>02104       
<a name="l02105"></a>02105       ++i;
<a name="l02106"></a>02106     }
<a name="l02107"></a>02107 
<a name="l02108"></a>02108   _dbus_assert (i == real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> || !<a class="code" href="group__DBusStringInternals.html#ga9c88845804be152df28b81d7cad5673a" title="Checks for ASCII whitespace byte.">DBUS_IS_ASCII_WHITE</a> (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>[i]));
<a name="l02109"></a>02109   
<a name="l02110"></a>02110   <span class="keywordflow">if</span> (end)
<a name="l02111"></a>02111     *end = i;
<a name="l02112"></a>02112 }
<a name="l02113"></a>02113 
<a name="l02114"></a>02114 
<a name="l02123"></a>02123 <span class="keywordtype">void</span>
<a name="l02124"></a><a class="code" href="group__DBusString.html#ga8600259d71a4adc14ab4558a9d2a0f7d">02124</a> <a class="code" href="group__DBusString.html#ga8600259d71a4adc14ab4558a9d2a0f7d" title="Skips whitespace from start, storing the first non-whitespace in *end.">_dbus_string_skip_white</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l02125"></a>02125                          <span class="keywordtype">int</span>               start,
<a name="l02126"></a>02126                          <span class="keywordtype">int</span>              *end)
<a name="l02127"></a>02127 {
<a name="l02128"></a>02128   <span class="keywordtype">int</span> i;
<a name="l02129"></a>02129   <a class="code" href="group__DBusStringInternals.html#ga5cf5f12f6d8f839e9a7c3ad790a83316" title="Checks assertions about a string that may be const or locked.">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l02130"></a>02130   _dbus_assert (start &lt;= real-&gt;len);
<a name="l02131"></a>02131   _dbus_assert (start &gt;= 0);
<a name="l02132"></a>02132   
<a name="l02133"></a>02133   i = start;
<a name="l02134"></a>02134   <span class="keywordflow">while</span> (i &lt; real-&gt;len)
<a name="l02135"></a>02135     {
<a name="l02136"></a>02136       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusStringInternals.html#ga9c88845804be152df28b81d7cad5673a" title="Checks for ASCII whitespace byte.">DBUS_IS_ASCII_WHITE</a> (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>[i]))
<a name="l02137"></a>02137         <span class="keywordflow">break</span>;
<a name="l02138"></a>02138       
<a name="l02139"></a>02139       ++i;
<a name="l02140"></a>02140     }
<a name="l02141"></a>02141 
<a name="l02142"></a>02142   _dbus_assert (i == real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> || !(<a class="code" href="group__DBusStringInternals.html#ga9c88845804be152df28b81d7cad5673a" title="Checks for ASCII whitespace byte.">DBUS_IS_ASCII_WHITE</a> (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>[i])));
<a name="l02143"></a>02143   
<a name="l02144"></a>02144   <span class="keywordflow">if</span> (end)
<a name="l02145"></a>02145     *end = i;
<a name="l02146"></a>02146 }
<a name="l02147"></a>02147 
<a name="l02156"></a>02156 <span class="keywordtype">void</span>
<a name="l02157"></a><a class="code" href="group__DBusString.html#ga578bb88acec5520825f2ba792cad7938">02157</a> <a class="code" href="group__DBusString.html#ga578bb88acec5520825f2ba792cad7938" title="Skips whitespace from end, storing the start index of the trailing whitespace in *start.">_dbus_string_skip_white_reverse</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l02158"></a>02158                                  <span class="keywordtype">int</span>               end,
<a name="l02159"></a>02159                                  <span class="keywordtype">int</span>              *start)
<a name="l02160"></a>02160 {
<a name="l02161"></a>02161   <span class="keywordtype">int</span> i;
<a name="l02162"></a>02162   <a class="code" href="group__DBusStringInternals.html#ga5cf5f12f6d8f839e9a7c3ad790a83316" title="Checks assertions about a string that may be const or locked.">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l02163"></a>02163   _dbus_assert (end &lt;= real-&gt;len);
<a name="l02164"></a>02164   _dbus_assert (end &gt;= 0);
<a name="l02165"></a>02165   
<a name="l02166"></a>02166   i = end;
<a name="l02167"></a>02167   <span class="keywordflow">while</span> (i &gt; 0)
<a name="l02168"></a>02168     {
<a name="l02169"></a>02169       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusStringInternals.html#ga9c88845804be152df28b81d7cad5673a" title="Checks for ASCII whitespace byte.">DBUS_IS_ASCII_WHITE</a> (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>[i-1]))
<a name="l02170"></a>02170         <span class="keywordflow">break</span>;
<a name="l02171"></a>02171       --i;
<a name="l02172"></a>02172     }
<a name="l02173"></a>02173 
<a name="l02174"></a>02174   _dbus_assert (i &gt;= 0 &amp;&amp; (i == 0 || !(<a class="code" href="group__DBusStringInternals.html#ga9c88845804be152df28b81d7cad5673a" title="Checks for ASCII whitespace byte.">DBUS_IS_ASCII_WHITE</a> (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>[i-1]))));
<a name="l02175"></a>02175   
<a name="l02176"></a>02176   <span class="keywordflow">if</span> (start)
<a name="l02177"></a>02177     *start = i;
<a name="l02178"></a>02178 }
<a name="l02179"></a>02179 
<a name="l02195"></a>02195 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l02196"></a><a class="code" href="group__DBusString.html#ga8b7fc22e6738173e1b2cef4b91b9c3c1">02196</a> <a class="code" href="group__DBusString.html#ga8b7fc22e6738173e1b2cef4b91b9c3c1" title="Assigns a newline-terminated or \r\n-terminated line from the front of the string to the given dest s...">_dbus_string_pop_line</a> (<a class="code" href="structDBusString.html">DBusString</a> *source,
<a name="l02197"></a>02197                        <a class="code" href="structDBusString.html">DBusString</a> *dest)
<a name="l02198"></a>02198 {
<a name="l02199"></a>02199   <span class="keywordtype">int</span> eol, eol_len;
<a name="l02200"></a>02200   
<a name="l02201"></a>02201   <a class="code" href="group__DBusString.html#ga08c423b93c28dd746dcb93e0461ab95c" title="Sets the length of a string.">_dbus_string_set_length</a> (dest, 0);
<a name="l02202"></a>02202   
<a name="l02203"></a>02203   eol = 0;
<a name="l02204"></a>02204   eol_len = 0;
<a name="l02205"></a>02205   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#ga3c98d1913e3ba4deb8eda60b2e262fdb" title="Finds end of line (&quot;\r\n&quot; or &quot;\n&quot;) in the string, returning TRUE and filling in the byte index where ...">_dbus_string_find_eol</a> (source, 0, &amp;eol, &amp;eol_len))
<a name="l02206"></a>02206     {
<a name="l02207"></a>02207       _dbus_assert (eol == _dbus_string_get_length (source));
<a name="l02208"></a>02208       <span class="keywordflow">if</span> (eol == 0)
<a name="l02209"></a>02209         {
<a name="l02210"></a>02210           <span class="comment">/* If there&#39;s no newline and source has zero length, we&#39;re done */</span>
<a name="l02211"></a>02211           <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02212"></a>02212         }
<a name="l02213"></a>02213       <span class="comment">/* otherwise, the last line of the file has no eol characters */</span>
<a name="l02214"></a>02214     }
<a name="l02215"></a>02215 
<a name="l02216"></a>02216   <span class="comment">/* remember eol can be 0 if it&#39;s an empty line, but eol_len should not be zero also</span>
<a name="l02217"></a>02217 <span class="comment">   * since find_eol returned TRUE</span>
<a name="l02218"></a>02218 <span class="comment">   */</span>
<a name="l02219"></a>02219   
<a name="l02220"></a>02220   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#gab8e2dcb2dc71bf225da0827c6086a727" title="Like _dbus_string_move(), but can move a segment from the middle of the source string.">_dbus_string_move_len</a> (source, 0, eol + eol_len, dest, 0))
<a name="l02221"></a>02221     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02222"></a>02222   
<a name="l02223"></a>02223   <span class="comment">/* remove line ending */</span>
<a name="l02224"></a>02224   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#ga08c423b93c28dd746dcb93e0461ab95c" title="Sets the length of a string.">_dbus_string_set_length</a> (dest, eol))
<a name="l02225"></a>02225     {
<a name="l02226"></a>02226       _dbus_assert_not_reached (<span class="stringliteral">&quot;out of memory when shortening a string&quot;</span>);
<a name="l02227"></a>02227       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02228"></a>02228     }
<a name="l02229"></a>02229 
<a name="l02230"></a>02230   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l02231"></a>02231 }
<a name="l02232"></a>02232 
<a name="l02233"></a>02233 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l02234"></a>02234 <span class="preprocessor"></span>
<a name="l02240"></a>02240 <span class="keywordtype">void</span>
<a name="l02241"></a>02241 _dbus_string_delete_first_word (<a class="code" href="structDBusString.html">DBusString</a> *str)
<a name="l02242"></a>02242 {
<a name="l02243"></a>02243   <span class="keywordtype">int</span> i;
<a name="l02244"></a>02244   
<a name="l02245"></a>02245   <span class="keywordflow">if</span> (<a class="code" href="group__DBusString.html#ga677ddb4246c7e7f67ed3145dc3c1c96b" title="Finds a blank (space or tab) in the string.">_dbus_string_find_blank</a> (str, 0, &amp;i))
<a name="l02246"></a>02246     <a class="code" href="group__DBusString.html#ga5698b163289be0066cf10c0f1caf877a" title="Skips blanks from start, storing the first non-blank in *end (blank is space or tab).">_dbus_string_skip_blank</a> (str, i, &amp;i);
<a name="l02247"></a>02247 
<a name="l02248"></a>02248   <a class="code" href="group__DBusString.html#ga7e0e164ad5bb094e5ccad9edc7ae4235" title="Deletes a segment of a DBusString with length len starting at start.">_dbus_string_delete</a> (str, 0, i);
<a name="l02249"></a>02249 }
<a name="l02250"></a>02250 <span class="preprocessor">#endif</span>
<a name="l02251"></a>02251 <span class="preprocessor"></span>
<a name="l02252"></a>02252 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l02253"></a>02253 <span class="preprocessor"></span>
<a name="l02258"></a>02258 <span class="keywordtype">void</span>
<a name="l02259"></a>02259 _dbus_string_delete_leading_blanks (<a class="code" href="structDBusString.html">DBusString</a> *str)
<a name="l02260"></a>02260 {
<a name="l02261"></a>02261   <span class="keywordtype">int</span> i;
<a name="l02262"></a>02262   
<a name="l02263"></a>02263   <a class="code" href="group__DBusString.html#ga5698b163289be0066cf10c0f1caf877a" title="Skips blanks from start, storing the first non-blank in *end (blank is space or tab).">_dbus_string_skip_blank</a> (str, 0, &amp;i);
<a name="l02264"></a>02264 
<a name="l02265"></a>02265   <span class="keywordflow">if</span> (i &gt; 0)
<a name="l02266"></a>02266     <a class="code" href="group__DBusString.html#ga7e0e164ad5bb094e5ccad9edc7ae4235" title="Deletes a segment of a DBusString with length len starting at start.">_dbus_string_delete</a> (str, 0, i);
<a name="l02267"></a>02267 }
<a name="l02268"></a>02268 <span class="preprocessor">#endif</span>
<a name="l02269"></a>02269 <span class="preprocessor"></span>
<a name="l02275"></a>02275 <span class="keywordtype">void</span>
<a name="l02276"></a><a class="code" href="group__DBusString.html#gaa92c6ab2c5e24cbefef0a3f3fc76f98b">02276</a> <a class="code" href="group__DBusString.html#gaa92c6ab2c5e24cbefef0a3f3fc76f98b" title="Deletes leading and trailing whitespace.">_dbus_string_chop_white</a>(<a class="code" href="structDBusString.html">DBusString</a> *str)
<a name="l02277"></a>02277 {
<a name="l02278"></a>02278   <span class="keywordtype">int</span> i;
<a name="l02279"></a>02279   
<a name="l02280"></a>02280   <a class="code" href="group__DBusString.html#ga8600259d71a4adc14ab4558a9d2a0f7d" title="Skips whitespace from start, storing the first non-whitespace in *end.">_dbus_string_skip_white</a> (str, 0, &amp;i);
<a name="l02281"></a>02281 
<a name="l02282"></a>02282   <span class="keywordflow">if</span> (i &gt; 0)
<a name="l02283"></a>02283     <a class="code" href="group__DBusString.html#ga7e0e164ad5bb094e5ccad9edc7ae4235" title="Deletes a segment of a DBusString with length len starting at start.">_dbus_string_delete</a> (str, 0, i);
<a name="l02284"></a>02284   
<a name="l02285"></a>02285   <a class="code" href="group__DBusString.html#ga578bb88acec5520825f2ba792cad7938" title="Skips whitespace from end, storing the start index of the trailing whitespace in *start.">_dbus_string_skip_white_reverse</a> (str, _dbus_string_get_length (str), &amp;i);
<a name="l02286"></a>02286 
<a name="l02287"></a>02287   <a class="code" href="group__DBusString.html#ga08c423b93c28dd746dcb93e0461ab95c" title="Sets the length of a string.">_dbus_string_set_length</a> (str, i);
<a name="l02288"></a>02288 }
<a name="l02289"></a>02289 
<a name="l02299"></a>02299 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l02300"></a><a class="code" href="group__DBusString.html#gad79c34af55b58f0e8b81ecf11b8694bb">02300</a> <a class="code" href="group__DBusString.html#gad79c34af55b58f0e8b81ecf11b8694bb" title="Tests two DBusString for equality.">_dbus_string_equal</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *a,
<a name="l02301"></a>02301                     <span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *b)
<a name="l02302"></a>02302 {
<a name="l02303"></a>02303   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ap;
<a name="l02304"></a>02304   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *bp;
<a name="l02305"></a>02305   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *a_end;
<a name="l02306"></a>02306   <span class="keyword">const</span> <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *real_a = (<span class="keyword">const</span> <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a>*) a;
<a name="l02307"></a>02307   <span class="keyword">const</span> <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *real_b = (<span class="keyword">const</span> <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a>*) b;
<a name="l02308"></a>02308   <a class="code" href="group__DBusStringInternals.html#ga862cb88a139179981e1fcd5643165b56" title="Checks a bunch of assertions about a string object.">DBUS_GENERIC_STRING_PREAMBLE</a> (real_a);
<a name="l02309"></a>02309   <a class="code" href="group__DBusStringInternals.html#ga862cb88a139179981e1fcd5643165b56" title="Checks a bunch of assertions about a string object.">DBUS_GENERIC_STRING_PREAMBLE</a> (real_b);
<a name="l02310"></a>02310 
<a name="l02311"></a>02311   <span class="keywordflow">if</span> (real_a-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> != real_b-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>)
<a name="l02312"></a>02312     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02313"></a>02313 
<a name="l02314"></a>02314   ap = real_a-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>;
<a name="l02315"></a>02315   bp = real_b-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>;
<a name="l02316"></a>02316   a_end = real_a-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + real_a-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>;
<a name="l02317"></a>02317   <span class="keywordflow">while</span> (ap != a_end)
<a name="l02318"></a>02318     {
<a name="l02319"></a>02319       <span class="keywordflow">if</span> (*ap != *bp)
<a name="l02320"></a>02320         <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02321"></a>02321       
<a name="l02322"></a>02322       ++ap;
<a name="l02323"></a>02323       ++bp;
<a name="l02324"></a>02324     }
<a name="l02325"></a>02325 
<a name="l02326"></a>02326   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l02327"></a>02327 }
<a name="l02328"></a>02328 
<a name="l02342"></a>02342 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l02343"></a><a class="code" href="group__DBusString.html#gacf39727ae9eb411b0c4cb3b891588fb0">02343</a> <a class="code" href="group__DBusString.html#gacf39727ae9eb411b0c4cb3b891588fb0" title="Tests two DBusString for equality up to the given length.">_dbus_string_equal_len</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *a,
<a name="l02344"></a>02344                         <span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *b,
<a name="l02345"></a>02345                         <span class="keywordtype">int</span>               len)
<a name="l02346"></a>02346 {
<a name="l02347"></a>02347   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ap;
<a name="l02348"></a>02348   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *bp;
<a name="l02349"></a>02349   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *a_end;
<a name="l02350"></a>02350   <span class="keyword">const</span> <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *real_a = (<span class="keyword">const</span> <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a>*) a;
<a name="l02351"></a>02351   <span class="keyword">const</span> <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *real_b = (<span class="keyword">const</span> <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a>*) b;
<a name="l02352"></a>02352   <a class="code" href="group__DBusStringInternals.html#ga862cb88a139179981e1fcd5643165b56" title="Checks a bunch of assertions about a string object.">DBUS_GENERIC_STRING_PREAMBLE</a> (real_a);
<a name="l02353"></a>02353   <a class="code" href="group__DBusStringInternals.html#ga862cb88a139179981e1fcd5643165b56" title="Checks a bunch of assertions about a string object.">DBUS_GENERIC_STRING_PREAMBLE</a> (real_b);
<a name="l02354"></a>02354 
<a name="l02355"></a>02355   <span class="keywordflow">if</span> (real_a-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> != real_b-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> &amp;&amp;
<a name="l02356"></a>02356       (real_a-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> &lt; len || real_b-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> &lt; len))
<a name="l02357"></a>02357     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02358"></a>02358 
<a name="l02359"></a>02359   ap = real_a-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>;
<a name="l02360"></a>02360   bp = real_b-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>;
<a name="l02361"></a>02361   a_end = real_a-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + MIN (real_a-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>, len);
<a name="l02362"></a>02362   <span class="keywordflow">while</span> (ap != a_end)
<a name="l02363"></a>02363     {
<a name="l02364"></a>02364       <span class="keywordflow">if</span> (*ap != *bp)
<a name="l02365"></a>02365         <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02366"></a>02366       
<a name="l02367"></a>02367       ++ap;
<a name="l02368"></a>02368       ++bp;
<a name="l02369"></a>02369     }
<a name="l02370"></a>02370 
<a name="l02371"></a>02371   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l02372"></a>02372 }
<a name="l02373"></a>02373 
<a name="l02390"></a>02390 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l02391"></a><a class="code" href="group__DBusString.html#ga2095c2a797ae245521a7588b32279110">02391</a> <a class="code" href="group__DBusString.html#ga2095c2a797ae245521a7588b32279110" title="Tests two sub-parts of two DBusString for equality.">_dbus_string_equal_substring</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a>  *a,
<a name="l02392"></a>02392                               <span class="keywordtype">int</span>                a_start,
<a name="l02393"></a>02393                               <span class="keywordtype">int</span>                a_len,
<a name="l02394"></a>02394                               <span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a>  *b,
<a name="l02395"></a>02395                               <span class="keywordtype">int</span>                b_start)
<a name="l02396"></a>02396 {
<a name="l02397"></a>02397   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ap;
<a name="l02398"></a>02398   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *bp;
<a name="l02399"></a>02399   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *a_end;
<a name="l02400"></a>02400   <span class="keyword">const</span> <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *real_a = (<span class="keyword">const</span> <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a>*) a;
<a name="l02401"></a>02401   <span class="keyword">const</span> <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *real_b = (<span class="keyword">const</span> <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a>*) b;
<a name="l02402"></a>02402   <a class="code" href="group__DBusStringInternals.html#ga862cb88a139179981e1fcd5643165b56" title="Checks a bunch of assertions about a string object.">DBUS_GENERIC_STRING_PREAMBLE</a> (real_a);
<a name="l02403"></a>02403   <a class="code" href="group__DBusStringInternals.html#ga862cb88a139179981e1fcd5643165b56" title="Checks a bunch of assertions about a string object.">DBUS_GENERIC_STRING_PREAMBLE</a> (real_b);
<a name="l02404"></a>02404   _dbus_assert (a_start &gt;= 0);
<a name="l02405"></a>02405   _dbus_assert (a_len &gt;= 0);
<a name="l02406"></a>02406   _dbus_assert (a_start &lt;= real_a-&gt;len);
<a name="l02407"></a>02407   _dbus_assert (a_len &lt;= real_a-&gt;len - a_start);
<a name="l02408"></a>02408   _dbus_assert (b_start &gt;= 0);
<a name="l02409"></a>02409   _dbus_assert (b_start &lt;= real_b-&gt;len);
<a name="l02410"></a>02410   
<a name="l02411"></a>02411   <span class="keywordflow">if</span> (a_len &gt; real_b-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> - b_start)
<a name="l02412"></a>02412     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02413"></a>02413 
<a name="l02414"></a>02414   ap = real_a-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + a_start;
<a name="l02415"></a>02415   bp = real_b-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + b_start;
<a name="l02416"></a>02416   a_end = ap + a_len;
<a name="l02417"></a>02417   <span class="keywordflow">while</span> (ap != a_end)
<a name="l02418"></a>02418     {
<a name="l02419"></a>02419       <span class="keywordflow">if</span> (*ap != *bp)
<a name="l02420"></a>02420         <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02421"></a>02421       
<a name="l02422"></a>02422       ++ap;
<a name="l02423"></a>02423       ++bp;
<a name="l02424"></a>02424     }
<a name="l02425"></a>02425 
<a name="l02426"></a>02426   _dbus_assert (bp &lt;= (real_b-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + real_b-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>));
<a name="l02427"></a>02427   
<a name="l02428"></a>02428   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l02429"></a>02429 }
<a name="l02430"></a>02430 
<a name="l02438"></a>02438 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l02439"></a><a class="code" href="group__DBusString.html#ga84f39f1bf398697920637d2982248c72">02439</a> <a class="code" href="group__DBusString.html#ga84f39f1bf398697920637d2982248c72" title="Checks whether a string is equal to a C string.">_dbus_string_equal_c_str</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *a,
<a name="l02440"></a>02440                           <span class="keyword">const</span> <span class="keywordtype">char</span>       *c_str)
<a name="l02441"></a>02441 {
<a name="l02442"></a>02442   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ap;
<a name="l02443"></a>02443   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *bp;
<a name="l02444"></a>02444   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *a_end;
<a name="l02445"></a>02445   <span class="keyword">const</span> <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *real_a = (<span class="keyword">const</span> <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a>*) a;
<a name="l02446"></a>02446   <a class="code" href="group__DBusStringInternals.html#ga862cb88a139179981e1fcd5643165b56" title="Checks a bunch of assertions about a string object.">DBUS_GENERIC_STRING_PREAMBLE</a> (real_a);
<a name="l02447"></a>02447   _dbus_assert (c_str != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l02448"></a>02448   
<a name="l02449"></a>02449   ap = real_a-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>;
<a name="l02450"></a>02450   bp = (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) c_str;
<a name="l02451"></a>02451   a_end = real_a-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + real_a-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>;
<a name="l02452"></a>02452   <span class="keywordflow">while</span> (ap != a_end &amp;&amp; *bp)
<a name="l02453"></a>02453     {
<a name="l02454"></a>02454       <span class="keywordflow">if</span> (*ap != *bp)
<a name="l02455"></a>02455         <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02456"></a>02456       
<a name="l02457"></a>02457       ++ap;
<a name="l02458"></a>02458       ++bp;
<a name="l02459"></a>02459     }
<a name="l02460"></a>02460 
<a name="l02461"></a>02461   <span class="keywordflow">if</span> (ap != a_end || *bp)
<a name="l02462"></a>02462     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02463"></a>02463   
<a name="l02464"></a>02464   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l02465"></a>02465 }
<a name="l02466"></a>02466 
<a name="l02467"></a>02467 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l02468"></a>02468 <span class="preprocessor"></span>
<a name="l02475"></a>02475 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l02476"></a>02476 _dbus_string_starts_with_c_str (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *a,
<a name="l02477"></a>02477                                 <span class="keyword">const</span> <span class="keywordtype">char</span>       *c_str)
<a name="l02478"></a>02478 {
<a name="l02479"></a>02479   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ap;
<a name="l02480"></a>02480   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *bp;
<a name="l02481"></a>02481   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *a_end;
<a name="l02482"></a>02482   <span class="keyword">const</span> <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a> *real_a = (<span class="keyword">const</span> <a class="code" href="structDBusRealString.html" title="Internals of DBusString.">DBusRealString</a>*) a;
<a name="l02483"></a>02483   <a class="code" href="group__DBusStringInternals.html#ga862cb88a139179981e1fcd5643165b56" title="Checks a bunch of assertions about a string object.">DBUS_GENERIC_STRING_PREAMBLE</a> (real_a);
<a name="l02484"></a>02484   _dbus_assert (c_str != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l02485"></a>02485   
<a name="l02486"></a>02486   ap = real_a-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a>;
<a name="l02487"></a>02487   bp = (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) c_str;
<a name="l02488"></a>02488   a_end = real_a-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + real_a-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a>;
<a name="l02489"></a>02489   <span class="keywordflow">while</span> (ap != a_end &amp;&amp; *bp)
<a name="l02490"></a>02490     {
<a name="l02491"></a>02491       <span class="keywordflow">if</span> (*ap != *bp)
<a name="l02492"></a>02492         <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02493"></a>02493       
<a name="l02494"></a>02494       ++ap;
<a name="l02495"></a>02495       ++bp;
<a name="l02496"></a>02496     }
<a name="l02497"></a>02497 
<a name="l02498"></a>02498   <span class="keywordflow">if</span> (*bp == <span class="charliteral">&#39;\0&#39;</span>)
<a name="l02499"></a>02499     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l02500"></a>02500   <span class="keywordflow">else</span>
<a name="l02501"></a>02501     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02502"></a>02502 }
<a name="l02503"></a>02503 <span class="preprocessor">#endif </span><span class="comment">/* DBUS_BUILD_TESTS */</span>
<a name="l02504"></a>02504 
<a name="l02513"></a>02513 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l02514"></a><a class="code" href="group__DBusString.html#gac3b78e2cb63fb37fbff8d7e647ddfa5a">02514</a> <a class="code" href="group__DBusString.html#gac3b78e2cb63fb37fbff8d7e647ddfa5a" title="Appends a two-character hex digit to a string, where the hex digit has the value of the given byte...">_dbus_string_append_byte_as_hex</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l02515"></a>02515                                  <span class="keywordtype">int</span>         byte)
<a name="l02516"></a>02516 {
<a name="l02517"></a>02517   <span class="keyword">const</span> <span class="keywordtype">char</span> hexdigits[16] = {
<a name="l02518"></a>02518     <span class="charliteral">&#39;0&#39;</span>, <span class="charliteral">&#39;1&#39;</span>, <span class="charliteral">&#39;2&#39;</span>, <span class="charliteral">&#39;3&#39;</span>, <span class="charliteral">&#39;4&#39;</span>, <span class="charliteral">&#39;5&#39;</span>, <span class="charliteral">&#39;6&#39;</span>, <span class="charliteral">&#39;7&#39;</span>, <span class="charliteral">&#39;8&#39;</span>, <span class="charliteral">&#39;9&#39;</span>,
<a name="l02519"></a>02519     <span class="charliteral">&#39;a&#39;</span>, <span class="charliteral">&#39;b&#39;</span>, <span class="charliteral">&#39;c&#39;</span>, <span class="charliteral">&#39;d&#39;</span>, <span class="charliteral">&#39;e&#39;</span>, <span class="charliteral">&#39;f&#39;</span>
<a name="l02520"></a>02520   };
<a name="l02521"></a>02521 
<a name="l02522"></a>02522   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#gaa6ecf36e70263659f921a4ef0335db12" title="Appends a single byte to the string, returning FALSE if not enough memory.">_dbus_string_append_byte</a> (str,
<a name="l02523"></a>02523                                  hexdigits[(byte &gt;&gt; 4)]))
<a name="l02524"></a>02524     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02525"></a>02525   
<a name="l02526"></a>02526   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#gaa6ecf36e70263659f921a4ef0335db12" title="Appends a single byte to the string, returning FALSE if not enough memory.">_dbus_string_append_byte</a> (str,
<a name="l02527"></a>02527                                  hexdigits[(byte &amp; 0x0f)]))
<a name="l02528"></a>02528     {
<a name="l02529"></a>02529       <a class="code" href="group__DBusString.html#ga08c423b93c28dd746dcb93e0461ab95c" title="Sets the length of a string.">_dbus_string_set_length</a> (str,
<a name="l02530"></a>02530                                _dbus_string_get_length (str) - 1);
<a name="l02531"></a>02531       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02532"></a>02532     }
<a name="l02533"></a>02533 
<a name="l02534"></a>02534   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l02535"></a>02535 }
<a name="l02536"></a>02536 
<a name="l02547"></a>02547 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l02548"></a><a class="code" href="group__DBusString.html#gaabb4873f436e015944a33cd1e3815cc9">02548</a> <a class="code" href="group__DBusString.html#gaabb4873f436e015944a33cd1e3815cc9" title="Encodes a string in hex, the way MD5 and SHA-1 are usually encoded.">_dbus_string_hex_encode</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *source,
<a name="l02549"></a>02549                          <span class="keywordtype">int</span>               start,
<a name="l02550"></a>02550                          <a class="code" href="structDBusString.html">DBusString</a>       *dest,
<a name="l02551"></a>02551                          <span class="keywordtype">int</span>               insert_at)
<a name="l02552"></a>02552 {
<a name="l02553"></a>02553   <a class="code" href="structDBusString.html">DBusString</a> result;
<a name="l02554"></a>02554   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p;
<a name="l02555"></a>02555   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end;
<a name="l02556"></a>02556   <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a> retval;
<a name="l02557"></a>02557   
<a name="l02558"></a>02558   _dbus_assert (start &lt;= _dbus_string_get_length (source));
<a name="l02559"></a>02559 
<a name="l02560"></a>02560   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#ga348252317f7bb8ac43529972945830ae" title="Initializes a string.">_dbus_string_init</a> (&amp;result))
<a name="l02561"></a>02561     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02562"></a>02562 
<a name="l02563"></a>02563   retval = <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02564"></a>02564   
<a name="l02565"></a>02565   p = (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) _dbus_string_get_const_data (source);
<a name="l02566"></a>02566   end = p + _dbus_string_get_length (source);
<a name="l02567"></a>02567   p += start;
<a name="l02568"></a>02568   
<a name="l02569"></a>02569   <span class="keywordflow">while</span> (p != end)
<a name="l02570"></a>02570     {
<a name="l02571"></a>02571       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#gac3b78e2cb63fb37fbff8d7e647ddfa5a" title="Appends a two-character hex digit to a string, where the hex digit has the value of the given byte...">_dbus_string_append_byte_as_hex</a> (&amp;result, *p))
<a name="l02572"></a>02572         <span class="keywordflow">goto</span> out;
<a name="l02573"></a>02573       
<a name="l02574"></a>02574       ++p;
<a name="l02575"></a>02575     }
<a name="l02576"></a>02576 
<a name="l02577"></a>02577   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#gad379fce8d4ef4f7e28f81f50b46ee4c9" title="Moves the end of one string into another string.">_dbus_string_move</a> (&amp;result, 0, dest, insert_at))
<a name="l02578"></a>02578     <span class="keywordflow">goto</span> out;
<a name="l02579"></a>02579 
<a name="l02580"></a>02580   retval = <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l02581"></a>02581 
<a name="l02582"></a>02582  out:
<a name="l02583"></a>02583   <a class="code" href="group__DBusString.html#ga781ca91acda49a834dce7d0ed0eef212" title="Frees a string created by _dbus_string_init().">_dbus_string_free</a> (&amp;result);
<a name="l02584"></a>02584   <span class="keywordflow">return</span> retval;
<a name="l02585"></a>02585 }
<a name="l02586"></a>02586 
<a name="l02597"></a>02597 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l02598"></a><a class="code" href="group__DBusString.html#ga0a8c20d855f9ddc05718b9e2ac0e33d8">02598</a> <a class="code" href="group__DBusString.html#ga0a8c20d855f9ddc05718b9e2ac0e33d8" title="Decodes a string from hex encoding.">_dbus_string_hex_decode</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *source,
<a name="l02599"></a>02599                          <span class="keywordtype">int</span>               start,
<a name="l02600"></a>02600                          <span class="keywordtype">int</span>              *end_return,
<a name="l02601"></a>02601                          <a class="code" href="structDBusString.html">DBusString</a>       *dest,
<a name="l02602"></a>02602                          <span class="keywordtype">int</span>               insert_at)
<a name="l02603"></a>02603 {
<a name="l02604"></a>02604   <a class="code" href="structDBusString.html">DBusString</a> result;
<a name="l02605"></a>02605   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p;
<a name="l02606"></a>02606   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end;
<a name="l02607"></a>02607   <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a> retval;
<a name="l02608"></a>02608   <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a> high_bits;
<a name="l02609"></a>02609   
<a name="l02610"></a>02610   _dbus_assert (start &lt;= _dbus_string_get_length (source));
<a name="l02611"></a>02611 
<a name="l02612"></a>02612   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#ga348252317f7bb8ac43529972945830ae" title="Initializes a string.">_dbus_string_init</a> (&amp;result))
<a name="l02613"></a>02613     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02614"></a>02614 
<a name="l02615"></a>02615   retval = <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02616"></a>02616 
<a name="l02617"></a>02617   high_bits = <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l02618"></a>02618   p = (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) _dbus_string_get_const_data (source);
<a name="l02619"></a>02619   end = p + _dbus_string_get_length (source);
<a name="l02620"></a>02620   p += start;
<a name="l02621"></a>02621   
<a name="l02622"></a>02622   <span class="keywordflow">while</span> (p != end)
<a name="l02623"></a>02623     {
<a name="l02624"></a>02624       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> val;
<a name="l02625"></a>02625 
<a name="l02626"></a>02626       <span class="keywordflow">switch</span> (*p)
<a name="l02627"></a>02627         {
<a name="l02628"></a>02628         <span class="keywordflow">case</span> <span class="charliteral">&#39;0&#39;</span>:
<a name="l02629"></a>02629           val = 0;
<a name="l02630"></a>02630           <span class="keywordflow">break</span>;
<a name="l02631"></a>02631         <span class="keywordflow">case</span> <span class="charliteral">&#39;1&#39;</span>:
<a name="l02632"></a>02632           val = 1;
<a name="l02633"></a>02633           <span class="keywordflow">break</span>;
<a name="l02634"></a>02634         <span class="keywordflow">case</span> <span class="charliteral">&#39;2&#39;</span>:
<a name="l02635"></a>02635           val = 2;
<a name="l02636"></a>02636           <span class="keywordflow">break</span>;
<a name="l02637"></a>02637         <span class="keywordflow">case</span> <span class="charliteral">&#39;3&#39;</span>:
<a name="l02638"></a>02638           val = 3;
<a name="l02639"></a>02639           <span class="keywordflow">break</span>;
<a name="l02640"></a>02640         <span class="keywordflow">case</span> <span class="charliteral">&#39;4&#39;</span>:
<a name="l02641"></a>02641           val = 4;
<a name="l02642"></a>02642           <span class="keywordflow">break</span>;
<a name="l02643"></a>02643         <span class="keywordflow">case</span> <span class="charliteral">&#39;5&#39;</span>:
<a name="l02644"></a>02644           val = 5;
<a name="l02645"></a>02645           <span class="keywordflow">break</span>;
<a name="l02646"></a>02646         <span class="keywordflow">case</span> <span class="charliteral">&#39;6&#39;</span>:
<a name="l02647"></a>02647           val = 6;
<a name="l02648"></a>02648           <span class="keywordflow">break</span>;
<a name="l02649"></a>02649         <span class="keywordflow">case</span> <span class="charliteral">&#39;7&#39;</span>:
<a name="l02650"></a>02650           val = 7;
<a name="l02651"></a>02651           <span class="keywordflow">break</span>;
<a name="l02652"></a>02652         <span class="keywordflow">case</span> <span class="charliteral">&#39;8&#39;</span>:
<a name="l02653"></a>02653           val = 8;
<a name="l02654"></a>02654           <span class="keywordflow">break</span>;
<a name="l02655"></a>02655         <span class="keywordflow">case</span> <span class="charliteral">&#39;9&#39;</span>:
<a name="l02656"></a>02656           val = 9;
<a name="l02657"></a>02657           <span class="keywordflow">break</span>;
<a name="l02658"></a>02658         <span class="keywordflow">case</span> <span class="charliteral">&#39;a&#39;</span>:
<a name="l02659"></a>02659         <span class="keywordflow">case</span> <span class="charliteral">&#39;A&#39;</span>:
<a name="l02660"></a>02660           val = 10;
<a name="l02661"></a>02661           <span class="keywordflow">break</span>;
<a name="l02662"></a>02662         <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>:
<a name="l02663"></a>02663         <span class="keywordflow">case</span> <span class="charliteral">&#39;B&#39;</span>:
<a name="l02664"></a>02664           val = 11;
<a name="l02665"></a>02665           <span class="keywordflow">break</span>;
<a name="l02666"></a>02666         <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>:
<a name="l02667"></a>02667         <span class="keywordflow">case</span> <span class="charliteral">&#39;C&#39;</span>:
<a name="l02668"></a>02668           val = 12;
<a name="l02669"></a>02669           <span class="keywordflow">break</span>;
<a name="l02670"></a>02670         <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:
<a name="l02671"></a>02671         <span class="keywordflow">case</span> <span class="charliteral">&#39;D&#39;</span>:
<a name="l02672"></a>02672           val = 13;
<a name="l02673"></a>02673           <span class="keywordflow">break</span>;
<a name="l02674"></a>02674         <span class="keywordflow">case</span> <span class="charliteral">&#39;e&#39;</span>:
<a name="l02675"></a>02675         <span class="keywordflow">case</span> <span class="charliteral">&#39;E&#39;</span>:
<a name="l02676"></a>02676           val = 14;
<a name="l02677"></a>02677           <span class="keywordflow">break</span>;
<a name="l02678"></a>02678         <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:
<a name="l02679"></a>02679         <span class="keywordflow">case</span> <span class="charliteral">&#39;F&#39;</span>:
<a name="l02680"></a>02680           val = 15;
<a name="l02681"></a>02681           <span class="keywordflow">break</span>;
<a name="l02682"></a>02682         <span class="keywordflow">default</span>:
<a name="l02683"></a>02683           <span class="keywordflow">goto</span> done;
<a name="l02684"></a>02684         }
<a name="l02685"></a>02685 
<a name="l02686"></a>02686       <span class="keywordflow">if</span> (high_bits)
<a name="l02687"></a>02687         {
<a name="l02688"></a>02688           <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#gaa6ecf36e70263659f921a4ef0335db12" title="Appends a single byte to the string, returning FALSE if not enough memory.">_dbus_string_append_byte</a> (&amp;result,
<a name="l02689"></a>02689                                          val &lt;&lt; 4))
<a name="l02690"></a>02690             <span class="keywordflow">goto</span> out;
<a name="l02691"></a>02691         }
<a name="l02692"></a>02692       <span class="keywordflow">else</span>
<a name="l02693"></a>02693         {
<a name="l02694"></a>02694           <span class="keywordtype">int</span> len;
<a name="l02695"></a>02695           <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> b;
<a name="l02696"></a>02696 
<a name="l02697"></a>02697           len = _dbus_string_get_length (&amp;result);
<a name="l02698"></a>02698           
<a name="l02699"></a>02699           b = _dbus_string_get_byte (&amp;result, len - 1);
<a name="l02700"></a>02700 
<a name="l02701"></a>02701           b |= val;
<a name="l02702"></a>02702 
<a name="l02703"></a>02703           _dbus_string_set_byte (&amp;result, len - 1, b);
<a name="l02704"></a>02704         }
<a name="l02705"></a>02705 
<a name="l02706"></a>02706       high_bits = !high_bits;
<a name="l02707"></a>02707 
<a name="l02708"></a>02708       ++p;
<a name="l02709"></a>02709     }
<a name="l02710"></a>02710 
<a name="l02711"></a>02711  done:
<a name="l02712"></a>02712   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#gad379fce8d4ef4f7e28f81f50b46ee4c9" title="Moves the end of one string into another string.">_dbus_string_move</a> (&amp;result, 0, dest, insert_at))
<a name="l02713"></a>02713     <span class="keywordflow">goto</span> out;
<a name="l02714"></a>02714 
<a name="l02715"></a>02715   <span class="keywordflow">if</span> (end_return)
<a name="l02716"></a>02716     *end_return = p - (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) _dbus_string_get_const_data (source);
<a name="l02717"></a>02717 
<a name="l02718"></a>02718   retval = <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l02719"></a>02719   
<a name="l02720"></a>02720  out:
<a name="l02721"></a>02721   <a class="code" href="group__DBusString.html#ga781ca91acda49a834dce7d0ed0eef212" title="Frees a string created by _dbus_string_init().">_dbus_string_free</a> (&amp;result);  
<a name="l02722"></a>02722   <span class="keywordflow">return</span> retval;
<a name="l02723"></a>02723 }
<a name="l02724"></a>02724 
<a name="l02738"></a>02738 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l02739"></a><a class="code" href="group__DBusString.html#gaa4324cd667e21beb31a5481cb0c12b6d">02739</a> <a class="code" href="group__DBusString.html#gaa4324cd667e21beb31a5481cb0c12b6d" title="Checks that the given range of the string is valid ASCII with no nul bytes.">_dbus_string_validate_ascii</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l02740"></a>02740                              <span class="keywordtype">int</span>               start,
<a name="l02741"></a>02741                              <span class="keywordtype">int</span>               len)
<a name="l02742"></a>02742 {
<a name="l02743"></a>02743   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *s;
<a name="l02744"></a>02744   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end;
<a name="l02745"></a>02745   <a class="code" href="group__DBusStringInternals.html#ga5cf5f12f6d8f839e9a7c3ad790a83316" title="Checks assertions about a string that may be const or locked.">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l02746"></a>02746   _dbus_assert (start &gt;= 0);
<a name="l02747"></a>02747   _dbus_assert (start &lt;= real-&gt;len);
<a name="l02748"></a>02748   _dbus_assert (len &gt;= 0);
<a name="l02749"></a>02749   
<a name="l02750"></a>02750   <span class="keywordflow">if</span> (len &gt; real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> - start)
<a name="l02751"></a>02751     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02752"></a>02752   
<a name="l02753"></a>02753   s = real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + start;
<a name="l02754"></a>02754   end = s + len;
<a name="l02755"></a>02755   <span class="keywordflow">while</span> (s != end)
<a name="l02756"></a>02756     {
<a name="l02757"></a>02757       <span class="keywordflow">if</span> (_DBUS_UNLIKELY (!_DBUS_ISASCII (*s)))
<a name="l02758"></a>02758         <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02759"></a>02759         
<a name="l02760"></a>02760       ++s;
<a name="l02761"></a>02761     }
<a name="l02762"></a>02762   
<a name="l02763"></a>02763   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l02764"></a>02764 }
<a name="l02765"></a>02765 
<a name="l02773"></a>02773 <span class="keywordtype">void</span>
<a name="l02774"></a><a class="code" href="group__DBusString.html#ga698f4b0299e6c6a707fd7e9c14915f00">02774</a> <a class="code" href="group__DBusString.html#ga698f4b0299e6c6a707fd7e9c14915f00" title="Converts the given range of the string to lower case.">_dbus_string_tolower_ascii</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l02775"></a>02775                             <span class="keywordtype">int</span>               start,
<a name="l02776"></a>02776                             <span class="keywordtype">int</span>               len)
<a name="l02777"></a>02777 {
<a name="l02778"></a>02778   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *s;
<a name="l02779"></a>02779   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end;
<a name="l02780"></a>02780   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l02781"></a>02781   _dbus_assert (start &gt;= 0);
<a name="l02782"></a>02782   _dbus_assert (start &lt;= real-&gt;len);
<a name="l02783"></a>02783   _dbus_assert (len &gt;= 0);
<a name="l02784"></a>02784   _dbus_assert (len &lt;= real-&gt;len - start);
<a name="l02785"></a>02785 
<a name="l02786"></a>02786   s = real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + start;
<a name="l02787"></a>02787   end = s + len;
<a name="l02788"></a>02788 
<a name="l02789"></a>02789   <span class="keywordflow">while</span> (s != end)
<a name="l02790"></a>02790     {
<a name="l02791"></a>02791       <span class="keywordflow">if</span> (*s &gt;= <span class="charliteral">&#39;A&#39;</span> &amp;&amp; *s &lt;= <span class="charliteral">&#39;Z&#39;</span>)
<a name="l02792"></a>02792           *s += <span class="charliteral">&#39;a&#39;</span> - <span class="charliteral">&#39;A&#39;</span>;
<a name="l02793"></a>02793       ++s;
<a name="l02794"></a>02794     }
<a name="l02795"></a>02795 }
<a name="l02796"></a>02796 
<a name="l02804"></a>02804 <span class="keywordtype">void</span>
<a name="l02805"></a><a class="code" href="group__DBusString.html#ga9c959f7d18ff21c5ae51846c6ba065f1">02805</a> <a class="code" href="group__DBusString.html#ga9c959f7d18ff21c5ae51846c6ba065f1" title="Converts the given range of the string to upper case.">_dbus_string_toupper_ascii</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l02806"></a>02806                             <span class="keywordtype">int</span>               start,
<a name="l02807"></a>02807                             <span class="keywordtype">int</span>               len)
<a name="l02808"></a>02808 {
<a name="l02809"></a>02809   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *s;
<a name="l02810"></a>02810   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end;
<a name="l02811"></a>02811   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l02812"></a>02812   _dbus_assert (start &gt;= 0);
<a name="l02813"></a>02813   _dbus_assert (start &lt;= real-&gt;len);
<a name="l02814"></a>02814   _dbus_assert (len &gt;= 0);
<a name="l02815"></a>02815   _dbus_assert (len &lt;= real-&gt;len - start);
<a name="l02816"></a>02816 
<a name="l02817"></a>02817   s = real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + start;
<a name="l02818"></a>02818   end = s + len;
<a name="l02819"></a>02819 
<a name="l02820"></a>02820   <span class="keywordflow">while</span> (s != end)
<a name="l02821"></a>02821     {
<a name="l02822"></a>02822       <span class="keywordflow">if</span> (*s &gt;= <span class="charliteral">&#39;a&#39;</span> &amp;&amp; *s &lt;= <span class="charliteral">&#39;z&#39;</span>)
<a name="l02823"></a>02823           *s += <span class="charliteral">&#39;A&#39;</span> - <span class="charliteral">&#39;a&#39;</span>;
<a name="l02824"></a>02824       ++s;
<a name="l02825"></a>02825     }
<a name="l02826"></a>02826 }
<a name="l02827"></a>02827 
<a name="l02843"></a>02843 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l02844"></a><a class="code" href="group__DBusString.html#ga65f0f04b7c9371406fc87343f691e8da">02844</a> <a class="code" href="group__DBusString.html#ga65f0f04b7c9371406fc87343f691e8da" title="Checks that the given range of the string is valid UTF-8.">_dbus_string_validate_utf8</a>  (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l02845"></a>02845                              <span class="keywordtype">int</span>               start,
<a name="l02846"></a>02846                              <span class="keywordtype">int</span>               len)
<a name="l02847"></a>02847 {
<a name="l02848"></a>02848   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p;
<a name="l02849"></a>02849   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end;
<a name="l02850"></a>02850   <a class="code" href="group__DBusStringInternals.html#ga5cf5f12f6d8f839e9a7c3ad790a83316" title="Checks assertions about a string that may be const or locked.">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l02851"></a>02851   _dbus_assert (start &gt;= 0);
<a name="l02852"></a>02852   _dbus_assert (start &lt;= real-&gt;len);
<a name="l02853"></a>02853   _dbus_assert (len &gt;= 0);
<a name="l02854"></a>02854 
<a name="l02855"></a>02855   <span class="comment">/* we are doing _DBUS_UNLIKELY() here which might be</span>
<a name="l02856"></a>02856 <span class="comment">   * dubious in a generic library like GLib, but in D-Bus</span>
<a name="l02857"></a>02857 <span class="comment">   * we know we&#39;re validating messages and that it would</span>
<a name="l02858"></a>02858 <span class="comment">   * only be evil/broken apps that would have invalid</span>
<a name="l02859"></a>02859 <span class="comment">   * UTF-8. Also, this function seems to be a performance</span>
<a name="l02860"></a>02860 <span class="comment">   * bottleneck in profiles.</span>
<a name="l02861"></a>02861 <span class="comment">   */</span>
<a name="l02862"></a>02862   
<a name="l02863"></a>02863   <span class="keywordflow">if</span> (_DBUS_UNLIKELY (len &gt; real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> - start))
<a name="l02864"></a>02864     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02865"></a>02865   
<a name="l02866"></a>02866   p = real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + start;
<a name="l02867"></a>02867   end = p + len;
<a name="l02868"></a>02868   
<a name="l02869"></a>02869   <span class="keywordflow">while</span> (p &lt; end)
<a name="l02870"></a>02870     {
<a name="l02871"></a>02871       <span class="keywordtype">int</span> i, mask, char_len;
<a name="l02872"></a>02872       dbus_unichar_t result;
<a name="l02873"></a>02873 
<a name="l02874"></a>02874       <span class="comment">/* nul bytes considered invalid */</span>
<a name="l02875"></a>02875       <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;\0&#39;</span>)
<a name="l02876"></a>02876         <span class="keywordflow">break</span>;
<a name="l02877"></a>02877       
<a name="l02878"></a>02878       <span class="comment">/* Special-case ASCII; this makes us go a lot faster in</span>
<a name="l02879"></a>02879 <span class="comment">       * D-Bus profiles where we are typically validating</span>
<a name="l02880"></a>02880 <span class="comment">       * function names and such. We have to know that</span>
<a name="l02881"></a>02881 <span class="comment">       * all following checks will pass for ASCII though,</span>
<a name="l02882"></a>02882 <span class="comment">       * comments follow ...</span>
<a name="l02883"></a>02883 <span class="comment">       */</span>      
<a name="l02884"></a>02884       <span class="keywordflow">if</span> (*p &lt; 128)
<a name="l02885"></a>02885         {
<a name="l02886"></a>02886           ++p;
<a name="l02887"></a>02887           <span class="keywordflow">continue</span>;
<a name="l02888"></a>02888         }
<a name="l02889"></a>02889       
<a name="l02890"></a>02890       <a class="code" href="group__DBusString.html#ga30614080229a4fb63460ffdc8ab484fb" title="computes length and mask of a unicode character">UTF8_COMPUTE</a> (*p, mask, char_len);
<a name="l02891"></a>02891 
<a name="l02892"></a>02892       <span class="keywordflow">if</span> (_DBUS_UNLIKELY (char_len == 0))  <span class="comment">/* ASCII: char_len == 1 */</span>
<a name="l02893"></a>02893         <span class="keywordflow">break</span>;
<a name="l02894"></a>02894 
<a name="l02895"></a>02895       <span class="comment">/* check that the expected number of bytes exists in the remaining length */</span>
<a name="l02896"></a>02896       <span class="keywordflow">if</span> (_DBUS_UNLIKELY ((end - p) &lt; char_len)) <span class="comment">/* ASCII: p &lt; end and char_len == 1 */</span>
<a name="l02897"></a>02897         <span class="keywordflow">break</span>;
<a name="l02898"></a>02898         
<a name="l02899"></a>02899       <a class="code" href="group__DBusString.html#gab5b4b316a69f78611a14e6b1fd091992" title="Gets a UTF-8 value.">UTF8_GET</a> (result, p, i, mask, char_len);
<a name="l02900"></a>02900 
<a name="l02901"></a>02901       <span class="comment">/* Check for overlong UTF-8 */</span>
<a name="l02902"></a>02902       <span class="keywordflow">if</span> (_DBUS_UNLIKELY (<a class="code" href="group__DBusString.html#ga9691ff5386e218870299de1d9e77ceea" title="computes length of a unicode character in UTF-8">UTF8_LENGTH</a> (result) != char_len)) <span class="comment">/* ASCII: UTF8_LENGTH == 1 */</span>
<a name="l02903"></a>02903         <span class="keywordflow">break</span>;
<a name="l02904"></a>02904 <span class="preprocessor">#if 0</span>
<a name="l02905"></a>02905 <span class="preprocessor"></span>      <span class="comment">/* The UNICODE_VALID check below will catch this */</span>
<a name="l02906"></a>02906       <span class="keywordflow">if</span> (_DBUS_UNLIKELY (result == (dbus_unichar_t)-1)) <span class="comment">/* ASCII: result = ascii value */</span>
<a name="l02907"></a>02907         <span class="keywordflow">break</span>;
<a name="l02908"></a>02908 <span class="preprocessor">#endif</span>
<a name="l02909"></a>02909 <span class="preprocessor"></span>
<a name="l02910"></a>02910       <span class="keywordflow">if</span> (_DBUS_UNLIKELY (!<a class="code" href="group__DBusString.html#ga25f0a93fc023fa0eec07ac1e32011e89" title="Check whether a Unicode (5.2) char is in a valid range.">UNICODE_VALID</a> (result))) <span class="comment">/* ASCII: always valid */</span>
<a name="l02911"></a>02911         <span class="keywordflow">break</span>;
<a name="l02912"></a>02912 
<a name="l02913"></a>02913       <span class="comment">/* UNICODE_VALID should have caught it */</span>
<a name="l02914"></a>02914       _dbus_assert (result != (dbus_unichar_t)-1);
<a name="l02915"></a>02915       
<a name="l02916"></a>02916       p += char_len;
<a name="l02917"></a>02917     }
<a name="l02918"></a>02918 
<a name="l02919"></a>02919   <span class="comment">/* See that we covered the entire length if a length was</span>
<a name="l02920"></a>02920 <span class="comment">   * passed in</span>
<a name="l02921"></a>02921 <span class="comment">   */</span>
<a name="l02922"></a>02922   <span class="keywordflow">if</span> (_DBUS_UNLIKELY (p != end))
<a name="l02923"></a>02923     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02924"></a>02924   <span class="keywordflow">else</span>
<a name="l02925"></a>02925     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l02926"></a>02926 }
<a name="l02927"></a>02927 
<a name="l02941"></a>02941 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l02942"></a><a class="code" href="group__DBusString.html#ga199d0fc00ee3cd0300a1b3870d7986a3">02942</a> <a class="code" href="group__DBusString.html#ga199d0fc00ee3cd0300a1b3870d7986a3" title="Checks that the given range of the string is all nul bytes.">_dbus_string_validate_nul</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l02943"></a>02943                            <span class="keywordtype">int</span>               start,
<a name="l02944"></a>02944                            <span class="keywordtype">int</span>               len)
<a name="l02945"></a>02945 {
<a name="l02946"></a>02946   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *s;
<a name="l02947"></a>02947   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end;
<a name="l02948"></a>02948   <a class="code" href="group__DBusStringInternals.html#ga5cf5f12f6d8f839e9a7c3ad790a83316" title="Checks assertions about a string that may be const or locked.">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l02949"></a>02949   _dbus_assert (start &gt;= 0);
<a name="l02950"></a>02950   _dbus_assert (len &gt;= 0);
<a name="l02951"></a>02951   _dbus_assert (start &lt;= real-&gt;len);
<a name="l02952"></a>02952   
<a name="l02953"></a>02953   <span class="keywordflow">if</span> (len &gt; real-&gt;<a class="code" href="structDBusRealString.html#aed6f543f7b748c4f5cf92b9aedd5f68d" title="Length without nul.">len</a> - start)
<a name="l02954"></a>02954     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02955"></a>02955   
<a name="l02956"></a>02956   s = real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> + start;
<a name="l02957"></a>02957   end = s + len;
<a name="l02958"></a>02958   <span class="keywordflow">while</span> (s != end)
<a name="l02959"></a>02959     {
<a name="l02960"></a>02960       <span class="keywordflow">if</span> (_DBUS_UNLIKELY (*s != <span class="charliteral">&#39;\0&#39;</span>))
<a name="l02961"></a>02961         <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l02962"></a>02962       ++s;
<a name="l02963"></a>02963     }
<a name="l02964"></a>02964   
<a name="l02965"></a>02965   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l02966"></a>02966 }
<a name="l02967"></a>02967 
<a name="l02973"></a>02973 <span class="keywordtype">void</span>
<a name="l02974"></a><a class="code" href="group__DBusString.html#ga9385fd0de31b3f5f4f8baa96bad3fac6">02974</a> <a class="code" href="group__DBusString.html#ga9385fd0de31b3f5f4f8baa96bad3fac6" title="Clears all allocated bytes in the string to zero.">_dbus_string_zero</a> (<a class="code" href="structDBusString.html">DBusString</a> *str)
<a name="l02975"></a>02975 {
<a name="l02976"></a>02976   <a class="code" href="group__DBusStringInternals.html#ga376570af2af3ebb7e59d45b49b9582b3" title="Checks assertions about a string object that needs to be modifiable - may not be locked or const...">DBUS_STRING_PREAMBLE</a> (str);
<a name="l02977"></a>02977 
<a name="l02978"></a>02978   memset (real-&gt;<a class="code" href="structDBusRealString.html#ad60d27edba516b0a179ce1ead1e74725" title="String data, plus nul termination.">str</a> - real-&gt;<a class="code" href="structDBusRealString.html#a21fb373a65e36646787392a3dfe62443" title="str - align_offset is the actual malloc block">align_offset</a>, <span class="charliteral">&#39;\0&#39;</span>, real-&gt;<a class="code" href="structDBusRealString.html#ae12ec58c271e47f3f89fae1410b7c5e5" title="Allocated size of data.">allocated</a>);
<a name="l02979"></a>02979 }
<a name="l02982"></a>02982 <span class="comment">/* tests are in dbus-string-util.c */</span>
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Wed Mar 26 2014 11:29:28 for D-Bus by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
