<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>D-Bus: dbus-hash.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">D-Bus
   &#160;<span id="projectnumber">1.4.18</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">dbus-hash.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* -*- mode: C; c-file-style: &quot;gnu&quot;; indent-tabs-mode: nil; -*- */</span>
<a name="l00002"></a>00002 <span class="comment">/* dbus-hash.c Generic hash table utility (internal to D-Bus implementation)</span>
<a name="l00003"></a>00003 <span class="comment"> * </span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (C) 2002  Red Hat, Inc.</span>
<a name="l00005"></a>00005 <span class="comment"> * Copyright (c) 1991-1993 The Regents of the University of California.</span>
<a name="l00006"></a>00006 <span class="comment"> * Copyright (c) 1994 Sun Microsystems, Inc.</span>
<a name="l00007"></a>00007 <span class="comment"> * </span>
<a name="l00008"></a>00008 <span class="comment"> * Hash table implementation based on generic/tclHash.c from the Tcl</span>
<a name="l00009"></a>00009 <span class="comment"> * source code. The original Tcl license applies to portions of the</span>
<a name="l00010"></a>00010 <span class="comment"> * code from tclHash.c; the Tcl license follows this standad D-Bus </span>
<a name="l00011"></a>00011 <span class="comment"> * license information.</span>
<a name="l00012"></a>00012 <span class="comment"> *</span>
<a name="l00013"></a>00013 <span class="comment"> * Licensed under the Academic Free License version 2.1</span>
<a name="l00014"></a>00014 <span class="comment"> * </span>
<a name="l00015"></a>00015 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00016"></a>00016 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00017"></a>00017 <span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00018"></a>00018 <span class="comment"> * (at your option) any later version.</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00021"></a>00021 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00022"></a>00022 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00023"></a>00023 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00024"></a>00024 <span class="comment"> * </span>
<a name="l00025"></a>00025 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00026"></a>00026 <span class="comment"> * along with this program; if not, write to the Free Software</span>
<a name="l00027"></a>00027 <span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA</span>
<a name="l00028"></a>00028 <span class="comment"> *</span>
<a name="l00029"></a>00029 <span class="comment"> */</span>
<a name="l00030"></a>00030 <span class="comment">/* </span>
<a name="l00031"></a>00031 <span class="comment"> * The following copyright applies to code from the Tcl distribution.</span>
<a name="l00032"></a>00032 <span class="comment"> *</span>
<a name="l00033"></a>00033 <span class="comment"> * Copyright (c) 1991-1993 The Regents of the University of California.</span>
<a name="l00034"></a>00034 <span class="comment"> * Copyright (c) 1994 Sun Microsystems, Inc.</span>
<a name="l00035"></a>00035 <span class="comment"> *</span>
<a name="l00036"></a>00036 <span class="comment"> * This software is copyrighted by the Regents of the University of</span>
<a name="l00037"></a>00037 <span class="comment"> * California, Sun Microsystems, Inc., Scriptics Corporation, and</span>
<a name="l00038"></a>00038 <span class="comment"> * other parties.  The following terms apply to all files associated</span>
<a name="l00039"></a>00039 <span class="comment"> * with the software unless explicitly disclaimed in individual files.</span>
<a name="l00040"></a>00040 <span class="comment"> * </span>
<a name="l00041"></a>00041 <span class="comment"> * The authors hereby grant permission to use, copy, modify,</span>
<a name="l00042"></a>00042 <span class="comment"> * distribute, and license this software and its documentation for any</span>
<a name="l00043"></a>00043 <span class="comment"> * purpose, provided that existing copyright notices are retained in</span>
<a name="l00044"></a>00044 <span class="comment"> * all copies and that this notice is included verbatim in any</span>
<a name="l00045"></a>00045 <span class="comment"> * distributions. No written agreement, license, or royalty fee is</span>
<a name="l00046"></a>00046 <span class="comment"> * required for any of the authorized uses.  Modifications to this</span>
<a name="l00047"></a>00047 <span class="comment"> * software may be copyrighted by their authors and need not follow</span>
<a name="l00048"></a>00048 <span class="comment"> * the licensing terms described here, provided that the new terms are</span>
<a name="l00049"></a>00049 <span class="comment"> * clearly indicated on the first page of each file where they apply.</span>
<a name="l00050"></a>00050 <span class="comment"> * </span>
<a name="l00051"></a>00051 <span class="comment"> * IN NO EVENT SHALL THE AUTHORS OR DISTRIBUTORS BE LIABLE TO ANY</span>
<a name="l00052"></a>00052 <span class="comment"> * PARTY FOR DIRECT, INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL</span>
<a name="l00053"></a>00053 <span class="comment"> * DAMAGES ARISING OUT OF THE USE OF THIS SOFTWARE, ITS DOCUMENTATION,</span>
<a name="l00054"></a>00054 <span class="comment"> * OR ANY DERIVATIVES THEREOF, EVEN IF THE AUTHORS HAVE BEEN ADVISED</span>
<a name="l00055"></a>00055 <span class="comment"> * OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00056"></a>00056 <span class="comment"> * </span>
<a name="l00057"></a>00057 <span class="comment"> * THE AUTHORS AND DISTRIBUTORS SPECIFICALLY DISCLAIM ANY WARRANTIES,</span>
<a name="l00058"></a>00058 <span class="comment"> * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF</span>
<a name="l00059"></a>00059 <span class="comment"> * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, AND</span>
<a name="l00060"></a>00060 <span class="comment"> * NON-INFRINGEMENT.  THIS SOFTWARE IS PROVIDED ON AN &quot;AS IS&quot; BASIS,</span>
<a name="l00061"></a>00061 <span class="comment"> * AND THE AUTHORS AND DISTRIBUTORS HAVE NO OBLIGATION TO PROVIDE</span>
<a name="l00062"></a>00062 <span class="comment"> * MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS.</span>
<a name="l00063"></a>00063 <span class="comment"> * </span>
<a name="l00064"></a>00064 <span class="comment"> * GOVERNMENT USE: If you are acquiring this software on behalf of the</span>
<a name="l00065"></a>00065 <span class="comment"> * U.S. government, the Government shall have only &quot;Restricted Rights&quot;</span>
<a name="l00066"></a>00066 <span class="comment"> * in the software and related documentation as defined in the Federal</span>
<a name="l00067"></a>00067 <span class="comment"> * Acquisition Regulations (FARs) in Clause 52.227.19 (c) (2).  If you</span>
<a name="l00068"></a>00068 <span class="comment"> * are acquiring the software on behalf of the Department of Defense,</span>
<a name="l00069"></a>00069 <span class="comment"> * the software shall be classified as &quot;Commercial Computer Software&quot;</span>
<a name="l00070"></a>00070 <span class="comment"> * and the Government shall have only &quot;Restricted Rights&quot; as defined</span>
<a name="l00071"></a>00071 <span class="comment"> * in Clause 252.227-7013 (c) (1) of DFARs.  Notwithstanding the</span>
<a name="l00072"></a>00072 <span class="comment"> * foregoing, the authors grant the U.S. Government and others acting</span>
<a name="l00073"></a>00073 <span class="comment"> * in its behalf permission to use and distribute the software in</span>
<a name="l00074"></a>00074 <span class="comment"> * accordance with the terms specified in this license.</span>
<a name="l00075"></a>00075 <span class="comment"> */</span>
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="preprocessor">#include &lt;config.h&gt;</span>
<a name="l00078"></a>00078 <span class="preprocessor">#include &quot;dbus-hash.h&quot;</span>
<a name="l00079"></a>00079 <span class="preprocessor">#include &quot;dbus-internals.h&quot;</span>
<a name="l00080"></a>00080 <span class="preprocessor">#include &quot;dbus-mempool.h&quot;</span>
<a name="l00081"></a>00081 
<a name="l00104"></a><a class="code" href="group__DBusHashTableInternals.html#ga8c6d6296d450e37074dbd8c15638b499">00104</a> <span class="preprocessor">#define REBUILD_MULTIPLIER  3</span>
<a name="l00105"></a>00105 <span class="preprocessor"></span>
<a name="l00122"></a><a class="code" href="group__DBusHashTableInternals.html#ga9dc8fd5a9e25bd2b229366a683ff78f9">00122</a> <span class="preprocessor">#define RANDOM_INDEX(table, i) \</span>
<a name="l00123"></a>00123 <span class="preprocessor">    (((((intptr_t) (i))*1103515245) &gt;&gt; (table)-&gt;down_shift) &amp; (table)-&gt;mask)</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span>
<a name="l00130"></a><a class="code" href="group__DBusHashTableInternals.html#ga4518324f3c3caacf5694065f4f6071d8">00130</a> <span class="preprocessor">#define DBUS_SMALL_HASH_TABLE 4</span>
<a name="l00131"></a>00131 <span class="preprocessor"></span>
<a name="l00135"></a><a class="code" href="group__DBusHashTableInternals.html#gad7d2d7c568541eeeb86104138d64a9f3">00135</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>;
<a name="l00136"></a>00136 
<a name="l00143"></a><a class="code" href="structDBusHashEntry.html">00143</a> <span class="keyword">struct </span><a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>
<a name="l00144"></a>00144 {
<a name="l00145"></a><a class="code" href="structDBusHashEntry.html#ae986e25c0b24237f9848ff43aa1d8501">00145</a>   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *<a class="code" href="structDBusHashEntry.html#ae986e25c0b24237f9848ff43aa1d8501" title="Pointer to next entry in this hash bucket, or NULL for end of chain.">next</a>;    
<a name="l00149"></a><a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894">00149</a>   <span class="keywordtype">void</span> *<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a>;              
<a name="l00150"></a><a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e">00150</a>   <span class="keywordtype">void</span> *<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a>;            
<a name="l00151"></a>00151 };
<a name="l00152"></a>00152 
<a name="l00156"></a><a class="code" href="group__DBusHashTableInternals.html#ga20a95a9ff37ad777575336e9e4fd8a10">00156</a> <span class="keyword">typedef</span> <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>* (* DBusFindEntryFunction) (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>        *table,
<a name="l00157"></a>00157                                                   <span class="keywordtype">void</span>                 *key,
<a name="l00158"></a>00158                                                   <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>           create_if_not_found,
<a name="l00159"></a>00159                                                   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>      ***bucket,
<a name="l00160"></a>00160                                                   <a class="code" href="group__DBusHashTable.html#ga175dc6ab841ed32bb6acf6e4c0df36a8" title="A preallocated hash entry.">DBusPreallocatedHash</a> *preallocated);
<a name="l00161"></a>00161 
<a name="l00168"></a><a class="code" href="structDBusHashTable.html">00168</a> <span class="keyword">struct </span><a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> {
<a name="l00169"></a><a class="code" href="structDBusHashTable.html#acb2b7bcba65da77f7ecf67da355ff770">00169</a>   <span class="keywordtype">int</span> <a class="code" href="structDBusHashTable.html#acb2b7bcba65da77f7ecf67da355ff770" title="Reference count.">refcount</a>;                       
<a name="l00171"></a><a class="code" href="structDBusHashTable.html#a1f974e2cb3038685b3edf493406ad99d">00171</a>   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> **<a class="code" href="structDBusHashTable.html#a1f974e2cb3038685b3edf493406ad99d" title="Pointer to bucket array.">buckets</a>;            
<a name="l00175"></a>00175   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *<a class="code" href="structDBusHashTable.html#af71877d64657c34a783caf6b82b016e9" title="Bucket array used for small tables (to avoid mallocs and frees).">static_buckets</a>[<a class="code" href="group__DBusHashTableInternals.html#ga4518324f3c3caacf5694065f4f6071d8" title="Initial number of buckets in hash table (hash table statically allocates its buckets for this size an...">DBUS_SMALL_HASH_TABLE</a>];
<a name="l00179"></a><a class="code" href="structDBusHashTable.html#a2dd2b9389d65d30e31e596dd786a9aa7">00179</a>   <span class="keywordtype">int</span> <a class="code" href="structDBusHashTable.html#a2dd2b9389d65d30e31e596dd786a9aa7" title="Total number of buckets allocated at **buckets.">n_buckets</a>;                       
<a name="l00182"></a><a class="code" href="structDBusHashTable.html#affbf11a9c3dd72d55b7976891f7b4650">00182</a>   <span class="keywordtype">int</span> <a class="code" href="structDBusHashTable.html#affbf11a9c3dd72d55b7976891f7b4650" title="Total number of entries present in table.">n_entries</a>;                       
<a name="l00185"></a><a class="code" href="structDBusHashTable.html#a29c408110c0d189d89b60c6c01cfb0cf">00185</a>   <span class="keywordtype">int</span> <a class="code" href="structDBusHashTable.html#a29c408110c0d189d89b60c6c01cfb0cf" title="Enlarge table when n_entries gets to be this large.">hi_rebuild_size</a>;                 
<a name="l00188"></a><a class="code" href="structDBusHashTable.html#aae6ea7cb15d618866854b2b6bd468419">00188</a>   <span class="keywordtype">int</span> <a class="code" href="structDBusHashTable.html#aae6ea7cb15d618866854b2b6bd468419" title="Shrink table when n_entries gets below this.">lo_rebuild_size</a>;                 
<a name="l00191"></a><a class="code" href="structDBusHashTable.html#a2e7e7b92bb9633ab95cfaa592b89025c">00191</a>   <span class="keywordtype">int</span> <a class="code" href="structDBusHashTable.html#a2e7e7b92bb9633ab95cfaa592b89025c" title="Shift count used in hashing function.">down_shift</a>;                      
<a name="l00195"></a><a class="code" href="structDBusHashTable.html#aec1230eebce3d256ca9ceebe372647e9">00195</a>   <span class="keywordtype">int</span> <a class="code" href="structDBusHashTable.html#aec1230eebce3d256ca9ceebe372647e9" title="Mask value used in hashing function.">mask</a>;                            
<a name="l00198"></a><a class="code" href="structDBusHashTable.html#a28f326a2947b6be0b0b852db376a1092">00198</a>   <a class="code" href="group__DBusHashTable.html#gab0ab9767ffa5b6720a13b3d741630852" title="Indicates the type of a key in the hash table.">DBusHashType</a> <a class="code" href="structDBusHashTable.html#a28f326a2947b6be0b0b852db376a1092" title="Type of keys used in this table.">key_type</a>;               
<a name="l00201"></a><a class="code" href="structDBusHashTable.html#ab98bafddf1b1ce1dad01c5595e278e35">00201</a>   <a class="code" href="group__DBusHashTableInternals.html#ga20a95a9ff37ad777575336e9e4fd8a10" title="Function used to find and optionally create a hash entry.">DBusFindEntryFunction</a> <a class="code" href="structDBusHashTable.html#ab98bafddf1b1ce1dad01c5595e278e35" title="Function for finding entries.">find_function</a>; 
<a name="l00203"></a><a class="code" href="structDBusHashTable.html#a5f6541574ea8e6bedd80773dce8e52a6">00203</a>   <a class="code" href="group__DBusMemory.html#ga061bcded226d76c7d7de35beaa165cb5" title="The type of a function which frees a block of memory.">DBusFreeFunction</a> <a class="code" href="structDBusHashTable.html#a5f6541574ea8e6bedd80773dce8e52a6" title="Function to free keys.">free_key_function</a>;   
<a name="l00204"></a><a class="code" href="structDBusHashTable.html#afbb42b5326b9c79352b168eace1687ca">00204</a>   <a class="code" href="group__DBusMemory.html#ga061bcded226d76c7d7de35beaa165cb5" title="The type of a function which frees a block of memory.">DBusFreeFunction</a> <a class="code" href="structDBusHashTable.html#afbb42b5326b9c79352b168eace1687ca" title="Function to free values.">free_value_function</a>; 
<a name="l00206"></a><a class="code" href="structDBusHashTable.html#ad1224e6c3c632afb265b78f8f6e30f97">00206</a>   <a class="code" href="structDBusMemPool.html" title="Internals fields of DBusMemPool.">DBusMemPool</a> *<a class="code" href="structDBusHashTable.html#ad1224e6c3c632afb265b78f8f6e30f97" title="Memory pool for hash entries.">entry_pool</a>;              
<a name="l00207"></a>00207 };
<a name="l00208"></a>00208 
<a name="l00212"></a><a class="code" href="structDBusRealHashIter.html">00212</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
<a name="l00213"></a>00213 {
<a name="l00214"></a><a class="code" href="structDBusRealHashIter.html#a0307c2b8fa9384554ceb3cc965b04633">00214</a>   <a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *<a class="code" href="structDBusRealHashIter.html#a0307c2b8fa9384554ceb3cc965b04633" title="Pointer to table containing entry.">table</a>;     
<a name="l00215"></a><a class="code" href="structDBusRealHashIter.html#ad36967dc68709d676ad591d7f75dd7fa">00215</a>   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> **bucket;   
<a name="l00219"></a><a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7">00219</a>   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a>;      
<a name="l00220"></a><a class="code" href="structDBusRealHashIter.html#a056417c3726f4f98eb94a9d2784a59e0">00220</a>   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *<a class="code" href="structDBusRealHashIter.html#a056417c3726f4f98eb94a9d2784a59e0" title="Next entry to be iterated onto in current bucket.">next_entry</a>; 
<a name="l00221"></a><a class="code" href="structDBusRealHashIter.html#adbf758933299ee6305c525ea0fe74824">00221</a>   <span class="keywordtype">int</span> <a class="code" href="structDBusRealHashIter.html#adbf758933299ee6305c525ea0fe74824" title="index of next bucket">next_bucket</a>;           
<a name="l00222"></a><a class="code" href="structDBusRealHashIter.html#a84f2a189ee1eb3e51a8089b798a7797a">00222</a>   <span class="keywordtype">int</span> <a class="code" href="structDBusRealHashIter.html#a84f2a189ee1eb3e51a8089b798a7797a" title="used to detect table resize since initialization">n_entries_on_init</a>;     
<a name="l00223"></a>00223 } <a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a>;
<a name="l00224"></a>00224 
<a name="l00225"></a>00225 _DBUS_STATIC_ASSERT (<span class="keyword">sizeof</span> (<a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a>) == <span class="keyword">sizeof</span> (<a class="code" href="structDBusHashIter.html" title="Hash iterator object.">DBusHashIter</a>));
<a name="l00226"></a>00226 
<a name="l00227"></a>00227 <span class="keyword">static</span> <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>* find_direct_function      (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>          *table,
<a name="l00228"></a>00228                                                  <span class="keywordtype">void</span>                   *key,
<a name="l00229"></a>00229                                                  <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>             create_if_not_found,
<a name="l00230"></a>00230                                                  <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>        ***bucket,
<a name="l00231"></a>00231                                                  <a class="code" href="group__DBusHashTable.html#ga175dc6ab841ed32bb6acf6e4c0df36a8" title="A preallocated hash entry.">DBusPreallocatedHash</a>   *preallocated);
<a name="l00232"></a>00232 <span class="keyword">static</span> <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>* find_string_function      (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>          *table,
<a name="l00233"></a>00233                                                  <span class="keywordtype">void</span>                   *key,
<a name="l00234"></a>00234                                                  <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>             create_if_not_found,
<a name="l00235"></a>00235                                                  <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>        ***bucket,
<a name="l00236"></a>00236                                                  <a class="code" href="group__DBusHashTable.html#ga175dc6ab841ed32bb6acf6e4c0df36a8" title="A preallocated hash entry.">DBusPreallocatedHash</a>   *preallocated);
<a name="l00237"></a>00237 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l00238"></a>00238 <span class="preprocessor"></span><span class="keyword">static</span> <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>* find_two_strings_function (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>          *table,
<a name="l00239"></a>00239                                                  <span class="keywordtype">void</span>                   *key,
<a name="l00240"></a>00240                                                  <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>             create_if_not_found,
<a name="l00241"></a>00241                                                  <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>        ***bucket,
<a name="l00242"></a>00242                                                  <a class="code" href="group__DBusHashTable.html#ga175dc6ab841ed32bb6acf6e4c0df36a8" title="A preallocated hash entry.">DBusPreallocatedHash</a>   *preallocated);
<a name="l00243"></a>00243 <span class="preprocessor">#endif</span>
<a name="l00244"></a>00244 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>   string_hash               (<span class="keyword">const</span> <span class="keywordtype">char</span>             *str);
<a name="l00245"></a>00245 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l00246"></a>00246 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>   two_strings_hash          (<span class="keyword">const</span> <span class="keywordtype">char</span>             *str);
<a name="l00247"></a>00247 <span class="preprocessor">#endif</span>
<a name="l00248"></a>00248 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span>           rebuild_table             (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>          *table);
<a name="l00249"></a>00249 <span class="keyword">static</span> <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>* alloc_entry               (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>          *table);
<a name="l00250"></a>00250 <span class="keyword">static</span> <span class="keywordtype">void</span>           remove_entry              (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>          *table,
<a name="l00251"></a>00251                                                  <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>         **bucket,
<a name="l00252"></a>00252                                                  <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>          *entry);
<a name="l00253"></a>00253 <span class="keyword">static</span> <span class="keywordtype">void</span>           free_entry                (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>          *table,
<a name="l00254"></a>00254                                                  <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>          *entry);
<a name="l00255"></a>00255 <span class="keyword">static</span> <span class="keywordtype">void</span>           free_entry_data           (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>          *table,
<a name="l00256"></a>00256                                                  <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>          *entry);
<a name="l00257"></a>00257 
<a name="l00258"></a>00258 
<a name="l00294"></a>00294 <a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>*
<a name="l00295"></a><a class="code" href="group__DBusHashTable.html#gac8e434348a354b9606d4c50c127a5eb4">00295</a> <a class="code" href="group__DBusHashTable.html#gac8e434348a354b9606d4c50c127a5eb4" title="Constructs a new hash table.">_dbus_hash_table_new</a> (<a class="code" href="group__DBusHashTable.html#gab0ab9767ffa5b6720a13b3d741630852" title="Indicates the type of a key in the hash table.">DBusHashType</a>     type,
<a name="l00296"></a>00296                       <a class="code" href="group__DBusMemory.html#ga061bcded226d76c7d7de35beaa165cb5" title="The type of a function which frees a block of memory.">DBusFreeFunction</a> key_free_function,
<a name="l00297"></a>00297                       <a class="code" href="group__DBusMemory.html#ga061bcded226d76c7d7de35beaa165cb5" title="The type of a function which frees a block of memory.">DBusFreeFunction</a> value_free_function)
<a name="l00298"></a>00298 {
<a name="l00299"></a>00299   <a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table;
<a name="l00300"></a>00300   <a class="code" href="structDBusMemPool.html" title="Internals fields of DBusMemPool.">DBusMemPool</a> *entry_pool;
<a name="l00301"></a>00301   
<a name="l00302"></a>00302   table = <a class="code" href="group__DBusMemory.html#gaba9d823abda7f4cadbaf5177d3b8b793" title="Safe macro for using dbus_malloc0().">dbus_new0</a> (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>, 1);
<a name="l00303"></a>00303   <span class="keywordflow">if</span> (table == <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>)
<a name="l00304"></a>00304     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>;
<a name="l00305"></a>00305 
<a name="l00306"></a>00306   entry_pool = <a class="code" href="group__DBusMemPool.html#gaf1bae02bc5fcb879f77ff2c13ca03ac8" title="Creates a new memory pool, or returns NULL on failure.">_dbus_mem_pool_new</a> (<span class="keyword">sizeof</span> (<a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>), <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>);
<a name="l00307"></a>00307   <span class="keywordflow">if</span> (entry_pool == <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>)
<a name="l00308"></a>00308     {
<a name="l00309"></a>00309       <a class="code" href="group__DBusMemory.html#ga34e666b19b015035a9a31e53da84b39a" title="Frees a block of memory previously allocated by dbus_malloc() or dbus_malloc0().">dbus_free</a> (table);
<a name="l00310"></a>00310       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>;
<a name="l00311"></a>00311     }
<a name="l00312"></a>00312   
<a name="l00313"></a>00313   table-&gt;<a class="code" href="structDBusHashTable.html#acb2b7bcba65da77f7ecf67da355ff770" title="Reference count.">refcount</a> = 1;
<a name="l00314"></a>00314   table-&gt;<a class="code" href="structDBusHashTable.html#ad1224e6c3c632afb265b78f8f6e30f97" title="Memory pool for hash entries.">entry_pool</a> = entry_pool;
<a name="l00315"></a>00315   
<a name="l00316"></a>00316   _dbus_assert (<a class="code" href="group__DBusHashTableInternals.html#ga4518324f3c3caacf5694065f4f6071d8" title="Initial number of buckets in hash table (hash table statically allocates its buckets for this size an...">DBUS_SMALL_HASH_TABLE</a> == _DBUS_N_ELEMENTS (table-&gt;<a class="code" href="structDBusHashTable.html#af71877d64657c34a783caf6b82b016e9" title="Bucket array used for small tables (to avoid mallocs and frees).">static_buckets</a>));
<a name="l00317"></a>00317   
<a name="l00318"></a>00318   table-&gt;<a class="code" href="structDBusHashTable.html#a1f974e2cb3038685b3edf493406ad99d" title="Pointer to bucket array.">buckets</a> = table-&gt;<a class="code" href="structDBusHashTable.html#af71877d64657c34a783caf6b82b016e9" title="Bucket array used for small tables (to avoid mallocs and frees).">static_buckets</a>;  
<a name="l00319"></a>00319   table-&gt;<a class="code" href="structDBusHashTable.html#a2dd2b9389d65d30e31e596dd786a9aa7" title="Total number of buckets allocated at **buckets.">n_buckets</a> = <a class="code" href="group__DBusHashTableInternals.html#ga4518324f3c3caacf5694065f4f6071d8" title="Initial number of buckets in hash table (hash table statically allocates its buckets for this size an...">DBUS_SMALL_HASH_TABLE</a>;
<a name="l00320"></a>00320   table-&gt;<a class="code" href="structDBusHashTable.html#affbf11a9c3dd72d55b7976891f7b4650" title="Total number of entries present in table.">n_entries</a> = 0;
<a name="l00321"></a>00321   table-&gt;<a class="code" href="structDBusHashTable.html#a29c408110c0d189d89b60c6c01cfb0cf" title="Enlarge table when n_entries gets to be this large.">hi_rebuild_size</a> = <a class="code" href="group__DBusHashTableInternals.html#ga4518324f3c3caacf5694065f4f6071d8" title="Initial number of buckets in hash table (hash table statically allocates its buckets for this size an...">DBUS_SMALL_HASH_TABLE</a> * <a class="code" href="group__DBusHashTableInternals.html#ga8c6d6296d450e37074dbd8c15638b499" title="When there are this many entries per bucket, on average, rebuild the hash table to make it larger...">REBUILD_MULTIPLIER</a>;
<a name="l00322"></a>00322   table-&gt;<a class="code" href="structDBusHashTable.html#aae6ea7cb15d618866854b2b6bd468419" title="Shrink table when n_entries gets below this.">lo_rebuild_size</a> = 0;
<a name="l00323"></a>00323   table-&gt;<a class="code" href="structDBusHashTable.html#a2e7e7b92bb9633ab95cfaa592b89025c" title="Shift count used in hashing function.">down_shift</a> = 28;
<a name="l00324"></a>00324   table-&gt;<a class="code" href="structDBusHashTable.html#aec1230eebce3d256ca9ceebe372647e9" title="Mask value used in hashing function.">mask</a> = 3;
<a name="l00325"></a>00325   table-&gt;<a class="code" href="structDBusHashTable.html#a28f326a2947b6be0b0b852db376a1092" title="Type of keys used in this table.">key_type</a> = type;
<a name="l00326"></a>00326 
<a name="l00327"></a>00327   _dbus_assert (table-&gt;<a class="code" href="structDBusHashTable.html#aec1230eebce3d256ca9ceebe372647e9" title="Mask value used in hashing function.">mask</a> &lt; table-&gt;<a class="code" href="structDBusHashTable.html#a2dd2b9389d65d30e31e596dd786a9aa7" title="Total number of buckets allocated at **buckets.">n_buckets</a>);
<a name="l00328"></a>00328   
<a name="l00329"></a>00329   <span class="keywordflow">switch</span> (table-&gt;<a class="code" href="structDBusHashTable.html#a28f326a2947b6be0b0b852db376a1092" title="Type of keys used in this table.">key_type</a>)
<a name="l00330"></a>00330     {
<a name="l00331"></a>00331     <span class="keywordflow">case</span> <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a26446bd9fbb15c6c381b35a810207141" title="Hash keys are integers.">DBUS_HASH_INT</a>:
<a name="l00332"></a>00332     <span class="keywordflow">case</span> <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a38604db762cd0ed315106a95a6b50c4d" title="Hash keys are pointers.">DBUS_HASH_POINTER</a>:
<a name="l00333"></a>00333     <span class="keywordflow">case</span> <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a477caf35cc3676d6412c9b57f1d0f6c7" title="Hash keys are integer capable to hold a pointer.">DBUS_HASH_UINTPTR</a>:
<a name="l00334"></a>00334       table-&gt;<a class="code" href="structDBusHashTable.html#ab98bafddf1b1ce1dad01c5595e278e35" title="Function for finding entries.">find_function</a> = find_direct_function;
<a name="l00335"></a>00335       <span class="keywordflow">break</span>;
<a name="l00336"></a>00336     <span class="keywordflow">case</span> <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a481fd0166d28da725b3e97f15192434e" title="Hash keys are strings.">DBUS_HASH_STRING</a>:
<a name="l00337"></a>00337       table-&gt;<a class="code" href="structDBusHashTable.html#ab98bafddf1b1ce1dad01c5595e278e35" title="Function for finding entries.">find_function</a> = find_string_function;
<a name="l00338"></a>00338       <span class="keywordflow">break</span>;
<a name="l00339"></a>00339     <span class="keywordflow">case</span> <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852ac750b865c7994a3dd6d1028b7ae76877" title="Hash key is two strings in one memory block, i.e.">DBUS_HASH_TWO_STRINGS</a>:
<a name="l00340"></a>00340 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l00341"></a>00341 <span class="preprocessor"></span>      table-&gt;<a class="code" href="structDBusHashTable.html#ab98bafddf1b1ce1dad01c5595e278e35" title="Function for finding entries.">find_function</a> = find_two_strings_function;
<a name="l00342"></a>00342 <span class="preprocessor">#endif</span>
<a name="l00343"></a>00343 <span class="preprocessor"></span>      <span class="keywordflow">break</span>;
<a name="l00344"></a>00344     <span class="keywordflow">default</span>:
<a name="l00345"></a>00345       _dbus_assert_not_reached (<span class="stringliteral">&quot;Unknown hash table type&quot;</span>);
<a name="l00346"></a>00346       <span class="keywordflow">break</span>;
<a name="l00347"></a>00347     }
<a name="l00348"></a>00348 
<a name="l00349"></a>00349   table-&gt;<a class="code" href="structDBusHashTable.html#a5f6541574ea8e6bedd80773dce8e52a6" title="Function to free keys.">free_key_function</a> = key_free_function;
<a name="l00350"></a>00350   table-&gt;<a class="code" href="structDBusHashTable.html#afbb42b5326b9c79352b168eace1687ca" title="Function to free values.">free_value_function</a> = value_free_function;
<a name="l00351"></a>00351 
<a name="l00352"></a>00352   <span class="keywordflow">return</span> table;
<a name="l00353"></a>00353 }
<a name="l00354"></a>00354 
<a name="l00355"></a>00355 
<a name="l00362"></a>00362 <a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *
<a name="l00363"></a><a class="code" href="group__DBusHashTable.html#ga4ad4622378885e5d911c26956e174a45">00363</a> <a class="code" href="group__DBusHashTable.html#ga4ad4622378885e5d911c26956e174a45" title="Increments the reference count for a hash table.">_dbus_hash_table_ref</a> (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table)
<a name="l00364"></a>00364 {
<a name="l00365"></a>00365   table-&gt;<a class="code" href="structDBusHashTable.html#acb2b7bcba65da77f7ecf67da355ff770" title="Reference count.">refcount</a> += 1;
<a name="l00366"></a>00366   
<a name="l00367"></a>00367   <span class="keywordflow">return</span> table;
<a name="l00368"></a>00368 }
<a name="l00369"></a>00369 
<a name="l00376"></a>00376 <span class="keywordtype">void</span>
<a name="l00377"></a><a class="code" href="group__DBusHashTable.html#ga96b777e00764b44e0f3216fd8478f5a9">00377</a> <a class="code" href="group__DBusHashTable.html#ga96b777e00764b44e0f3216fd8478f5a9" title="Decrements the reference count for a hash table, freeing the hash table if the count reaches zero...">_dbus_hash_table_unref</a> (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table)
<a name="l00378"></a>00378 {
<a name="l00379"></a>00379   table-&gt;<a class="code" href="structDBusHashTable.html#acb2b7bcba65da77f7ecf67da355ff770" title="Reference count.">refcount</a> -= 1;
<a name="l00380"></a>00380 
<a name="l00381"></a>00381   <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structDBusHashTable.html#acb2b7bcba65da77f7ecf67da355ff770" title="Reference count.">refcount</a> == 0)
<a name="l00382"></a>00382     {
<a name="l00383"></a>00383 <span class="preprocessor">#if 0</span>
<a name="l00384"></a>00384 <span class="preprocessor"></span>      <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l00385"></a>00385       <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *next;
<a name="l00386"></a>00386       <span class="keywordtype">int</span> i;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388       <span class="comment">/* Free the entries in the table. */</span>
<a name="l00389"></a>00389       <span class="keywordflow">for</span> (i = 0; i &lt; table-&gt;<a class="code" href="structDBusHashTable.html#a2dd2b9389d65d30e31e596dd786a9aa7" title="Total number of buckets allocated at **buckets.">n_buckets</a>; i++)
<a name="l00390"></a>00390         {
<a name="l00391"></a>00391           entry = table-&gt;<a class="code" href="structDBusHashTable.html#a1f974e2cb3038685b3edf493406ad99d" title="Pointer to bucket array.">buckets</a>[i];
<a name="l00392"></a>00392           <span class="keywordflow">while</span> (entry != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>)
<a name="l00393"></a>00393             {
<a name="l00394"></a>00394               next = entry-&gt;<a class="code" href="structDBusHashEntry.html#ae986e25c0b24237f9848ff43aa1d8501" title="Pointer to next entry in this hash bucket, or NULL for end of chain.">next</a>;
<a name="l00395"></a>00395 
<a name="l00396"></a>00396               free_entry (table, entry);
<a name="l00397"></a>00397               
<a name="l00398"></a>00398               entry = next;
<a name="l00399"></a>00399             }
<a name="l00400"></a>00400         }
<a name="l00401"></a>00401 <span class="preprocessor">#else</span>
<a name="l00402"></a>00402 <span class="preprocessor"></span>      <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l00403"></a>00403       <span class="keywordtype">int</span> i;
<a name="l00404"></a>00404 
<a name="l00405"></a>00405       <span class="comment">/* Free the entries in the table. */</span>
<a name="l00406"></a>00406       <span class="keywordflow">for</span> (i = 0; i &lt; table-&gt;<a class="code" href="structDBusHashTable.html#a2dd2b9389d65d30e31e596dd786a9aa7" title="Total number of buckets allocated at **buckets.">n_buckets</a>; i++)
<a name="l00407"></a>00407         {
<a name="l00408"></a>00408           entry = table-&gt;<a class="code" href="structDBusHashTable.html#a1f974e2cb3038685b3edf493406ad99d" title="Pointer to bucket array.">buckets</a>[i];
<a name="l00409"></a>00409           <span class="keywordflow">while</span> (entry != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>)
<a name="l00410"></a>00410             {
<a name="l00411"></a>00411               free_entry_data (table, entry);
<a name="l00412"></a>00412               
<a name="l00413"></a>00413               entry = entry-&gt;<a class="code" href="structDBusHashEntry.html#ae986e25c0b24237f9848ff43aa1d8501" title="Pointer to next entry in this hash bucket, or NULL for end of chain.">next</a>;
<a name="l00414"></a>00414             }
<a name="l00415"></a>00415         }
<a name="l00416"></a>00416       <span class="comment">/* We can do this very quickly with memory pools ;-) */</span>
<a name="l00417"></a>00417       <a class="code" href="group__DBusMemPool.html#ga58e4f3def46410d5bb138a2b8f366b1a" title="Frees a memory pool (and all elements allocated from it).">_dbus_mem_pool_free</a> (table-&gt;<a class="code" href="structDBusHashTable.html#ad1224e6c3c632afb265b78f8f6e30f97" title="Memory pool for hash entries.">entry_pool</a>);
<a name="l00418"></a>00418 <span class="preprocessor">#endif</span>
<a name="l00419"></a>00419 <span class="preprocessor"></span>      
<a name="l00420"></a>00420       <span class="comment">/* Free the bucket array, if it was dynamically allocated. */</span>
<a name="l00421"></a>00421       <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structDBusHashTable.html#a1f974e2cb3038685b3edf493406ad99d" title="Pointer to bucket array.">buckets</a> != table-&gt;<a class="code" href="structDBusHashTable.html#af71877d64657c34a783caf6b82b016e9" title="Bucket array used for small tables (to avoid mallocs and frees).">static_buckets</a>)
<a name="l00422"></a>00422         <a class="code" href="group__DBusMemory.html#ga34e666b19b015035a9a31e53da84b39a" title="Frees a block of memory previously allocated by dbus_malloc() or dbus_malloc0().">dbus_free</a> (table-&gt;<a class="code" href="structDBusHashTable.html#a1f974e2cb3038685b3edf493406ad99d" title="Pointer to bucket array.">buckets</a>);
<a name="l00423"></a>00423 
<a name="l00424"></a>00424       <a class="code" href="group__DBusMemory.html#ga34e666b19b015035a9a31e53da84b39a" title="Frees a block of memory previously allocated by dbus_malloc() or dbus_malloc0().">dbus_free</a> (table);
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426 }
<a name="l00427"></a>00427 
<a name="l00433"></a>00433 <span class="keywordtype">void</span>
<a name="l00434"></a><a class="code" href="group__DBusHashTable.html#gad169f3790ca67f8a0adafcdc88ef7188">00434</a> <a class="code" href="group__DBusHashTable.html#gad169f3790ca67f8a0adafcdc88ef7188" title="Removed all entries from a hash table.">_dbus_hash_table_remove_all</a> (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table)
<a name="l00435"></a>00435 {
<a name="l00436"></a>00436   <a class="code" href="structDBusHashIter.html" title="Hash iterator object.">DBusHashIter</a> iter;
<a name="l00437"></a>00437   <a class="code" href="group__DBusHashTable.html#ga1b0e6df8a8617ef0f8f25adfba3acc4c" title="Initializes a hash table iterator.">_dbus_hash_iter_init</a> (table, &amp;iter);
<a name="l00438"></a>00438   <span class="keywordflow">while</span> (<a class="code" href="group__DBusHashTable.html#ga723e61fcc91ca673e90ff872c07ea19c" title="Move the hash iterator forward one step, to the next hash entry.">_dbus_hash_iter_next</a> (&amp;iter))
<a name="l00439"></a>00439     {
<a name="l00440"></a>00440       <a class="code" href="group__DBusHashTable.html#ga0ef12d773a546f070cff91cbf1e8d16e" title="Removes the current entry from the hash table.">_dbus_hash_iter_remove_entry</a>(&amp;iter);
<a name="l00441"></a>00441     }
<a name="l00442"></a>00442 }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444 <span class="keyword">static</span> <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>*
<a name="l00445"></a>00445 alloc_entry (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table)
<a name="l00446"></a>00446 {
<a name="l00447"></a>00447   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l00448"></a>00448 
<a name="l00449"></a>00449   entry = <a class="code" href="group__DBusMemPool.html#ga0946d54f767b4f55238f5a39c8543df1" title="Allocates an object from the memory pool.">_dbus_mem_pool_alloc</a> (table-&gt;<a class="code" href="structDBusHashTable.html#ad1224e6c3c632afb265b78f8f6e30f97" title="Memory pool for hash entries.">entry_pool</a>);
<a name="l00450"></a>00450   
<a name="l00451"></a>00451   <span class="keywordflow">return</span> entry;
<a name="l00452"></a>00452 }
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00455"></a>00455 free_entry_data (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>  *table,
<a name="l00456"></a>00456                  <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>  *entry)
<a name="l00457"></a>00457 {
<a name="l00458"></a>00458   <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structDBusHashTable.html#a5f6541574ea8e6bedd80773dce8e52a6" title="Function to free keys.">free_key_function</a>)
<a name="l00459"></a>00459     (* table-&gt;<a class="code" href="structDBusHashTable.html#a5f6541574ea8e6bedd80773dce8e52a6" title="Function to free keys.">free_key_function</a>) (entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a>);
<a name="l00460"></a>00460   <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structDBusHashTable.html#afbb42b5326b9c79352b168eace1687ca" title="Function to free values.">free_value_function</a>)
<a name="l00461"></a>00461     (* table-&gt;<a class="code" href="structDBusHashTable.html#afbb42b5326b9c79352b168eace1687ca" title="Function to free values.">free_value_function</a>) (entry-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a>);
<a name="l00462"></a>00462 }
<a name="l00463"></a>00463 
<a name="l00464"></a>00464 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00465"></a>00465 free_entry (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>  *table,
<a name="l00466"></a>00466             <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>  *entry)
<a name="l00467"></a>00467 {
<a name="l00468"></a>00468   free_entry_data (table, entry);
<a name="l00469"></a>00469   <a class="code" href="group__DBusMemPool.html#ga4e2feaefee7384ed940059e6c7b0a9d5" title="Deallocates an object previously created with _dbus_mem_pool_alloc().">_dbus_mem_pool_dealloc</a> (table-&gt;<a class="code" href="structDBusHashTable.html#ad1224e6c3c632afb265b78f8f6e30f97" title="Memory pool for hash entries.">entry_pool</a>, entry);
<a name="l00470"></a>00470 }
<a name="l00471"></a>00471 
<a name="l00472"></a>00472 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00473"></a>00473 remove_entry (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>  *table,
<a name="l00474"></a>00474               <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> **bucket,
<a name="l00475"></a>00475               <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>  *entry)
<a name="l00476"></a>00476 {
<a name="l00477"></a>00477   _dbus_assert (table != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00478"></a>00478   _dbus_assert (bucket != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00479"></a>00479   _dbus_assert (*bucket != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);  
<a name="l00480"></a>00480   _dbus_assert (entry != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00481"></a>00481   
<a name="l00482"></a>00482   <span class="keywordflow">if</span> (*bucket == entry)
<a name="l00483"></a>00483     *bucket = entry-&gt;<a class="code" href="structDBusHashEntry.html#ae986e25c0b24237f9848ff43aa1d8501" title="Pointer to next entry in this hash bucket, or NULL for end of chain.">next</a>;
<a name="l00484"></a>00484   <span class="keywordflow">else</span>
<a name="l00485"></a>00485     {
<a name="l00486"></a>00486       <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *prev;
<a name="l00487"></a>00487       prev = *bucket;
<a name="l00488"></a>00488 
<a name="l00489"></a>00489       <span class="keywordflow">while</span> (prev-&gt;<a class="code" href="structDBusHashEntry.html#ae986e25c0b24237f9848ff43aa1d8501" title="Pointer to next entry in this hash bucket, or NULL for end of chain.">next</a> != entry)
<a name="l00490"></a>00490         prev = prev-&gt;<a class="code" href="structDBusHashEntry.html#ae986e25c0b24237f9848ff43aa1d8501" title="Pointer to next entry in this hash bucket, or NULL for end of chain.">next</a>;      
<a name="l00491"></a>00491       
<a name="l00492"></a>00492       _dbus_assert (prev != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00493"></a>00493 
<a name="l00494"></a>00494       prev-&gt;<a class="code" href="structDBusHashEntry.html#ae986e25c0b24237f9848ff43aa1d8501" title="Pointer to next entry in this hash bucket, or NULL for end of chain.">next</a> = entry-&gt;<a class="code" href="structDBusHashEntry.html#ae986e25c0b24237f9848ff43aa1d8501" title="Pointer to next entry in this hash bucket, or NULL for end of chain.">next</a>;
<a name="l00495"></a>00495     }
<a name="l00496"></a>00496   
<a name="l00497"></a>00497   table-&gt;<a class="code" href="structDBusHashTable.html#affbf11a9c3dd72d55b7976891f7b4650" title="Total number of entries present in table.">n_entries</a> -= 1;
<a name="l00498"></a>00498   free_entry (table, entry);
<a name="l00499"></a>00499 }
<a name="l00500"></a>00500 
<a name="l00532"></a>00532 <span class="keywordtype">void</span>
<a name="l00533"></a><a class="code" href="group__DBusHashTable.html#ga1b0e6df8a8617ef0f8f25adfba3acc4c">00533</a> <a class="code" href="group__DBusHashTable.html#ga1b0e6df8a8617ef0f8f25adfba3acc4c" title="Initializes a hash table iterator.">_dbus_hash_iter_init</a> (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table,
<a name="l00534"></a>00534                       <a class="code" href="structDBusHashIter.html" title="Hash iterator object.">DBusHashIter</a>  *iter)
<a name="l00535"></a>00535 {
<a name="l00536"></a>00536   <a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a> *real;
<a name="l00537"></a>00537   
<a name="l00538"></a>00538   _dbus_assert (<span class="keyword">sizeof</span> (<a class="code" href="structDBusHashIter.html" title="Hash iterator object.">DBusHashIter</a>) == <span class="keyword">sizeof</span> (<a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a>));
<a name="l00539"></a>00539   
<a name="l00540"></a>00540   real = (<a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a>*) iter;
<a name="l00541"></a>00541 
<a name="l00542"></a>00542   real-&gt;<a class="code" href="structDBusRealHashIter.html#a0307c2b8fa9384554ceb3cc965b04633" title="Pointer to table containing entry.">table</a> = table;
<a name="l00543"></a>00543   real-&gt;<a class="code" href="structDBusRealHashIter.html#ad36967dc68709d676ad591d7f75dd7fa" title="Pointer to bucket that points to first entry in this entry&#39;s chain: used for deleting the entry...">bucket</a> = <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>;
<a name="l00544"></a>00544   real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a> = <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>;
<a name="l00545"></a>00545   real-&gt;<a class="code" href="structDBusRealHashIter.html#a056417c3726f4f98eb94a9d2784a59e0" title="Next entry to be iterated onto in current bucket.">next_entry</a> = <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>;
<a name="l00546"></a>00546   real-&gt;<a class="code" href="structDBusRealHashIter.html#adbf758933299ee6305c525ea0fe74824" title="index of next bucket">next_bucket</a> = 0;
<a name="l00547"></a>00547   real-&gt;<a class="code" href="structDBusRealHashIter.html#a84f2a189ee1eb3e51a8089b798a7797a" title="used to detect table resize since initialization">n_entries_on_init</a> = table-&gt;<a class="code" href="structDBusHashTable.html#affbf11a9c3dd72d55b7976891f7b4650" title="Total number of entries present in table.">n_entries</a>;
<a name="l00548"></a>00548 }
<a name="l00549"></a>00549 
<a name="l00558"></a>00558 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l00559"></a><a class="code" href="group__DBusHashTable.html#ga723e61fcc91ca673e90ff872c07ea19c">00559</a> <a class="code" href="group__DBusHashTable.html#ga723e61fcc91ca673e90ff872c07ea19c" title="Move the hash iterator forward one step, to the next hash entry.">_dbus_hash_iter_next</a> (<a class="code" href="structDBusHashIter.html" title="Hash iterator object.">DBusHashIter</a>  *iter)
<a name="l00560"></a>00560 {
<a name="l00561"></a>00561   <a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a> *real;
<a name="l00562"></a>00562   
<a name="l00563"></a>00563   _dbus_assert (<span class="keyword">sizeof</span> (<a class="code" href="structDBusHashIter.html" title="Hash iterator object.">DBusHashIter</a>) == <span class="keyword">sizeof</span> (<a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a>));
<a name="l00564"></a>00564   
<a name="l00565"></a>00565   real = (<a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a>*) iter;
<a name="l00566"></a>00566 
<a name="l00567"></a>00567   <span class="comment">/* if this assertion failed someone probably added hash entries</span>
<a name="l00568"></a>00568 <span class="comment">   * during iteration, which is bad.</span>
<a name="l00569"></a>00569 <span class="comment">   */</span>
<a name="l00570"></a>00570   _dbus_assert (real-&gt;<a class="code" href="structDBusRealHashIter.html#a84f2a189ee1eb3e51a8089b798a7797a" title="used to detect table resize since initialization">n_entries_on_init</a> &gt;= real-&gt;<a class="code" href="structDBusRealHashIter.html#a0307c2b8fa9384554ceb3cc965b04633" title="Pointer to table containing entry.">table</a>-&gt;<a class="code" href="structDBusHashTable.html#affbf11a9c3dd72d55b7976891f7b4650" title="Total number of entries present in table.">n_entries</a>);
<a name="l00571"></a>00571   
<a name="l00572"></a>00572   <span class="comment">/* Remember that real-&gt;entry may have been deleted */</span>
<a name="l00573"></a>00573   
<a name="l00574"></a>00574   <span class="keywordflow">while</span> (real-&gt;<a class="code" href="structDBusRealHashIter.html#a056417c3726f4f98eb94a9d2784a59e0" title="Next entry to be iterated onto in current bucket.">next_entry</a> == <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>)
<a name="l00575"></a>00575     {
<a name="l00576"></a>00576       <span class="keywordflow">if</span> (real-&gt;<a class="code" href="structDBusRealHashIter.html#adbf758933299ee6305c525ea0fe74824" title="index of next bucket">next_bucket</a> &gt;= real-&gt;<a class="code" href="structDBusRealHashIter.html#a0307c2b8fa9384554ceb3cc965b04633" title="Pointer to table containing entry.">table</a>-&gt;<a class="code" href="structDBusHashTable.html#a2dd2b9389d65d30e31e596dd786a9aa7" title="Total number of buckets allocated at **buckets.">n_buckets</a>)
<a name="l00577"></a>00577         {
<a name="l00578"></a>00578           <span class="comment">/* invalidate iter and return false */</span>
<a name="l00579"></a>00579           real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a> = <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>;
<a name="l00580"></a>00580           real-&gt;<a class="code" href="structDBusRealHashIter.html#a0307c2b8fa9384554ceb3cc965b04633" title="Pointer to table containing entry.">table</a> = <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>;
<a name="l00581"></a>00581           real-&gt;<a class="code" href="structDBusRealHashIter.html#ad36967dc68709d676ad591d7f75dd7fa" title="Pointer to bucket that points to first entry in this entry&#39;s chain: used for deleting the entry...">bucket</a> = <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>;
<a name="l00582"></a>00582           <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00583"></a>00583         }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585       real-&gt;<a class="code" href="structDBusRealHashIter.html#ad36967dc68709d676ad591d7f75dd7fa" title="Pointer to bucket that points to first entry in this entry&#39;s chain: used for deleting the entry...">bucket</a> = &amp;(real-&gt;<a class="code" href="structDBusRealHashIter.html#a0307c2b8fa9384554ceb3cc965b04633" title="Pointer to table containing entry.">table</a>-&gt;<a class="code" href="structDBusHashTable.html#a1f974e2cb3038685b3edf493406ad99d" title="Pointer to bucket array.">buckets</a>[real-&gt;<a class="code" href="structDBusRealHashIter.html#adbf758933299ee6305c525ea0fe74824" title="index of next bucket">next_bucket</a>]);
<a name="l00586"></a>00586       real-&gt;<a class="code" href="structDBusRealHashIter.html#a056417c3726f4f98eb94a9d2784a59e0" title="Next entry to be iterated onto in current bucket.">next_entry</a> = *(real-&gt;<a class="code" href="structDBusRealHashIter.html#ad36967dc68709d676ad591d7f75dd7fa" title="Pointer to bucket that points to first entry in this entry&#39;s chain: used for deleting the entry...">bucket</a>);
<a name="l00587"></a>00587       real-&gt;<a class="code" href="structDBusRealHashIter.html#adbf758933299ee6305c525ea0fe74824" title="index of next bucket">next_bucket</a> += 1;
<a name="l00588"></a>00588     }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590   _dbus_assert (real-&gt;<a class="code" href="structDBusRealHashIter.html#a056417c3726f4f98eb94a9d2784a59e0" title="Next entry to be iterated onto in current bucket.">next_entry</a> != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00591"></a>00591   _dbus_assert (real-&gt;<a class="code" href="structDBusRealHashIter.html#ad36967dc68709d676ad591d7f75dd7fa" title="Pointer to bucket that points to first entry in this entry&#39;s chain: used for deleting the entry...">bucket</a> != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00592"></a>00592   
<a name="l00593"></a>00593   real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a> = real-&gt;<a class="code" href="structDBusRealHashIter.html#a056417c3726f4f98eb94a9d2784a59e0" title="Next entry to be iterated onto in current bucket.">next_entry</a>;
<a name="l00594"></a>00594   real-&gt;<a class="code" href="structDBusRealHashIter.html#a056417c3726f4f98eb94a9d2784a59e0" title="Next entry to be iterated onto in current bucket.">next_entry</a> = real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a>-&gt;<a class="code" href="structDBusHashEntry.html#ae986e25c0b24237f9848ff43aa1d8501" title="Pointer to next entry in this hash bucket, or NULL for end of chain.">next</a>;
<a name="l00595"></a>00595   
<a name="l00596"></a>00596   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00597"></a>00597 }
<a name="l00598"></a>00598 
<a name="l00607"></a>00607 <span class="keywordtype">void</span>
<a name="l00608"></a><a class="code" href="group__DBusHashTable.html#ga0ef12d773a546f070cff91cbf1e8d16e">00608</a> <a class="code" href="group__DBusHashTable.html#ga0ef12d773a546f070cff91cbf1e8d16e" title="Removes the current entry from the hash table.">_dbus_hash_iter_remove_entry</a> (<a class="code" href="structDBusHashIter.html" title="Hash iterator object.">DBusHashIter</a> *iter)
<a name="l00609"></a>00609 {
<a name="l00610"></a>00610   <a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a> *real;
<a name="l00611"></a>00611 
<a name="l00612"></a>00612   real = (<a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a>*) iter;
<a name="l00613"></a>00613 
<a name="l00614"></a>00614   _dbus_assert (real-&gt;<a class="code" href="structDBusRealHashIter.html#a0307c2b8fa9384554ceb3cc965b04633" title="Pointer to table containing entry.">table</a> != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00615"></a>00615   _dbus_assert (real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a> != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00616"></a>00616   _dbus_assert (real-&gt;<a class="code" href="structDBusRealHashIter.html#ad36967dc68709d676ad591d7f75dd7fa" title="Pointer to bucket that points to first entry in this entry&#39;s chain: used for deleting the entry...">bucket</a> != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00617"></a>00617   
<a name="l00618"></a>00618   remove_entry (real-&gt;<a class="code" href="structDBusRealHashIter.html#a0307c2b8fa9384554ceb3cc965b04633" title="Pointer to table containing entry.">table</a>, real-&gt;<a class="code" href="structDBusRealHashIter.html#ad36967dc68709d676ad591d7f75dd7fa" title="Pointer to bucket that points to first entry in this entry&#39;s chain: used for deleting the entry...">bucket</a>, real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a>);
<a name="l00619"></a>00619 
<a name="l00620"></a>00620   real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a> = <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>; <span class="comment">/* make it crash if you try to use this entry */</span>
<a name="l00621"></a>00621 }
<a name="l00622"></a>00622 
<a name="l00628"></a>00628 <span class="keywordtype">void</span>*
<a name="l00629"></a><a class="code" href="group__DBusHashTable.html#ga34bf277ee37f919bd00516b5ae4e12b5">00629</a> <a class="code" href="group__DBusHashTable.html#ga34bf277ee37f919bd00516b5ae4e12b5" title="Gets the value of the current entry.">_dbus_hash_iter_get_value</a> (<a class="code" href="structDBusHashIter.html" title="Hash iterator object.">DBusHashIter</a> *iter)
<a name="l00630"></a>00630 {
<a name="l00631"></a>00631   <a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a> *real;
<a name="l00632"></a>00632 
<a name="l00633"></a>00633   real = (<a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a>*) iter;
<a name="l00634"></a>00634 
<a name="l00635"></a>00635   _dbus_assert (real-&gt;<a class="code" href="structDBusRealHashIter.html#a0307c2b8fa9384554ceb3cc965b04633" title="Pointer to table containing entry.">table</a> != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00636"></a>00636   _dbus_assert (real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a> != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00637"></a>00637 
<a name="l00638"></a>00638   <span class="keywordflow">return</span> real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a>-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a>;
<a name="l00639"></a>00639 }
<a name="l00640"></a>00640 
<a name="l00651"></a>00651 <span class="keywordtype">void</span>
<a name="l00652"></a><a class="code" href="group__DBusHashTable.html#ga24193343c0948019d4a302fc18bfd5d9">00652</a> <a class="code" href="group__DBusHashTable.html#ga24193343c0948019d4a302fc18bfd5d9" title="Sets the value of the current entry.">_dbus_hash_iter_set_value</a> (<a class="code" href="structDBusHashIter.html" title="Hash iterator object.">DBusHashIter</a> *iter,
<a name="l00653"></a>00653                            <span class="keywordtype">void</span>         *value)
<a name="l00654"></a>00654 {
<a name="l00655"></a>00655   <a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a> *real;
<a name="l00656"></a>00656 
<a name="l00657"></a>00657   real = (<a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a>*) iter;
<a name="l00658"></a>00658 
<a name="l00659"></a>00659   _dbus_assert (real-&gt;<a class="code" href="structDBusRealHashIter.html#a0307c2b8fa9384554ceb3cc965b04633" title="Pointer to table containing entry.">table</a> != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00660"></a>00660   _dbus_assert (real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a> != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00661"></a>00661 
<a name="l00662"></a>00662   <span class="keywordflow">if</span> (real-&gt;<a class="code" href="structDBusRealHashIter.html#a0307c2b8fa9384554ceb3cc965b04633" title="Pointer to table containing entry.">table</a>-&gt;<a class="code" href="structDBusHashTable.html#afbb42b5326b9c79352b168eace1687ca" title="Function to free values.">free_value_function</a> &amp;&amp; value != real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a>-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a>)    
<a name="l00663"></a>00663     (* real-&gt;<a class="code" href="structDBusRealHashIter.html#a0307c2b8fa9384554ceb3cc965b04633" title="Pointer to table containing entry.">table</a>-&gt;<a class="code" href="structDBusHashTable.html#afbb42b5326b9c79352b168eace1687ca" title="Function to free values.">free_value_function</a>) (real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a>-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a>);
<a name="l00664"></a>00664   
<a name="l00665"></a>00665   real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a>-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a> = value;
<a name="l00666"></a>00666 }
<a name="l00667"></a>00667 
<a name="l00674"></a>00674 <span class="keywordtype">int</span>
<a name="l00675"></a><a class="code" href="group__DBusHashTable.html#ga7a1b9fd35f9f7bdd86f9d71a6379053f">00675</a> <a class="code" href="group__DBusHashTable.html#ga7a1b9fd35f9f7bdd86f9d71a6379053f" title="Gets the key for the current entry.">_dbus_hash_iter_get_int_key</a> (<a class="code" href="structDBusHashIter.html" title="Hash iterator object.">DBusHashIter</a> *iter)
<a name="l00676"></a>00676 {
<a name="l00677"></a>00677   <a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a> *real;
<a name="l00678"></a>00678 
<a name="l00679"></a>00679   real = (<a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a>*) iter;
<a name="l00680"></a>00680 
<a name="l00681"></a>00681   _dbus_assert (real-&gt;<a class="code" href="structDBusRealHashIter.html#a0307c2b8fa9384554ceb3cc965b04633" title="Pointer to table containing entry.">table</a> != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00682"></a>00682   _dbus_assert (real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a> != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00683"></a>00683 
<a name="l00684"></a>00684   <span class="keywordflow">return</span> _DBUS_POINTER_TO_INT (real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a>-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a>);
<a name="l00685"></a>00685 }
<a name="l00686"></a>00686 
<a name="l00693"></a>00693 uintptr_t
<a name="l00694"></a><a class="code" href="group__DBusHashTable.html#gaab14d583840d0a1b5c829d76959dcbf0">00694</a> <a class="code" href="group__DBusHashTable.html#gaab14d583840d0a1b5c829d76959dcbf0" title="Gets the key for the current entry.">_dbus_hash_iter_get_uintptr_key</a> (<a class="code" href="structDBusHashIter.html" title="Hash iterator object.">DBusHashIter</a> *iter)
<a name="l00695"></a>00695 {
<a name="l00696"></a>00696   <a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a> *real;
<a name="l00697"></a>00697 
<a name="l00698"></a>00698   real = (<a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a>*) iter;
<a name="l00699"></a>00699 
<a name="l00700"></a>00700   _dbus_assert (real-&gt;<a class="code" href="structDBusRealHashIter.html#a0307c2b8fa9384554ceb3cc965b04633" title="Pointer to table containing entry.">table</a> != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00701"></a>00701   _dbus_assert (real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a> != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00702"></a>00702 
<a name="l00703"></a>00703   <span class="keywordflow">return</span> (uintptr_t) real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a>-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a>;
<a name="l00704"></a>00704 }
<a name="l00705"></a>00705 
<a name="l00711"></a>00711 <span class="keyword">const</span> <span class="keywordtype">char</span>*
<a name="l00712"></a><a class="code" href="group__DBusHashTable.html#gaa0cff082174b1ab0380902ce4ae43d08">00712</a> <a class="code" href="group__DBusHashTable.html#gaa0cff082174b1ab0380902ce4ae43d08" title="Gets the key for the current entry.">_dbus_hash_iter_get_string_key</a> (<a class="code" href="structDBusHashIter.html" title="Hash iterator object.">DBusHashIter</a> *iter)
<a name="l00713"></a>00713 {
<a name="l00714"></a>00714   <a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a> *real;
<a name="l00715"></a>00715 
<a name="l00716"></a>00716   real = (<a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a>*) iter;
<a name="l00717"></a>00717 
<a name="l00718"></a>00718   _dbus_assert (real-&gt;<a class="code" href="structDBusRealHashIter.html#a0307c2b8fa9384554ceb3cc965b04633" title="Pointer to table containing entry.">table</a> != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00719"></a>00719   _dbus_assert (real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a> != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00720"></a>00720 
<a name="l00721"></a>00721   <span class="keywordflow">return</span> real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a>-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a>;
<a name="l00722"></a>00722 }
<a name="l00723"></a>00723 
<a name="l00724"></a>00724 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l00725"></a>00725 <span class="preprocessor"></span>
<a name="l00730"></a>00730 <span class="keyword">const</span> <span class="keywordtype">char</span>*
<a name="l00731"></a>00731 _dbus_hash_iter_get_two_strings_key (<a class="code" href="structDBusHashIter.html" title="Hash iterator object.">DBusHashIter</a> *iter)
<a name="l00732"></a>00732 {
<a name="l00733"></a>00733   <a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a> *real;
<a name="l00734"></a>00734 
<a name="l00735"></a>00735   real = (<a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a>*) iter;
<a name="l00736"></a>00736 
<a name="l00737"></a>00737   _dbus_assert (real-&gt;<a class="code" href="structDBusRealHashIter.html#a0307c2b8fa9384554ceb3cc965b04633" title="Pointer to table containing entry.">table</a> != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00738"></a>00738   _dbus_assert (real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a> != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00739"></a>00739 
<a name="l00740"></a>00740   <span class="keywordflow">return</span> real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a>-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a>;
<a name="l00741"></a>00741 }
<a name="l00742"></a>00742 <span class="preprocessor">#endif </span><span class="comment">/* DBUS_BUILD_TESTS */</span>
<a name="l00743"></a>00743 
<a name="l00775"></a>00775 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l00776"></a><a class="code" href="group__DBusHashTable.html#gab156c35d6dd9ff6e408a835db28323fb">00776</a> <a class="code" href="group__DBusHashTable.html#gab156c35d6dd9ff6e408a835db28323fb" title="A low-level but efficient interface for manipulating the hash table.">_dbus_hash_iter_lookup</a> (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table,
<a name="l00777"></a>00777                         <span class="keywordtype">void</span>          *key,
<a name="l00778"></a>00778                         <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>    create_if_not_found,
<a name="l00779"></a>00779                         <a class="code" href="structDBusHashIter.html" title="Hash iterator object.">DBusHashIter</a>  *iter)
<a name="l00780"></a>00780 {
<a name="l00781"></a>00781   <a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a> *real;
<a name="l00782"></a>00782   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l00783"></a>00783   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> **bucket;
<a name="l00784"></a>00784   
<a name="l00785"></a>00785   _dbus_assert (<span class="keyword">sizeof</span> (<a class="code" href="structDBusHashIter.html" title="Hash iterator object.">DBusHashIter</a>) == <span class="keyword">sizeof</span> (<a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a>));
<a name="l00786"></a>00786   
<a name="l00787"></a>00787   real = (<a class="code" href="structDBusRealHashIter.html" title="Internals of DBusHashIter.">DBusRealHashIter</a>*) iter;
<a name="l00788"></a>00788 
<a name="l00789"></a>00789   entry = (* table-&gt;<a class="code" href="structDBusHashTable.html#ab98bafddf1b1ce1dad01c5595e278e35" title="Function for finding entries.">find_function</a>) (table, key, create_if_not_found, &amp;bucket, <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l00790"></a>00790 
<a name="l00791"></a>00791   <span class="keywordflow">if</span> (entry == <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>)
<a name="l00792"></a>00792     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l00793"></a>00793   
<a name="l00794"></a>00794   real-&gt;<a class="code" href="structDBusRealHashIter.html#a0307c2b8fa9384554ceb3cc965b04633" title="Pointer to table containing entry.">table</a> = table;
<a name="l00795"></a>00795   real-&gt;<a class="code" href="structDBusRealHashIter.html#ad36967dc68709d676ad591d7f75dd7fa" title="Pointer to bucket that points to first entry in this entry&#39;s chain: used for deleting the entry...">bucket</a> = bucket;
<a name="l00796"></a>00796   real-&gt;<a class="code" href="structDBusRealHashIter.html#a438db1cb3a9c6db716f8bf35fe3054c7" title="Current hash entry.">entry</a> = entry;
<a name="l00797"></a>00797   real-&gt;<a class="code" href="structDBusRealHashIter.html#a056417c3726f4f98eb94a9d2784a59e0" title="Next entry to be iterated onto in current bucket.">next_entry</a> = entry-&gt;<a class="code" href="structDBusHashEntry.html#ae986e25c0b24237f9848ff43aa1d8501" title="Pointer to next entry in this hash bucket, or NULL for end of chain.">next</a>;
<a name="l00798"></a>00798   real-&gt;<a class="code" href="structDBusRealHashIter.html#adbf758933299ee6305c525ea0fe74824" title="index of next bucket">next_bucket</a> = (bucket - table-&gt;<a class="code" href="structDBusHashTable.html#a1f974e2cb3038685b3edf493406ad99d" title="Pointer to bucket array.">buckets</a>) + 1;
<a name="l00799"></a>00799   real-&gt;<a class="code" href="structDBusRealHashIter.html#a84f2a189ee1eb3e51a8089b798a7797a" title="used to detect table resize since initialization">n_entries_on_init</a> = table-&gt;<a class="code" href="structDBusHashTable.html#affbf11a9c3dd72d55b7976891f7b4650" title="Total number of entries present in table.">n_entries</a>; 
<a name="l00800"></a>00800 
<a name="l00801"></a>00801   _dbus_assert (&amp;(table-&gt;<a class="code" href="structDBusHashTable.html#a1f974e2cb3038685b3edf493406ad99d" title="Pointer to bucket array.">buckets</a>[real-&gt;<a class="code" href="structDBusRealHashIter.html#adbf758933299ee6305c525ea0fe74824" title="index of next bucket">next_bucket</a>-1]) == real-&gt;<a class="code" href="structDBusRealHashIter.html#ad36967dc68709d676ad591d7f75dd7fa" title="Pointer to bucket that points to first entry in this entry&#39;s chain: used for deleting the entry...">bucket</a>);
<a name="l00802"></a>00802   
<a name="l00803"></a>00803   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l00804"></a>00804 }
<a name="l00805"></a>00805 
<a name="l00806"></a>00806 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00807"></a>00807 add_allocated_entry (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>   *table,
<a name="l00808"></a>00808                      <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>   *entry,
<a name="l00809"></a>00809                      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>     idx,
<a name="l00810"></a>00810                      <span class="keywordtype">void</span>            *key,
<a name="l00811"></a>00811                      <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> ***bucket)
<a name="l00812"></a>00812 {
<a name="l00813"></a>00813   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> **b;  
<a name="l00814"></a>00814   
<a name="l00815"></a>00815   entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a> = key;
<a name="l00816"></a>00816   
<a name="l00817"></a>00817   b = &amp;(table-&gt;<a class="code" href="structDBusHashTable.html#a1f974e2cb3038685b3edf493406ad99d" title="Pointer to bucket array.">buckets</a>[idx]);
<a name="l00818"></a>00818   entry-&gt;<a class="code" href="structDBusHashEntry.html#ae986e25c0b24237f9848ff43aa1d8501" title="Pointer to next entry in this hash bucket, or NULL for end of chain.">next</a> = *b;
<a name="l00819"></a>00819   *b = entry;
<a name="l00820"></a>00820 
<a name="l00821"></a>00821   <span class="keywordflow">if</span> (bucket)
<a name="l00822"></a>00822     *bucket = b;
<a name="l00823"></a>00823   
<a name="l00824"></a>00824   table-&gt;<a class="code" href="structDBusHashTable.html#affbf11a9c3dd72d55b7976891f7b4650" title="Total number of entries present in table.">n_entries</a> += 1;
<a name="l00825"></a>00825 
<a name="l00826"></a>00826   <span class="comment">/* note we ONLY rebuild when ADDING - because you can iterate over a</span>
<a name="l00827"></a>00827 <span class="comment">   * table and remove entries safely.</span>
<a name="l00828"></a>00828 <span class="comment">   */</span>
<a name="l00829"></a>00829   <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structDBusHashTable.html#affbf11a9c3dd72d55b7976891f7b4650" title="Total number of entries present in table.">n_entries</a> &gt;= table-&gt;<a class="code" href="structDBusHashTable.html#a29c408110c0d189d89b60c6c01cfb0cf" title="Enlarge table when n_entries gets to be this large.">hi_rebuild_size</a> ||
<a name="l00830"></a>00830       table-&gt;<a class="code" href="structDBusHashTable.html#affbf11a9c3dd72d55b7976891f7b4650" title="Total number of entries present in table.">n_entries</a> &lt; table-&gt;<a class="code" href="structDBusHashTable.html#aae6ea7cb15d618866854b2b6bd468419" title="Shrink table when n_entries gets below this.">lo_rebuild_size</a>)
<a name="l00831"></a>00831     rebuild_table (table);
<a name="l00832"></a>00832 }
<a name="l00833"></a>00833 
<a name="l00834"></a>00834 <span class="keyword">static</span> <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>*
<a name="l00835"></a>00835 add_entry (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>        *table, 
<a name="l00836"></a>00836            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>          idx,
<a name="l00837"></a>00837            <span class="keywordtype">void</span>                 *key,
<a name="l00838"></a>00838            <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>      ***bucket,
<a name="l00839"></a>00839            <a class="code" href="group__DBusHashTable.html#ga175dc6ab841ed32bb6acf6e4c0df36a8" title="A preallocated hash entry.">DBusPreallocatedHash</a> *preallocated)
<a name="l00840"></a>00840 {
<a name="l00841"></a>00841   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>  *entry;
<a name="l00842"></a>00842 
<a name="l00843"></a>00843   <span class="keywordflow">if</span> (preallocated == <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>)
<a name="l00844"></a>00844     {
<a name="l00845"></a>00845       entry = alloc_entry (table);
<a name="l00846"></a>00846       <span class="keywordflow">if</span> (entry == <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>)
<a name="l00847"></a>00847         {
<a name="l00848"></a>00848           <span class="keywordflow">if</span> (bucket)
<a name="l00849"></a>00849             *bucket = <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>;
<a name="l00850"></a>00850           <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>;
<a name="l00851"></a>00851         }
<a name="l00852"></a>00852     }
<a name="l00853"></a>00853   <span class="keywordflow">else</span>
<a name="l00854"></a>00854     {
<a name="l00855"></a>00855       entry = (<a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>*) preallocated;
<a name="l00856"></a>00856     }
<a name="l00857"></a>00857 
<a name="l00858"></a>00858   add_allocated_entry (table, entry, idx, key, bucket);
<a name="l00859"></a>00859 
<a name="l00860"></a>00860   <span class="keywordflow">return</span> entry;
<a name="l00861"></a>00861 }
<a name="l00862"></a>00862 
<a name="l00863"></a>00863 <span class="comment">/* This is g_str_hash from GLib which was</span>
<a name="l00864"></a>00864 <span class="comment"> * extensively discussed/tested/profiled</span>
<a name="l00865"></a>00865 <span class="comment"> */</span>
<a name="l00866"></a>00866 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l00867"></a>00867 string_hash (<span class="keyword">const</span> <span class="keywordtype">char</span> *str)
<a name="l00868"></a>00868 {
<a name="l00869"></a>00869   <span class="keyword">const</span> <span class="keywordtype">char</span> *p = str;
<a name="l00870"></a>00870   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> h = *p;
<a name="l00871"></a>00871 
<a name="l00872"></a>00872   <span class="keywordflow">if</span> (h)
<a name="l00873"></a>00873     <span class="keywordflow">for</span> (p += 1; *p != <span class="charliteral">&#39;\0&#39;</span>; p++)
<a name="l00874"></a>00874       h = (h &lt;&lt; 5) - h + *p;
<a name="l00875"></a>00875 
<a name="l00876"></a>00876   <span class="keywordflow">return</span> h;
<a name="l00877"></a>00877 }
<a name="l00878"></a>00878 
<a name="l00879"></a>00879 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l00880"></a>00880 <span class="preprocessor"></span><span class="comment">/* This hashes a memory block with two nul-terminated strings</span>
<a name="l00881"></a>00881 <span class="comment"> * in it, used in dbus-object-registry.c at the moment.</span>
<a name="l00882"></a>00882 <span class="comment"> */</span>
<a name="l00883"></a>00883 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l00884"></a>00884 two_strings_hash (<span class="keyword">const</span> <span class="keywordtype">char</span> *str)
<a name="l00885"></a>00885 {
<a name="l00886"></a>00886   <span class="keyword">const</span> <span class="keywordtype">char</span> *p = str;
<a name="l00887"></a>00887   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> h = *p;
<a name="l00888"></a>00888 
<a name="l00889"></a>00889   <span class="keywordflow">if</span> (h)
<a name="l00890"></a>00890     <span class="keywordflow">for</span> (p += 1; *p != <span class="charliteral">&#39;\0&#39;</span>; p++)
<a name="l00891"></a>00891       h = (h &lt;&lt; 5) - h + *p;
<a name="l00892"></a>00892 
<a name="l00893"></a>00893   <span class="keywordflow">for</span> (p += 1; *p != <span class="charliteral">&#39;\0&#39;</span>; p++)
<a name="l00894"></a>00894     h = (h &lt;&lt; 5) - h + *p;
<a name="l00895"></a>00895   
<a name="l00896"></a>00896   <span class="keywordflow">return</span> h;
<a name="l00897"></a>00897 }
<a name="l00898"></a>00898 <span class="preprocessor">#endif </span><span class="comment">/* DBUS_BUILD_TESTS */</span>
<a name="l00899"></a>00899 
<a name="l00901"></a><a class="code" href="group__DBusHashTable.html#gaa76f90a33882453d9eadcb270c96df92">00901</a> <span class="keyword">typedef</span> int (* <a class="code" href="group__DBusHashTable.html#gaa76f90a33882453d9eadcb270c96df92" title="Key comparison function.">KeyCompareFunc</a>) (<span class="keyword">const</span> <span class="keywordtype">void</span> *key_a, <span class="keyword">const</span> <span class="keywordtype">void</span> *key_b);
<a name="l00902"></a>00902 
<a name="l00903"></a>00903 <span class="keyword">static</span> <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>*
<a name="l00904"></a>00904 find_generic_function (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>        *table,
<a name="l00905"></a>00905                        <span class="keywordtype">void</span>                 *key,
<a name="l00906"></a>00906                        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>          idx,
<a name="l00907"></a>00907                        <a class="code" href="group__DBusHashTable.html#gaa76f90a33882453d9eadcb270c96df92" title="Key comparison function.">KeyCompareFunc</a>        compare_func,
<a name="l00908"></a>00908                        <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>           create_if_not_found,
<a name="l00909"></a>00909                        <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>      ***bucket,
<a name="l00910"></a>00910                        <a class="code" href="group__DBusHashTable.html#ga175dc6ab841ed32bb6acf6e4c0df36a8" title="A preallocated hash entry.">DBusPreallocatedHash</a> *preallocated)
<a name="l00911"></a>00911 {
<a name="l00912"></a>00912   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l00913"></a>00913 
<a name="l00914"></a>00914   <span class="keywordflow">if</span> (bucket)
<a name="l00915"></a>00915     *bucket = <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>;
<a name="l00916"></a>00916 
<a name="l00917"></a>00917   <span class="comment">/* Search all of the entries in this bucket. */</span>
<a name="l00918"></a>00918   entry = table-&gt;<a class="code" href="structDBusHashTable.html#a1f974e2cb3038685b3edf493406ad99d" title="Pointer to bucket array.">buckets</a>[idx];
<a name="l00919"></a>00919   <span class="keywordflow">while</span> (entry != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>)
<a name="l00920"></a>00920     {
<a name="l00921"></a>00921       <span class="keywordflow">if</span> ((compare_func == <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a> &amp;&amp; key == entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a>) ||
<a name="l00922"></a>00922           (compare_func != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a> &amp;&amp; (* compare_func) (key, entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a>) == 0))
<a name="l00923"></a>00923         {
<a name="l00924"></a>00924           <span class="keywordflow">if</span> (bucket)
<a name="l00925"></a>00925             *bucket = &amp;(table-&gt;<a class="code" href="structDBusHashTable.html#a1f974e2cb3038685b3edf493406ad99d" title="Pointer to bucket array.">buckets</a>[idx]);
<a name="l00926"></a>00926 
<a name="l00927"></a>00927           <span class="keywordflow">if</span> (preallocated)
<a name="l00928"></a>00928             <a class="code" href="group__DBusHashTable.html#ga159dfec03d53e6e2ff485fc83aed2552" title="Frees an opaque DBusPreallocatedHash that was *not* used in order to insert into the hash table...">_dbus_hash_table_free_preallocated_entry</a> (table, preallocated);
<a name="l00929"></a>00929           
<a name="l00930"></a>00930           <span class="keywordflow">return</span> entry;
<a name="l00931"></a>00931         }
<a name="l00932"></a>00932       
<a name="l00933"></a>00933       entry = entry-&gt;<a class="code" href="structDBusHashEntry.html#ae986e25c0b24237f9848ff43aa1d8501" title="Pointer to next entry in this hash bucket, or NULL for end of chain.">next</a>;
<a name="l00934"></a>00934     }
<a name="l00935"></a>00935 
<a name="l00936"></a>00936   <span class="keywordflow">if</span> (create_if_not_found)
<a name="l00937"></a>00937     entry = add_entry (table, idx, key, bucket, preallocated);
<a name="l00938"></a>00938   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (preallocated)
<a name="l00939"></a>00939     <a class="code" href="group__DBusHashTable.html#ga159dfec03d53e6e2ff485fc83aed2552" title="Frees an opaque DBusPreallocatedHash that was *not* used in order to insert into the hash table...">_dbus_hash_table_free_preallocated_entry</a> (table, preallocated);
<a name="l00940"></a>00940   
<a name="l00941"></a>00941   <span class="keywordflow">return</span> entry;
<a name="l00942"></a>00942 }
<a name="l00943"></a>00943 
<a name="l00944"></a>00944 <span class="keyword">static</span> <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>*
<a name="l00945"></a>00945 find_string_function (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>        *table,
<a name="l00946"></a>00946                       <span class="keywordtype">void</span>                 *key,
<a name="l00947"></a>00947                       <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>           create_if_not_found,
<a name="l00948"></a>00948                       <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>      ***bucket,
<a name="l00949"></a>00949                       <a class="code" href="group__DBusHashTable.html#ga175dc6ab841ed32bb6acf6e4c0df36a8" title="A preallocated hash entry.">DBusPreallocatedHash</a> *preallocated)
<a name="l00950"></a>00950 {
<a name="l00951"></a>00951   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx;
<a name="l00952"></a>00952   
<a name="l00953"></a>00953   idx = string_hash (key) &amp; table-&gt;<a class="code" href="structDBusHashTable.html#aec1230eebce3d256ca9ceebe372647e9" title="Mask value used in hashing function.">mask</a>;
<a name="l00954"></a>00954 
<a name="l00955"></a>00955   <span class="keywordflow">return</span> find_generic_function (table, key, idx,
<a name="l00956"></a>00956                                 (<a class="code" href="group__DBusHashTable.html#gaa76f90a33882453d9eadcb270c96df92" title="Key comparison function.">KeyCompareFunc</a>) strcmp, create_if_not_found, bucket,
<a name="l00957"></a>00957                                 preallocated);
<a name="l00958"></a>00958 }
<a name="l00959"></a>00959 
<a name="l00960"></a>00960 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l00961"></a>00961 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00962"></a>00962 two_strings_cmp (<span class="keyword">const</span> <span class="keywordtype">char</span> *a,
<a name="l00963"></a>00963                  <span class="keyword">const</span> <span class="keywordtype">char</span> *b)
<a name="l00964"></a>00964 {
<a name="l00965"></a>00965   <span class="keywordtype">size_t</span> len_a;
<a name="l00966"></a>00966   <span class="keywordtype">size_t</span> len_b;
<a name="l00967"></a>00967   <span class="keywordtype">int</span> res;
<a name="l00968"></a>00968   
<a name="l00969"></a>00969   res = strcmp (a, b);
<a name="l00970"></a>00970   <span class="keywordflow">if</span> (res != 0)
<a name="l00971"></a>00971     <span class="keywordflow">return</span> res;
<a name="l00972"></a>00972 
<a name="l00973"></a>00973   len_a = strlen (a);
<a name="l00974"></a>00974   len_b = strlen (b);
<a name="l00975"></a>00975 
<a name="l00976"></a>00976   <span class="keywordflow">return</span> strcmp (a + len_a + 1, b + len_b + 1);
<a name="l00977"></a>00977 }
<a name="l00978"></a>00978 <span class="preprocessor">#endif</span>
<a name="l00979"></a>00979 <span class="preprocessor"></span>
<a name="l00980"></a>00980 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l00981"></a>00981 <span class="preprocessor"></span><span class="keyword">static</span> <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>*
<a name="l00982"></a>00982 find_two_strings_function (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>        *table,
<a name="l00983"></a>00983                            <span class="keywordtype">void</span>                 *key,
<a name="l00984"></a>00984                            <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>           create_if_not_found,
<a name="l00985"></a>00985                            <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>      ***bucket,
<a name="l00986"></a>00986                            <a class="code" href="group__DBusHashTable.html#ga175dc6ab841ed32bb6acf6e4c0df36a8" title="A preallocated hash entry.">DBusPreallocatedHash</a> *preallocated)
<a name="l00987"></a>00987 {
<a name="l00988"></a>00988   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx;
<a name="l00989"></a>00989   
<a name="l00990"></a>00990   idx = two_strings_hash (key) &amp; table-&gt;<a class="code" href="structDBusHashTable.html#aec1230eebce3d256ca9ceebe372647e9" title="Mask value used in hashing function.">mask</a>;
<a name="l00991"></a>00991 
<a name="l00992"></a>00992   <span class="keywordflow">return</span> find_generic_function (table, key, idx,
<a name="l00993"></a>00993                                 (<a class="code" href="group__DBusHashTable.html#gaa76f90a33882453d9eadcb270c96df92" title="Key comparison function.">KeyCompareFunc</a>) two_strings_cmp, create_if_not_found, bucket,
<a name="l00994"></a>00994                                 preallocated);
<a name="l00995"></a>00995 }
<a name="l00996"></a>00996 <span class="preprocessor">#endif </span><span class="comment">/* DBUS_BUILD_TESTS */</span>
<a name="l00997"></a>00997 
<a name="l00998"></a>00998 <span class="keyword">static</span> <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>*
<a name="l00999"></a>00999 find_direct_function (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>        *table,
<a name="l01000"></a>01000                       <span class="keywordtype">void</span>                 *key,
<a name="l01001"></a>01001                       <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>           create_if_not_found,
<a name="l01002"></a>01002                       <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>      ***bucket,
<a name="l01003"></a>01003                       <a class="code" href="group__DBusHashTable.html#ga175dc6ab841ed32bb6acf6e4c0df36a8" title="A preallocated hash entry.">DBusPreallocatedHash</a> *preallocated)
<a name="l01004"></a>01004 {
<a name="l01005"></a>01005   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx;
<a name="l01006"></a>01006   
<a name="l01007"></a>01007   idx = <a class="code" href="group__DBusHashTableInternals.html#ga9dc8fd5a9e25bd2b229366a683ff78f9" title="Takes a preliminary integer hash value and produces an index into a hash tables bucket list...">RANDOM_INDEX</a> (table, key) &amp; table-&gt;<a class="code" href="structDBusHashTable.html#aec1230eebce3d256ca9ceebe372647e9" title="Mask value used in hashing function.">mask</a>;
<a name="l01008"></a>01008 
<a name="l01009"></a>01009 
<a name="l01010"></a>01010   <span class="keywordflow">return</span> find_generic_function (table, key, idx,
<a name="l01011"></a>01011                                 <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>, create_if_not_found, bucket,
<a name="l01012"></a>01012                                 preallocated);
<a name="l01013"></a>01013 }
<a name="l01014"></a>01014 
<a name="l01015"></a>01015 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01016"></a>01016 rebuild_table (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table)
<a name="l01017"></a>01017 {
<a name="l01018"></a>01018   <span class="keywordtype">int</span> old_size;
<a name="l01019"></a>01019   <span class="keywordtype">int</span> new_buckets;
<a name="l01020"></a>01020   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> **old_buckets;
<a name="l01021"></a>01021   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> **old_chain;
<a name="l01022"></a>01022   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l01023"></a>01023   <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a> growing;
<a name="l01024"></a>01024   
<a name="l01025"></a>01025   <span class="comment">/*</span>
<a name="l01026"></a>01026 <span class="comment">   * Allocate and initialize the new bucket array, and set up</span>
<a name="l01027"></a>01027 <span class="comment">   * hashing constants for new array size.</span>
<a name="l01028"></a>01028 <span class="comment">   */</span>
<a name="l01029"></a>01029 
<a name="l01030"></a>01030   growing = table-&gt;<a class="code" href="structDBusHashTable.html#affbf11a9c3dd72d55b7976891f7b4650" title="Total number of entries present in table.">n_entries</a> &gt;= table-&gt;<a class="code" href="structDBusHashTable.html#a29c408110c0d189d89b60c6c01cfb0cf" title="Enlarge table when n_entries gets to be this large.">hi_rebuild_size</a>;
<a name="l01031"></a>01031   
<a name="l01032"></a>01032   old_size = table-&gt;<a class="code" href="structDBusHashTable.html#a2dd2b9389d65d30e31e596dd786a9aa7" title="Total number of buckets allocated at **buckets.">n_buckets</a>;
<a name="l01033"></a>01033   old_buckets = table-&gt;<a class="code" href="structDBusHashTable.html#a1f974e2cb3038685b3edf493406ad99d" title="Pointer to bucket array.">buckets</a>;
<a name="l01034"></a>01034 
<a name="l01035"></a>01035   <span class="keywordflow">if</span> (growing)
<a name="l01036"></a>01036     {
<a name="l01037"></a>01037       <span class="comment">/* overflow paranoia */</span>
<a name="l01038"></a>01038       <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structDBusHashTable.html#a2dd2b9389d65d30e31e596dd786a9aa7" title="Total number of buckets allocated at **buckets.">n_buckets</a> &lt; _DBUS_INT_MAX / 4 &amp;&amp;
<a name="l01039"></a>01039           table-&gt;<a class="code" href="structDBusHashTable.html#a2e7e7b92bb9633ab95cfaa592b89025c" title="Shift count used in hashing function.">down_shift</a> &gt;= 0)
<a name="l01040"></a>01040         new_buckets = table-&gt;<a class="code" href="structDBusHashTable.html#a2dd2b9389d65d30e31e596dd786a9aa7" title="Total number of buckets allocated at **buckets.">n_buckets</a> * 4;
<a name="l01041"></a>01041       <span class="keywordflow">else</span>
<a name="l01042"></a>01042         <span class="keywordflow">return</span>; <span class="comment">/* can&#39;t grow anymore */</span>
<a name="l01043"></a>01043     }
<a name="l01044"></a>01044   <span class="keywordflow">else</span>
<a name="l01045"></a>01045     {
<a name="l01046"></a>01046       new_buckets = table-&gt;<a class="code" href="structDBusHashTable.html#a2dd2b9389d65d30e31e596dd786a9aa7" title="Total number of buckets allocated at **buckets.">n_buckets</a> / 4;
<a name="l01047"></a>01047       <span class="keywordflow">if</span> (new_buckets &lt; <a class="code" href="group__DBusHashTableInternals.html#ga4518324f3c3caacf5694065f4f6071d8" title="Initial number of buckets in hash table (hash table statically allocates its buckets for this size an...">DBUS_SMALL_HASH_TABLE</a>)
<a name="l01048"></a>01048         <span class="keywordflow">return</span>; <span class="comment">/* don&#39;t bother shrinking this far */</span>
<a name="l01049"></a>01049     }
<a name="l01050"></a>01050 
<a name="l01051"></a>01051   table-&gt;<a class="code" href="structDBusHashTable.html#a1f974e2cb3038685b3edf493406ad99d" title="Pointer to bucket array.">buckets</a> = <a class="code" href="group__DBusMemory.html#gaba9d823abda7f4cadbaf5177d3b8b793" title="Safe macro for using dbus_malloc0().">dbus_new0</a> (<a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>*, new_buckets);
<a name="l01052"></a>01052   <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structDBusHashTable.html#a1f974e2cb3038685b3edf493406ad99d" title="Pointer to bucket array.">buckets</a> == <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>)
<a name="l01053"></a>01053     {
<a name="l01054"></a>01054       <span class="comment">/* out of memory, yay - just don&#39;t reallocate, the table will</span>
<a name="l01055"></a>01055 <span class="comment">       * still work, albeit more slowly.</span>
<a name="l01056"></a>01056 <span class="comment">       */</span>
<a name="l01057"></a>01057       table-&gt;<a class="code" href="structDBusHashTable.html#a1f974e2cb3038685b3edf493406ad99d" title="Pointer to bucket array.">buckets</a> = old_buckets;
<a name="l01058"></a>01058       <span class="keywordflow">return</span>;
<a name="l01059"></a>01059     }
<a name="l01060"></a>01060 
<a name="l01061"></a>01061   table-&gt;<a class="code" href="structDBusHashTable.html#a2dd2b9389d65d30e31e596dd786a9aa7" title="Total number of buckets allocated at **buckets.">n_buckets</a> = new_buckets;
<a name="l01062"></a>01062   
<a name="l01063"></a>01063   <span class="keywordflow">if</span> (growing)
<a name="l01064"></a>01064     {
<a name="l01065"></a>01065       table-&gt;<a class="code" href="structDBusHashTable.html#aae6ea7cb15d618866854b2b6bd468419" title="Shrink table when n_entries gets below this.">lo_rebuild_size</a> = table-&gt;<a class="code" href="structDBusHashTable.html#a29c408110c0d189d89b60c6c01cfb0cf" title="Enlarge table when n_entries gets to be this large.">hi_rebuild_size</a>;
<a name="l01066"></a>01066       table-&gt;<a class="code" href="structDBusHashTable.html#a29c408110c0d189d89b60c6c01cfb0cf" title="Enlarge table when n_entries gets to be this large.">hi_rebuild_size</a> *= 4;
<a name="l01067"></a>01067       
<a name="l01068"></a>01068       table-&gt;<a class="code" href="structDBusHashTable.html#a2e7e7b92bb9633ab95cfaa592b89025c" title="Shift count used in hashing function.">down_shift</a> -= 2;               <span class="comment">/* keep 2 more high bits */</span>
<a name="l01069"></a>01069       table-&gt;<a class="code" href="structDBusHashTable.html#aec1230eebce3d256ca9ceebe372647e9" title="Mask value used in hashing function.">mask</a> = (table-&gt;<a class="code" href="structDBusHashTable.html#aec1230eebce3d256ca9ceebe372647e9" title="Mask value used in hashing function.">mask</a> &lt;&lt; 2) + 3; <span class="comment">/* keep 2 more high bits */</span>
<a name="l01070"></a>01070     }
<a name="l01071"></a>01071   <span class="keywordflow">else</span>
<a name="l01072"></a>01072     {
<a name="l01073"></a>01073       table-&gt;<a class="code" href="structDBusHashTable.html#a29c408110c0d189d89b60c6c01cfb0cf" title="Enlarge table when n_entries gets to be this large.">hi_rebuild_size</a> = table-&gt;<a class="code" href="structDBusHashTable.html#aae6ea7cb15d618866854b2b6bd468419" title="Shrink table when n_entries gets below this.">lo_rebuild_size</a>;
<a name="l01074"></a>01074       table-&gt;<a class="code" href="structDBusHashTable.html#aae6ea7cb15d618866854b2b6bd468419" title="Shrink table when n_entries gets below this.">lo_rebuild_size</a> /= 4;
<a name="l01075"></a>01075 
<a name="l01076"></a>01076       table-&gt;<a class="code" href="structDBusHashTable.html#a2e7e7b92bb9633ab95cfaa592b89025c" title="Shift count used in hashing function.">down_shift</a> += 2;         <span class="comment">/* keep 2 fewer high bits */</span>
<a name="l01077"></a>01077       table-&gt;<a class="code" href="structDBusHashTable.html#aec1230eebce3d256ca9ceebe372647e9" title="Mask value used in hashing function.">mask</a> = table-&gt;<a class="code" href="structDBusHashTable.html#aec1230eebce3d256ca9ceebe372647e9" title="Mask value used in hashing function.">mask</a> &gt;&gt; 2; <span class="comment">/* keep 2 fewer high bits */</span>
<a name="l01078"></a>01078     }
<a name="l01079"></a>01079 
<a name="l01080"></a>01080 <span class="preprocessor">#if 0</span>
<a name="l01081"></a>01081 <span class="preprocessor"></span>  printf (<span class="stringliteral">&quot;%s table to lo = %d hi = %d downshift = %d mask = 0x%x\n&quot;</span>,
<a name="l01082"></a>01082           growing ? <span class="stringliteral">&quot;GROW&quot;</span> : <span class="stringliteral">&quot;SHRINK&quot;</span>,
<a name="l01083"></a>01083           table-&gt;<a class="code" href="structDBusHashTable.html#aae6ea7cb15d618866854b2b6bd468419" title="Shrink table when n_entries gets below this.">lo_rebuild_size</a>,
<a name="l01084"></a>01084           table-&gt;<a class="code" href="structDBusHashTable.html#a29c408110c0d189d89b60c6c01cfb0cf" title="Enlarge table when n_entries gets to be this large.">hi_rebuild_size</a>,
<a name="l01085"></a>01085           table-&gt;<a class="code" href="structDBusHashTable.html#a2e7e7b92bb9633ab95cfaa592b89025c" title="Shift count used in hashing function.">down_shift</a>,
<a name="l01086"></a>01086           table-&gt;<a class="code" href="structDBusHashTable.html#aec1230eebce3d256ca9ceebe372647e9" title="Mask value used in hashing function.">mask</a>);
<a name="l01087"></a>01087 <span class="preprocessor">#endif</span>
<a name="l01088"></a>01088 <span class="preprocessor"></span>  
<a name="l01089"></a>01089   _dbus_assert (table-&gt;<a class="code" href="structDBusHashTable.html#aae6ea7cb15d618866854b2b6bd468419" title="Shrink table when n_entries gets below this.">lo_rebuild_size</a> &gt;= 0);
<a name="l01090"></a>01090   _dbus_assert (table-&gt;<a class="code" href="structDBusHashTable.html#a29c408110c0d189d89b60c6c01cfb0cf" title="Enlarge table when n_entries gets to be this large.">hi_rebuild_size</a> &gt; table-&gt;<a class="code" href="structDBusHashTable.html#aae6ea7cb15d618866854b2b6bd468419" title="Shrink table when n_entries gets below this.">lo_rebuild_size</a>);
<a name="l01091"></a>01091   _dbus_assert (table-&gt;<a class="code" href="structDBusHashTable.html#aec1230eebce3d256ca9ceebe372647e9" title="Mask value used in hashing function.">mask</a> != 0);
<a name="l01092"></a>01092   <span class="comment">/* the mask is essentially the max index */</span>
<a name="l01093"></a>01093   _dbus_assert (table-&gt;<a class="code" href="structDBusHashTable.html#aec1230eebce3d256ca9ceebe372647e9" title="Mask value used in hashing function.">mask</a> &lt; table-&gt;<a class="code" href="structDBusHashTable.html#a2dd2b9389d65d30e31e596dd786a9aa7" title="Total number of buckets allocated at **buckets.">n_buckets</a>);
<a name="l01094"></a>01094   
<a name="l01095"></a>01095   <span class="comment">/*</span>
<a name="l01096"></a>01096 <span class="comment">   * Rehash all of the existing entries into the new bucket array.</span>
<a name="l01097"></a>01097 <span class="comment">   */</span>
<a name="l01098"></a>01098 
<a name="l01099"></a>01099   <span class="keywordflow">for</span> (old_chain = old_buckets; old_size &gt; 0; old_size--, old_chain++)
<a name="l01100"></a>01100     {
<a name="l01101"></a>01101       <span class="keywordflow">for</span> (entry = *old_chain; entry != <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>; entry = *old_chain)
<a name="l01102"></a>01102         {
<a name="l01103"></a>01103           <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx;
<a name="l01104"></a>01104           <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> **bucket;
<a name="l01105"></a>01105           
<a name="l01106"></a>01106           *old_chain = entry-&gt;<a class="code" href="structDBusHashEntry.html#ae986e25c0b24237f9848ff43aa1d8501" title="Pointer to next entry in this hash bucket, or NULL for end of chain.">next</a>;
<a name="l01107"></a>01107           <span class="keywordflow">switch</span> (table-&gt;<a class="code" href="structDBusHashTable.html#a28f326a2947b6be0b0b852db376a1092" title="Type of keys used in this table.">key_type</a>)
<a name="l01108"></a>01108             {
<a name="l01109"></a>01109             <span class="keywordflow">case</span> <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a481fd0166d28da725b3e97f15192434e" title="Hash keys are strings.">DBUS_HASH_STRING</a>:
<a name="l01110"></a>01110               idx = string_hash (entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a>) &amp; table-&gt;<a class="code" href="structDBusHashTable.html#aec1230eebce3d256ca9ceebe372647e9" title="Mask value used in hashing function.">mask</a>;
<a name="l01111"></a>01111               <span class="keywordflow">break</span>;
<a name="l01112"></a>01112             <span class="keywordflow">case</span> <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852ac750b865c7994a3dd6d1028b7ae76877" title="Hash key is two strings in one memory block, i.e.">DBUS_HASH_TWO_STRINGS</a>:
<a name="l01113"></a>01113 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l01114"></a>01114 <span class="preprocessor"></span>              idx = two_strings_hash (entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a>) &amp; table-&gt;<a class="code" href="structDBusHashTable.html#aec1230eebce3d256ca9ceebe372647e9" title="Mask value used in hashing function.">mask</a>;
<a name="l01115"></a>01115 <span class="preprocessor">#else</span>
<a name="l01116"></a>01116 <span class="preprocessor"></span>              idx = 0;
<a name="l01117"></a>01117               _dbus_assert_not_reached (<span class="stringliteral">&quot;two-strings is not enabled&quot;</span>);
<a name="l01118"></a>01118 <span class="preprocessor">#endif</span>
<a name="l01119"></a>01119 <span class="preprocessor"></span>              <span class="keywordflow">break</span>;
<a name="l01120"></a>01120             <span class="keywordflow">case</span> <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a26446bd9fbb15c6c381b35a810207141" title="Hash keys are integers.">DBUS_HASH_INT</a>:
<a name="l01121"></a>01121             <span class="keywordflow">case</span> <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a477caf35cc3676d6412c9b57f1d0f6c7" title="Hash keys are integer capable to hold a pointer.">DBUS_HASH_UINTPTR</a>:
<a name="l01122"></a>01122             <span class="keywordflow">case</span> <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a38604db762cd0ed315106a95a6b50c4d" title="Hash keys are pointers.">DBUS_HASH_POINTER</a>:
<a name="l01123"></a>01123               idx = <a class="code" href="group__DBusHashTableInternals.html#ga9dc8fd5a9e25bd2b229366a683ff78f9" title="Takes a preliminary integer hash value and produces an index into a hash tables bucket list...">RANDOM_INDEX</a> (table, entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a>);
<a name="l01124"></a>01124               <span class="keywordflow">break</span>;
<a name="l01125"></a>01125             <span class="keywordflow">default</span>:
<a name="l01126"></a>01126               idx = 0;
<a name="l01127"></a>01127               _dbus_assert_not_reached (<span class="stringliteral">&quot;Unknown hash table type&quot;</span>);
<a name="l01128"></a>01128               <span class="keywordflow">break</span>;
<a name="l01129"></a>01129             }
<a name="l01130"></a>01130           
<a name="l01131"></a>01131           bucket = &amp;(table-&gt;<a class="code" href="structDBusHashTable.html#a1f974e2cb3038685b3edf493406ad99d" title="Pointer to bucket array.">buckets</a>[idx]);
<a name="l01132"></a>01132           entry-&gt;<a class="code" href="structDBusHashEntry.html#ae986e25c0b24237f9848ff43aa1d8501" title="Pointer to next entry in this hash bucket, or NULL for end of chain.">next</a> = *bucket;
<a name="l01133"></a>01133           *bucket = entry;
<a name="l01134"></a>01134         }
<a name="l01135"></a>01135     }
<a name="l01136"></a>01136   
<a name="l01137"></a>01137   <span class="comment">/* Free the old bucket array, if it was dynamically allocated. */</span>
<a name="l01138"></a>01138 
<a name="l01139"></a>01139   <span class="keywordflow">if</span> (old_buckets != table-&gt;<a class="code" href="structDBusHashTable.html#af71877d64657c34a783caf6b82b016e9" title="Bucket array used for small tables (to avoid mallocs and frees).">static_buckets</a>)
<a name="l01140"></a>01140     <a class="code" href="group__DBusMemory.html#ga34e666b19b015035a9a31e53da84b39a" title="Frees a block of memory previously allocated by dbus_malloc() or dbus_malloc0().">dbus_free</a> (old_buckets);
<a name="l01141"></a>01141 }
<a name="l01142"></a>01142 
<a name="l01152"></a>01152 <span class="keywordtype">void</span>*
<a name="l01153"></a><a class="code" href="group__DBusHashTable.html#gad51eb3fe682721dd4f6a920ca87cb730">01153</a> <a class="code" href="group__DBusHashTable.html#gad51eb3fe682721dd4f6a920ca87cb730" title="Looks up the value for a given string in a hash table of type DBUS_HASH_STRING.">_dbus_hash_table_lookup_string</a> (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table,
<a name="l01154"></a>01154                                 <span class="keyword">const</span> <span class="keywordtype">char</span>    *key)
<a name="l01155"></a>01155 {
<a name="l01156"></a>01156   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l01157"></a>01157 
<a name="l01158"></a>01158   _dbus_assert (table-&gt;<a class="code" href="structDBusHashTable.html#a28f326a2947b6be0b0b852db376a1092" title="Type of keys used in this table.">key_type</a> == <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a481fd0166d28da725b3e97f15192434e" title="Hash keys are strings.">DBUS_HASH_STRING</a>);
<a name="l01159"></a>01159   
<a name="l01160"></a>01160   entry = (* table-&gt;<a class="code" href="structDBusHashTable.html#ab98bafddf1b1ce1dad01c5595e278e35" title="Function for finding entries.">find_function</a>) (table, (<span class="keywordtype">char</span>*) key, <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>, <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>, <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l01161"></a>01161 
<a name="l01162"></a>01162   <span class="keywordflow">if</span> (entry)
<a name="l01163"></a>01163     <span class="keywordflow">return</span> entry-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a>;
<a name="l01164"></a>01164   <span class="keywordflow">else</span>
<a name="l01165"></a>01165     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>;
<a name="l01166"></a>01166 }
<a name="l01167"></a>01167 
<a name="l01168"></a>01168 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l01169"></a>01169 <span class="preprocessor"></span>
<a name="l01178"></a>01178 <span class="keywordtype">void</span>*
<a name="l01179"></a>01179 _dbus_hash_table_lookup_two_strings (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table,
<a name="l01180"></a>01180                                      <span class="keyword">const</span> <span class="keywordtype">char</span>    *key)
<a name="l01181"></a>01181 {
<a name="l01182"></a>01182   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l01183"></a>01183 
<a name="l01184"></a>01184   _dbus_assert (table-&gt;<a class="code" href="structDBusHashTable.html#a28f326a2947b6be0b0b852db376a1092" title="Type of keys used in this table.">key_type</a> == <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852ac750b865c7994a3dd6d1028b7ae76877" title="Hash key is two strings in one memory block, i.e.">DBUS_HASH_TWO_STRINGS</a>);
<a name="l01185"></a>01185   
<a name="l01186"></a>01186   entry = (* table-&gt;<a class="code" href="structDBusHashTable.html#ab98bafddf1b1ce1dad01c5595e278e35" title="Function for finding entries.">find_function</a>) (table, (<span class="keywordtype">char</span>*) key, <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>, <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>, <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l01187"></a>01187 
<a name="l01188"></a>01188   <span class="keywordflow">if</span> (entry)
<a name="l01189"></a>01189     <span class="keywordflow">return</span> entry-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a>;
<a name="l01190"></a>01190   <span class="keywordflow">else</span>
<a name="l01191"></a>01191     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>;
<a name="l01192"></a>01192 }
<a name="l01193"></a>01193 <span class="preprocessor">#endif </span><span class="comment">/* DBUS_BUILD_TESTS */</span>
<a name="l01194"></a>01194 
<a name="l01204"></a>01204 <span class="keywordtype">void</span>*
<a name="l01205"></a><a class="code" href="group__DBusHashTable.html#ga36ff49c4c35599e6fcdadc7f6805c49e">01205</a> <a class="code" href="group__DBusHashTable.html#ga36ff49c4c35599e6fcdadc7f6805c49e" title="Looks up the value for a given integer in a hash table of type DBUS_HASH_INT.">_dbus_hash_table_lookup_int</a> (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table,
<a name="l01206"></a>01206                              <span class="keywordtype">int</span>            key)
<a name="l01207"></a>01207 {
<a name="l01208"></a>01208   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l01209"></a>01209 
<a name="l01210"></a>01210   _dbus_assert (table-&gt;<a class="code" href="structDBusHashTable.html#a28f326a2947b6be0b0b852db376a1092" title="Type of keys used in this table.">key_type</a> == <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a26446bd9fbb15c6c381b35a810207141" title="Hash keys are integers.">DBUS_HASH_INT</a>);
<a name="l01211"></a>01211   
<a name="l01212"></a>01212   entry = (* table-&gt;<a class="code" href="structDBusHashTable.html#ab98bafddf1b1ce1dad01c5595e278e35" title="Function for finding entries.">find_function</a>) (table, _DBUS_INT_TO_POINTER (key), <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>, <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>, <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l01213"></a>01213 
<a name="l01214"></a>01214   <span class="keywordflow">if</span> (entry)
<a name="l01215"></a>01215     <span class="keywordflow">return</span> entry-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a>;
<a name="l01216"></a>01216   <span class="keywordflow">else</span>
<a name="l01217"></a>01217     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>;
<a name="l01218"></a>01218 }
<a name="l01219"></a>01219 
<a name="l01220"></a>01220 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l01221"></a>01221 <span class="preprocessor"></span><span class="comment">/* disabled since it&#39;s only used for testing */</span>
<a name="l01231"></a>01231 <span class="keywordtype">void</span>*
<a name="l01232"></a>01232 _dbus_hash_table_lookup_pointer (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table,
<a name="l01233"></a>01233                                  <span class="keywordtype">void</span>          *key)
<a name="l01234"></a>01234 {
<a name="l01235"></a>01235   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l01236"></a>01236 
<a name="l01237"></a>01237   _dbus_assert (table-&gt;<a class="code" href="structDBusHashTable.html#a28f326a2947b6be0b0b852db376a1092" title="Type of keys used in this table.">key_type</a> == <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a38604db762cd0ed315106a95a6b50c4d" title="Hash keys are pointers.">DBUS_HASH_POINTER</a>);
<a name="l01238"></a>01238   
<a name="l01239"></a>01239   entry = (* table-&gt;<a class="code" href="structDBusHashTable.html#ab98bafddf1b1ce1dad01c5595e278e35" title="Function for finding entries.">find_function</a>) (table, key, FALSE, NULL, NULL);
<a name="l01240"></a>01240 
<a name="l01241"></a>01241   <span class="keywordflow">if</span> (entry)
<a name="l01242"></a>01242     <span class="keywordflow">return</span> entry-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a>;
<a name="l01243"></a>01243   <span class="keywordflow">else</span>
<a name="l01244"></a>01244     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>;
<a name="l01245"></a>01245 }
<a name="l01246"></a>01246 <span class="preprocessor">#endif </span><span class="comment">/* DBUS_BUILD_TESTS */</span>
<a name="l01247"></a>01247 
<a name="l01257"></a>01257 <span class="keywordtype">void</span>*
<a name="l01258"></a><a class="code" href="group__DBusHashTable.html#gae0ac411f87a797767f36c6e64fd807b3">01258</a> <a class="code" href="group__DBusHashTable.html#gae0ac411f87a797767f36c6e64fd807b3" title="Looks up the value for a given integer in a hash table of type DBUS_HASH_UINTPTR.">_dbus_hash_table_lookup_uintptr</a> (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table,
<a name="l01259"></a>01259                                  uintptr_t      key)
<a name="l01260"></a>01260 {
<a name="l01261"></a>01261   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l01262"></a>01262 
<a name="l01263"></a>01263   _dbus_assert (table-&gt;<a class="code" href="structDBusHashTable.html#a28f326a2947b6be0b0b852db376a1092" title="Type of keys used in this table.">key_type</a> == <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a477caf35cc3676d6412c9b57f1d0f6c7" title="Hash keys are integer capable to hold a pointer.">DBUS_HASH_UINTPTR</a>);
<a name="l01264"></a>01264   
<a name="l01265"></a>01265   entry = (* table-&gt;<a class="code" href="structDBusHashTable.html#ab98bafddf1b1ce1dad01c5595e278e35" title="Function for finding entries.">find_function</a>) (table, (<span class="keywordtype">void</span>*) key, <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>, <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>, <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l01266"></a>01266 
<a name="l01267"></a>01267   <span class="keywordflow">if</span> (entry)
<a name="l01268"></a>01268     <span class="keywordflow">return</span> entry-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a>;
<a name="l01269"></a>01269   <span class="keywordflow">else</span>
<a name="l01270"></a>01270     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>;
<a name="l01271"></a>01271 }
<a name="l01272"></a>01272 
<a name="l01281"></a>01281 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01282"></a><a class="code" href="group__DBusHashTable.html#ga388d50ce1a07bf0790b9f2ecdb08a396">01282</a> <a class="code" href="group__DBusHashTable.html#ga388d50ce1a07bf0790b9f2ecdb08a396" title="Removes the hash entry for the given key.">_dbus_hash_table_remove_string</a> (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table,
<a name="l01283"></a>01283                                 <span class="keyword">const</span> <span class="keywordtype">char</span>    *key)
<a name="l01284"></a>01284 {
<a name="l01285"></a>01285   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l01286"></a>01286   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> **bucket;
<a name="l01287"></a>01287   
<a name="l01288"></a>01288   _dbus_assert (table-&gt;<a class="code" href="structDBusHashTable.html#a28f326a2947b6be0b0b852db376a1092" title="Type of keys used in this table.">key_type</a> == <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a481fd0166d28da725b3e97f15192434e" title="Hash keys are strings.">DBUS_HASH_STRING</a>);
<a name="l01289"></a>01289   
<a name="l01290"></a>01290   entry = (* table-&gt;<a class="code" href="structDBusHashTable.html#ab98bafddf1b1ce1dad01c5595e278e35" title="Function for finding entries.">find_function</a>) (table, (<span class="keywordtype">char</span>*) key, <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>, &amp;bucket, <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l01291"></a>01291 
<a name="l01292"></a>01292   <span class="keywordflow">if</span> (entry)
<a name="l01293"></a>01293     {
<a name="l01294"></a>01294       remove_entry (table, bucket, entry);
<a name="l01295"></a>01295       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01296"></a>01296     }
<a name="l01297"></a>01297   <span class="keywordflow">else</span>
<a name="l01298"></a>01298     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01299"></a>01299 }
<a name="l01300"></a>01300 
<a name="l01301"></a>01301 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l01302"></a>01302 <span class="preprocessor"></span>
<a name="l01310"></a>01310 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01311"></a>01311 _dbus_hash_table_remove_two_strings (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table,
<a name="l01312"></a>01312                                      <span class="keyword">const</span> <span class="keywordtype">char</span>    *key)
<a name="l01313"></a>01313 {
<a name="l01314"></a>01314   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l01315"></a>01315   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> **bucket;
<a name="l01316"></a>01316   
<a name="l01317"></a>01317   _dbus_assert (table-&gt;<a class="code" href="structDBusHashTable.html#a28f326a2947b6be0b0b852db376a1092" title="Type of keys used in this table.">key_type</a> == <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852ac750b865c7994a3dd6d1028b7ae76877" title="Hash key is two strings in one memory block, i.e.">DBUS_HASH_TWO_STRINGS</a>);
<a name="l01318"></a>01318   
<a name="l01319"></a>01319   entry = (* table-&gt;<a class="code" href="structDBusHashTable.html#ab98bafddf1b1ce1dad01c5595e278e35" title="Function for finding entries.">find_function</a>) (table, (<span class="keywordtype">char</span>*) key, <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>, &amp;bucket, <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l01320"></a>01320 
<a name="l01321"></a>01321   <span class="keywordflow">if</span> (entry)
<a name="l01322"></a>01322     {
<a name="l01323"></a>01323       remove_entry (table, bucket, entry);
<a name="l01324"></a>01324       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01325"></a>01325     }
<a name="l01326"></a>01326   <span class="keywordflow">else</span>
<a name="l01327"></a>01327     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01328"></a>01328 }
<a name="l01329"></a>01329 <span class="preprocessor">#endif </span><span class="comment">/* DBUS_BUILD_TESTS */</span>
<a name="l01330"></a>01330 
<a name="l01339"></a>01339 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01340"></a><a class="code" href="group__DBusHashTable.html#gacdebe75bd692605a69dc73c15e0eefd0">01340</a> <a class="code" href="group__DBusHashTable.html#gacdebe75bd692605a69dc73c15e0eefd0" title="Removes the hash entry for the given key.">_dbus_hash_table_remove_int</a> (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table,
<a name="l01341"></a>01341                              <span class="keywordtype">int</span>            key)
<a name="l01342"></a>01342 {
<a name="l01343"></a>01343   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l01344"></a>01344   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> **bucket;
<a name="l01345"></a>01345   
<a name="l01346"></a>01346   _dbus_assert (table-&gt;<a class="code" href="structDBusHashTable.html#a28f326a2947b6be0b0b852db376a1092" title="Type of keys used in this table.">key_type</a> == <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a26446bd9fbb15c6c381b35a810207141" title="Hash keys are integers.">DBUS_HASH_INT</a>);
<a name="l01347"></a>01347   
<a name="l01348"></a>01348   entry = (* table-&gt;<a class="code" href="structDBusHashTable.html#ab98bafddf1b1ce1dad01c5595e278e35" title="Function for finding entries.">find_function</a>) (table, _DBUS_INT_TO_POINTER (key), <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>, &amp;bucket, <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l01349"></a>01349   
<a name="l01350"></a>01350   <span class="keywordflow">if</span> (entry)
<a name="l01351"></a>01351     {
<a name="l01352"></a>01352       remove_entry (table, bucket, entry);
<a name="l01353"></a>01353       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01354"></a>01354     }
<a name="l01355"></a>01355   <span class="keywordflow">else</span>
<a name="l01356"></a>01356     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01357"></a>01357 }
<a name="l01358"></a>01358 
<a name="l01359"></a>01359 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l01360"></a>01360 <span class="preprocessor"></span><span class="comment">/* disabled since it&#39;s only used for testing */</span>
<a name="l01369"></a>01369 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01370"></a>01370 _dbus_hash_table_remove_pointer (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table,
<a name="l01371"></a>01371                                  <span class="keywordtype">void</span>          *key)
<a name="l01372"></a>01372 {
<a name="l01373"></a>01373   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l01374"></a>01374   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> **bucket;
<a name="l01375"></a>01375   
<a name="l01376"></a>01376   _dbus_assert (table-&gt;<a class="code" href="structDBusHashTable.html#a28f326a2947b6be0b0b852db376a1092" title="Type of keys used in this table.">key_type</a> == <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a38604db762cd0ed315106a95a6b50c4d" title="Hash keys are pointers.">DBUS_HASH_POINTER</a>);
<a name="l01377"></a>01377   
<a name="l01378"></a>01378   entry = (* table-&gt;<a class="code" href="structDBusHashTable.html#ab98bafddf1b1ce1dad01c5595e278e35" title="Function for finding entries.">find_function</a>) (table, key, FALSE, &amp;bucket, NULL);
<a name="l01379"></a>01379   
<a name="l01380"></a>01380   <span class="keywordflow">if</span> (entry)
<a name="l01381"></a>01381     {
<a name="l01382"></a>01382       remove_entry (table, bucket, entry);
<a name="l01383"></a>01383       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01384"></a>01384     }
<a name="l01385"></a>01385   <span class="keywordflow">else</span>
<a name="l01386"></a>01386     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01387"></a>01387 }
<a name="l01388"></a>01388 <span class="preprocessor">#endif </span><span class="comment">/* DBUS_BUILD_TESTS */</span>
<a name="l01389"></a>01389 
<a name="l01398"></a>01398 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01399"></a><a class="code" href="group__DBusHashTable.html#ga0ad8fa1108bad2b4bd5b4ce539d32d64">01399</a> <a class="code" href="group__DBusHashTable.html#ga0ad8fa1108bad2b4bd5b4ce539d32d64" title="Removes the hash entry for the given key.">_dbus_hash_table_remove_uintptr</a> (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table,
<a name="l01400"></a>01400                                  uintptr_t      key)
<a name="l01401"></a>01401 {
<a name="l01402"></a>01402   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l01403"></a>01403   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> **bucket;
<a name="l01404"></a>01404   
<a name="l01405"></a>01405   _dbus_assert (table-&gt;<a class="code" href="structDBusHashTable.html#a28f326a2947b6be0b0b852db376a1092" title="Type of keys used in this table.">key_type</a> == <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a477caf35cc3676d6412c9b57f1d0f6c7" title="Hash keys are integer capable to hold a pointer.">DBUS_HASH_UINTPTR</a>);
<a name="l01406"></a>01406   
<a name="l01407"></a>01407   entry = (* table-&gt;<a class="code" href="structDBusHashTable.html#ab98bafddf1b1ce1dad01c5595e278e35" title="Function for finding entries.">find_function</a>) (table, (<span class="keywordtype">void</span>*) key, <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>, &amp;bucket, <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l01408"></a>01408   
<a name="l01409"></a>01409   <span class="keywordflow">if</span> (entry)
<a name="l01410"></a>01410     {
<a name="l01411"></a>01411       remove_entry (table, bucket, entry);
<a name="l01412"></a>01412       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01413"></a>01413     }
<a name="l01414"></a>01414   <span class="keywordflow">else</span>
<a name="l01415"></a>01415     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01416"></a>01416 }
<a name="l01417"></a>01417 
<a name="l01433"></a>01433 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01434"></a><a class="code" href="group__DBusHashTable.html#ga43e98a91a11952824c544330e19f6c22">01434</a> <a class="code" href="group__DBusHashTable.html#ga43e98a91a11952824c544330e19f6c22" title="Creates a hash entry with the given key and value.">_dbus_hash_table_insert_string</a> (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table,
<a name="l01435"></a>01435                                 <span class="keywordtype">char</span>          *key,
<a name="l01436"></a>01436                                 <span class="keywordtype">void</span>          *value)
<a name="l01437"></a>01437 {
<a name="l01438"></a>01438   <a class="code" href="group__DBusHashTable.html#ga175dc6ab841ed32bb6acf6e4c0df36a8" title="A preallocated hash entry.">DBusPreallocatedHash</a> *preallocated;
<a name="l01439"></a>01439 
<a name="l01440"></a>01440   _dbus_assert (table-&gt;<a class="code" href="structDBusHashTable.html#a28f326a2947b6be0b0b852db376a1092" title="Type of keys used in this table.">key_type</a> == <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a481fd0166d28da725b3e97f15192434e" title="Hash keys are strings.">DBUS_HASH_STRING</a>);
<a name="l01441"></a>01441 
<a name="l01442"></a>01442   preallocated = <a class="code" href="group__DBusHashTable.html#ga7c2fed5599678e550af10eaa7fd5b1d1" title="Preallocate an opaque data blob that allows us to insert into the hash table at a later time without ...">_dbus_hash_table_preallocate_entry</a> (table);
<a name="l01443"></a>01443   <span class="keywordflow">if</span> (preallocated == NULL)
<a name="l01444"></a>01444     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01445"></a>01445 
<a name="l01446"></a>01446   <a class="code" href="group__DBusHashTable.html#ga770a9b786a9594350165b7224bd173ee" title="Inserts a string-keyed entry into the hash table, using a preallocated data block from _dbus_hash_tab...">_dbus_hash_table_insert_string_preallocated</a> (table, preallocated,
<a name="l01447"></a>01447                                                key, value);
<a name="l01448"></a>01448   
<a name="l01449"></a>01449   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01450"></a>01450 }
<a name="l01451"></a>01451 
<a name="l01452"></a>01452 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l01453"></a>01453 <span class="preprocessor"></span>
<a name="l01468"></a>01468 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01469"></a>01469 _dbus_hash_table_insert_two_strings (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table,
<a name="l01470"></a>01470                                      <span class="keywordtype">char</span>          *key,
<a name="l01471"></a>01471                                      <span class="keywordtype">void</span>          *value)
<a name="l01472"></a>01472 {
<a name="l01473"></a>01473   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l01474"></a>01474   
<a name="l01475"></a>01475   _dbus_assert (table-&gt;<a class="code" href="structDBusHashTable.html#a28f326a2947b6be0b0b852db376a1092" title="Type of keys used in this table.">key_type</a> == <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852ac750b865c7994a3dd6d1028b7ae76877" title="Hash key is two strings in one memory block, i.e.">DBUS_HASH_TWO_STRINGS</a>);
<a name="l01476"></a>01476   
<a name="l01477"></a>01477   entry = (* table-&gt;<a class="code" href="structDBusHashTable.html#ab98bafddf1b1ce1dad01c5595e278e35" title="Function for finding entries.">find_function</a>) (table, key, <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>, NULL, NULL);
<a name="l01478"></a>01478 
<a name="l01479"></a>01479   <span class="keywordflow">if</span> (entry == NULL)
<a name="l01480"></a>01480     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>; <span class="comment">/* no memory */</span>
<a name="l01481"></a>01481 
<a name="l01482"></a>01482   <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structDBusHashTable.html#a5f6541574ea8e6bedd80773dce8e52a6" title="Function to free keys.">free_key_function</a> &amp;&amp; entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a> != key)
<a name="l01483"></a>01483     (* table-&gt;<a class="code" href="structDBusHashTable.html#a5f6541574ea8e6bedd80773dce8e52a6" title="Function to free keys.">free_key_function</a>) (entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a>);
<a name="l01484"></a>01484   
<a name="l01485"></a>01485   <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structDBusHashTable.html#afbb42b5326b9c79352b168eace1687ca" title="Function to free values.">free_value_function</a> &amp;&amp; entry-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a> != value)
<a name="l01486"></a>01486     (* table-&gt;<a class="code" href="structDBusHashTable.html#afbb42b5326b9c79352b168eace1687ca" title="Function to free values.">free_value_function</a>) (entry-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a>);
<a name="l01487"></a>01487   
<a name="l01488"></a>01488   entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a> = key;
<a name="l01489"></a>01489   entry-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a> = value;
<a name="l01490"></a>01490 
<a name="l01491"></a>01491   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01492"></a>01492 }
<a name="l01493"></a>01493 <span class="preprocessor">#endif </span><span class="comment">/* DBUS_BUILD_TESTS */</span>
<a name="l01494"></a>01494 
<a name="l01510"></a>01510 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01511"></a><a class="code" href="group__DBusHashTable.html#gaca20a83f3214db08fa34df2c49c8edd5">01511</a> <a class="code" href="group__DBusHashTable.html#gaca20a83f3214db08fa34df2c49c8edd5" title="Creates a hash entry with the given key and value.">_dbus_hash_table_insert_int</a> (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table,
<a name="l01512"></a>01512                              <span class="keywordtype">int</span>            key,
<a name="l01513"></a>01513                              <span class="keywordtype">void</span>          *value)
<a name="l01514"></a>01514 {
<a name="l01515"></a>01515   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l01516"></a>01516 
<a name="l01517"></a>01517   _dbus_assert (table-&gt;<a class="code" href="structDBusHashTable.html#a28f326a2947b6be0b0b852db376a1092" title="Type of keys used in this table.">key_type</a> == <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a26446bd9fbb15c6c381b35a810207141" title="Hash keys are integers.">DBUS_HASH_INT</a>);
<a name="l01518"></a>01518   
<a name="l01519"></a>01519   entry = (* table-&gt;<a class="code" href="structDBusHashTable.html#ab98bafddf1b1ce1dad01c5595e278e35" title="Function for finding entries.">find_function</a>) (table, _DBUS_INT_TO_POINTER (key), <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>, <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>, <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l01520"></a>01520 
<a name="l01521"></a>01521   <span class="keywordflow">if</span> (entry == NULL)
<a name="l01522"></a>01522     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>; <span class="comment">/* no memory */</span>
<a name="l01523"></a>01523 
<a name="l01524"></a>01524   <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structDBusHashTable.html#a5f6541574ea8e6bedd80773dce8e52a6" title="Function to free keys.">free_key_function</a> &amp;&amp; entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a> != _DBUS_INT_TO_POINTER (key))
<a name="l01525"></a>01525     (* table-&gt;<a class="code" href="structDBusHashTable.html#a5f6541574ea8e6bedd80773dce8e52a6" title="Function to free keys.">free_key_function</a>) (entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a>);
<a name="l01526"></a>01526   
<a name="l01527"></a>01527   <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structDBusHashTable.html#afbb42b5326b9c79352b168eace1687ca" title="Function to free values.">free_value_function</a> &amp;&amp; entry-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a> != value)
<a name="l01528"></a>01528     (* table-&gt;<a class="code" href="structDBusHashTable.html#afbb42b5326b9c79352b168eace1687ca" title="Function to free values.">free_value_function</a>) (entry-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a>);
<a name="l01529"></a>01529   
<a name="l01530"></a>01530   entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a> = _DBUS_INT_TO_POINTER (key);
<a name="l01531"></a>01531   entry-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a> = value;
<a name="l01532"></a>01532 
<a name="l01533"></a>01533   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01534"></a>01534 }
<a name="l01535"></a>01535 
<a name="l01536"></a>01536 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l01537"></a>01537 <span class="preprocessor"></span><span class="comment">/* disabled since it&#39;s only used for testing */</span>
<a name="l01553"></a>01553 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01554"></a>01554 _dbus_hash_table_insert_pointer (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table,
<a name="l01555"></a>01555                                  <span class="keywordtype">void</span>          *key,
<a name="l01556"></a>01556                                  <span class="keywordtype">void</span>          *value)
<a name="l01557"></a>01557 {
<a name="l01558"></a>01558   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l01559"></a>01559 
<a name="l01560"></a>01560   _dbus_assert (table-&gt;<a class="code" href="structDBusHashTable.html#a28f326a2947b6be0b0b852db376a1092" title="Type of keys used in this table.">key_type</a> == <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a38604db762cd0ed315106a95a6b50c4d" title="Hash keys are pointers.">DBUS_HASH_POINTER</a>);
<a name="l01561"></a>01561   
<a name="l01562"></a>01562   entry = (* table-&gt;<a class="code" href="structDBusHashTable.html#ab98bafddf1b1ce1dad01c5595e278e35" title="Function for finding entries.">find_function</a>) (table, key, <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>, NULL, NULL);
<a name="l01563"></a>01563 
<a name="l01564"></a>01564   <span class="keywordflow">if</span> (entry == NULL)
<a name="l01565"></a>01565     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>; <span class="comment">/* no memory */</span>
<a name="l01566"></a>01566 
<a name="l01567"></a>01567   <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structDBusHashTable.html#a5f6541574ea8e6bedd80773dce8e52a6" title="Function to free keys.">free_key_function</a> &amp;&amp; entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a> != key)
<a name="l01568"></a>01568     (* table-&gt;<a class="code" href="structDBusHashTable.html#a5f6541574ea8e6bedd80773dce8e52a6" title="Function to free keys.">free_key_function</a>) (entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a>);
<a name="l01569"></a>01569   
<a name="l01570"></a>01570   <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structDBusHashTable.html#afbb42b5326b9c79352b168eace1687ca" title="Function to free values.">free_value_function</a> &amp;&amp; entry-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a> != value)
<a name="l01571"></a>01571     (* table-&gt;<a class="code" href="structDBusHashTable.html#afbb42b5326b9c79352b168eace1687ca" title="Function to free values.">free_value_function</a>) (entry-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a>);
<a name="l01572"></a>01572   
<a name="l01573"></a>01573   entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a> = key;
<a name="l01574"></a>01574   entry-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a> = value;
<a name="l01575"></a>01575 
<a name="l01576"></a>01576   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01577"></a>01577 }
<a name="l01578"></a>01578 <span class="preprocessor">#endif </span><span class="comment">/* DBUS_BUILD_TESTS */</span>
<a name="l01579"></a>01579 
<a name="l01595"></a>01595 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01596"></a><a class="code" href="group__DBusHashTable.html#ga811d833032ca919a9063ca835482d01a">01596</a> <a class="code" href="group__DBusHashTable.html#ga811d833032ca919a9063ca835482d01a" title="Creates a hash entry with the given key and value.">_dbus_hash_table_insert_uintptr</a> (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table,
<a name="l01597"></a>01597                                  uintptr_t      key,
<a name="l01598"></a>01598                                  <span class="keywordtype">void</span>          *value)
<a name="l01599"></a>01599 {
<a name="l01600"></a>01600   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l01601"></a>01601 
<a name="l01602"></a>01602   _dbus_assert (table-&gt;<a class="code" href="structDBusHashTable.html#a28f326a2947b6be0b0b852db376a1092" title="Type of keys used in this table.">key_type</a> == <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a477caf35cc3676d6412c9b57f1d0f6c7" title="Hash keys are integer capable to hold a pointer.">DBUS_HASH_UINTPTR</a>);
<a name="l01603"></a>01603   
<a name="l01604"></a>01604   entry = (* table-&gt;<a class="code" href="structDBusHashTable.html#ab98bafddf1b1ce1dad01c5595e278e35" title="Function for finding entries.">find_function</a>) (table, (<span class="keywordtype">void</span>*) key, <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>, <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>, <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>);
<a name="l01605"></a>01605 
<a name="l01606"></a>01606   <span class="keywordflow">if</span> (entry == NULL)
<a name="l01607"></a>01607     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>; <span class="comment">/* no memory */</span>
<a name="l01608"></a>01608 
<a name="l01609"></a>01609   <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structDBusHashTable.html#a5f6541574ea8e6bedd80773dce8e52a6" title="Function to free keys.">free_key_function</a> &amp;&amp; entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a> != (<span class="keywordtype">void</span>*) key)
<a name="l01610"></a>01610     (* table-&gt;<a class="code" href="structDBusHashTable.html#a5f6541574ea8e6bedd80773dce8e52a6" title="Function to free keys.">free_key_function</a>) (entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a>);
<a name="l01611"></a>01611   
<a name="l01612"></a>01612   <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structDBusHashTable.html#afbb42b5326b9c79352b168eace1687ca" title="Function to free values.">free_value_function</a> &amp;&amp; entry-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a> != value)
<a name="l01613"></a>01613     (* table-&gt;<a class="code" href="structDBusHashTable.html#afbb42b5326b9c79352b168eace1687ca" title="Function to free values.">free_value_function</a>) (entry-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a>);
<a name="l01614"></a>01614   
<a name="l01615"></a>01615   entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a> = (<span class="keywordtype">void</span>*) key;
<a name="l01616"></a>01616   entry-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a> = value;
<a name="l01617"></a>01617 
<a name="l01618"></a>01618   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l01619"></a>01619 }
<a name="l01620"></a>01620 
<a name="l01628"></a>01628 <a class="code" href="group__DBusHashTable.html#ga175dc6ab841ed32bb6acf6e4c0df36a8" title="A preallocated hash entry.">DBusPreallocatedHash</a>*
<a name="l01629"></a><a class="code" href="group__DBusHashTable.html#ga7c2fed5599678e550af10eaa7fd5b1d1">01629</a> <a class="code" href="group__DBusHashTable.html#ga7c2fed5599678e550af10eaa7fd5b1d1" title="Preallocate an opaque data blob that allows us to insert into the hash table at a later time without ...">_dbus_hash_table_preallocate_entry</a> (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table)
<a name="l01630"></a>01630 {
<a name="l01631"></a>01631   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l01632"></a>01632   
<a name="l01633"></a>01633   entry = alloc_entry (table);
<a name="l01634"></a>01634 
<a name="l01635"></a>01635   <span class="keywordflow">return</span> (<a class="code" href="group__DBusHashTable.html#ga175dc6ab841ed32bb6acf6e4c0df36a8" title="A preallocated hash entry.">DBusPreallocatedHash</a>*) entry;
<a name="l01636"></a>01636 }
<a name="l01637"></a>01637 
<a name="l01645"></a>01645 <span class="keywordtype">void</span>
<a name="l01646"></a><a class="code" href="group__DBusHashTable.html#ga159dfec03d53e6e2ff485fc83aed2552">01646</a> <a class="code" href="group__DBusHashTable.html#ga159dfec03d53e6e2ff485fc83aed2552" title="Frees an opaque DBusPreallocatedHash that was *not* used in order to insert into the hash table...">_dbus_hash_table_free_preallocated_entry</a> (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>        *table,
<a name="l01647"></a>01647                                           <a class="code" href="group__DBusHashTable.html#ga175dc6ab841ed32bb6acf6e4c0df36a8" title="A preallocated hash entry.">DBusPreallocatedHash</a> *preallocated)
<a name="l01648"></a>01648 {
<a name="l01649"></a>01649   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l01650"></a>01650 
<a name="l01651"></a>01651   _dbus_assert (preallocated != NULL);
<a name="l01652"></a>01652   
<a name="l01653"></a>01653   entry = (<a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>*) preallocated;
<a name="l01654"></a>01654   
<a name="l01655"></a>01655   <span class="comment">/* Don&#39;t use free_entry(), since this entry has no key/data */</span>
<a name="l01656"></a>01656   <a class="code" href="group__DBusMemPool.html#ga4e2feaefee7384ed940059e6c7b0a9d5" title="Deallocates an object previously created with _dbus_mem_pool_alloc().">_dbus_mem_pool_dealloc</a> (table-&gt;<a class="code" href="structDBusHashTable.html#ad1224e6c3c632afb265b78f8f6e30f97" title="Memory pool for hash entries.">entry_pool</a>, entry);
<a name="l01657"></a>01657 }
<a name="l01658"></a>01658 
<a name="l01672"></a>01672 <span class="keywordtype">void</span>
<a name="l01673"></a><a class="code" href="group__DBusHashTable.html#ga770a9b786a9594350165b7224bd173ee">01673</a> <a class="code" href="group__DBusHashTable.html#ga770a9b786a9594350165b7224bd173ee" title="Inserts a string-keyed entry into the hash table, using a preallocated data block from _dbus_hash_tab...">_dbus_hash_table_insert_string_preallocated</a> (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>        *table,
<a name="l01674"></a>01674                                              <a class="code" href="group__DBusHashTable.html#ga175dc6ab841ed32bb6acf6e4c0df36a8" title="A preallocated hash entry.">DBusPreallocatedHash</a> *preallocated,
<a name="l01675"></a>01675                                              <span class="keywordtype">char</span>                 *key,
<a name="l01676"></a>01676                                              <span class="keywordtype">void</span>                 *value)
<a name="l01677"></a>01677 {
<a name="l01678"></a>01678   <a class="code" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a> *entry;
<a name="l01679"></a>01679 
<a name="l01680"></a>01680   _dbus_assert (table-&gt;<a class="code" href="structDBusHashTable.html#a28f326a2947b6be0b0b852db376a1092" title="Type of keys used in this table.">key_type</a> == <a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a481fd0166d28da725b3e97f15192434e" title="Hash keys are strings.">DBUS_HASH_STRING</a>);
<a name="l01681"></a>01681   _dbus_assert (preallocated != NULL);
<a name="l01682"></a>01682   
<a name="l01683"></a>01683   entry = (* table-&gt;<a class="code" href="structDBusHashTable.html#ab98bafddf1b1ce1dad01c5595e278e35" title="Function for finding entries.">find_function</a>) (table, key, <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>, NULL, preallocated);
<a name="l01684"></a>01684 
<a name="l01685"></a>01685   _dbus_assert (entry != NULL);
<a name="l01686"></a>01686   
<a name="l01687"></a>01687   <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structDBusHashTable.html#a5f6541574ea8e6bedd80773dce8e52a6" title="Function to free keys.">free_key_function</a> &amp;&amp; entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a> != key)
<a name="l01688"></a>01688     (* table-&gt;<a class="code" href="structDBusHashTable.html#a5f6541574ea8e6bedd80773dce8e52a6" title="Function to free keys.">free_key_function</a>) (entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a>);
<a name="l01689"></a>01689 
<a name="l01690"></a>01690   <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structDBusHashTable.html#afbb42b5326b9c79352b168eace1687ca" title="Function to free values.">free_value_function</a> &amp;&amp; entry-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a> != value)
<a name="l01691"></a>01691     (* table-&gt;<a class="code" href="structDBusHashTable.html#afbb42b5326b9c79352b168eace1687ca" title="Function to free values.">free_value_function</a>) (entry-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a>);
<a name="l01692"></a>01692       
<a name="l01693"></a>01693   entry-&gt;<a class="code" href="structDBusHashEntry.html#aefd9bbdcbc7d15c906e2c289c8d2e894" title="Hash key.">key</a> = key;
<a name="l01694"></a>01694   entry-&gt;<a class="code" href="structDBusHashEntry.html#ad792e9c81cc3a23859b2c60b3b00af3e" title="Hash value.">value</a> = value;
<a name="l01695"></a>01695 }
<a name="l01696"></a>01696 
<a name="l01703"></a>01703 <span class="keywordtype">int</span>
<a name="l01704"></a><a class="code" href="group__DBusHashTable.html#gad48297fc27442c19a7c4bd4d1ef9ef77">01704</a> <a class="code" href="group__DBusHashTable.html#gad48297fc27442c19a7c4bd4d1ef9ef77" title="Gets the number of hash entries in a hash table.">_dbus_hash_table_get_n_entries</a> (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table)
<a name="l01705"></a>01705 {
<a name="l01706"></a>01706   <span class="keywordflow">return</span> table-&gt;<a class="code" href="structDBusHashTable.html#affbf11a9c3dd72d55b7976891f7b4650" title="Total number of entries present in table.">n_entries</a>;
<a name="l01707"></a>01707 }
<a name="l01708"></a>01708 
<a name="l01711"></a>01711 <span class="preprocessor">#ifdef DBUS_BUILD_TESTS</span>
<a name="l01712"></a>01712 <span class="preprocessor"></span><span class="preprocessor">#include &quot;dbus-test.h&quot;</span>
<a name="l01713"></a>01713 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l01714"></a>01714 
<a name="l01715"></a>01715 <span class="comment">/* If you&#39;re wondering why the hash table test takes</span>
<a name="l01716"></a>01716 <span class="comment"> * forever to run, it&#39;s because we call this function</span>
<a name="l01717"></a>01717 <span class="comment"> * in inner loops thus making things quadratic.</span>
<a name="l01718"></a>01718 <span class="comment"> */</span>
<a name="l01719"></a>01719 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01720"></a>01720 count_entries (<a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table)
<a name="l01721"></a>01721 {
<a name="l01722"></a>01722   <a class="code" href="structDBusHashIter.html" title="Hash iterator object.">DBusHashIter</a> iter;
<a name="l01723"></a>01723   <span class="keywordtype">int</span> count;
<a name="l01724"></a>01724 
<a name="l01725"></a>01725   count = 0;
<a name="l01726"></a>01726   <a class="code" href="group__DBusHashTable.html#ga1b0e6df8a8617ef0f8f25adfba3acc4c" title="Initializes a hash table iterator.">_dbus_hash_iter_init</a> (table, &amp;iter);
<a name="l01727"></a>01727   <span class="keywordflow">while</span> (<a class="code" href="group__DBusHashTable.html#ga723e61fcc91ca673e90ff872c07ea19c" title="Move the hash iterator forward one step, to the next hash entry.">_dbus_hash_iter_next</a> (&amp;iter))
<a name="l01728"></a>01728     ++count;
<a name="l01729"></a>01729 
<a name="l01730"></a>01730   _dbus_assert (count == <a class="code" href="group__DBusHashTable.html#gad48297fc27442c19a7c4bd4d1ef9ef77" title="Gets the number of hash entries in a hash table.">_dbus_hash_table_get_n_entries</a> (table));
<a name="l01731"></a>01731   
<a name="l01732"></a>01732   <span class="keywordflow">return</span> count;
<a name="l01733"></a>01733 }
<a name="l01734"></a>01734 
<a name="l01735"></a>01735 <span class="comment">/* Copy the foo\0bar\0 double string thing */</span>
<a name="l01736"></a>01736 <span class="keyword">static</span> <span class="keywordtype">char</span>*
<a name="l01737"></a>01737 _dbus_strdup2 (<span class="keyword">const</span> <span class="keywordtype">char</span> *str)
<a name="l01738"></a>01738 {
<a name="l01739"></a>01739   <span class="keywordtype">size_t</span> len;
<a name="l01740"></a>01740   <span class="keywordtype">char</span> *copy;
<a name="l01741"></a>01741   
<a name="l01742"></a>01742   <span class="keywordflow">if</span> (str == NULL)
<a name="l01743"></a>01743     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>;
<a name="l01744"></a>01744   
<a name="l01745"></a>01745   len = strlen (str);
<a name="l01746"></a>01746   len += strlen ((str + len + 1));
<a name="l01747"></a>01747 
<a name="l01748"></a>01748   copy = <a class="code" href="group__DBusMemory.html#gaf6e588659067a854c3cca7ebe8ae5084" title="Allocates the given number of bytes, as with standard malloc().">dbus_malloc</a> (len + 2);
<a name="l01749"></a>01749   <span class="keywordflow">if</span> (copy == NULL)
<a name="l01750"></a>01750     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>;
<a name="l01751"></a>01751 
<a name="l01752"></a>01752   memcpy (copy, str, len + 2);
<a name="l01753"></a>01753   
<a name="l01754"></a>01754   <span class="keywordflow">return</span> copy;
<a name="l01755"></a>01755 }
<a name="l01756"></a>01756 
<a name="l01762"></a>01762 <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a>
<a name="l01763"></a>01763 _dbus_hash_test (<span class="keywordtype">void</span>)
<a name="l01764"></a>01764 {
<a name="l01765"></a>01765   <span class="keywordtype">int</span> i;
<a name="l01766"></a>01766   <a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table1;
<a name="l01767"></a>01767   <a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table2;
<a name="l01768"></a>01768   <a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table3;
<a name="l01769"></a>01769   <a class="code" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> *table4;
<a name="l01770"></a>01770   <a class="code" href="structDBusHashIter.html" title="Hash iterator object.">DBusHashIter</a> iter;
<a name="l01771"></a>01771 <span class="preprocessor">#define N_HASH_KEYS 5000</span>
<a name="l01772"></a>01772 <span class="preprocessor"></span>  <span class="keywordtype">char</span> **keys;
<a name="l01773"></a>01773   <a class="code" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349" title="A boolean, valid values are TRUE and FALSE.">dbus_bool_t</a> ret = <a class="code" href="group__DBusMacros.html#gaa93f0eb578d23995850d61f7d61c55c1" title="Expands to &quot;0&quot;.">FALSE</a>;
<a name="l01774"></a>01774 
<a name="l01775"></a>01775   keys = <a class="code" href="group__DBusMemory.html#ga54ccb556e7964112a825a7f46c156ca0" title="Safe macro for using dbus_malloc().">dbus_new</a> (<span class="keywordtype">char</span> *, N_HASH_KEYS);
<a name="l01776"></a>01776   <span class="keywordflow">if</span> (keys == NULL)
<a name="l01777"></a>01777     _dbus_assert_not_reached (<span class="stringliteral">&quot;no memory&quot;</span>);
<a name="l01778"></a>01778 
<a name="l01779"></a>01779   <span class="keywordflow">for</span> (i = 0; i &lt; N_HASH_KEYS; i++)
<a name="l01780"></a>01780     {
<a name="l01781"></a>01781       keys[i] = <a class="code" href="group__DBusMemory.html#gaf6e588659067a854c3cca7ebe8ae5084" title="Allocates the given number of bytes, as with standard malloc().">dbus_malloc</a> (128);
<a name="l01782"></a>01782 
<a name="l01783"></a>01783       <span class="keywordflow">if</span> (keys[i] == NULL)
<a name="l01784"></a>01784         _dbus_assert_not_reached (<span class="stringliteral">&quot;no memory&quot;</span>);
<a name="l01785"></a>01785     }
<a name="l01786"></a>01786 
<a name="l01787"></a>01787   printf (<span class="stringliteral">&quot;Computing test hash keys...\n&quot;</span>);
<a name="l01788"></a>01788   i = 0;
<a name="l01789"></a>01789   <span class="keywordflow">while</span> (i &lt; N_HASH_KEYS)
<a name="l01790"></a>01790     {
<a name="l01791"></a>01791       <span class="keywordtype">int</span> len;
<a name="l01792"></a>01792 
<a name="l01793"></a>01793       <span class="comment">/* all the hash keys are TWO_STRINGS, but</span>
<a name="l01794"></a>01794 <span class="comment">       * then we can also use those as regular strings.</span>
<a name="l01795"></a>01795 <span class="comment">       */</span>
<a name="l01796"></a>01796       
<a name="l01797"></a>01797       len = sprintf (keys[i], <span class="stringliteral">&quot;Hash key %d&quot;</span>, i);
<a name="l01798"></a>01798       sprintf (keys[i] + len + 1, <span class="stringliteral">&quot;Two string %d&quot;</span>, i);
<a name="l01799"></a>01799       _dbus_assert (*(keys[i] + len) == <span class="charliteral">&#39;\0&#39;</span>);
<a name="l01800"></a>01800       _dbus_assert (*(keys[i] + len + 1) != <span class="charliteral">&#39;\0&#39;</span>);
<a name="l01801"></a>01801       ++i;
<a name="l01802"></a>01802     }
<a name="l01803"></a>01803   printf (<span class="stringliteral">&quot;... done.\n&quot;</span>);
<a name="l01804"></a>01804   
<a name="l01805"></a>01805   table1 = <a class="code" href="group__DBusHashTable.html#gac8e434348a354b9606d4c50c127a5eb4" title="Constructs a new hash table.">_dbus_hash_table_new</a> (<a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a481fd0166d28da725b3e97f15192434e" title="Hash keys are strings.">DBUS_HASH_STRING</a>,
<a name="l01806"></a>01806                                  <a class="code" href="group__DBusMemory.html#ga34e666b19b015035a9a31e53da84b39a" title="Frees a block of memory previously allocated by dbus_malloc() or dbus_malloc0().">dbus_free</a>, <a class="code" href="group__DBusMemory.html#ga34e666b19b015035a9a31e53da84b39a" title="Frees a block of memory previously allocated by dbus_malloc() or dbus_malloc0().">dbus_free</a>);
<a name="l01807"></a>01807   <span class="keywordflow">if</span> (table1 == NULL)
<a name="l01808"></a>01808     <span class="keywordflow">goto</span> out;
<a name="l01809"></a>01809 
<a name="l01810"></a>01810   table2 = <a class="code" href="group__DBusHashTable.html#gac8e434348a354b9606d4c50c127a5eb4" title="Constructs a new hash table.">_dbus_hash_table_new</a> (<a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a26446bd9fbb15c6c381b35a810207141" title="Hash keys are integers.">DBUS_HASH_INT</a>,
<a name="l01811"></a>01811                                  NULL, <a class="code" href="group__DBusMemory.html#ga34e666b19b015035a9a31e53da84b39a" title="Frees a block of memory previously allocated by dbus_malloc() or dbus_malloc0().">dbus_free</a>);
<a name="l01812"></a>01812   <span class="keywordflow">if</span> (table2 == NULL)
<a name="l01813"></a>01813     <span class="keywordflow">goto</span> out;
<a name="l01814"></a>01814 
<a name="l01815"></a>01815   table3 = <a class="code" href="group__DBusHashTable.html#gac8e434348a354b9606d4c50c127a5eb4" title="Constructs a new hash table.">_dbus_hash_table_new</a> (<a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a477caf35cc3676d6412c9b57f1d0f6c7" title="Hash keys are integer capable to hold a pointer.">DBUS_HASH_UINTPTR</a>,
<a name="l01816"></a>01816                                  NULL, <a class="code" href="group__DBusMemory.html#ga34e666b19b015035a9a31e53da84b39a" title="Frees a block of memory previously allocated by dbus_malloc() or dbus_malloc0().">dbus_free</a>);
<a name="l01817"></a>01817   <span class="keywordflow">if</span> (table3 == NULL)
<a name="l01818"></a>01818     <span class="keywordflow">goto</span> out;
<a name="l01819"></a>01819 
<a name="l01820"></a>01820   table4 = <a class="code" href="group__DBusHashTable.html#gac8e434348a354b9606d4c50c127a5eb4" title="Constructs a new hash table.">_dbus_hash_table_new</a> (<a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852ac750b865c7994a3dd6d1028b7ae76877" title="Hash key is two strings in one memory block, i.e.">DBUS_HASH_TWO_STRINGS</a>,
<a name="l01821"></a>01821                                  <a class="code" href="group__DBusMemory.html#ga34e666b19b015035a9a31e53da84b39a" title="Frees a block of memory previously allocated by dbus_malloc() or dbus_malloc0().">dbus_free</a>, <a class="code" href="group__DBusMemory.html#ga34e666b19b015035a9a31e53da84b39a" title="Frees a block of memory previously allocated by dbus_malloc() or dbus_malloc0().">dbus_free</a>);
<a name="l01822"></a>01822   <span class="keywordflow">if</span> (table4 == NULL)
<a name="l01823"></a>01823     <span class="keywordflow">goto</span> out;
<a name="l01824"></a>01824 
<a name="l01825"></a>01825   
<a name="l01826"></a>01826   <span class="comment">/* Insert and remove a bunch of stuff, counting the table in between</span>
<a name="l01827"></a>01827 <span class="comment">   * to be sure it&#39;s not broken and that iteration works</span>
<a name="l01828"></a>01828 <span class="comment">   */</span>
<a name="l01829"></a>01829   i = 0;
<a name="l01830"></a>01830   <span class="keywordflow">while</span> (i &lt; 3000)
<a name="l01831"></a>01831     {
<a name="l01832"></a>01832       <span class="keywordtype">void</span> *value;
<a name="l01833"></a>01833       <span class="keywordtype">char</span> *key;
<a name="l01834"></a>01834 
<a name="l01835"></a>01835       key = <a class="code" href="group__DBusInternalsUtils.html#ga9d00d77f6595b9d7ac1baf59d44bf58c" title="Duplicates a string.">_dbus_strdup</a> (keys[i]);
<a name="l01836"></a>01836       <span class="keywordflow">if</span> (key == NULL)
<a name="l01837"></a>01837         <span class="keywordflow">goto</span> out;
<a name="l01838"></a>01838       value = <a class="code" href="group__DBusInternalsUtils.html#ga9d00d77f6595b9d7ac1baf59d44bf58c" title="Duplicates a string.">_dbus_strdup</a> (<span class="stringliteral">&quot;Value!&quot;</span>);
<a name="l01839"></a>01839       <span class="keywordflow">if</span> (value == NULL)
<a name="l01840"></a>01840         <span class="keywordflow">goto</span> out;
<a name="l01841"></a>01841       
<a name="l01842"></a>01842       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusHashTable.html#ga43e98a91a11952824c544330e19f6c22" title="Creates a hash entry with the given key and value.">_dbus_hash_table_insert_string</a> (table1,
<a name="l01843"></a>01843                                            key, value))
<a name="l01844"></a>01844         <span class="keywordflow">goto</span> out;
<a name="l01845"></a>01845 
<a name="l01846"></a>01846       value = <a class="code" href="group__DBusInternalsUtils.html#ga9d00d77f6595b9d7ac1baf59d44bf58c" title="Duplicates a string.">_dbus_strdup</a> (keys[i]);
<a name="l01847"></a>01847       <span class="keywordflow">if</span> (value == NULL)
<a name="l01848"></a>01848         <span class="keywordflow">goto</span> out;
<a name="l01849"></a>01849       
<a name="l01850"></a>01850       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusHashTable.html#gaca20a83f3214db08fa34df2c49c8edd5" title="Creates a hash entry with the given key and value.">_dbus_hash_table_insert_int</a> (table2,
<a name="l01851"></a>01851                                         i, value))
<a name="l01852"></a>01852         <span class="keywordflow">goto</span> out;
<a name="l01853"></a>01853 
<a name="l01854"></a>01854       value = <a class="code" href="group__DBusInternalsUtils.html#ga9d00d77f6595b9d7ac1baf59d44bf58c" title="Duplicates a string.">_dbus_strdup</a> (keys[i]);
<a name="l01855"></a>01855       <span class="keywordflow">if</span> (value == NULL)
<a name="l01856"></a>01856         <span class="keywordflow">goto</span> out;
<a name="l01857"></a>01857       
<a name="l01858"></a>01858       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusHashTable.html#ga811d833032ca919a9063ca835482d01a" title="Creates a hash entry with the given key and value.">_dbus_hash_table_insert_uintptr</a> (table3,
<a name="l01859"></a>01859                                           i, value))
<a name="l01860"></a>01860         <span class="keywordflow">goto</span> out;
<a name="l01861"></a>01861 
<a name="l01862"></a>01862       key = _dbus_strdup2 (keys[i]);
<a name="l01863"></a>01863       <span class="keywordflow">if</span> (key == NULL)
<a name="l01864"></a>01864         <span class="keywordflow">goto</span> out;
<a name="l01865"></a>01865       value = <a class="code" href="group__DBusInternalsUtils.html#ga9d00d77f6595b9d7ac1baf59d44bf58c" title="Duplicates a string.">_dbus_strdup</a> (<span class="stringliteral">&quot;Value!&quot;</span>);
<a name="l01866"></a>01866       <span class="keywordflow">if</span> (value == NULL)
<a name="l01867"></a>01867         <span class="keywordflow">goto</span> out;
<a name="l01868"></a>01868       
<a name="l01869"></a>01869       <span class="keywordflow">if</span> (!_dbus_hash_table_insert_two_strings (table4,
<a name="l01870"></a>01870                                                 key, value))
<a name="l01871"></a>01871         <span class="keywordflow">goto</span> out;
<a name="l01872"></a>01872       
<a name="l01873"></a>01873       _dbus_assert (count_entries (table1) == i + 1);
<a name="l01874"></a>01874       _dbus_assert (count_entries (table2) == i + 1);
<a name="l01875"></a>01875       _dbus_assert (count_entries (table3) == i + 1);
<a name="l01876"></a>01876       _dbus_assert (count_entries (table4) == i + 1);
<a name="l01877"></a>01877 
<a name="l01878"></a>01878       value = <a class="code" href="group__DBusHashTable.html#gad51eb3fe682721dd4f6a920ca87cb730" title="Looks up the value for a given string in a hash table of type DBUS_HASH_STRING.">_dbus_hash_table_lookup_string</a> (table1, keys[i]);
<a name="l01879"></a>01879       _dbus_assert (value != NULL);
<a name="l01880"></a>01880       _dbus_assert (strcmp (value, <span class="stringliteral">&quot;Value!&quot;</span>) == 0);
<a name="l01881"></a>01881 
<a name="l01882"></a>01882       value = <a class="code" href="group__DBusHashTable.html#ga36ff49c4c35599e6fcdadc7f6805c49e" title="Looks up the value for a given integer in a hash table of type DBUS_HASH_INT.">_dbus_hash_table_lookup_int</a> (table2, i);
<a name="l01883"></a>01883       _dbus_assert (value != NULL);
<a name="l01884"></a>01884       _dbus_assert (strcmp (value, keys[i]) == 0);
<a name="l01885"></a>01885 
<a name="l01886"></a>01886       value = <a class="code" href="group__DBusHashTable.html#gae0ac411f87a797767f36c6e64fd807b3" title="Looks up the value for a given integer in a hash table of type DBUS_HASH_UINTPTR.">_dbus_hash_table_lookup_uintptr</a> (table3, i);
<a name="l01887"></a>01887       _dbus_assert (value != NULL);
<a name="l01888"></a>01888       _dbus_assert (strcmp (value, keys[i]) == 0);
<a name="l01889"></a>01889 
<a name="l01890"></a>01890       value = _dbus_hash_table_lookup_two_strings (table4, keys[i]);
<a name="l01891"></a>01891       _dbus_assert (value != NULL);
<a name="l01892"></a>01892       _dbus_assert (strcmp (value, <span class="stringliteral">&quot;Value!&quot;</span>) == 0);
<a name="l01893"></a>01893       
<a name="l01894"></a>01894       ++i;
<a name="l01895"></a>01895     }
<a name="l01896"></a>01896 
<a name="l01897"></a>01897   --i;
<a name="l01898"></a>01898   <span class="keywordflow">while</span> (i &gt;= 0)
<a name="l01899"></a>01899     {
<a name="l01900"></a>01900       <a class="code" href="group__DBusHashTable.html#ga388d50ce1a07bf0790b9f2ecdb08a396" title="Removes the hash entry for the given key.">_dbus_hash_table_remove_string</a> (table1,
<a name="l01901"></a>01901                                       keys[i]);
<a name="l01902"></a>01902 
<a name="l01903"></a>01903       <a class="code" href="group__DBusHashTable.html#gacdebe75bd692605a69dc73c15e0eefd0" title="Removes the hash entry for the given key.">_dbus_hash_table_remove_int</a> (table2, i);
<a name="l01904"></a>01904 
<a name="l01905"></a>01905       <a class="code" href="group__DBusHashTable.html#ga0ad8fa1108bad2b4bd5b4ce539d32d64" title="Removes the hash entry for the given key.">_dbus_hash_table_remove_uintptr</a> (table3, i);
<a name="l01906"></a>01906 
<a name="l01907"></a>01907       _dbus_hash_table_remove_two_strings (table4,
<a name="l01908"></a>01908                                            keys[i]);
<a name="l01909"></a>01909       
<a name="l01910"></a>01910       _dbus_assert (count_entries (table1) == i);
<a name="l01911"></a>01911       _dbus_assert (count_entries (table2) == i);
<a name="l01912"></a>01912       _dbus_assert (count_entries (table3) == i);
<a name="l01913"></a>01913       _dbus_assert (count_entries (table4) == i);
<a name="l01914"></a>01914 
<a name="l01915"></a>01915       --i;
<a name="l01916"></a>01916     }
<a name="l01917"></a>01917 
<a name="l01918"></a>01918   <a class="code" href="group__DBusHashTable.html#ga4ad4622378885e5d911c26956e174a45" title="Increments the reference count for a hash table.">_dbus_hash_table_ref</a> (table1);
<a name="l01919"></a>01919   <a class="code" href="group__DBusHashTable.html#ga4ad4622378885e5d911c26956e174a45" title="Increments the reference count for a hash table.">_dbus_hash_table_ref</a> (table2);
<a name="l01920"></a>01920   <a class="code" href="group__DBusHashTable.html#ga4ad4622378885e5d911c26956e174a45" title="Increments the reference count for a hash table.">_dbus_hash_table_ref</a> (table3);
<a name="l01921"></a>01921   <a class="code" href="group__DBusHashTable.html#ga4ad4622378885e5d911c26956e174a45" title="Increments the reference count for a hash table.">_dbus_hash_table_ref</a> (table4);
<a name="l01922"></a>01922   <a class="code" href="group__DBusHashTable.html#ga96b777e00764b44e0f3216fd8478f5a9" title="Decrements the reference count for a hash table, freeing the hash table if the count reaches zero...">_dbus_hash_table_unref</a> (table1);
<a name="l01923"></a>01923   <a class="code" href="group__DBusHashTable.html#ga96b777e00764b44e0f3216fd8478f5a9" title="Decrements the reference count for a hash table, freeing the hash table if the count reaches zero...">_dbus_hash_table_unref</a> (table2);
<a name="l01924"></a>01924   <a class="code" href="group__DBusHashTable.html#ga96b777e00764b44e0f3216fd8478f5a9" title="Decrements the reference count for a hash table, freeing the hash table if the count reaches zero...">_dbus_hash_table_unref</a> (table3);
<a name="l01925"></a>01925   <a class="code" href="group__DBusHashTable.html#ga96b777e00764b44e0f3216fd8478f5a9" title="Decrements the reference count for a hash table, freeing the hash table if the count reaches zero...">_dbus_hash_table_unref</a> (table4);
<a name="l01926"></a>01926   <a class="code" href="group__DBusHashTable.html#ga96b777e00764b44e0f3216fd8478f5a9" title="Decrements the reference count for a hash table, freeing the hash table if the count reaches zero...">_dbus_hash_table_unref</a> (table1);
<a name="l01927"></a>01927   <a class="code" href="group__DBusHashTable.html#ga96b777e00764b44e0f3216fd8478f5a9" title="Decrements the reference count for a hash table, freeing the hash table if the count reaches zero...">_dbus_hash_table_unref</a> (table2);
<a name="l01928"></a>01928   <a class="code" href="group__DBusHashTable.html#ga96b777e00764b44e0f3216fd8478f5a9" title="Decrements the reference count for a hash table, freeing the hash table if the count reaches zero...">_dbus_hash_table_unref</a> (table3);
<a name="l01929"></a>01929   <a class="code" href="group__DBusHashTable.html#ga96b777e00764b44e0f3216fd8478f5a9" title="Decrements the reference count for a hash table, freeing the hash table if the count reaches zero...">_dbus_hash_table_unref</a> (table4);
<a name="l01930"></a>01930   table3 = <a class="code" href="group__DBusMacros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="A null pointer, defined appropriately for C or C++.">NULL</a>;
<a name="l01931"></a>01931 
<a name="l01932"></a>01932   <span class="comment">/* Insert a bunch of stuff then check</span>
<a name="l01933"></a>01933 <span class="comment">   * that iteration works correctly (finds the right</span>
<a name="l01934"></a>01934 <span class="comment">   * values, iter_set_value works, etc.)</span>
<a name="l01935"></a>01935 <span class="comment">   */</span>
<a name="l01936"></a>01936   table1 = <a class="code" href="group__DBusHashTable.html#gac8e434348a354b9606d4c50c127a5eb4" title="Constructs a new hash table.">_dbus_hash_table_new</a> (<a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a481fd0166d28da725b3e97f15192434e" title="Hash keys are strings.">DBUS_HASH_STRING</a>,
<a name="l01937"></a>01937                                  <a class="code" href="group__DBusMemory.html#ga34e666b19b015035a9a31e53da84b39a" title="Frees a block of memory previously allocated by dbus_malloc() or dbus_malloc0().">dbus_free</a>, <a class="code" href="group__DBusMemory.html#ga34e666b19b015035a9a31e53da84b39a" title="Frees a block of memory previously allocated by dbus_malloc() or dbus_malloc0().">dbus_free</a>);
<a name="l01938"></a>01938   <span class="keywordflow">if</span> (table1 == NULL)
<a name="l01939"></a>01939     <span class="keywordflow">goto</span> out;
<a name="l01940"></a>01940   
<a name="l01941"></a>01941   table2 = <a class="code" href="group__DBusHashTable.html#gac8e434348a354b9606d4c50c127a5eb4" title="Constructs a new hash table.">_dbus_hash_table_new</a> (<a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a26446bd9fbb15c6c381b35a810207141" title="Hash keys are integers.">DBUS_HASH_INT</a>,
<a name="l01942"></a>01942                                  NULL, <a class="code" href="group__DBusMemory.html#ga34e666b19b015035a9a31e53da84b39a" title="Frees a block of memory previously allocated by dbus_malloc() or dbus_malloc0().">dbus_free</a>);
<a name="l01943"></a>01943   <span class="keywordflow">if</span> (table2 == NULL)
<a name="l01944"></a>01944     <span class="keywordflow">goto</span> out;
<a name="l01945"></a>01945   
<a name="l01946"></a>01946   i = 0;
<a name="l01947"></a>01947   <span class="keywordflow">while</span> (i &lt; 5000)
<a name="l01948"></a>01948     {
<a name="l01949"></a>01949       <span class="keywordtype">char</span> *key;
<a name="l01950"></a>01950       <span class="keywordtype">void</span> *value;      
<a name="l01951"></a>01951       
<a name="l01952"></a>01952       key = <a class="code" href="group__DBusInternalsUtils.html#ga9d00d77f6595b9d7ac1baf59d44bf58c" title="Duplicates a string.">_dbus_strdup</a> (keys[i]);
<a name="l01953"></a>01953       <span class="keywordflow">if</span> (key == NULL)
<a name="l01954"></a>01954         <span class="keywordflow">goto</span> out;
<a name="l01955"></a>01955       value = <a class="code" href="group__DBusInternalsUtils.html#ga9d00d77f6595b9d7ac1baf59d44bf58c" title="Duplicates a string.">_dbus_strdup</a> (<span class="stringliteral">&quot;Value!&quot;</span>);
<a name="l01956"></a>01956       <span class="keywordflow">if</span> (value == NULL)
<a name="l01957"></a>01957         <span class="keywordflow">goto</span> out;
<a name="l01958"></a>01958       
<a name="l01959"></a>01959       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusHashTable.html#ga43e98a91a11952824c544330e19f6c22" title="Creates a hash entry with the given key and value.">_dbus_hash_table_insert_string</a> (table1,
<a name="l01960"></a>01960                                            key, value))
<a name="l01961"></a>01961         <span class="keywordflow">goto</span> out;
<a name="l01962"></a>01962 
<a name="l01963"></a>01963       value = <a class="code" href="group__DBusInternalsUtils.html#ga9d00d77f6595b9d7ac1baf59d44bf58c" title="Duplicates a string.">_dbus_strdup</a> (keys[i]);
<a name="l01964"></a>01964       <span class="keywordflow">if</span> (value == NULL)
<a name="l01965"></a>01965         <span class="keywordflow">goto</span> out;
<a name="l01966"></a>01966       
<a name="l01967"></a>01967       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusHashTable.html#gaca20a83f3214db08fa34df2c49c8edd5" title="Creates a hash entry with the given key and value.">_dbus_hash_table_insert_int</a> (table2,
<a name="l01968"></a>01968                                         i, value))
<a name="l01969"></a>01969         <span class="keywordflow">goto</span> out;
<a name="l01970"></a>01970       
<a name="l01971"></a>01971       _dbus_assert (count_entries (table1) == i + 1);
<a name="l01972"></a>01972       _dbus_assert (count_entries (table2) == i + 1);
<a name="l01973"></a>01973       
<a name="l01974"></a>01974       ++i;
<a name="l01975"></a>01975     }
<a name="l01976"></a>01976 
<a name="l01977"></a>01977   <a class="code" href="group__DBusHashTable.html#ga1b0e6df8a8617ef0f8f25adfba3acc4c" title="Initializes a hash table iterator.">_dbus_hash_iter_init</a> (table1, &amp;iter);
<a name="l01978"></a>01978   <span class="keywordflow">while</span> (<a class="code" href="group__DBusHashTable.html#ga723e61fcc91ca673e90ff872c07ea19c" title="Move the hash iterator forward one step, to the next hash entry.">_dbus_hash_iter_next</a> (&amp;iter))
<a name="l01979"></a>01979     {
<a name="l01980"></a>01980       <span class="keyword">const</span> <span class="keywordtype">char</span> *key;
<a name="l01981"></a>01981       <span class="keywordtype">void</span> *value;
<a name="l01982"></a>01982 
<a name="l01983"></a>01983       key = <a class="code" href="group__DBusHashTable.html#gaa0cff082174b1ab0380902ce4ae43d08" title="Gets the key for the current entry.">_dbus_hash_iter_get_string_key</a> (&amp;iter);
<a name="l01984"></a>01984       value = <a class="code" href="group__DBusHashTable.html#ga34bf277ee37f919bd00516b5ae4e12b5" title="Gets the value of the current entry.">_dbus_hash_iter_get_value</a> (&amp;iter);
<a name="l01985"></a>01985 
<a name="l01986"></a>01986       _dbus_assert (<a class="code" href="group__DBusHashTable.html#gad51eb3fe682721dd4f6a920ca87cb730" title="Looks up the value for a given string in a hash table of type DBUS_HASH_STRING.">_dbus_hash_table_lookup_string</a> (table1, key) == value);
<a name="l01987"></a>01987 
<a name="l01988"></a>01988       value = <a class="code" href="group__DBusInternalsUtils.html#ga9d00d77f6595b9d7ac1baf59d44bf58c" title="Duplicates a string.">_dbus_strdup</a> (<span class="stringliteral">&quot;Different value!&quot;</span>);
<a name="l01989"></a>01989       <span class="keywordflow">if</span> (value == NULL)
<a name="l01990"></a>01990         <span class="keywordflow">goto</span> out;
<a name="l01991"></a>01991       
<a name="l01992"></a>01992       <a class="code" href="group__DBusHashTable.html#ga24193343c0948019d4a302fc18bfd5d9" title="Sets the value of the current entry.">_dbus_hash_iter_set_value</a> (&amp;iter, value);
<a name="l01993"></a>01993 
<a name="l01994"></a>01994       _dbus_assert (<a class="code" href="group__DBusHashTable.html#gad51eb3fe682721dd4f6a920ca87cb730" title="Looks up the value for a given string in a hash table of type DBUS_HASH_STRING.">_dbus_hash_table_lookup_string</a> (table1, key) == value);
<a name="l01995"></a>01995     }
<a name="l01996"></a>01996   
<a name="l01997"></a>01997   <a class="code" href="group__DBusHashTable.html#ga1b0e6df8a8617ef0f8f25adfba3acc4c" title="Initializes a hash table iterator.">_dbus_hash_iter_init</a> (table1, &amp;iter);
<a name="l01998"></a>01998   <span class="keywordflow">while</span> (<a class="code" href="group__DBusHashTable.html#ga723e61fcc91ca673e90ff872c07ea19c" title="Move the hash iterator forward one step, to the next hash entry.">_dbus_hash_iter_next</a> (&amp;iter))
<a name="l01999"></a>01999     {
<a name="l02000"></a>02000       <a class="code" href="group__DBusHashTable.html#ga0ef12d773a546f070cff91cbf1e8d16e" title="Removes the current entry from the hash table.">_dbus_hash_iter_remove_entry</a> (&amp;iter);
<a name="l02001"></a>02001       _dbus_assert (count_entries (table1) == i - 1);
<a name="l02002"></a>02002       --i;
<a name="l02003"></a>02003     }
<a name="l02004"></a>02004 
<a name="l02005"></a>02005   <a class="code" href="group__DBusHashTable.html#ga1b0e6df8a8617ef0f8f25adfba3acc4c" title="Initializes a hash table iterator.">_dbus_hash_iter_init</a> (table2, &amp;iter);
<a name="l02006"></a>02006   <span class="keywordflow">while</span> (<a class="code" href="group__DBusHashTable.html#ga723e61fcc91ca673e90ff872c07ea19c" title="Move the hash iterator forward one step, to the next hash entry.">_dbus_hash_iter_next</a> (&amp;iter))
<a name="l02007"></a>02007     {
<a name="l02008"></a>02008       <span class="keywordtype">int</span> key;
<a name="l02009"></a>02009       <span class="keywordtype">void</span> *value;
<a name="l02010"></a>02010 
<a name="l02011"></a>02011       key = <a class="code" href="group__DBusHashTable.html#ga7a1b9fd35f9f7bdd86f9d71a6379053f" title="Gets the key for the current entry.">_dbus_hash_iter_get_int_key</a> (&amp;iter);
<a name="l02012"></a>02012       value = <a class="code" href="group__DBusHashTable.html#ga34bf277ee37f919bd00516b5ae4e12b5" title="Gets the value of the current entry.">_dbus_hash_iter_get_value</a> (&amp;iter);
<a name="l02013"></a>02013 
<a name="l02014"></a>02014       _dbus_assert (<a class="code" href="group__DBusHashTable.html#ga36ff49c4c35599e6fcdadc7f6805c49e" title="Looks up the value for a given integer in a hash table of type DBUS_HASH_INT.">_dbus_hash_table_lookup_int</a> (table2, key) == value);
<a name="l02015"></a>02015 
<a name="l02016"></a>02016       value = <a class="code" href="group__DBusInternalsUtils.html#ga9d00d77f6595b9d7ac1baf59d44bf58c" title="Duplicates a string.">_dbus_strdup</a> (<span class="stringliteral">&quot;Different value!&quot;</span>);
<a name="l02017"></a>02017       <span class="keywordflow">if</span> (value == NULL)
<a name="l02018"></a>02018         <span class="keywordflow">goto</span> out;
<a name="l02019"></a>02019       
<a name="l02020"></a>02020       <a class="code" href="group__DBusHashTable.html#ga24193343c0948019d4a302fc18bfd5d9" title="Sets the value of the current entry.">_dbus_hash_iter_set_value</a> (&amp;iter, value);
<a name="l02021"></a>02021 
<a name="l02022"></a>02022       _dbus_assert (<a class="code" href="group__DBusHashTable.html#ga36ff49c4c35599e6fcdadc7f6805c49e" title="Looks up the value for a given integer in a hash table of type DBUS_HASH_INT.">_dbus_hash_table_lookup_int</a> (table2, key) == value);
<a name="l02023"></a>02023     }
<a name="l02024"></a>02024 
<a name="l02025"></a>02025   i = count_entries (table2);
<a name="l02026"></a>02026   <a class="code" href="group__DBusHashTable.html#ga1b0e6df8a8617ef0f8f25adfba3acc4c" title="Initializes a hash table iterator.">_dbus_hash_iter_init</a> (table2, &amp;iter);
<a name="l02027"></a>02027   <span class="keywordflow">while</span> (<a class="code" href="group__DBusHashTable.html#ga723e61fcc91ca673e90ff872c07ea19c" title="Move the hash iterator forward one step, to the next hash entry.">_dbus_hash_iter_next</a> (&amp;iter))
<a name="l02028"></a>02028     {
<a name="l02029"></a>02029       <a class="code" href="group__DBusHashTable.html#ga0ef12d773a546f070cff91cbf1e8d16e" title="Removes the current entry from the hash table.">_dbus_hash_iter_remove_entry</a> (&amp;iter);
<a name="l02030"></a>02030       _dbus_assert (count_entries (table2) + 1 == i);
<a name="l02031"></a>02031       --i;
<a name="l02032"></a>02032     }
<a name="l02033"></a>02033 
<a name="l02034"></a>02034   <span class="comment">/* add/remove interleaved, to check that we grow/shrink the table</span>
<a name="l02035"></a>02035 <span class="comment">   * appropriately</span>
<a name="l02036"></a>02036 <span class="comment">   */</span>
<a name="l02037"></a>02037   i = 0;
<a name="l02038"></a>02038   <span class="keywordflow">while</span> (i &lt; 1000)
<a name="l02039"></a>02039     {
<a name="l02040"></a>02040       <span class="keywordtype">char</span> *key;
<a name="l02041"></a>02041       <span class="keywordtype">void</span> *value;
<a name="l02042"></a>02042             
<a name="l02043"></a>02043       key = <a class="code" href="group__DBusInternalsUtils.html#ga9d00d77f6595b9d7ac1baf59d44bf58c" title="Duplicates a string.">_dbus_strdup</a> (keys[i]);
<a name="l02044"></a>02044       <span class="keywordflow">if</span> (key == NULL)
<a name="l02045"></a>02045         <span class="keywordflow">goto</span> out;
<a name="l02046"></a>02046 
<a name="l02047"></a>02047       value = <a class="code" href="group__DBusInternalsUtils.html#ga9d00d77f6595b9d7ac1baf59d44bf58c" title="Duplicates a string.">_dbus_strdup</a> (<span class="stringliteral">&quot;Value!&quot;</span>);
<a name="l02048"></a>02048       <span class="keywordflow">if</span> (value == NULL)
<a name="l02049"></a>02049         <span class="keywordflow">goto</span> out;
<a name="l02050"></a>02050       
<a name="l02051"></a>02051       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusHashTable.html#ga43e98a91a11952824c544330e19f6c22" title="Creates a hash entry with the given key and value.">_dbus_hash_table_insert_string</a> (table1,
<a name="l02052"></a>02052                                            key, value))
<a name="l02053"></a>02053         <span class="keywordflow">goto</span> out;
<a name="l02054"></a>02054       
<a name="l02055"></a>02055       ++i;
<a name="l02056"></a>02056     }
<a name="l02057"></a>02057 
<a name="l02058"></a>02058   --i;
<a name="l02059"></a>02059   <span class="keywordflow">while</span> (i &gt;= 0)
<a name="l02060"></a>02060     {
<a name="l02061"></a>02061       <span class="keywordtype">char</span> *key;
<a name="l02062"></a>02062       <span class="keywordtype">void</span> *value;      
<a name="l02063"></a>02063       
<a name="l02064"></a>02064       key = <a class="code" href="group__DBusInternalsUtils.html#ga9d00d77f6595b9d7ac1baf59d44bf58c" title="Duplicates a string.">_dbus_strdup</a> (keys[i]);
<a name="l02065"></a>02065       <span class="keywordflow">if</span> (key == NULL)
<a name="l02066"></a>02066         <span class="keywordflow">goto</span> out;
<a name="l02067"></a>02067       value = <a class="code" href="group__DBusInternalsUtils.html#ga9d00d77f6595b9d7ac1baf59d44bf58c" title="Duplicates a string.">_dbus_strdup</a> (<span class="stringliteral">&quot;Value!&quot;</span>);
<a name="l02068"></a>02068       <span class="keywordflow">if</span> (value == NULL)
<a name="l02069"></a>02069         <span class="keywordflow">goto</span> out;
<a name="l02070"></a>02070 
<a name="l02071"></a>02071       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusHashTable.html#ga388d50ce1a07bf0790b9f2ecdb08a396" title="Removes the hash entry for the given key.">_dbus_hash_table_remove_string</a> (table1, keys[i]))
<a name="l02072"></a>02072         <span class="keywordflow">goto</span> out;
<a name="l02073"></a>02073       
<a name="l02074"></a>02074       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusHashTable.html#ga43e98a91a11952824c544330e19f6c22" title="Creates a hash entry with the given key and value.">_dbus_hash_table_insert_string</a> (table1,
<a name="l02075"></a>02075                                            key, value))
<a name="l02076"></a>02076         <span class="keywordflow">goto</span> out;
<a name="l02077"></a>02077 
<a name="l02078"></a>02078       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusHashTable.html#ga388d50ce1a07bf0790b9f2ecdb08a396" title="Removes the hash entry for the given key.">_dbus_hash_table_remove_string</a> (table1, keys[i]))
<a name="l02079"></a>02079         <span class="keywordflow">goto</span> out;
<a name="l02080"></a>02080       
<a name="l02081"></a>02081       _dbus_assert (<a class="code" href="group__DBusHashTable.html#gad48297fc27442c19a7c4bd4d1ef9ef77" title="Gets the number of hash entries in a hash table.">_dbus_hash_table_get_n_entries</a> (table1) == i);
<a name="l02082"></a>02082       
<a name="l02083"></a>02083       --i;
<a name="l02084"></a>02084     }
<a name="l02085"></a>02085 
<a name="l02086"></a>02086   <span class="comment">/* nuke these tables */</span>
<a name="l02087"></a>02087   <a class="code" href="group__DBusHashTable.html#ga96b777e00764b44e0f3216fd8478f5a9" title="Decrements the reference count for a hash table, freeing the hash table if the count reaches zero...">_dbus_hash_table_unref</a> (table1);
<a name="l02088"></a>02088   <a class="code" href="group__DBusHashTable.html#ga96b777e00764b44e0f3216fd8478f5a9" title="Decrements the reference count for a hash table, freeing the hash table if the count reaches zero...">_dbus_hash_table_unref</a> (table2);
<a name="l02089"></a>02089 
<a name="l02090"></a>02090 
<a name="l02091"></a>02091   <span class="comment">/* Now do a bunch of things again using _dbus_hash_iter_lookup() to</span>
<a name="l02092"></a>02092 <span class="comment">   * be sure that interface works.</span>
<a name="l02093"></a>02093 <span class="comment">   */</span>
<a name="l02094"></a>02094   table1 = <a class="code" href="group__DBusHashTable.html#gac8e434348a354b9606d4c50c127a5eb4" title="Constructs a new hash table.">_dbus_hash_table_new</a> (<a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a481fd0166d28da725b3e97f15192434e" title="Hash keys are strings.">DBUS_HASH_STRING</a>,
<a name="l02095"></a>02095                                  <a class="code" href="group__DBusMemory.html#ga34e666b19b015035a9a31e53da84b39a" title="Frees a block of memory previously allocated by dbus_malloc() or dbus_malloc0().">dbus_free</a>, <a class="code" href="group__DBusMemory.html#ga34e666b19b015035a9a31e53da84b39a" title="Frees a block of memory previously allocated by dbus_malloc() or dbus_malloc0().">dbus_free</a>);
<a name="l02096"></a>02096   <span class="keywordflow">if</span> (table1 == NULL)
<a name="l02097"></a>02097     <span class="keywordflow">goto</span> out;
<a name="l02098"></a>02098   
<a name="l02099"></a>02099   table2 = <a class="code" href="group__DBusHashTable.html#gac8e434348a354b9606d4c50c127a5eb4" title="Constructs a new hash table.">_dbus_hash_table_new</a> (<a class="code" href="group__DBusHashTable.html#ggab0ab9767ffa5b6720a13b3d741630852a26446bd9fbb15c6c381b35a810207141" title="Hash keys are integers.">DBUS_HASH_INT</a>,
<a name="l02100"></a>02100                                  NULL, <a class="code" href="group__DBusMemory.html#ga34e666b19b015035a9a31e53da84b39a" title="Frees a block of memory previously allocated by dbus_malloc() or dbus_malloc0().">dbus_free</a>);
<a name="l02101"></a>02101   <span class="keywordflow">if</span> (table2 == NULL)
<a name="l02102"></a>02102     <span class="keywordflow">goto</span> out;
<a name="l02103"></a>02103   
<a name="l02104"></a>02104   i = 0;
<a name="l02105"></a>02105   <span class="keywordflow">while</span> (i &lt; 3000)
<a name="l02106"></a>02106     {
<a name="l02107"></a>02107       <span class="keywordtype">void</span> *value;
<a name="l02108"></a>02108       <span class="keywordtype">char</span> *key;
<a name="l02109"></a>02109 
<a name="l02110"></a>02110       key = <a class="code" href="group__DBusInternalsUtils.html#ga9d00d77f6595b9d7ac1baf59d44bf58c" title="Duplicates a string.">_dbus_strdup</a> (keys[i]);
<a name="l02111"></a>02111       <span class="keywordflow">if</span> (key == NULL)
<a name="l02112"></a>02112         <span class="keywordflow">goto</span> out;
<a name="l02113"></a>02113       value = <a class="code" href="group__DBusInternalsUtils.html#ga9d00d77f6595b9d7ac1baf59d44bf58c" title="Duplicates a string.">_dbus_strdup</a> (<span class="stringliteral">&quot;Value!&quot;</span>);
<a name="l02114"></a>02114       <span class="keywordflow">if</span> (value == NULL)
<a name="l02115"></a>02115         <span class="keywordflow">goto</span> out;
<a name="l02116"></a>02116       
<a name="l02117"></a>02117       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusHashTable.html#gab156c35d6dd9ff6e408a835db28323fb" title="A low-level but efficient interface for manipulating the hash table.">_dbus_hash_iter_lookup</a> (table1,
<a name="l02118"></a>02118                                    key, <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>, &amp;iter))
<a name="l02119"></a>02119         <span class="keywordflow">goto</span> out;
<a name="l02120"></a>02120       _dbus_assert (<a class="code" href="group__DBusHashTable.html#ga34bf277ee37f919bd00516b5ae4e12b5" title="Gets the value of the current entry.">_dbus_hash_iter_get_value</a> (&amp;iter) == NULL);
<a name="l02121"></a>02121       <a class="code" href="group__DBusHashTable.html#ga24193343c0948019d4a302fc18bfd5d9" title="Sets the value of the current entry.">_dbus_hash_iter_set_value</a> (&amp;iter, value);
<a name="l02122"></a>02122 
<a name="l02123"></a>02123       value = <a class="code" href="group__DBusInternalsUtils.html#ga9d00d77f6595b9d7ac1baf59d44bf58c" title="Duplicates a string.">_dbus_strdup</a> (keys[i]);
<a name="l02124"></a>02124       <span class="keywordflow">if</span> (value == NULL)
<a name="l02125"></a>02125         <span class="keywordflow">goto</span> out;
<a name="l02126"></a>02126 
<a name="l02127"></a>02127       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusHashTable.html#gab156c35d6dd9ff6e408a835db28323fb" title="A low-level but efficient interface for manipulating the hash table.">_dbus_hash_iter_lookup</a> (table2,
<a name="l02128"></a>02128                                    _DBUS_INT_TO_POINTER (i), <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>, &amp;iter))
<a name="l02129"></a>02129         <span class="keywordflow">goto</span> out;
<a name="l02130"></a>02130       _dbus_assert (<a class="code" href="group__DBusHashTable.html#ga34bf277ee37f919bd00516b5ae4e12b5" title="Gets the value of the current entry.">_dbus_hash_iter_get_value</a> (&amp;iter) == NULL);
<a name="l02131"></a>02131       <a class="code" href="group__DBusHashTable.html#ga24193343c0948019d4a302fc18bfd5d9" title="Sets the value of the current entry.">_dbus_hash_iter_set_value</a> (&amp;iter, value); 
<a name="l02132"></a>02132       
<a name="l02133"></a>02133       _dbus_assert (count_entries (table1) == i + 1);
<a name="l02134"></a>02134       _dbus_assert (count_entries (table2) == i + 1);
<a name="l02135"></a>02135 
<a name="l02136"></a>02136       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusHashTable.html#gab156c35d6dd9ff6e408a835db28323fb" title="A low-level but efficient interface for manipulating the hash table.">_dbus_hash_iter_lookup</a> (table1, keys[i], FALSE, &amp;iter))
<a name="l02137"></a>02137         <span class="keywordflow">goto</span> out;
<a name="l02138"></a>02138       
<a name="l02139"></a>02139       value = <a class="code" href="group__DBusHashTable.html#ga34bf277ee37f919bd00516b5ae4e12b5" title="Gets the value of the current entry.">_dbus_hash_iter_get_value</a> (&amp;iter);
<a name="l02140"></a>02140       _dbus_assert (value != NULL);
<a name="l02141"></a>02141       _dbus_assert (strcmp (value, <span class="stringliteral">&quot;Value!&quot;</span>) == 0);
<a name="l02142"></a>02142 
<a name="l02143"></a>02143       <span class="comment">/* Iterate just to be sure it works, though</span>
<a name="l02144"></a>02144 <span class="comment">       * it&#39;s a stupid thing to do</span>
<a name="l02145"></a>02145 <span class="comment">       */</span>
<a name="l02146"></a>02146       <span class="keywordflow">while</span> (<a class="code" href="group__DBusHashTable.html#ga723e61fcc91ca673e90ff872c07ea19c" title="Move the hash iterator forward one step, to the next hash entry.">_dbus_hash_iter_next</a> (&amp;iter))
<a name="l02147"></a>02147         ;
<a name="l02148"></a>02148       
<a name="l02149"></a>02149       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusHashTable.html#gab156c35d6dd9ff6e408a835db28323fb" title="A low-level but efficient interface for manipulating the hash table.">_dbus_hash_iter_lookup</a> (table2, _DBUS_INT_TO_POINTER (i), FALSE, &amp;iter))
<a name="l02150"></a>02150         <span class="keywordflow">goto</span> out;
<a name="l02151"></a>02151 
<a name="l02152"></a>02152       value = <a class="code" href="group__DBusHashTable.html#ga34bf277ee37f919bd00516b5ae4e12b5" title="Gets the value of the current entry.">_dbus_hash_iter_get_value</a> (&amp;iter);
<a name="l02153"></a>02153       _dbus_assert (value != NULL);
<a name="l02154"></a>02154       _dbus_assert (strcmp (value, keys[i]) == 0);
<a name="l02155"></a>02155 
<a name="l02156"></a>02156       <span class="comment">/* Iterate just to be sure it works, though</span>
<a name="l02157"></a>02157 <span class="comment">       * it&#39;s a stupid thing to do</span>
<a name="l02158"></a>02158 <span class="comment">       */</span>
<a name="l02159"></a>02159       <span class="keywordflow">while</span> (<a class="code" href="group__DBusHashTable.html#ga723e61fcc91ca673e90ff872c07ea19c" title="Move the hash iterator forward one step, to the next hash entry.">_dbus_hash_iter_next</a> (&amp;iter))
<a name="l02160"></a>02160         ;
<a name="l02161"></a>02161       
<a name="l02162"></a>02162       ++i;
<a name="l02163"></a>02163     }
<a name="l02164"></a>02164 
<a name="l02165"></a>02165   --i;
<a name="l02166"></a>02166   <span class="keywordflow">while</span> (i &gt;= 0)
<a name="l02167"></a>02167     {
<a name="l02168"></a>02168       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusHashTable.html#gab156c35d6dd9ff6e408a835db28323fb" title="A low-level but efficient interface for manipulating the hash table.">_dbus_hash_iter_lookup</a> (table1, keys[i], FALSE, &amp;iter))
<a name="l02169"></a>02169         _dbus_assert_not_reached (<span class="stringliteral">&quot;hash entry should have existed&quot;</span>);
<a name="l02170"></a>02170       <a class="code" href="group__DBusHashTable.html#ga0ef12d773a546f070cff91cbf1e8d16e" title="Removes the current entry from the hash table.">_dbus_hash_iter_remove_entry</a> (&amp;iter);
<a name="l02171"></a>02171       
<a name="l02172"></a>02172       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusHashTable.html#gab156c35d6dd9ff6e408a835db28323fb" title="A low-level but efficient interface for manipulating the hash table.">_dbus_hash_iter_lookup</a> (table2, _DBUS_INT_TO_POINTER (i), FALSE, &amp;iter))
<a name="l02173"></a>02173         _dbus_assert_not_reached (<span class="stringliteral">&quot;hash entry should have existed&quot;</span>);
<a name="l02174"></a>02174       <a class="code" href="group__DBusHashTable.html#ga0ef12d773a546f070cff91cbf1e8d16e" title="Removes the current entry from the hash table.">_dbus_hash_iter_remove_entry</a> (&amp;iter);
<a name="l02175"></a>02175 
<a name="l02176"></a>02176       _dbus_assert (count_entries (table1) == i);
<a name="l02177"></a>02177       _dbus_assert (count_entries (table2) == i);
<a name="l02178"></a>02178 
<a name="l02179"></a>02179       --i;
<a name="l02180"></a>02180     }
<a name="l02181"></a>02181 
<a name="l02182"></a>02182   <a class="code" href="group__DBusHashTable.html#ga96b777e00764b44e0f3216fd8478f5a9" title="Decrements the reference count for a hash table, freeing the hash table if the count reaches zero...">_dbus_hash_table_unref</a> (table1);
<a name="l02183"></a>02183   <a class="code" href="group__DBusHashTable.html#ga96b777e00764b44e0f3216fd8478f5a9" title="Decrements the reference count for a hash table, freeing the hash table if the count reaches zero...">_dbus_hash_table_unref</a> (table2);
<a name="l02184"></a>02184 
<a name="l02185"></a>02185   ret = <a class="code" href="group__DBusMacros.html#gaa8cecfc5c5c054d2875c03e77b7be15d" title="Expands to &quot;1&quot;.">TRUE</a>;
<a name="l02186"></a>02186 
<a name="l02187"></a>02187  out:
<a name="l02188"></a>02188   <span class="keywordflow">for</span> (i = 0; i &lt; N_HASH_KEYS; i++)
<a name="l02189"></a>02189     <a class="code" href="group__DBusMemory.html#ga34e666b19b015035a9a31e53da84b39a" title="Frees a block of memory previously allocated by dbus_malloc() or dbus_malloc0().">dbus_free</a> (keys[i]);
<a name="l02190"></a>02190 
<a name="l02191"></a>02191   <a class="code" href="group__DBusMemory.html#ga34e666b19b015035a9a31e53da84b39a" title="Frees a block of memory previously allocated by dbus_malloc() or dbus_malloc0().">dbus_free</a> (keys);
<a name="l02192"></a>02192   
<a name="l02193"></a>02193   <span class="keywordflow">return</span> ret;
<a name="l02194"></a>02194 }
<a name="l02195"></a>02195 
<a name="l02196"></a>02196 <span class="preprocessor">#endif </span><span class="comment">/* DBUS_BUILD_TESTS */</span>
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Wed Mar 26 2014 11:29:27 for D-Bus by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
