<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>apt: /home/rpmuser/debian/check/apt-0.8.16~exp12ubuntu10.16/apt-pkg/acquire-worker.h Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">apt
   &#160;<span id="projectnumber">@VERSION@</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_c37ff385fd032239d555211fc694500a.html">apt-pkg</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">acquire-worker.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="acquire-worker_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// -*- mode: cpp; mode: fold -*-</span>
<a name="l00002"></a>00002 <span class="comment">// Description                                                          /*{{{*/</span>
<a name="l00003"></a>00003 <span class="comment">// $Id: acquire-worker.h,v 1.12 2001/02/20 07:03:17 jgg Exp $</span>
<a name="l00004"></a>00004 <span class="comment">/* ######################################################################</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">   Acquire Worker - Worker process manager</span>
<a name="l00007"></a>00007 <span class="comment">   </span>
<a name="l00008"></a>00008 <span class="comment">   Each worker class is associated with exaclty one subprocess.</span>
<a name="l00009"></a>00009 <span class="comment">   </span>
<a name="l00010"></a>00010 <span class="comment">   ##################################################################### */</span>
<a name="l00011"></a>00011                                                                         <span class="comment">/*}}}*/</span>
<a name="l00012"></a>00012 
<a name="l00019"></a>00019 <span class="preprocessor">#ifndef PKGLIB_ACQUIRE_WORKER_H</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span><span class="preprocessor">#define PKGLIB_ACQUIRE_WORKER_H</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;<a class="code" href="acquire_8h.html">apt-pkg/acquire.h</a>&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;apt-pkg/weakptr.h&gt;</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 
<a name="l00045"></a><a class="code" href="classpkgAcquire_1_1Worker.html">00045</a> <span class="keyword">class </span><a class="code" href="classpkgAcquire_1_1Worker.html" title="A fetch subprocess.">pkgAcquire::Worker</a> : <span class="keyword">public</span> <a class="code" href="classWeakPointable.html">WeakPointable</a>
<a name="l00046"></a>00046 {
<a name="l00048"></a>00048    <span class="keywordtype">void</span> *d;
<a name="l00049"></a>00049   
<a name="l00050"></a>00050    <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classpkgAcquire.html" title="The core download scheduler. {{{.">pkgAcquire</a>;
<a name="l00051"></a>00051    
<a name="l00052"></a>00052    <span class="keyword">protected</span>:
<a name="l00053"></a>00053    <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classpkgAcquire_1_1Queue.html" title="A single download queue in a pkgAcquire object. {{{.">Queue</a>;
<a name="l00054"></a>00054 
<a name="l00059"></a><a class="code" href="classpkgAcquire_1_1Worker.html#a70b012fdfb38bfe94b52924d45c5462d">00059</a>    <a class="code" href="classpkgAcquire_1_1Worker.html" title="A fetch subprocess.">Worker</a> *<a class="code" href="classpkgAcquire_1_1Worker.html#a70b012fdfb38bfe94b52924d45c5462d" title="The next link on the Queue list.">NextQueue</a>;
<a name="l00060"></a>00060 
<a name="l00062"></a><a class="code" href="classpkgAcquire_1_1Worker.html#a3faf9ec3dc6548bd0ec0f656a91d9b8f">00062</a>    <a class="code" href="classpkgAcquire_1_1Worker.html" title="A fetch subprocess.">Worker</a> *<a class="code" href="classpkgAcquire_1_1Worker.html#a3faf9ec3dc6548bd0ec0f656a91d9b8f" title="The next link on the Acquire list.">NextAcquire</a>;
<a name="l00063"></a>00063    
<a name="l00065"></a><a class="code" href="classpkgAcquire_1_1Worker.html#a99d906c6fe7507d8452fa4566377d2eb">00065</a>    <a class="code" href="classpkgAcquire_1_1Queue.html" title="A single download queue in a pkgAcquire object. {{{.">Queue</a> *<a class="code" href="classpkgAcquire_1_1Worker.html#a99d906c6fe7507d8452fa4566377d2eb" title="The Queue with which this worker is associated.">OwnerQ</a>;
<a name="l00066"></a>00066 
<a name="l00070"></a><a class="code" href="classpkgAcquire_1_1Worker.html#aa7f97da72ceb8761a1cda178c778ca7c">00070</a>    <a class="code" href="classpkgAcquireStatus.html" title="A monitor object for downloads controlled by the pkgAcquire class. {{{.">pkgAcquireStatus</a> *<a class="code" href="classpkgAcquire_1_1Worker.html#aa7f97da72ceb8761a1cda178c778ca7c" title="The download progress indicator to which progress messages should be sent.">Log</a>;
<a name="l00071"></a>00071 
<a name="l00076"></a><a class="code" href="classpkgAcquire_1_1Worker.html#a33b828cdf6b336e68c51bb8e068e1297">00076</a>    <a class="code" href="structpkgAcquire_1_1MethodConfig.html" title="Information about the properties of a single acquire method. {{{.">MethodConfig</a> *<a class="code" href="classpkgAcquire_1_1Worker.html#a33b828cdf6b336e68c51bb8e068e1297" title="The configuration of this method. On startup, the target of this pointer is filled in with basic data...">Config</a>;
<a name="l00077"></a>00077 
<a name="l00082"></a><a class="code" href="classpkgAcquire_1_1Worker.html#a006a979c4801f6b6ceb33cb3acd6dc89">00082</a>    std::string <a class="code" href="classpkgAcquire_1_1Worker.html#a006a979c4801f6b6ceb33cb3acd6dc89" title="The access method to be used by this worker.">Access</a>;
<a name="l00083"></a>00083 
<a name="l00085"></a><a class="code" href="classpkgAcquire_1_1Worker.html#a593a34f5ed2b53f33f69c4f17aa836eb">00085</a>    pid_t <a class="code" href="classpkgAcquire_1_1Worker.html#a593a34f5ed2b53f33f69c4f17aa836eb" title="The PID of the subprocess.">Process</a>;
<a name="l00086"></a>00086 
<a name="l00092"></a><a class="code" href="classpkgAcquire_1_1Worker.html#a2eb3145b965a64b578db347d1bae648b">00092</a>    <span class="keywordtype">int</span> <a class="code" href="classpkgAcquire_1_1Worker.html#a2eb3145b965a64b578db347d1bae648b" title="A file descriptor connected to the standard output of the subprocess.">InFd</a>;
<a name="l00093"></a>00093 
<a name="l00099"></a><a class="code" href="classpkgAcquire_1_1Worker.html#af2679e54f43d436f88045350be6fb2ab">00099</a>    <span class="keywordtype">int</span> <a class="code" href="classpkgAcquire_1_1Worker.html#af2679e54f43d436f88045350be6fb2ab" title="A file descriptor connected to the standard input of the subprocess.">OutFd</a>;
<a name="l00100"></a>00100 
<a name="l00106"></a><a class="code" href="classpkgAcquire_1_1Worker.html#a849bc65c54e1bcbe8a7f053ce2cec672">00106</a>    <span class="keywordtype">bool</span> <a class="code" href="classpkgAcquire_1_1Worker.html#a849bc65c54e1bcbe8a7f053ce2cec672" title="Set to true if the worker is in a state in which it might generate data or command responses...">InReady</a>;
<a name="l00107"></a>00107 
<a name="l00113"></a><a class="code" href="classpkgAcquire_1_1Worker.html#a0b8717fb6d062212c251900cee4e6004">00113</a>    <span class="keywordtype">bool</span> <a class="code" href="classpkgAcquire_1_1Worker.html#a0b8717fb6d062212c251900cee4e6004" title="Set to true if the worker is in a state in which it is legal to send commands to it.">OutReady</a>;
<a name="l00114"></a>00114    
<a name="l00116"></a><a class="code" href="classpkgAcquire_1_1Worker.html#acdf3472c9b75f32dae88032d42d1cb6c">00116</a>    <span class="keywordtype">bool</span> <a class="code" href="classpkgAcquire_1_1Worker.html#acdf3472c9b75f32dae88032d42d1cb6c">Debug</a>;
<a name="l00117"></a>00117 
<a name="l00121"></a><a class="code" href="classpkgAcquire_1_1Worker.html#ad4a47a4aae6979a5a870f4fd7953a8d6">00121</a>    std::vector&lt;std::string&gt; <a class="code" href="classpkgAcquire_1_1Worker.html#ad4a47a4aae6979a5a870f4fd7953a8d6" title="The raw text values of messages received from the worker, in sequence.">MessageQueue</a>;
<a name="l00122"></a>00122 
<a name="l00127"></a><a class="code" href="classpkgAcquire_1_1Worker.html#a27ee7762ef1caaf3ec8c3598c15e7886">00127</a>    std::string <a class="code" href="classpkgAcquire_1_1Worker.html#a27ee7762ef1caaf3ec8c3598c15e7886" title="Buffers pending writes to the subprocess.">OutQueue</a>;
<a name="l00128"></a>00128    
<a name="l00135"></a>00135    <span class="keywordtype">void</span> <a class="code" href="classpkgAcquire_1_1Worker.html#a9af72b216eb95e320f0f261d9497c5c1" title="Common code for the constructor.">Construct</a>();
<a name="l00136"></a>00136    
<a name="l00147"></a>00147    <span class="keywordtype">bool</span> <a class="code" href="classpkgAcquire_1_1Worker.html#a1f374a34dcd1bd9881717b345118fd49" title="Retrieve any available messages from the subprocess.">ReadMessages</a>();
<a name="l00148"></a>00148 
<a name="l00158"></a>00158    <span class="keywordtype">bool</span> <a class="code" href="classpkgAcquire_1_1Worker.html#a26a68d57a249a042c1e32186ce2fce8b" title="Parse and dispatch pending messages.">RunMessages</a>();
<a name="l00159"></a>00159 
<a name="l00166"></a>00166    <span class="keywordtype">bool</span> <a class="code" href="classpkgAcquire_1_1Worker.html#a5a3e1a57c0fe730162df8a50677ae513" title="Read and dispatch any pending messages from the subprocess.">InFdReady</a>();
<a name="l00167"></a>00167 
<a name="l00175"></a>00175    <span class="keywordtype">bool</span> <a class="code" href="classpkgAcquire_1_1Worker.html#a2bd3e6488eaf8af11cedae06f7de9e2c" title="Send any pending commands to the subprocess.">OutFdReady</a>();
<a name="l00176"></a>00176    
<a name="l00186"></a>00186    <span class="keywordtype">bool</span> <a class="code" href="classpkgAcquire_1_1Worker.html#aa3de23b9c5a564121a667dd9b392e158" title="Handle a 100 Capabilities response from the subprocess.">Capabilities</a>(std::string Message);
<a name="l00187"></a>00187 
<a name="l00204"></a>00204    <span class="keywordtype">bool</span> <a class="code" href="classpkgAcquire_1_1Worker.html#af79a315ab449f2046389c91e3f114326" title="Send a 601 Configuration message (containing the APT configuration) to the subprocess.">SendConfiguration</a>();
<a name="l00205"></a>00205 
<a name="l00217"></a>00217    <span class="keywordtype">bool</span> <a class="code" href="classpkgAcquire_1_1Worker.html#a5fa3dc5431fbfcd2b5ceed5f97f1eb84" title="Handle a 403 Media Change message.">MediaChange</a>(std::string Message);
<a name="l00218"></a>00218    
<a name="l00228"></a>00228    <span class="keywordtype">bool</span> <a class="code" href="classpkgAcquire_1_1Worker.html#a94fe52037e4594131495b1791d6654ea" title="Invoked when the worked process dies unexpectedly.">MethodFailure</a>();
<a name="l00229"></a>00229 
<a name="l00235"></a>00235    <span class="keywordtype">void</span> <a class="code" href="classpkgAcquire_1_1Worker.html#a6a6deb8c5e68383147e31b24690ea0fd" title="Invoked when a fetch job is completed, either successfully or unsuccessfully.">ItemDone</a>();
<a name="l00236"></a>00236    
<a name="l00237"></a>00237    <span class="keyword">public</span>:
<a name="l00238"></a>00238    
<a name="l00240"></a><a class="code" href="classpkgAcquire_1_1Worker.html#adbe3d9577156a7736f774428835b31e9">00240</a>    <a class="code" href="structpkgAcquire_1_1Queue_1_1QItem.html" title="A single item placed in this queue.">pkgAcquire::Queue::QItem</a> *<a class="code" href="classpkgAcquire_1_1Worker.html#adbe3d9577156a7736f774428835b31e9" title="The queue entry that is currently being downloaded.">CurrentItem</a>;
<a name="l00241"></a>00241 
<a name="l00245"></a><a class="code" href="classpkgAcquire_1_1Worker.html#ae08432c27cb86081cae64bb384b3ac4b">00245</a>    std::string <a class="code" href="classpkgAcquire_1_1Worker.html#ae08432c27cb86081cae64bb384b3ac4b" title="The most recent status string received from the subprocess.">Status</a>;
<a name="l00246"></a>00246 
<a name="l00250"></a><a class="code" href="classpkgAcquire_1_1Worker.html#af6da844ee8d9f7ae8f59e1821edc7948">00250</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code" href="classpkgAcquire_1_1Worker.html#af6da844ee8d9f7ae8f59e1821edc7948" title="How many bytes of the file have been downloaded. Zero if the current progress of the file cannot be d...">CurrentSize</a>;
<a name="l00251"></a>00251 
<a name="l00255"></a><a class="code" href="classpkgAcquire_1_1Worker.html#ace18d22dfea021e7f9ae876b1974ccbe">00255</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code" href="classpkgAcquire_1_1Worker.html#ace18d22dfea021e7f9ae876b1974ccbe" title="The total number of bytes to be downloaded. Zero if the total size of the final is unknown...">TotalSize</a>;
<a name="l00256"></a>00256 
<a name="l00260"></a><a class="code" href="classpkgAcquire_1_1Worker.html#abd497ee7ec5dec08e88b4658730ecf63">00260</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code" href="classpkgAcquire_1_1Worker.html#abd497ee7ec5dec08e88b4658730ecf63" title="How much of the file was already downloaded prior to starting this worker.">ResumePoint</a>;
<a name="l00261"></a>00261    
<a name="l00271"></a>00271    <span class="keywordtype">bool</span> <a class="code" href="classpkgAcquire_1_1Worker.html#a37fbf2dea83d49ebf053ecc76c5b39b3" title="Tell the subprocess to download the given item.">QueueItem</a>(<a class="code" href="structpkgAcquire_1_1Queue_1_1QItem.html" title="A single item placed in this queue.">pkgAcquire::Queue::QItem</a> *<a class="code" href="classpkgAcquire_1_1Item.html" title="Represents the process by which a pkgAcquire object should {{{ retrieve a file or a collection of fil...">Item</a>);
<a name="l00272"></a>00272 
<a name="l00280"></a>00280    <span class="keywordtype">bool</span> <a class="code" href="classpkgAcquire_1_1Worker.html#aa70efaa4751ac6d5d54dce88fe725e0a" title="Start up the worker and fill in Config.">Start</a>();
<a name="l00281"></a>00281 
<a name="l00285"></a>00285    <span class="keywordtype">void</span> <a class="code" href="classpkgAcquire_1_1Worker.html#ae7e67c4b41efe972e0bd8ccaeacce912" title="Update the worker statistics (CurrentSize, TotalSize, etc).">Pulse</a>();
<a name="l00286"></a>00286 
<a name="l00288"></a><a class="code" href="classpkgAcquire_1_1Worker.html#af6ace6a8dd9e4dd8d12815078706b00c">00288</a>    <span class="keyword">inline</span> <span class="keyword">const</span> <a class="code" href="structpkgAcquire_1_1MethodConfig.html" title="Information about the properties of a single acquire method. {{{.">MethodConfig</a> *<a class="code" href="classpkgAcquire_1_1Worker.html#af6ace6a8dd9e4dd8d12815078706b00c">GetConf</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> <a class="code" href="classpkgAcquire_1_1Worker.html#a33b828cdf6b336e68c51bb8e068e1297" title="The configuration of this method. On startup, the target of this pointer is filled in with basic data...">Config</a>;};
<a name="l00289"></a>00289 
<a name="l00301"></a>00301    <a class="code" href="classpkgAcquire_1_1Worker.html#ac0cf8a483d82d1372c6f7d499937860c" title="Create a new Worker to download files.">Worker</a>(<a class="code" href="classpkgAcquire_1_1Queue.html" title="A single download queue in a pkgAcquire object. {{{.">Queue</a> *<a class="code" href="classpkgAcquire_1_1Worker.html#a99d906c6fe7507d8452fa4566377d2eb" title="The Queue with which this worker is associated.">OwnerQ</a>,<a class="code" href="structpkgAcquire_1_1MethodConfig.html" title="Information about the properties of a single acquire method. {{{.">MethodConfig</a> *<a class="code" href="classpkgAcquire_1_1Worker.html#a33b828cdf6b336e68c51bb8e068e1297" title="The configuration of this method. On startup, the target of this pointer is filled in with basic data...">Config</a>,<a class="code" href="classpkgAcquireStatus.html" title="A monitor object for downloads controlled by the pkgAcquire class. {{{.">pkgAcquireStatus</a> *<a class="code" href="classpkgAcquire_1_1Worker.html#aa7f97da72ceb8761a1cda178c778ca7c" title="The download progress indicator to which progress messages should be sent.">Log</a>);
<a name="l00302"></a>00302 
<a name="l00313"></a>00313    <a class="code" href="classpkgAcquire_1_1Worker.html#ac0cf8a483d82d1372c6f7d499937860c" title="Create a new Worker to download files.">Worker</a>(<a class="code" href="structpkgAcquire_1_1MethodConfig.html" title="Information about the properties of a single acquire method. {{{.">MethodConfig</a> *<a class="code" href="classpkgAcquire_1_1Worker.html#a33b828cdf6b336e68c51bb8e068e1297" title="The configuration of this method. On startup, the target of this pointer is filled in with basic data...">Config</a>);
<a name="l00314"></a>00314 
<a name="l00320"></a>00320    <span class="keyword">virtual</span> <a class="code" href="classpkgAcquire_1_1Worker.html#a6c90b9d499e906079194f681b6cb90ca" title="Clean up this worker.">~Worker</a>();
<a name="l00321"></a>00321 };
<a name="l00322"></a>00322 
<a name="l00325"></a>00325 <span class="preprocessor">#endif</span>
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Wed Mar 26 2014 10:05:24 for apt by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
