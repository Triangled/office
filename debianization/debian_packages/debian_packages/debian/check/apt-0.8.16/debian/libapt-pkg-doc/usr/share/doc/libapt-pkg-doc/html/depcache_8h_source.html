<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>apt: /home/rpmuser/debian/check/apt-0.8.16~exp12ubuntu10.16/apt-pkg/depcache.h Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">apt
   &#160;<span id="projectnumber">@VERSION@</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_c37ff385fd032239d555211fc694500a.html">apt-pkg</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">depcache.h</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// -*- mode: c++; mode: fold -*-</span>
<a name="l00002"></a>00002 <span class="comment">// Description                                                          /*{{{*/</span>
<a name="l00003"></a>00003 <span class="comment">// $Id: depcache.h,v 1.14 2001/02/20 07:03:17 jgg Exp $</span>
<a name="l00004"></a>00004 <span class="comment">/* ######################################################################</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">   DepCache - Dependency Extension data for the cache</span>
<a name="l00007"></a>00007 <span class="comment">   </span>
<a name="l00008"></a>00008 <span class="comment">   This class stores the cache data and a set of extension structures for</span>
<a name="l00009"></a>00009 <span class="comment">   monitoring the current state of all the packages. It also generates and</span>
<a name="l00010"></a>00010 <span class="comment">   caches the &#39;install&#39; state of many things. This refers to the state of the</span>
<a name="l00011"></a>00011 <span class="comment">   package after an install has been run.</span>
<a name="l00012"></a>00012 <span class="comment"></span>
<a name="l00013"></a>00013 <span class="comment">   The StateCache::State field can be -1,0,1,2 which is &lt;,=,&gt;,no current.</span>
<a name="l00014"></a>00014 <span class="comment">   StateCache::Mode is which of the 3 fields is active.</span>
<a name="l00015"></a>00015 <span class="comment">   </span>
<a name="l00016"></a>00016 <span class="comment">   This structure is important to support the readonly status of the cache </span>
<a name="l00017"></a>00017 <span class="comment">   file. When the data is saved the cache will be refereshed from our </span>
<a name="l00018"></a>00018 <span class="comment">   internal rep and written to disk. Then the actual persistant data </span>
<a name="l00019"></a>00019 <span class="comment">   files will be put on the disk.</span>
<a name="l00020"></a>00020 <span class="comment"></span>
<a name="l00021"></a>00021 <span class="comment">   Each dependency is compared against 3 target versions to produce to</span>
<a name="l00022"></a>00022 <span class="comment">   3 dependency results.</span>
<a name="l00023"></a>00023 <span class="comment">     Now - Compared using the Currently install version</span>
<a name="l00024"></a>00024 <span class="comment">     Install - Compared using the install version (final state)</span>
<a name="l00025"></a>00025 <span class="comment">     CVer - (Candidate Verion) Compared using the Candidate Version</span>
<a name="l00026"></a>00026 <span class="comment">   The candidate and now results are used to decide wheather a package</span>
<a name="l00027"></a>00027 <span class="comment">   should be automatically installed or if it should be left alone.</span>
<a name="l00028"></a>00028 <span class="comment">   </span>
<a name="l00029"></a>00029 <span class="comment">   Remember, the Candidate Version is selected based on the distribution</span>
<a name="l00030"></a>00030 <span class="comment">   settings for the Package. The Install Version is selected based on the</span>
<a name="l00031"></a>00031 <span class="comment">   state (Delete, Keep, Install) field and can be either the Current Version</span>
<a name="l00032"></a>00032 <span class="comment">   or the Candidate version.</span>
<a name="l00033"></a>00033 <span class="comment">   </span>
<a name="l00034"></a>00034 <span class="comment">   The Candidate version is what is shown the &#39;Install Version&#39; field.</span>
<a name="l00035"></a>00035 <span class="comment">   </span>
<a name="l00036"></a>00036 <span class="comment">   ##################################################################### */</span>
<a name="l00037"></a>00037                                                                         <span class="comment">/*}}}*/</span>
<a name="l00038"></a>00038 <span class="preprocessor">#ifndef PKGLIB_DEPCACHE_H</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">#define PKGLIB_DEPCACHE_H</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;apt-pkg/configuration.h&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;<a class="code" href="pkgcache_8h.html" title="pkgCache - Structure definitions for the cache file">apt-pkg/pkgcache.h</a>&gt;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;memory&gt;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;set&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;list&gt;</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="preprocessor">#ifndef APT_8_CLEANER_HEADERS</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span><span class="preprocessor">#include &lt;apt-pkg/progress.h&gt;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;apt-pkg/error.h&gt;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#endif</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span>
<a name="l00054"></a>00054 <span class="keyword">class </span><a class="code" href="classOpProgress.html">OpProgress</a>;
<a name="l00055"></a>00055 
<a name="l00056"></a><a class="code" href="classpkgDepCache.html">00056</a> <span class="keyword">class </span><a class="code" href="classpkgDepCache.html">pkgDepCache</a> : <span class="keyword">protected</span> <a class="code" href="classpkgCache.html">pkgCache</a>::Namespace
<a name="l00057"></a>00057 {
<a name="l00058"></a>00058    <span class="keyword">public</span>:
<a name="l00059"></a>00059 
<a name="l00061"></a><a class="code" href="classpkgDepCache_1_1InRootSetFunc.html">00061</a>    <span class="keyword">class </span><a class="code" href="classpkgDepCache_1_1InRootSetFunc.html" title="An arbitrary predicate on packages.">InRootSetFunc</a>
<a name="l00062"></a>00062    {
<a name="l00063"></a>00063    <span class="keyword">public</span>:
<a name="l00064"></a>00064      <span class="keyword">virtual</span> <span class="keywordtype">bool</span> InRootSet(<span class="keyword">const</span> <a class="code" href="classpkgCache_1_1PkgIterator.html">pkgCache::PkgIterator</a> &amp;pkg) {<span class="keywordflow">return</span> <span class="keyword">false</span>;};
<a name="l00065"></a>00065      <span class="keyword">virtual</span> ~<a class="code" href="classpkgDepCache_1_1InRootSetFunc.html" title="An arbitrary predicate on packages.">InRootSetFunc</a>() {};
<a name="l00066"></a>00066    };
<a name="l00067"></a>00067 
<a name="l00068"></a>00068    <span class="keyword">private</span>:
<a name="l00085"></a>00085    <span class="keywordtype">void</span> MarkPackage(<span class="keyword">const</span> <a class="code" href="classpkgCache_1_1PkgIterator.html">pkgCache::PkgIterator</a> &amp;pkg,
<a name="l00086"></a>00086                     <span class="keyword">const</span> <a class="code" href="classpkgCache_1_1VerIterator.html">pkgCache::VerIterator</a> &amp;ver,
<a name="l00087"></a>00087                     <span class="keywordtype">bool</span> <span class="keyword">const</span> &amp;follow_recommends,
<a name="l00088"></a>00088                     <span class="keywordtype">bool</span> <span class="keyword">const</span> &amp;follow_suggests);
<a name="l00089"></a>00089 
<a name="l00103"></a>00103    <span class="keywordtype">bool</span> MarkRequired(<a class="code" href="classpkgDepCache_1_1InRootSetFunc.html" title="An arbitrary predicate on packages.">InRootSetFunc</a> &amp;rootFunc);
<a name="l00104"></a>00104 
<a name="l00114"></a>00114    <span class="keywordtype">bool</span> Sweep();
<a name="l00115"></a>00115 
<a name="l00116"></a>00116    <span class="keyword">public</span>:
<a name="l00117"></a>00117    
<a name="l00118"></a>00118    <span class="comment">// These flags are used in DepState</span>
<a name="l00119"></a>00119    <span class="keyword">enum</span> DepFlags {DepNow = (1 &lt;&lt; 0),DepInstall = (1 &lt;&lt; 1),DepCVer = (1 &lt;&lt; 2),
<a name="l00120"></a>00120                   DepGNow = (1 &lt;&lt; 3),DepGInstall = (1 &lt;&lt; 4),DepGCVer = (1 &lt;&lt; 5)};
<a name="l00121"></a>00121 
<a name="l00122"></a>00122    <span class="comment">// These flags are used in StateCache::DepState</span>
<a name="l00123"></a>00123    <span class="keyword">enum</span> DepStateFlags {DepNowPolicy = (1 &lt;&lt; 0), DepNowMin = (1 &lt;&lt; 1),
<a name="l00124"></a>00124                        DepInstPolicy = (1 &lt;&lt; 2), DepInstMin = (1 &lt;&lt; 3),
<a name="l00125"></a>00125                        DepCandPolicy = (1 &lt;&lt; 4), DepCandMin = (1 &lt;&lt; 5)};
<a name="l00126"></a>00126    
<a name="l00127"></a>00127    <span class="comment">// These flags are used in StateCache::iFlags</span>
<a name="l00128"></a>00128    <span class="keyword">enum</span> InternalFlags {AutoKept = (1 &lt;&lt; 0), Purge = (1 &lt;&lt; 1), ReInstall = (1 &lt;&lt; 2), Protected = (1 &lt;&lt; 3)};
<a name="l00129"></a>00129       
<a name="l00130"></a>00130    <span class="keyword">enum</span> VersionTypes {NowVersion, InstallVersion, CandidateVersion};
<a name="l00131"></a>00131    <span class="keyword">enum</span> ModeList {ModeDelete = 0, ModeKeep = 1, ModeInstall = 2};
<a name="l00132"></a>00132 
<a name="l00156"></a><a class="code" href="classpkgDepCache_1_1ActionGroup.html">00156</a>    <span class="keyword">class </span><a class="code" href="classpkgDepCache_1_1ActionGroup.html" title="Represents an active action group.">ActionGroup</a>
<a name="l00157"></a>00157    {
<a name="l00158"></a>00158        <a class="code" href="classpkgDepCache.html">pkgDepCache</a> &amp;cache;
<a name="l00159"></a>00159 
<a name="l00160"></a>00160        <span class="keywordtype">bool</span> released;
<a name="l00161"></a>00161 
<a name="l00163"></a>00163        <a class="code" href="classpkgDepCache_1_1ActionGroup.html" title="Represents an active action group.">ActionGroup</a>(<span class="keyword">const</span> <a class="code" href="classpkgDepCache_1_1ActionGroup.html" title="Represents an active action group.">ActionGroup</a> &amp;other);
<a name="l00164"></a>00164    <span class="keyword">public</span>:
<a name="l00173"></a>00173        <a class="code" href="classpkgDepCache_1_1ActionGroup.html" title="Represents an active action group.">ActionGroup</a>(<a class="code" href="classpkgDepCache.html">pkgDepCache</a> &amp;cache);
<a name="l00174"></a>00174 
<a name="l00179"></a>00179        <span class="keywordtype">void</span> <a class="code" href="classpkgDepCache_1_1ActionGroup.html#a23b477d0e2d399f75d585d154c346591" title="Clean up the action group before it is destroyed.">release</a>();
<a name="l00180"></a>00180 
<a name="l00186"></a>00186        <a class="code" href="classpkgDepCache_1_1ActionGroup.html#ae23e9160a48c2bc17b7d1abffd745deb" title="Destroy the action group.">~ActionGroup</a>();
<a name="l00187"></a>00187    };
<a name="l00188"></a>00188 
<a name="l00192"></a><a class="code" href="classpkgDepCache_1_1DefaultRootSetFunc.html">00192</a>    <span class="keyword">class </span><a class="code" href="classpkgDepCache_1_1DefaultRootSetFunc.html" title="Returns true for packages matching a regular expression in APT::NeverAutoRemove.">DefaultRootSetFunc</a> : <span class="keyword">public</span> <a class="code" href="classpkgDepCache_1_1InRootSetFunc.html" title="An arbitrary predicate on packages.">InRootSetFunc</a>, <span class="keyword">public</span> <a class="code" href="classConfiguration.html">Configuration</a>::MatchAgainstConfig
<a name="l00193"></a>00193    {
<a name="l00194"></a>00194    <span class="keyword">public</span>:
<a name="l00195"></a>00195      <a class="code" href="classpkgDepCache_1_1DefaultRootSetFunc.html" title="Returns true for packages matching a regular expression in APT::NeverAutoRemove.">DefaultRootSetFunc</a>() : <a class="code" href="classConfiguration_1_1MatchAgainstConfig.html" title="match a string against a configurable list of patterns">Configuration::MatchAgainstConfig</a>(<span class="stringliteral">&quot;APT::NeverAutoRemove&quot;</span>) {};
<a name="l00196"></a>00196      <span class="keyword">virtual</span> ~<a class="code" href="classpkgDepCache_1_1DefaultRootSetFunc.html" title="Returns true for packages matching a regular expression in APT::NeverAutoRemove.">DefaultRootSetFunc</a>() {};
<a name="l00197"></a>00197 
<a name="l00198"></a>00198      <span class="keywordtype">bool</span> InRootSet(<span class="keyword">const</span> <a class="code" href="classpkgCache_1_1PkgIterator.html">pkgCache::PkgIterator</a> &amp;pkg) { <span class="keywordflow">return</span> pkg.end() == <span class="keyword">false</span> &amp;&amp; <a class="code" href="classConfiguration_1_1MatchAgainstConfig.html#a6b22196d9933bb73b60e258c2a8263b3" title="Returns true for a string matching one of the patterns.">Match</a>(pkg.Name()); };
<a name="l00199"></a>00199    };
<a name="l00200"></a>00200 
<a name="l00201"></a><a class="code" href="structpkgDepCache_1_1StateCache.html">00201</a>    <span class="keyword">struct </span><a class="code" href="structpkgDepCache_1_1StateCache.html">StateCache</a>
<a name="l00202"></a>00202    {
<a name="l00203"></a>00203       <span class="comment">// Epoch stripped text versions of the two version fields</span>
<a name="l00204"></a>00204       <span class="keyword">const</span> <span class="keywordtype">char</span> *CandVersion;
<a name="l00205"></a>00205       <span class="keyword">const</span> <span class="keywordtype">char</span> *CurVersion;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207       <span class="comment">// Pointer to the candidate install version. </span>
<a name="l00208"></a>00208       Version *CandidateVer;
<a name="l00209"></a>00209 
<a name="l00210"></a>00210       <span class="comment">// Pointer to the install version.</span>
<a name="l00211"></a>00211       Version *InstallVer;
<a name="l00212"></a>00212       
<a name="l00213"></a>00213       <span class="comment">// Copy of Package::Flags</span>
<a name="l00214"></a>00214       <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> Flags;
<a name="l00215"></a>00215       <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> iFlags;           <span class="comment">// Internal flags</span>
<a name="l00216"></a>00216 
<a name="l00218"></a><a class="code" href="structpkgDepCache_1_1StateCache.html#a72d73f7024c40960ff644d3270bb482c">00218</a>       <span class="keywordtype">bool</span> <a class="code" href="structpkgDepCache_1_1StateCache.html#a72d73f7024c40960ff644d3270bb482c" title="true if this package can be reached from the root set.">Marked</a>;
<a name="l00219"></a>00219 
<a name="l00226"></a><a class="code" href="structpkgDepCache_1_1StateCache.html#a568795a48143af2663ad3dc310d3074c">00226</a>       <span class="keywordtype">bool</span> <a class="code" href="structpkgDepCache_1_1StateCache.html#a568795a48143af2663ad3dc310d3074c" title="true if this package is unused and should be removed.">Garbage</a>;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228       <span class="comment">// Various tree indicators</span>
<a name="l00229"></a>00229       <span class="keywordtype">signed</span> <span class="keywordtype">char</span> Status;              <span class="comment">// -1,0,1,2</span>
<a name="l00230"></a>00230       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> Mode;              <span class="comment">// ModeList</span>
<a name="l00231"></a>00231       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> DepState;          <span class="comment">// DepState Flags</span>
<a name="l00232"></a>00232 
<a name="l00233"></a>00233       <span class="comment">// Update of candidate version</span>
<a name="l00234"></a>00234       <span class="keyword">const</span> <span class="keywordtype">char</span> *StripEpoch(<span class="keyword">const</span> <span class="keywordtype">char</span> *Ver);
<a name="l00235"></a>00235       <span class="keywordtype">void</span> Update(<a class="code" href="classpkgCache_1_1PkgIterator.html">PkgIterator</a> Pkg,<a class="code" href="classpkgCache.html">pkgCache</a> &amp;Cache);
<a name="l00236"></a>00236       
<a name="l00237"></a>00237       <span class="comment">// Various test members for the current status of the package</span>
<a name="l00238"></a>00238       <span class="keyword">inline</span> <span class="keywordtype">bool</span> NewInstall()<span class="keyword"> const </span>{<span class="keywordflow">return</span> Status == 2 &amp;&amp; Mode == ModeInstall;};
<a name="l00239"></a>00239       <span class="keyword">inline</span> <span class="keywordtype">bool</span> Delete()<span class="keyword"> const </span>{<span class="keywordflow">return</span> Mode == ModeDelete;};
<a name="l00240"></a>00240       <span class="keyword">inline</span> <span class="keywordtype">bool</span> Purge()<span class="keyword"> const </span>{<span class="keywordflow">return</span> Delete() == <span class="keyword">true</span> &amp;&amp; (iFlags &amp; pkgDepCache::Purge) == pkgDepCache::Purge; };
<a name="l00241"></a>00241       <span class="keyword">inline</span> <span class="keywordtype">bool</span> Keep()<span class="keyword"> const </span>{<span class="keywordflow">return</span> Mode == ModeKeep;};
<a name="l00242"></a>00242       <span class="keyword">inline</span> <span class="keywordtype">bool</span> Protect()<span class="keyword"> const </span>{<span class="keywordflow">return</span> (iFlags &amp; Protected) == Protected;};
<a name="l00243"></a>00243       <span class="keyword">inline</span> <span class="keywordtype">bool</span> Upgrade()<span class="keyword"> const </span>{<span class="keywordflow">return</span> Status &gt; 0 &amp;&amp; Mode == ModeInstall;};
<a name="l00244"></a>00244       <span class="keyword">inline</span> <span class="keywordtype">bool</span> Upgradable()<span class="keyword"> const </span>{<span class="keywordflow">return</span> Status &gt;= 1;};
<a name="l00245"></a>00245       <span class="keyword">inline</span> <span class="keywordtype">bool</span> Downgrade()<span class="keyword"> const </span>{<span class="keywordflow">return</span> Status &lt; 0 &amp;&amp; Mode == ModeInstall;};
<a name="l00246"></a>00246       <span class="keyword">inline</span> <span class="keywordtype">bool</span> Held()<span class="keyword"> const </span>{<span class="keywordflow">return</span> Status != 0 &amp;&amp; Keep();};
<a name="l00247"></a>00247       <span class="keyword">inline</span> <span class="keywordtype">bool</span> NowBroken()<span class="keyword"> const </span>{<span class="keywordflow">return</span> (DepState &amp; DepNowMin) != DepNowMin;};
<a name="l00248"></a>00248       <span class="keyword">inline</span> <span class="keywordtype">bool</span> NowPolicyBroken()<span class="keyword"> const </span>{<span class="keywordflow">return</span> (DepState &amp; DepNowPolicy) != DepNowPolicy;};
<a name="l00249"></a>00249       <span class="keyword">inline</span> <span class="keywordtype">bool</span> InstBroken()<span class="keyword"> const </span>{<span class="keywordflow">return</span> (DepState &amp; DepInstMin) != DepInstMin;};
<a name="l00250"></a>00250       <span class="keyword">inline</span> <span class="keywordtype">bool</span> InstPolicyBroken()<span class="keyword"> const </span>{<span class="keywordflow">return</span> (DepState &amp; DepInstPolicy) != DepInstPolicy;};
<a name="l00251"></a>00251       <span class="keyword">inline</span> <span class="keywordtype">bool</span> Install()<span class="keyword"> const </span>{<span class="keywordflow">return</span> Mode == ModeInstall;};
<a name="l00252"></a>00252       <span class="keyword">inline</span> <span class="keywordtype">bool</span> ReInstall()<span class="keyword"> const </span>{<span class="keywordflow">return</span> Delete() == <span class="keyword">false</span> &amp;&amp; (iFlags &amp; pkgDepCache::ReInstall) == pkgDepCache::ReInstall;};
<a name="l00253"></a>00253       <span class="keyword">inline</span> VerIterator InstVerIter(<a class="code" href="classpkgCache.html">pkgCache</a> &amp;Cache)
<a name="l00254"></a>00254                 {<span class="keywordflow">return</span> VerIterator(Cache,InstallVer);};
<a name="l00255"></a>00255       <span class="keyword">inline</span> VerIterator CandidateVerIter(<a class="code" href="classpkgCache.html">pkgCache</a> &amp;Cache)
<a name="l00256"></a>00256                 {<span class="keywordflow">return</span> VerIterator(Cache,CandidateVer);};
<a name="l00257"></a>00257    };
<a name="l00258"></a>00258    
<a name="l00259"></a>00259    <span class="comment">// Helper functions</span>
<a name="l00260"></a>00260    <span class="keywordtype">void</span> BuildGroupOrs(VerIterator <span class="keyword">const</span> &amp;V);
<a name="l00261"></a>00261    <span class="keywordtype">void</span> UpdateVerState(PkgIterator Pkg);
<a name="l00262"></a>00262 
<a name="l00263"></a>00263    <span class="comment">// User Policy control</span>
<a name="l00264"></a><a class="code" href="classpkgDepCache_1_1Policy.html">00264</a>    <span class="keyword">class </span><a class="code" href="classpkgDepCache_1_1Policy.html">Policy</a>
<a name="l00265"></a>00265    {
<a name="l00266"></a>00266       <span class="keyword">public</span>:
<a name="l00267"></a>00267       <a class="code" href="classpkgDepCache_1_1Policy.html">Policy</a>() {
<a name="l00268"></a>00268          InstallRecommends = _config-&gt;FindB(<span class="stringliteral">&quot;APT::Install-Recommends&quot;</span>, <span class="keyword">false</span>);
<a name="l00269"></a>00269          InstallSuggests = _config-&gt;FindB(<span class="stringliteral">&quot;APT::Install-Suggests&quot;</span>, <span class="keyword">false</span>);
<a name="l00270"></a>00270       }
<a name="l00271"></a>00271 
<a name="l00272"></a>00272       <span class="keyword">virtual</span> <a class="code" href="classpkgCache_1_1VerIterator.html">VerIterator</a> GetCandidateVer(<a class="code" href="classpkgCache_1_1PkgIterator.html">PkgIterator</a> <span class="keyword">const</span> &amp;Pkg);
<a name="l00273"></a>00273       <span class="keyword">virtual</span> <span class="keywordtype">bool</span> IsImportantDep(<a class="code" href="classpkgCache_1_1DepIterator.html">DepIterator</a> <span class="keyword">const</span> &amp;<a class="code" href="structpkgCache_1_1Dep.html">Dep</a>);
<a name="l00274"></a>00274       <span class="keyword">virtual</span> <span class="keywordtype">signed</span> <span class="keywordtype">short</span> GetPriority(<a class="code" href="classpkgCache_1_1PkgIterator.html">PkgIterator</a> <span class="keyword">const</span> &amp;Pkg);
<a name="l00275"></a>00275       <span class="keyword">virtual</span> <span class="keywordtype">signed</span> <span class="keywordtype">short</span> GetPriority(<a class="code" href="classpkgCache_1_1PkgFileIterator.html">PkgFileIterator</a> <span class="keyword">const</span> &amp;File);
<a name="l00276"></a>00276 
<a name="l00277"></a>00277       <span class="keyword">virtual</span> ~<a class="code" href="classpkgDepCache_1_1Policy.html">Policy</a>() {};
<a name="l00278"></a>00278 
<a name="l00279"></a>00279       <span class="keyword">private</span>:
<a name="l00280"></a>00280       <span class="keywordtype">bool</span> InstallRecommends;
<a name="l00281"></a>00281       <span class="keywordtype">bool</span> InstallSuggests;
<a name="l00282"></a>00282    };
<a name="l00283"></a>00283 
<a name="l00284"></a>00284    <span class="keyword">private</span>:
<a name="l00288"></a>00288    <span class="keywordtype">int</span> group_level;
<a name="l00289"></a>00289 
<a name="l00290"></a>00290    <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classpkgDepCache_1_1ActionGroup.html" title="Represents an active action group.">ActionGroup</a>;
<a name="l00291"></a>00291      
<a name="l00292"></a>00292    <span class="keyword">protected</span>:
<a name="l00293"></a>00293 
<a name="l00294"></a>00294    <span class="comment">// State information</span>
<a name="l00295"></a>00295    <a class="code" href="classpkgCache.html">pkgCache</a> *Cache;
<a name="l00296"></a>00296    <a class="code" href="structpkgDepCache_1_1StateCache.html">StateCache</a> *PkgState;
<a name="l00297"></a>00297    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *DepState;
<a name="l00298"></a>00298 
<a name="l00300"></a><a class="code" href="classpkgDepCache.html#ab49a20f20f37cf4879e2ee750220e285">00300</a>    <span class="keywordtype">signed</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code" href="classpkgDepCache.html#ab49a20f20f37cf4879e2ee750220e285">iUsrSize</a>;
<a name="l00302"></a><a class="code" href="classpkgDepCache.html#a3d3b83546b872ad372361b470d463f45">00302</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code" href="classpkgDepCache.html#a3d3b83546b872ad372361b470d463f45">iDownloadSize</a>;
<a name="l00303"></a>00303    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> iInstCount;
<a name="l00304"></a>00304    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> iDelCount;
<a name="l00305"></a>00305    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> iKeepCount;
<a name="l00306"></a>00306    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> iBrokenCount;
<a name="l00307"></a>00307    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> iPolicyBrokenCount;
<a name="l00308"></a>00308    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> iBadCount;
<a name="l00309"></a>00309 
<a name="l00310"></a>00310    <span class="keywordtype">bool</span> DebugMarker;
<a name="l00311"></a>00311    <span class="keywordtype">bool</span> DebugAutoInstall;
<a name="l00312"></a>00312 
<a name="l00313"></a>00313    <a class="code" href="classpkgDepCache_1_1Policy.html">Policy</a> *delLocalPolicy;           <span class="comment">// For memory clean up..</span>
<a name="l00314"></a>00314    <a class="code" href="classpkgDepCache_1_1Policy.html">Policy</a> *LocalPolicy;
<a name="l00315"></a>00315    
<a name="l00316"></a>00316    <span class="comment">// Check for a matching provides</span>
<a name="l00317"></a>00317    <span class="keywordtype">bool</span> CheckDep(<a class="code" href="classpkgCache_1_1DepIterator.html">DepIterator</a> <a class="code" href="structpkgCache_1_1Dep.html">Dep</a>,<span class="keywordtype">int</span> Type,<a class="code" href="classpkgCache_1_1PkgIterator.html">PkgIterator</a> &amp;Res);
<a name="l00318"></a>00318    <span class="keyword">inline</span> <span class="keywordtype">bool</span> CheckDep(<a class="code" href="classpkgCache_1_1DepIterator.html">DepIterator</a> <a class="code" href="structpkgCache_1_1Dep.html">Dep</a>,<span class="keywordtype">int</span> Type)
<a name="l00319"></a>00319    {
<a name="l00320"></a>00320       <a class="code" href="classpkgCache_1_1PkgIterator.html">PkgIterator</a> Res(*<span class="keyword">this</span>,0);
<a name="l00321"></a>00321       <span class="keywordflow">return</span> CheckDep(Dep,Type,Res);
<a name="l00322"></a>00322    }
<a name="l00323"></a>00323    
<a name="l00324"></a>00324    <span class="comment">// Computes state information for deps and versions (w/o storing)</span>
<a name="l00325"></a>00325    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> DependencyState(DepIterator &amp;D);
<a name="l00326"></a>00326    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> VersionState(DepIterator D,<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> Check,
<a name="l00327"></a>00327                               <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SetMin,
<a name="l00328"></a>00328                               <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SetPolicy);
<a name="l00329"></a>00329 
<a name="l00330"></a>00330    <span class="comment">// Recalculates various portions of the cache, call after changing something</span>
<a name="l00331"></a>00331    <span class="keywordtype">void</span> Update(DepIterator Dep);           <span class="comment">// Mostly internal</span>
<a name="l00332"></a>00332    <span class="keywordtype">void</span> Update(PkgIterator <span class="keyword">const</span> &amp;P);
<a name="l00333"></a>00333    
<a name="l00334"></a>00334    <span class="comment">// Count manipulators</span>
<a name="l00335"></a>00335    <span class="keywordtype">void</span> AddSizes(<span class="keyword">const</span> PkgIterator &amp;Pkg, <span class="keywordtype">bool</span> <span class="keyword">const</span> Invert = <span class="keyword">false</span>);
<a name="l00336"></a>00336    <span class="keyword">inline</span> <span class="keywordtype">void</span> RemoveSizes(<span class="keyword">const</span> PkgIterator &amp;Pkg) {AddSizes(Pkg, <span class="keyword">true</span>);};
<a name="l00337"></a>00337    <span class="keywordtype">void</span> AddStates(<span class="keyword">const</span> PkgIterator &amp;Pkg, <span class="keywordtype">bool</span> <span class="keyword">const</span> Invert = <span class="keyword">false</span>);
<a name="l00338"></a>00338    <span class="keyword">inline</span> <span class="keywordtype">void</span> RemoveStates(<span class="keyword">const</span> PkgIterator &amp;Pkg) {AddStates(Pkg,<span class="keyword">true</span>);};
<a name="l00339"></a>00339    
<a name="l00340"></a>00340    <span class="keyword">public</span>:
<a name="l00341"></a>00341 
<a name="l00342"></a>00342    <span class="comment">// Legacy.. We look like a pkgCache</span>
<a name="l00343"></a>00343    <span class="keyword">inline</span> operator pkgCache &amp;() {<span class="keywordflow">return</span> *Cache;};
<a name="l00344"></a>00344    <span class="keyword">inline</span> Header &amp;Head() {<span class="keywordflow">return</span> *Cache-&gt;HeaderP;};
<a name="l00345"></a>00345    <span class="keyword">inline</span> GrpIterator GrpBegin() {<span class="keywordflow">return</span> Cache-&gt;GrpBegin();};
<a name="l00346"></a>00346    <span class="keyword">inline</span> PkgIterator PkgBegin() {<span class="keywordflow">return</span> Cache-&gt;PkgBegin();};
<a name="l00347"></a>00347    <span class="keyword">inline</span> GrpIterator FindGrp(std::string <span class="keyword">const</span> &amp;Name) {<span class="keywordflow">return</span> Cache-&gt;FindGrp(Name);};
<a name="l00348"></a>00348    <span class="keyword">inline</span> PkgIterator FindPkg(std::string <span class="keyword">const</span> &amp;Name) {<span class="keywordflow">return</span> Cache-&gt;FindPkg(Name);};
<a name="l00349"></a>00349    <span class="keyword">inline</span> PkgIterator FindPkg(std::string <span class="keyword">const</span> &amp;Name, std::string <span class="keyword">const</span> &amp;Arch) {<span class="keywordflow">return</span> Cache-&gt;FindPkg(Name, Arch);};
<a name="l00350"></a>00350 
<a name="l00351"></a>00351    <span class="keyword">inline</span> <a class="code" href="classpkgCache.html">pkgCache</a> &amp;GetCache() {<span class="keywordflow">return</span> *Cache;};
<a name="l00352"></a>00352    <span class="keyword">inline</span> <a class="code" href="classpkgVersioningSystem.html">pkgVersioningSystem</a> &amp;VS() {<span class="keywordflow">return</span> *Cache-&gt;VS;};
<a name="l00353"></a>00353    
<a name="l00354"></a>00354    <span class="comment">// Policy implementation</span>
<a name="l00355"></a>00355    <span class="keyword">inline</span> VerIterator GetCandidateVer(PkgIterator <span class="keyword">const</span> &amp;Pkg) {<span class="keywordflow">return</span> LocalPolicy-&gt;GetCandidateVer(Pkg);};
<a name="l00356"></a>00356    <span class="keyword">inline</span> <span class="keywordtype">bool</span> IsImportantDep(DepIterator Dep) {<span class="keywordflow">return</span> LocalPolicy-&gt;IsImportantDep(Dep);};
<a name="l00357"></a>00357    <span class="keyword">inline</span> Policy &amp;GetPolicy() {<span class="keywordflow">return</span> *LocalPolicy;};
<a name="l00358"></a>00358    
<a name="l00359"></a>00359    <span class="comment">// Accessors</span>
<a name="l00360"></a>00360    <span class="keyword">inline</span> StateCache &amp;operator [](PkgIterator <span class="keyword">const</span> &amp;I) {<span class="keywordflow">return</span> PkgState[I-&gt;ID];};
<a name="l00361"></a>00361    <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> &amp;operator [](DepIterator <span class="keyword">const</span> &amp;I) {<span class="keywordflow">return</span> DepState[I-&gt;ID];};
<a name="l00362"></a>00362 
<a name="l00371"></a>00371    <span class="keyword">virtual</span> InRootSetFunc *<a class="code" href="classpkgDepCache.html#a1ab9378572dc74fc8088fd690d494570">GetRootSetFunc</a>();
<a name="l00372"></a>00372 
<a name="l00375"></a>00375    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classpkgDepCache.html#af3287419f765a35b0f1f25e449167718">MarkFollowsRecommends</a>();
<a name="l00376"></a>00376 
<a name="l00379"></a>00379    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classpkgDepCache.html#a9890f74f3e35a54ac7d4f3b5ab00aeb2">MarkFollowsSuggests</a>();
<a name="l00380"></a>00380 
<a name="l00390"></a><a class="code" href="classpkgDepCache.html#ac23028ed7e8f73b492717b077b3b52e8">00390</a>    <span class="keywordtype">bool</span> <a class="code" href="classpkgDepCache.html#ac23028ed7e8f73b492717b077b3b52e8" title="Update the Marked and Garbage fields of all packages.">MarkAndSweep</a>(<a class="code" href="classpkgDepCache_1_1InRootSetFunc.html" title="An arbitrary predicate on packages.">InRootSetFunc</a> &amp;rootFunc)
<a name="l00391"></a>00391    {
<a name="l00392"></a>00392      <span class="keywordflow">return</span> MarkRequired(rootFunc) &amp;&amp; Sweep();
<a name="l00393"></a>00393    }
<a name="l00394"></a>00394 
<a name="l00395"></a>00395    <span class="keywordtype">bool</span> MarkAndSweep()
<a name="l00396"></a>00396    {
<a name="l00397"></a>00397      std::auto_ptr&lt;InRootSetFunc&gt; f(<a class="code" href="classpkgDepCache.html#a1ab9378572dc74fc8088fd690d494570">GetRootSetFunc</a>());
<a name="l00398"></a>00398      <span class="keywordflow">if</span>(f.get() != NULL)
<a name="l00399"></a>00399        <span class="keywordflow">return</span> MarkAndSweep(*f.get());
<a name="l00400"></a>00400      <span class="keywordflow">else</span>
<a name="l00401"></a>00401        <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00402"></a>00402    }
<a name="l00403"></a>00403 
<a name="l00406"></a>00406    <span class="comment">// @{</span>
<a name="l00407"></a>00407    <span class="keywordtype">bool</span> MarkKeep(PkgIterator <span class="keyword">const</span> &amp;Pkg, <span class="keywordtype">bool</span> Soft = <span class="keyword">false</span>,
<a name="l00408"></a>00408                  <span class="keywordtype">bool</span> FromUser = <span class="keyword">true</span>, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> Depth = 0);
<a name="l00409"></a>00409    <span class="keywordtype">bool</span> MarkDelete(PkgIterator <span class="keyword">const</span> &amp;Pkg, <span class="keywordtype">bool</span> MarkPurge = <span class="keyword">false</span>,
<a name="l00410"></a>00410                    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> Depth = 0, <span class="keywordtype">bool</span> FromUser = <span class="keyword">true</span>);
<a name="l00411"></a>00411    <span class="keywordtype">bool</span> MarkInstall(PkgIterator <span class="keyword">const</span> &amp;Pkg,<span class="keywordtype">bool</span> AutoInst = <span class="keyword">true</span>,
<a name="l00412"></a>00412                     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> Depth = 0, <span class="keywordtype">bool</span> FromUser = <span class="keyword">true</span>,
<a name="l00413"></a>00413                     <span class="keywordtype">bool</span> ForceImportantDeps = <span class="keyword">false</span>);
<a name="l00414"></a>00414    <span class="keywordtype">void</span> MarkProtected(PkgIterator <span class="keyword">const</span> &amp;Pkg) { PkgState[Pkg-&gt;ID].iFlags |= Protected; };
<a name="l00415"></a>00415 
<a name="l00416"></a>00416    <span class="keywordtype">void</span> SetReInstall(PkgIterator <span class="keyword">const</span> &amp;Pkg,<span class="keywordtype">bool</span> To);
<a name="l00417"></a>00417    <span class="keywordtype">void</span> SetCandidateVersion(VerIterator TargetVer);
<a name="l00418"></a>00418    <span class="keywordtype">bool</span> SetCandidateRelease(<a class="code" href="classpkgCache_1_1VerIterator.html">pkgCache::VerIterator</a> TargetVer,
<a name="l00419"></a>00419                                 std::string <span class="keyword">const</span> &amp;TargetRel);
<a name="l00434"></a>00434    <span class="keywordtype">bool</span> SetCandidateRelease(<a class="code" href="classpkgCache_1_1VerIterator.html">pkgCache::VerIterator</a> TargetVer,
<a name="l00435"></a>00435                             std::string <span class="keyword">const</span> &amp;TargetRel,
<a name="l00436"></a>00436                             std::list&lt;std::pair&lt;pkgCache::VerIterator, pkgCache::VerIterator&gt; &gt; &amp;Changed);
<a name="l00437"></a>00437 
<a name="l00439"></a>00439    <span class="keywordtype">void</span> <a class="code" href="classpkgDepCache.html#a88a05f968ff34a58f71a896ad15dea4d">MarkAuto</a>(<span class="keyword">const</span> PkgIterator &amp;Pkg, <span class="keywordtype">bool</span> Auto);
<a name="l00440"></a>00440    <span class="comment">// @}</span>
<a name="l00441"></a>00441 
<a name="l00458"></a>00458    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classpkgDepCache.html#a5fdeb68216c5ff24d05181afa44e9e4b">IsInstallOk</a>(<span class="keyword">const</span> PkgIterator &amp;Pkg,<span class="keywordtype">bool</span> AutoInst = <span class="keyword">true</span>,
<a name="l00459"></a>00459                             <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> Depth = 0, <span class="keywordtype">bool</span> FromUser = <span class="keyword">true</span>);
<a name="l00460"></a>00460 
<a name="l00477"></a>00477    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classpkgDepCache.html#a9889a8e869ac184b4366c8bfb1846225">IsDeleteOk</a>(<span class="keyword">const</span> PkgIterator &amp;Pkg,<span class="keywordtype">bool</span> MarkPurge = <span class="keyword">false</span>,
<a name="l00478"></a>00478                             <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> Depth = 0, <span class="keywordtype">bool</span> FromUser = <span class="keyword">true</span>);
<a name="l00479"></a>00479 
<a name="l00480"></a>00480    <span class="comment">// read persistent states</span>
<a name="l00481"></a>00481    <span class="keywordtype">bool</span> readStateFile(<a class="code" href="classOpProgress.html">OpProgress</a> *prog);
<a name="l00482"></a>00482    <span class="keywordtype">bool</span> writeStateFile(<a class="code" href="classOpProgress.html">OpProgress</a> *prog, <span class="keywordtype">bool</span> InstalledOnly=<span class="keyword">true</span>);
<a name="l00483"></a>00483    
<a name="l00484"></a>00484    <span class="comment">// Size queries</span>
<a name="l00485"></a>00485    <span class="keyword">inline</span> <span class="keywordtype">signed</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> UsrSize() {<span class="keywordflow">return</span> <a class="code" href="classpkgDepCache.html#ab49a20f20f37cf4879e2ee750220e285">iUsrSize</a>;};
<a name="l00486"></a>00486    <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> DebSize() {<span class="keywordflow">return</span> <a class="code" href="classpkgDepCache.html#a3d3b83546b872ad372361b470d463f45">iDownloadSize</a>;};
<a name="l00487"></a>00487    <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> DelCount() {<span class="keywordflow">return</span> iDelCount;};
<a name="l00488"></a>00488    <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> KeepCount() {<span class="keywordflow">return</span> iKeepCount;};
<a name="l00489"></a>00489    <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> InstCount() {<span class="keywordflow">return</span> iInstCount;};
<a name="l00490"></a>00490    <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> BrokenCount() {<span class="keywordflow">return</span> iBrokenCount;};
<a name="l00491"></a>00491    <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> PolicyBrokenCount() {<span class="keywordflow">return</span> iPolicyBrokenCount;};
<a name="l00492"></a>00492    <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> BadCount() {<span class="keywordflow">return</span> iBadCount;};
<a name="l00493"></a>00493 
<a name="l00494"></a>00494    <span class="keywordtype">bool</span> Init(<a class="code" href="classOpProgress.html">OpProgress</a> *Prog);
<a name="l00495"></a>00495    <span class="comment">// Generate all state information</span>
<a name="l00496"></a>00496    <span class="keywordtype">void</span> Update(<a class="code" href="classOpProgress.html">OpProgress</a> *Prog = 0);
<a name="l00497"></a>00497 
<a name="l00498"></a>00498    <a class="code" href="classpkgDepCache.html">pkgDepCache</a>(<a class="code" href="classpkgCache.html">pkgCache</a> *Cache,Policy *Plcy = 0);
<a name="l00499"></a>00499    <span class="keyword">virtual</span> ~<a class="code" href="classpkgDepCache.html">pkgDepCache</a>();
<a name="l00500"></a>00500 
<a name="l00501"></a>00501    <span class="keyword">private</span>:
<a name="l00502"></a>00502    <span class="keywordtype">bool</span> IsModeChangeOk(ModeList <span class="keyword">const</span> mode, PkgIterator <span class="keyword">const</span> &amp;Pkg,
<a name="l00503"></a>00503                         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keyword">const</span> Depth, <span class="keywordtype">bool</span> <span class="keyword">const</span> FromUser);
<a name="l00504"></a>00504 };
<a name="l00505"></a>00505 
<a name="l00506"></a>00506 <span class="preprocessor">#endif</span>
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Wed Mar 26 2014 10:05:25 for apt by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
